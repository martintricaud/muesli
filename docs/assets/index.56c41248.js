var Zf=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports);var Jf=Zf((exports,module)=>{(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))o(u);new MutationObserver(u=>{for(const c of u)if(c.type==="childList")for(const b of c.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&o(b)}).observe(document,{childList:!0,subtree:!0});function s(u){const c={};return u.integrity&&(c.integrity=u.integrity),u.referrerpolicy&&(c.referrerPolicy=u.referrerpolicy),u.crossorigin==="use-credentials"?c.credentials="include":u.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(u){if(u.ep)return;u.ep=!0;const c=s(u);fetch(u.href,c)}})();let wasm;const cachedTextDecoder=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});cachedTextDecoder.decode();let cachedUint8Memory0=new Uint8Array;function getUint8Memory0(){return cachedUint8Memory0.byteLength===0&&(cachedUint8Memory0=new Uint8Array(wasm.memory.buffer)),cachedUint8Memory0}function getStringFromWasm0(r,n){return cachedTextDecoder.decode(getUint8Memory0().subarray(r,r+n))}let WASM_VECTOR_LEN=0;const cachedTextEncoder=new TextEncoder("utf-8"),encodeString=typeof cachedTextEncoder.encodeInto=="function"?function(r,n){return cachedTextEncoder.encodeInto(r,n)}:function(r,n){const s=cachedTextEncoder.encode(r);return n.set(s),{read:r.length,written:s.length}};function passStringToWasm0(r,n,s){if(s===void 0){const A=cachedTextEncoder.encode(r),D=n(A.length);return getUint8Memory0().subarray(D,D+A.length).set(A),WASM_VECTOR_LEN=A.length,D}let o=r.length,u=n(o);const c=getUint8Memory0();let b=0;for(;b<o;b++){const A=r.charCodeAt(b);if(A>127)break;c[u+b]=A}if(b!==o){b!==0&&(r=r.slice(b)),u=s(u,o,o=b+r.length*3);const A=getUint8Memory0().subarray(u+b,u+o);b+=encodeString(r,A).written}return WASM_VECTOR_LEN=b,u}let cachedInt32Memory0=new Int32Array;function getInt32Memory0(){return cachedInt32Memory0.byteLength===0&&(cachedInt32Memory0=new Int32Array(wasm.memory.buffer)),cachedInt32Memory0}let cachedUint32Memory0=new Uint32Array;function getUint32Memory0(){return cachedUint32Memory0.byteLength===0&&(cachedUint32Memory0=new Uint32Array(wasm.memory.buffer)),cachedUint32Memory0}function getArrayU32FromWasm0(r,n){return getUint32Memory0().subarray(r/4,r/4+n)}function hilbert_axes_wasm_from_str(r,n,s){try{const b=wasm.__wbindgen_add_to_stack_pointer(-16),A=passStringToWasm0(r,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),D=WASM_VECTOR_LEN;wasm.hilbert_axes_wasm_from_str(b,A,D,n,s);var o=getInt32Memory0()[b/4+0],u=getInt32Memory0()[b/4+1],c=getArrayU32FromWasm0(o,u).slice();return wasm.__wbindgen_free(o,u*4),c}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}function passArray32ToWasm0(r,n){const s=n(r.length*4);return getUint32Memory0().set(r,s/4),WASM_VECTOR_LEN=r.length,s}function hilbert_index_wasm_to_str(r,n){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16),c=passArray32ToWasm0(r,wasm.__wbindgen_malloc),b=WASM_VECTOR_LEN;wasm.hilbert_index_wasm_to_str(u,c,b,n);var s=getInt32Memory0()[u/4+0],o=getInt32Memory0()[u/4+1];return getStringFromWasm0(s,o)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_free(s,o)}}function rescale_hilbert_from_str(r,n,s){const o=passStringToWasm0(r,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),u=WASM_VECTOR_LEN;return wasm.rescale_hilbert_from_str(o,u,n,s)}async function load(r,n){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,n)}catch(o){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const s=await r.arrayBuffer();return await WebAssembly.instantiate(s,n)}else{const s=await WebAssembly.instantiate(r,n);return s instanceof WebAssembly.Instance?{instance:s,module:r}:s}}function getImports(){const r={};return r.wbg={},r.wbg.__wbindgen_throw=function(n,s){throw new Error(getStringFromWasm0(n,s))},r}function finalizeInit(r,n){return wasm=r.exports,init$1.__wbindgen_wasm_module=n,cachedInt32Memory0=new Int32Array,cachedUint32Memory0=new Uint32Array,cachedUint8Memory0=new Uint8Array,wasm}async function init$1(r){typeof r>"u"&&(r=new URL("/muesli/assets/hilbert_bg.2059dff0.wasm",self.location));const n=getImports();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:s,module:o}=await load(await r,n);return finalizeInit(s,o)}const app="";function noop(){}function run(r){return r()}function blank_object(){return Object.create(null)}function run_all(r){r.forEach(run)}function is_function(r){return typeof r=="function"}function safe_not_equal(r,n){return r!=r?n==n:r!==n||r&&typeof r=="object"||typeof r=="function"}function is_empty(r){return Object.keys(r).length===0}function subscribe(r,...n){if(r==null)return noop;const s=r.subscribe(...n);return s.unsubscribe?()=>s.unsubscribe():s}function component_subscribe(r,n,s){r.$$.on_destroy.push(subscribe(n,s))}function set_store_value(r,n,s){return r.set(s),n}function append(r,n){r.appendChild(n)}function insert$2(r,n,s){r.insertBefore(n,s||null)}function detach(r){r.parentNode.removeChild(r)}function destroy_each(r,n){for(let s=0;s<r.length;s+=1)r[s]&&r[s].d(n)}function element(r){return document.createElement(r)}function svg_element(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function text(r){return document.createTextNode(r)}function space(){return text(" ")}function empty$2(){return text("")}function listen(r,n,s,o){return r.addEventListener(n,s,o),()=>r.removeEventListener(n,s,o)}function attr(r,n,s){s==null?r.removeAttribute(n):r.getAttribute(n)!==s&&r.setAttribute(n,s)}function children(r){return Array.from(r.childNodes)}function set_data(r,n){n=""+n,r.wholeText!==n&&(r.data=n)}function set_style(r,n,s,o){s===null?r.style.removeProperty(n):r.style.setProperty(n,s,o?"important":"")}function select_option(r,n){for(let s=0;s<r.options.length;s+=1){const o=r.options[s];if(o.__value===n){o.selected=!0;return}}r.selectedIndex=-1}function select_value(r){const n=r.querySelector(":checked")||r.options[0];return n&&n.__value}let crossorigin;function is_crossorigin(){if(crossorigin===void 0){crossorigin=!1;try{typeof window<"u"&&window.parent&&window.parent.document}catch{crossorigin=!0}}return crossorigin}function add_resize_listener(r,n){getComputedStyle(r).position==="static"&&(r.style.position="relative");const o=element("iframe");o.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),o.setAttribute("aria-hidden","true"),o.tabIndex=-1;const u=is_crossorigin();let c;return u?(o.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",c=listen(window,"message",b=>{b.source===o.contentWindow&&n()})):(o.src="about:blank",o.onload=()=>{c=listen(o.contentWindow,"resize",n)}),append(r,o),()=>{(u||c&&o.contentWindow)&&c(),detach(o)}}function toggle_class(r,n,s){r.classList[s?"add":"remove"](n)}function custom_event(r,n,{bubbles:s=!1,cancelable:o=!1}={}){const u=document.createEvent("CustomEvent");return u.initCustomEvent(r,s,o,n),u}let current_component;function set_current_component(r){current_component=r}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function onMount(r){get_current_component().$$.on_mount.push(r)}function afterUpdate(r){get_current_component().$$.after_update.push(r)}function createEventDispatcher(){const r=get_current_component();return(n,s,{cancelable:o=!1}={})=>{const u=r.$$.callbacks[n];if(u){const c=custom_event(n,s,{cancelable:o});return u.slice().forEach(b=>{b.call(r,c)}),!c.defaultPrevented}return!0}}const dirty_components=[],binding_callbacks=[],render_callbacks=[],flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function add_render_callback(r){render_callbacks.push(r)}const seen_callbacks=new Set;let flushidx=0;function flush(){const r=current_component;do{for(;flushidx<dirty_components.length;){const n=dirty_components[flushidx];flushidx++,set_current_component(n),update(n.$$)}for(set_current_component(null),dirty_components.length=0,flushidx=0;binding_callbacks.length;)binding_callbacks.pop()();for(let n=0;n<render_callbacks.length;n+=1){const s=render_callbacks[n];seen_callbacks.has(s)||(seen_callbacks.add(s),s())}render_callbacks.length=0}while(dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,seen_callbacks.clear(),set_current_component(r)}function update(r){if(r.fragment!==null){r.update(),run_all(r.before_update);const n=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,n),r.after_update.forEach(add_render_callback)}}const outroing=new Set;let outros;function group_outros(){outros={r:0,c:[],p:outros}}function check_outros(){outros.r||run_all(outros.c),outros=outros.p}function transition_in(r,n){r&&r.i&&(outroing.delete(r),r.i(n))}function transition_out(r,n,s,o){if(r&&r.o){if(outroing.has(r))return;outroing.add(r),outros.c.push(()=>{outroing.delete(r),o&&(s&&r.d(1),o())}),r.o(n)}else o&&o()}function create_component(r){r&&r.c()}function mount_component(r,n,s,o){const{fragment:u,on_mount:c,on_destroy:b,after_update:A}=r.$$;u&&u.m(n,s),o||add_render_callback(()=>{const D=c.map(run).filter(is_function);b?b.push(...D):run_all(D),r.$$.on_mount=[]}),A.forEach(add_render_callback)}function destroy_component(r,n){const s=r.$$;s.fragment!==null&&(run_all(s.on_destroy),s.fragment&&s.fragment.d(n),s.on_destroy=s.fragment=null,s.ctx=[])}function make_dirty(r,n){r.$$.dirty[0]===-1&&(dirty_components.push(r),schedule_update(),r.$$.dirty.fill(0)),r.$$.dirty[n/31|0]|=1<<n%31}function init(r,n,s,o,u,c,b,A=[-1]){const D=current_component;set_current_component(r);const V=r.$$={fragment:null,ctx:null,props:c,update:noop,not_equal:u,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(D?D.$$.context:[])),callbacks:blank_object(),dirty:A,skip_bound:!1,root:n.target||D.$$.root};b&&b(V.root);let Ae=!1;if(V.ctx=s?s(r,n.props||{},(Le,Ee,...xe)=>{const Pe=xe.length?xe[0]:Ee;return V.ctx&&u(V.ctx[Le],V.ctx[Le]=Pe)&&(!V.skip_bound&&V.bound[Le]&&V.bound[Le](Pe),Ae&&make_dirty(r,Le)),Ee}):[],V.update(),Ae=!0,run_all(V.before_update),V.fragment=o?o(V.ctx):!1,n.target){if(n.hydrate){const Le=children(n.target);V.fragment&&V.fragment.l(Le),Le.forEach(detach)}else V.fragment&&V.fragment.c();n.intro&&transition_in(r.$$.fragment),mount_component(r,n.target,n.anchor,n.customElement),flush()}set_current_component(D)}class SvelteComponent{$destroy(){destroy_component(this,1),this.$destroy=noop}$on(n,s){const o=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return o.push(s),()=>{const u=o.indexOf(s);u!==-1&&o.splice(u,1)}}$set(n){this.$$set&&!is_empty(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}}const subscriber_queue=[];function readable(r,n){return{subscribe:writable(r,n).subscribe}}function writable(r,n=noop){let s;const o=new Set;function u(A){if(safe_not_equal(r,A)&&(r=A,s)){const D=!subscriber_queue.length;for(const V of o)V[1](),subscriber_queue.push(V,r);if(D){for(let V=0;V<subscriber_queue.length;V+=2)subscriber_queue[V][0](subscriber_queue[V+1]);subscriber_queue.length=0}}}function c(A){u(A(r))}function b(A,D=noop){const V=[A,D];return o.add(V),o.size===1&&(s=n(u)||noop),A(r),()=>{o.delete(V),o.size===0&&(s(),s=null)}}return{set:u,update:c,subscribe:b}}function derived(r,n,s){const o=!Array.isArray(r),u=o?[r]:r,c=n.length<2;return readable(s,b=>{let A=!1;const D=[];let V=0,Ae=noop;const Le=()=>{if(V)return;Ae();const xe=n(o?D[0]:D,b);c?b(xe):Ae=is_function(xe)?xe:noop},Ee=u.map((xe,Pe)=>subscribe(xe,Ne=>{D[Pe]=Ne,V&=~(1<<Pe),A&&Le()},()=>{V|=1<<Pe}));return A=!0,Le(),function(){run_all(Ee),Ae()}})}var F=function(){return!1};const F$1=F;var T=function(){return!0};const T$1=T,__={"@@functional/placeholder":!0};function _isPlaceholder(r){return r!=null&&typeof r=="object"&&r["@@functional/placeholder"]===!0}function _curry1(r){return function n(s){return arguments.length===0||_isPlaceholder(s)?n:r.apply(this,arguments)}}function _curry2(r){return function n(s,o){switch(arguments.length){case 0:return n;case 1:return _isPlaceholder(s)?n:_curry1(function(u){return r(s,u)});default:return _isPlaceholder(s)&&_isPlaceholder(o)?n:_isPlaceholder(s)?_curry1(function(u){return r(u,o)}):_isPlaceholder(o)?_curry1(function(u){return r(s,u)}):r(s,o)}}}function _arity(r,n){switch(r){case 0:return function(){return n.apply(this,arguments)};case 1:return function(s){return n.apply(this,arguments)};case 2:return function(s,o){return n.apply(this,arguments)};case 3:return function(s,o,u){return n.apply(this,arguments)};case 4:return function(s,o,u,c){return n.apply(this,arguments)};case 5:return function(s,o,u,c,b){return n.apply(this,arguments)};case 6:return function(s,o,u,c,b,A){return n.apply(this,arguments)};case 7:return function(s,o,u,c,b,A,D){return n.apply(this,arguments)};case 8:return function(s,o,u,c,b,A,D,V){return n.apply(this,arguments)};case 9:return function(s,o,u,c,b,A,D,V,Ae){return n.apply(this,arguments)};case 10:return function(s,o,u,c,b,A,D,V,Ae,Le){return n.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function _curryN(r,n,s){return function(){for(var o=[],u=0,c=r,b=0;b<n.length||u<arguments.length;){var A;b<n.length&&(!_isPlaceholder(n[b])||u>=arguments.length)?A=n[b]:(A=arguments[u],u+=1),o[b]=A,_isPlaceholder(A)||(c-=1),b+=1}return c<=0?s.apply(this,o):_arity(c,_curryN(r,o,s))}}var curryN=_curry2(function(n,s){return n===1?_curry1(s):_arity(n,_curryN(n,[],s))});const curryN$1=curryN;function _curry3(r){return function n(s,o,u){switch(arguments.length){case 0:return n;case 1:return _isPlaceholder(s)?n:_curry2(function(c,b){return r(s,c,b)});case 2:return _isPlaceholder(s)&&_isPlaceholder(o)?n:_isPlaceholder(s)?_curry2(function(c,b){return r(c,o,b)}):_isPlaceholder(o)?_curry2(function(c,b){return r(s,c,b)}):_curry1(function(c){return r(s,o,c)});default:return _isPlaceholder(s)&&_isPlaceholder(o)&&_isPlaceholder(u)?n:_isPlaceholder(s)&&_isPlaceholder(o)?_curry2(function(c,b){return r(c,b,u)}):_isPlaceholder(s)&&_isPlaceholder(u)?_curry2(function(c,b){return r(c,o,b)}):_isPlaceholder(o)&&_isPlaceholder(u)?_curry2(function(c,b){return r(s,c,b)}):_isPlaceholder(s)?_curry1(function(c){return r(c,o,u)}):_isPlaceholder(o)?_curry1(function(c){return r(s,c,u)}):_isPlaceholder(u)?_curry1(function(c){return r(s,o,c)}):r(s,o,u)}}}const _isArray=Array.isArray||function(n){return n!=null&&n.length>=0&&Object.prototype.toString.call(n)==="[object Array]"};function _isTransformer(r){return r!=null&&typeof r["@@transducer/step"]=="function"}function _dispatchable(r,n,s){return function(){if(arguments.length===0)return s();var o=arguments[arguments.length-1];if(!_isArray(o)){for(var u=0;u<r.length;){if(typeof o[r[u]]=="function")return o[r[u]].apply(o,Array.prototype.slice.call(arguments,0,-1));u+=1}if(_isTransformer(o)){var c=n.apply(null,Array.prototype.slice.call(arguments,0,-1));return c(o)}}return s.apply(this,arguments)}}function _reduced(r){return r&&r["@@transducer/reduced"]?r:{"@@transducer/value":r,"@@transducer/reduced":!0}}const _xfBase={init:function(){return this.xf["@@transducer/init"]()},result:function(r){return this.xf["@@transducer/result"](r)}};var max=_curry2(function(n,s){return s>n?s:n});const max$1=max;function _map(r,n){for(var s=0,o=n.length,u=Array(o);s<o;)u[s]=r(n[s]),s+=1;return u}function _isString(r){return Object.prototype.toString.call(r)==="[object String]"}var _isArrayLike=_curry1(function(n){return _isArray(n)?!0:!n||typeof n!="object"||_isString(n)?!1:n.length===0?!0:n.length>0?n.hasOwnProperty(0)&&n.hasOwnProperty(n.length-1):!1});const _isArrayLike$1=_isArrayLike;var XWrap=function(){function r(n){this.f=n}return r.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},r.prototype["@@transducer/result"]=function(n){return n},r.prototype["@@transducer/step"]=function(n,s){return this.f(n,s)},r}();function _xwrap(r){return new XWrap(r)}var bind=_curry2(function(n,s){return _arity(n.length,function(){return n.apply(s,arguments)})});const bind$1=bind;function _arrayReduce(r,n,s){for(var o=0,u=s.length;o<u;){if(n=r["@@transducer/step"](n,s[o]),n&&n["@@transducer/reduced"]){n=n["@@transducer/value"];break}o+=1}return r["@@transducer/result"](n)}function _iterableReduce(r,n,s){for(var o=s.next();!o.done;){if(n=r["@@transducer/step"](n,o.value),n&&n["@@transducer/reduced"]){n=n["@@transducer/value"];break}o=s.next()}return r["@@transducer/result"](n)}function _methodReduce(r,n,s,o){return r["@@transducer/result"](s[o](bind$1(r["@@transducer/step"],r),n))}var symIterator=typeof Symbol<"u"?Symbol.iterator:"@@iterator";function _reduce(r,n,s){if(typeof r=="function"&&(r=_xwrap(r)),_isArrayLike$1(s))return _arrayReduce(r,n,s);if(typeof s["fantasy-land/reduce"]=="function")return _methodReduce(r,n,s,"fantasy-land/reduce");if(s[symIterator]!=null)return _iterableReduce(r,n,s[symIterator]());if(typeof s.next=="function")return _iterableReduce(r,n,s);if(typeof s.reduce=="function")return _methodReduce(r,n,s,"reduce");throw new TypeError("reduce: list must be array or iterable")}var XMap=function(){function r(n,s){this.xf=s,this.f=n}return r.prototype["@@transducer/init"]=_xfBase.init,r.prototype["@@transducer/result"]=_xfBase.result,r.prototype["@@transducer/step"]=function(n,s){return this.xf["@@transducer/step"](n,this.f(s))},r}(),_xmap=_curry2(function(n,s){return new XMap(n,s)});const _xmap$1=_xmap;function _has(r,n){return Object.prototype.hasOwnProperty.call(n,r)}var toString$2=Object.prototype.toString,_isArguments=function(){return toString$2.call(arguments)==="[object Arguments]"?function(n){return toString$2.call(n)==="[object Arguments]"}:function(n){return _has("callee",n)}}();const _isArguments$1=_isArguments;var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],hasArgsEnumBug=function(){return arguments.propertyIsEnumerable("length")}(),contains$2=function(n,s){for(var o=0;o<n.length;){if(n[o]===s)return!0;o+=1}return!1},keys=_curry1(typeof Object.keys=="function"&&!hasArgsEnumBug?function(n){return Object(n)!==n?[]:Object.keys(n)}:function(n){if(Object(n)!==n)return[];var s,o,u=[],c=hasArgsEnumBug&&_isArguments$1(n);for(s in n)_has(s,n)&&(!c||s!=="length")&&(u[u.length]=s);if(hasEnumBug)for(o=nonEnumerableProps.length-1;o>=0;)s=nonEnumerableProps[o],_has(s,n)&&!contains$2(u,s)&&(u[u.length]=s),o-=1;return u});const keys$1=keys;var map$2=_curry2(_dispatchable(["fantasy-land/map","map"],_xmap$1,function(n,s){switch(Object.prototype.toString.call(s)){case"[object Function]":return curryN$1(s.length,function(){return n.call(this,s.apply(this,arguments))});case"[object Object]":return _reduce(function(o,u){return o[u]=n(s[u]),o},{},keys$1(s));default:return _map(n,s)}}));const map$3=map$2,_isInteger=Number.isInteger||function(n){return n<<0===n};var nth=_curry2(function(n,s){var o=n<0?s.length+n:n;return _isString(s)?s.charAt(o):s[o]});const nth$1=nth;var prop=_curry2(function(n,s){if(s!=null)return _isInteger(n)?nth$1(n,s):s[n]});const prop$1=prop;var pluck=_curry2(function(n,s){return map$3(prop$1(n),s)});const pluck$1=pluck;var reduce=_curry3(_reduce);const reduce$1=reduce;var allPass=_curry1(function(n){return curryN$1(reduce$1(max$1,0,pluck$1("length",n)),function(){for(var s=0,o=n.length;s<o;){if(!n[s].apply(this,arguments))return!1;s+=1}return!0})});const allPass$1=allPass;var always=_curry1(function(n){return function(){return n}});const always$1=always;function _assoc(r,n,s){if(_isInteger(r)&&_isArray(s)){var o=[].concat(s);return o[r]=n,o}var u={};for(var c in s)u[c]=s[c];return u[r]=n,u}var isNil=_curry1(function(n){return n==null});const isNil$1=isNil;var assocPath=_curry3(function r(n,s,o){if(n.length===0)return s;var u=n[0];if(n.length>1){var c=!isNil$1(o)&&_has(u,o)?o[u]:_isInteger(n[1])?[]:{};s=r(Array.prototype.slice.call(n,1),s,c)}return _assoc(u,s,o)});const assocPath$1=assocPath;var assoc=_curry3(function(n,s,o){return assocPath$1([n],s,o)});const assoc$1=assoc;function _isFunction(r){var n=Object.prototype.toString.call(r);return n==="[object Function]"||n==="[object AsyncFunction]"||n==="[object GeneratorFunction]"||n==="[object AsyncGeneratorFunction]"}var clamp=_curry3(function(n,s,o){if(n>s)throw new Error("min must not be greater than max in clamp(min, max, value)");return o<n?n:o>s?s:o});const clamp$1=clamp;function _cloneRegExp(r){return new RegExp(r.source,(r.global?"g":"")+(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.sticky?"y":"")+(r.unicode?"u":""))}var type=_curry1(function(n){return n===null?"Null":n===void 0?"Undefined":Object.prototype.toString.call(n).slice(8,-1)});const type$1=type;function _clone(r,n,s,o){var u=function(b){for(var A=n.length,D=0;D<A;){if(r===n[D])return s[D];D+=1}n[D]=r,s[D]=b;for(var V in r)r.hasOwnProperty(V)&&(b[V]=o?_clone(r[V],n,s,!0):r[V]);return b};switch(type$1(r)){case"Object":return u(Object.create(Object.getPrototypeOf(r)));case"Array":return u([]);case"Date":return new Date(r.valueOf());case"RegExp":return _cloneRegExp(r);case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":return r.slice();default:return r}}var not=_curry1(function(n){return!n});const not$1=not;function _pipe(r,n){return function(){return n.call(this,r.apply(this,arguments))}}function _checkForMethod(r,n){return function(){var s=arguments.length;if(s===0)return n();var o=arguments[s-1];return _isArray(o)||typeof o[r]!="function"?n.apply(this,arguments):o[r].apply(o,Array.prototype.slice.call(arguments,0,s-1))}}var slice=_curry3(_checkForMethod("slice",function(n,s,o){return Array.prototype.slice.call(o,n,s)}));const slice$1=slice;var tail=_curry1(_checkForMethod("tail",slice$1(1,1/0)));const tail$1=tail;function pipe(){if(arguments.length===0)throw new Error("pipe requires at least one argument");return _arity(arguments[0].length,reduce$1(_pipe,arguments[0],tail$1(arguments)))}function _identity(r){return r}var identity=_curry1(_identity);const identity$1=identity;function _arrayFromIterator(r){for(var n=[],s;!(s=r.next()).done;)n.push(s.value);return n}function _includesWith(r,n,s){for(var o=0,u=s.length;o<u;){if(r(n,s[o]))return!0;o+=1}return!1}function _functionName(r){var n=String(r).match(/^function (\w*)/);return n==null?"":n[1]}function _objectIs(r,n){return r===n?r!==0||1/r===1/n:r!==r&&n!==n}const _objectIs$1=typeof Object.is=="function"?Object.is:_objectIs;function _uniqContentEquals(r,n,s,o){var u=_arrayFromIterator(r),c=_arrayFromIterator(n);function b(A,D){return _equals(A,D,s.slice(),o.slice())}return!_includesWith(function(A,D){return!_includesWith(b,D,A)},c,u)}function _equals(r,n,s,o){if(_objectIs$1(r,n))return!0;var u=type$1(r);if(u!==type$1(n))return!1;if(typeof r["fantasy-land/equals"]=="function"||typeof n["fantasy-land/equals"]=="function")return typeof r["fantasy-land/equals"]=="function"&&r["fantasy-land/equals"](n)&&typeof n["fantasy-land/equals"]=="function"&&n["fantasy-land/equals"](r);if(typeof r.equals=="function"||typeof n.equals=="function")return typeof r.equals=="function"&&r.equals(n)&&typeof n.equals=="function"&&n.equals(r);switch(u){case"Arguments":case"Array":case"Object":if(typeof r.constructor=="function"&&_functionName(r.constructor)==="Promise")return r===n;break;case"Boolean":case"Number":case"String":if(!(typeof r==typeof n&&_objectIs$1(r.valueOf(),n.valueOf())))return!1;break;case"Date":if(!_objectIs$1(r.valueOf(),n.valueOf()))return!1;break;case"Error":return r.name===n.name&&r.message===n.message;case"RegExp":if(!(r.source===n.source&&r.global===n.global&&r.ignoreCase===n.ignoreCase&&r.multiline===n.multiline&&r.sticky===n.sticky&&r.unicode===n.unicode))return!1;break}for(var c=s.length-1;c>=0;){if(s[c]===r)return o[c]===n;c-=1}switch(u){case"Map":return r.size!==n.size?!1:_uniqContentEquals(r.entries(),n.entries(),s.concat([r]),o.concat([n]));case"Set":return r.size!==n.size?!1:_uniqContentEquals(r.values(),n.values(),s.concat([r]),o.concat([n]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var b=keys$1(r);if(b.length!==keys$1(n).length)return!1;var A=s.concat([r]),D=o.concat([n]);for(c=b.length-1;c>=0;){var V=b[c];if(!(_has(V,n)&&_equals(n[V],r[V],A,D)))return!1;c-=1}return!0}var equals=_curry2(function(n,s){return _equals(n,s,[],[])});const equals$1=equals;function _indexOf(r,n,s){var o,u;if(typeof r.indexOf=="function")switch(typeof n){case"number":if(n===0){for(o=1/n;s<r.length;){if(u=r[s],u===0&&1/u===o)return s;s+=1}return-1}else if(n!==n){for(;s<r.length;){if(u=r[s],typeof u=="number"&&u!==u)return s;s+=1}return-1}return r.indexOf(n,s);case"string":case"boolean":case"function":case"undefined":return r.indexOf(n,s);case"object":if(n===null)return r.indexOf(n,s)}for(;s<r.length;){if(equals$1(r[s],n))return s;s+=1}return-1}function _includes(r,n){return _indexOf(n,r,0)>=0}function _quote(r){var n=r.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0");return'"'+n.replace(/"/g,'\\"')+'"'}var pad=function(n){return(n<10?"0":"")+n},_toISOString=typeof Date.prototype.toISOString=="function"?function(n){return n.toISOString()}:function(n){return n.getUTCFullYear()+"-"+pad(n.getUTCMonth()+1)+"-"+pad(n.getUTCDate())+"T"+pad(n.getUTCHours())+":"+pad(n.getUTCMinutes())+":"+pad(n.getUTCSeconds())+"."+(n.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"};const _toISOString$1=_toISOString;function _complement(r){return function(){return!r.apply(this,arguments)}}function _filter(r,n){for(var s=0,o=n.length,u=[];s<o;)r(n[s])&&(u[u.length]=n[s]),s+=1;return u}function _isObject(r){return Object.prototype.toString.call(r)==="[object Object]"}var XFilter=function(){function r(n,s){this.xf=s,this.f=n}return r.prototype["@@transducer/init"]=_xfBase.init,r.prototype["@@transducer/result"]=_xfBase.result,r.prototype["@@transducer/step"]=function(n,s){return this.f(s)?this.xf["@@transducer/step"](n,s):n},r}(),_xfilter=_curry2(function(n,s){return new XFilter(n,s)});const _xfilter$1=_xfilter;var filter$1=_curry2(_dispatchable(["fantasy-land/filter","filter"],_xfilter$1,function(r,n){return _isObject(n)?_reduce(function(s,o){return r(n[o])&&(s[o]=n[o]),s},{},keys$1(n)):_filter(r,n)}));const filter$2=filter$1;var reject=_curry2(function(n,s){return filter$2(_complement(n),s)});const reject$1=reject;function _toString(r,n){var s=function(b){var A=n.concat([r]);return _includes(b,A)?"<Circular>":_toString(b,A)},o=function(c,b){return _map(function(A){return _quote(A)+": "+s(c[A])},b.slice().sort())};switch(Object.prototype.toString.call(r)){case"[object Arguments]":return"(function() { return arguments; }("+_map(s,r).join(", ")+"))";case"[object Array]":return"["+_map(s,r).concat(o(r,reject$1(function(c){return/^\d+$/.test(c)},keys$1(r)))).join(", ")+"]";case"[object Boolean]":return typeof r=="object"?"new Boolean("+s(r.valueOf())+")":r.toString();case"[object Date]":return"new Date("+(isNaN(r.valueOf())?s(NaN):_quote(_toISOString$1(r)))+")";case"[object Null]":return"null";case"[object Number]":return typeof r=="object"?"new Number("+s(r.valueOf())+")":1/r===-1/0?"-0":r.toString(10);case"[object String]":return typeof r=="object"?"new String("+s(r.valueOf())+")":_quote(r);case"[object Undefined]":return"undefined";default:if(typeof r.toString=="function"){var u=r.toString();if(u!=="[object Object]")return u}return"{"+o(r,keys$1(r)).join(", ")+"}"}}var toString=_curry1(function(n){return _toString(n,[])});const toString$1=toString;var cond=_curry1(function(n){var s=reduce$1(max$1,0,map$3(function(o){return o[0].length},n));return _arity(s,function(){for(var o=0;o<n.length;){if(n[o][0].apply(this,arguments))return n[o][1].apply(this,arguments);o+=1}})});const cond$1=cond;var curry=_curry1(function(n){return curryN$1(n.length,n)});const curry$1=curry;var XReduceBy=function(){function r(n,s,o,u){this.valueFn=n,this.valueAcc=s,this.keyFn=o,this.xf=u,this.inputs={}}return r.prototype["@@transducer/init"]=_xfBase.init,r.prototype["@@transducer/result"]=function(n){var s;for(s in this.inputs)if(_has(s,this.inputs)&&(n=this.xf["@@transducer/step"](n,this.inputs[s]),n["@@transducer/reduced"])){n=n["@@transducer/value"];break}return this.inputs=null,this.xf["@@transducer/result"](n)},r.prototype["@@transducer/step"]=function(n,s){var o=this.keyFn(s);return this.inputs[o]=this.inputs[o]||[o,this.valueAcc],this.inputs[o][1]=this.valueFn(this.inputs[o][1],s),n},r}(),_xreduceBy=_curryN(4,[],function(n,s,o,u){return new XReduceBy(n,s,o,u)});const _xreduceBy$1=_xreduceBy;var reduceBy=_curryN(4,[],_dispatchable([],_xreduceBy$1,function(n,s,o,u){return _reduce(function(c,b){var A=o(b),D=n(_has(A,c)?c[A]:_clone(s,[],[],!1),b);return D&&D["@@transducer/reduced"]?_reduced(c):(c[A]=D,c)},{},u)}));const reduceBy$1=reduceBy;var remove$1=_curry3(function(n,s,o){var u=Array.prototype.slice.call(o,0);return u.splice(n,s),u});const remove$2=remove$1;var last$2=nth$1(-1);const last$3=last$2;var or=_curry2(function(n,s){return n||s});const or$1=or;function _isTypedArray(r){var n=Object.prototype.toString.call(r);return n==="[object Uint8ClampedArray]"||n==="[object Int8Array]"||n==="[object Uint8Array]"||n==="[object Int16Array]"||n==="[object Uint16Array]"||n==="[object Int32Array]"||n==="[object Uint32Array]"||n==="[object Float32Array]"||n==="[object Float64Array]"||n==="[object BigInt64Array]"||n==="[object BigUint64Array]"}var empty=_curry1(function(n){return n!=null&&typeof n["fantasy-land/empty"]=="function"?n["fantasy-land/empty"]():n!=null&&n.constructor!=null&&typeof n.constructor["fantasy-land/empty"]=="function"?n.constructor["fantasy-land/empty"]():n!=null&&typeof n.empty=="function"?n.empty():n!=null&&n.constructor!=null&&typeof n.constructor.empty=="function"?n.constructor.empty():_isArray(n)?[]:_isString(n)?"":_isObject(n)?{}:_isArguments$1(n)?function(){return arguments}():_isTypedArray(n)?n.constructor.from(""):void 0});const empty$1=empty;var evolve$1=_curry2(function r(n,s){if(!_isObject(s)&&!_isArray(s))return s;var o=s instanceof Array?[]:{},u,c,b;for(c in s)u=n[c],b=typeof u,o[c]=b==="function"?u(s[c]):u&&b==="object"?r(u,s[c]):s[c];return o});const evolve$2=evolve$1;var XFindIndex=function(){function r(n,s){this.xf=s,this.f=n,this.idx=-1,this.found=!1}return r.prototype["@@transducer/init"]=_xfBase.init,r.prototype["@@transducer/result"]=function(n){return this.found||(n=this.xf["@@transducer/step"](n,-1)),this.xf["@@transducer/result"](n)},r.prototype["@@transducer/step"]=function(n,s){return this.idx+=1,this.f(s)&&(this.found=!0,n=_reduced(this.xf["@@transducer/step"](n,this.idx))),n},r}(),_xfindIndex=_curry2(function(n,s){return new XFindIndex(n,s)});const _xfindIndex$1=_xfindIndex;var findIndex=_curry2(_dispatchable([],_xfindIndex$1,function(n,s){for(var o=0,u=s.length;o<u;){if(n(s[o]))return o;o+=1}return-1}));const findIndex$1=findIndex;var fromPairs=_curry1(function(n){for(var s={},o=0;o<n.length;)s[n[o][0]]=n[o][1],o+=1;return s});const fromPairs$1=fromPairs;var groupBy=_curry2(_checkForMethod("groupBy",reduceBy$1(function(r,n){return r.push(n),r},[])));const groupBy$1=groupBy;var insert=_curry3(function(n,s,o){n=n<o.length&&n>=0?n:o.length;var u=Array.prototype.slice.call(o,0);return u.splice(n,0,s),u});const insert$1=insert;function _objectAssign(r){if(r==null)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(r),s=1,o=arguments.length;s<o;){var u=arguments[s];if(u!=null)for(var c in u)_has(c,u)&&(n[c]=u[c]);s+=1}return n}const _objectAssign$1=typeof Object.assign=="function"?Object.assign:_objectAssign;var objOf=_curry2(function(n,s){var o={};return o[n]=s,o});const objOf$1=objOf;var invoker=_curry2(function(n,s){return curryN$1(n+1,function(){var o=arguments[n];if(o!=null&&_isFunction(o[s]))return o[s].apply(o,Array.prototype.slice.call(arguments,0,n));throw new TypeError(toString$1(o)+' does not have a method named "'+s+'"')})});const invoker$1=invoker;var is=_curry2(function(n,s){return s instanceof n||s!=null&&(s.constructor===n||n.name==="Object"&&typeof s=="object")});const is$1=is;var isEmpty=_curry1(function(n){return n!=null&&equals$1(n,empty$1(n))});const isEmpty$1=isEmpty;var lens=_curry2(function(n,s){return function(o){return function(u){return map$3(function(c){return s(c,u)},o(n(u)))}}});const lens$1=lens;var paths=_curry2(function(n,s){return n.map(function(o){for(var u=s,c=0,b;c<o.length;){if(u==null)return;b=o[c],u=_isInteger(b)?nth$1(b,u):u[b],c+=1}return u})});const paths$1=paths;var path=_curry2(function(n,s){return paths$1([n],s)[0]});const path$1=path;var mapObjIndexed=_curry2(function(n,s){return _reduce(function(o,u){return o[u]=n(s[u],u,s),o},{},keys$1(s))});const mapObjIndexed$1=mapObjIndexed;var mergeWithKey=_curry3(function(n,s,o){var u={},c;for(c in s)_has(c,s)&&(u[c]=_has(c,o)?n(c,s[c],o[c]):s[c]);for(c in o)_has(c,o)&&!_has(c,u)&&(u[c]=o[c]);return u});const mergeWithKey$1=mergeWithKey;var mergeLeft=_curry2(function(n,s){return _objectAssign$1({},s,n)});const mergeLeft$1=mergeLeft;var mergeRight=_curry2(function(n,s){return _objectAssign$1({},n,s)});const mergeRight$1=mergeRight;var mergeWith=_curry3(function(n,s,o){return mergeWithKey$1(function(u,c,b){return n(c,b)},s,o)});const mergeWith$1=mergeWith;function _modify(r,n,s){if(_isInteger(r)&&_isArray(s)){var o=[].concat(s);return o[r]=n(o[r]),o}var u={};for(var c in s)u[c]=s[c];return u[r]=n(u[r]),u}var modifyPath=_curry3(function r(n,s,o){if(!_isObject(o)&&!_isArray(o)||n.length===0)return o;var u=n[0];if(!_has(u,o))return o;if(n.length===1)return _modify(u,s,o);var c=r(Array.prototype.slice.call(n,1),s,o[u]);return c===o[u]?o:_assoc(u,c,o)});const modifyPath$1=modifyPath;var modify=_curry3(function(n,s,o){return modifyPath$1([n],s,o)});const modify$1=modify;var multiply=_curry2(function(n,s){return n*s});const multiply$1=multiply;var Identity=function(r){return{value:r,map:function(n){return Identity(n(r))}}},over=_curry3(function(n,s,o){return n(function(u){return Identity(s(u))})(o).value});const over$1=over;var pick=_curry2(function(n,s){for(var o={},u=0;u<n.length;)n[u]in s&&(o[n[u]]=s[n[u]]),u+=1;return o});const pick$1=pick;var pickBy=_curry2(function(n,s){var o={};for(var u in s)n(s[u],u,s)&&(o[u]=s[u]);return o});const pickBy$1=pickBy;var propEq=_curry3(function(n,s,o){return equals$1(s,prop$1(n,o))});const propEq$1=propEq;var props=_curry2(function(n,s){return n.map(function(o){return path$1([o],s)})});const props$1=props;var set=_curry3(function(n,s,o){return over$1(n,always$1(s),o)});const set$1=set;var sort=_curry2(function(n,s){return Array.prototype.slice.call(s,0).sort(n)});const sort$1=sort;var split=invoker$1(1,"split");const split$1=split;var toPairs=_curry1(function(n){var s=[];for(var o in n)_has(o,n)&&(s[s.length]=[o,n[o]]);return s});const toPairs$1=toPairs;var Const=function(r){return{value:r,"fantasy-land/map":function(){return this}}},view=_curry2(function(n,s){return n(Const)(s).value});const view$1=view;var zipObj=_curry2(function(n,s){for(var o=0,u=Math.min(n.length,s.length),c={};o<u;)c[n[o]]=s[o],o+=1;return c});const zipObj$1=zipObj,HilbertForward=(r,n,s)=>wasm_functions.forward(r.toString(),n,s),HilbertInverse=(r,n)=>BigInt(wasm_functions.inverse(r,n));function prod(r,n,s){if(typeof r==typeof n)return r*n;{let[o,u]=typeof r=="bigint"?[n,r]:[r,n];return BigInt(Math.round(o*10**s))*u/BigInt(10**s)}}sort$1((r,n)=>r-n);const scale$1=(r,n,s,o,u,c=9)=>prod((u-r)/(n-r),o-s,c),lerp=curry$1((r,n,s,o,u,c=identity$1)=>scale$1(r,n,s,o,c(u))+s);//! bad code coverage
function assignDefaultName(r){const n=r.filter(o=>o.includes("preset")).map(o=>parseInt(last$3(o),10)).filter(o=>Number.isInteger(o));let s=1;for(;n.includes(s);)s+=1;return"preset"+s}const deepMap=curry$1((r,n)=>mapObjIndexed$1((s,o)=>or$1(is$1(Array,s),is$1(Object,s))?deepMap(r,s):r(s),n)),deepAlways=deepMap(always$1),deepObjOf=(r,n)=>assocPath$1(r,n,{}),mergePartialWith=curry$1((r,n,s)=>mergeWith$1(r,n,pick$1(keys$1(n),s)));function lerpView(r,n,s){return function(o){return lerp(...n(o),...s,o[r])}}function lerpSet(r,n,s){return function(o,u){return assoc$1(r,lerp(...s,...n(u),o),u)}}function lerpLens(r,n,s){return lens$1(lerpView(r,n,s),lerpSet(r,n,s))}function stringToPath(r){return isEmpty$1(split$1(" ",r))?[]:map$3(n=>isNaN(n)?n:Number(n),split$1(" ",r))}const pipeEvolver=(r,n)=>mergeWith$1((s,o)=>pipe(s,o),r,n);function evolve(r,n){const s={};for(const[o,u]of Object.entries(n))o in r?s[o]=r[o](u):s[o]=u;return s}const constrainEvolver=(r,n,s,o)=>cond$1([[s,always$1(n)],[T$1,always$1(pipeEvolver(n,o))]])(r),solve=curry$1((r,n,s)=>{const o=mapObjIndexed$1((u,c)=>n[c]==null?identity$1:n[c],s);//! assumes that "constraints" have been sorted in propagation order
return r.reduce((u,{predicate:c,g:b})=>constrainEvolver(s,u,c,b(u,s)),o)}),liftSolve=curry$1((r,n,s)=>evolve$2(mergePartialWith(r,n,s),s));let e=1e-6;const constraintsPreset=[{predicate:r=>r.c1-r.c0>=e,g:(r,n)=>({c0:s=>r.c1(s-e/2)-e/2,c1:s=>r.c0(s+e/2)+e/2})},{predicate:r=>r.z>=r.c1-r.c0&&r.z<=e,g:(r,n)=>({z:s=>clamp$1(e,r.c1(n.c1)-r.c0(n.c0),r.z(s))})},{predicate:r=>r.b<=r.c0+r.z/2&&r.b>=r.c1-r.z/2,g:(r,n)=>({b:s=>clamp$1(r.c0(n.c0)+r.z(n.z)/2,r.c1(n.c1)-r.z(n.z)/2,r.b(s))})},{predicate:r=>r.a<=r.b-r.z/2&&r.a>=r.b+r.z/2,g:(r,n)=>({a:s=>clamp$1(r.b(n.b)-r.z(n.z)/2,r.b(n.b)+r.z(n.z)/2,r.a(s))})}],scale=curry$1((r,n)=>evolve({x:s=>s*r,y:s=>s*r},n));curry$1((r,n,s)=>evolve({x:o=>o*r+s.x,y:o=>o*r+s.y},n));const dot=(r,n)=>r.x*n.x+r.y*n.y,norm=r=>Math.sqrt(dot(r,r)),setNorm=(r,n)=>scale(r,unit(n)),add=(r,n)=>evolve({x:s=>s+r.x,y:s=>s+r.y},n),sub=(r,n)=>evolve({x:s=>s-r.x,y:s=>s-r.y},n),unit=r=>scale(1/norm(r),r);curry$1((r,n)=>scale(dot(n,r)/norm(r),r));const projectXAB=(r,n,s)=>add(n,scale(dot(sub(n,r),sub(n,s))/norm(sub(n,s)),unit(sub(n,s))));curry$1((r,n)=>({x:2*r.x-n.x,y:2*r.y-n.y}));curry$1((r,n,s)=>({x:(r.x*(1+n)-s.x)/n,y:(r.y*(1+n)-s.y)/n}));const EventStore=writable({x:0,y:0,movementX:0,movementY:0,mouseDown:!0,mouseDiff:!0}),UIOptions=writable({noscroll:!1});EventStore.subscribe(r=>r);function liftedConstraintStore(r,n=.01){function s(V){let Ae=V;return Ae.z??(Ae.z=V.c1-V.c0),Ae.b??(Ae.b=(V.c1-V.c0)/2),Ae.a??(Ae.a=lerp(0,1,Ae.b-Ae.z/2,Ae.b+Ae.z/2,Math.random())),Ae.locked??(Ae.locked=!1),Ae}let o=map$3(s,fromPairs$1(r)),u=deepAlways(fromPairs$1(r));const c=writable(liftSolve(solve(constraintsPreset),u,o)),b=writable(map$3(V=>V[0],r));function A(V){c.update(liftSolve(solve(constraintsPreset),V))}function D(V){A(deepAlways(V))}return[{subscribe:c.subscribe,set:D,update:c.update,evolve:A},{subscribe:b.subscribe,set:b.set,update:b.update}]}function MuesliStore(r){const[n,s]=liftedConstraintStore(r.inputSpace),o=writable(32),u=derived([s,n],([We,ut])=>reject$1(bt=>prop$1("locked",ut[bt]),We)),c=derived([u,o],([We,ut])=>BigInt(2**(We.length*ut)-1));let b,A,D,V,Ae,Le;o.subscribe(We=>{A=We}),n.subscribe(We=>{b=We}),u.subscribe(We=>{D=We}),c.subscribe(We=>{Le=We}),r.h_local??(r.h_local=prod(.5,Le,9)),r.h_global??(r.h_global=prod(.5,Le,9));const[Ee,xe]=[writable(r.h_local),writable(r.h_global)];xe.subscribe(We=>{V=We}),Ee.subscribe(We=>{Ae=We});let Pe=lerpLens("a",({b:We,z:ut})=>[We-ut/2,We+ut/2],[0,2**A-1]),Ne=lerpLens("b",({c0:We,c1:ut,z:bt})=>[We+bt/2,ut-bt/2],[0,2**A-1]);function at(We){ce(always$1(clamp$1(0n,Le,We)))}function je(We){$e(always$1(clamp$1(0n,Le,We)))}function ce(We){Ee.update(bt=>clamp$1(0n,Le,We(bt)));let ut=zipObj$1(D,HilbertForward(Ae,A,D.length));n.set(mergeWith$1(set$1(Pe),ut,b))}function $e(We){xe.update(pipe(We,clamp$1(0n,Le)));let ut=zipObj$1(D,HilbertForward(V,A,D.length));n.set(mergeWith$1(set$1(Ne),ut,b))}function Me(We){_t(liftSolve(solve(constraintsPreset),pick$1(D,We)))}function _t(We){n.update(We);let[ut,bt]=[mapObjIndexed$1(view$1(Ne),b),mapObjIndexed$1(view$1(Pe),b)];Ee.set(HilbertInverse(Uint32Array.from(props$1(D,bt)),A)),xe.set(HilbertInverse(Uint32Array.from(props$1(D,ut)),A))}return[{subscribe:xe.subscribe,set:je,update:$e},{subscribe:Ee.subscribe,set:at,update:ce},{subscribe:n.subscribe,set:n.set,update:_t,evolve:Me},o,u,derived(n,pluck$1("a")),c]}function AlignmentStore(r,n,s){const[o,u,c]=[writable(r),writable(n),writable(s)],b=writable(n),[A,D]=[writable(!1),writable(!1)],[V,Ae,Le]=[derived([o,u],([Qe,dt])=>sub(Qe,dt)),derived([o,c],([Qe,dt])=>sub(Qe,dt)),derived([u,c],([Qe,dt])=>sub(Qe,dt))],Ee=writable(void 0),xe=derived([o,c],([Qe,dt])=>({z:Qe.movementX/(Qe.y-dt.y)}));let Pe,Ne,at,je,ce,$e,Me,_t,We,ut;A.subscribe(Qe=>{Pe=Qe}),D.subscribe(Qe=>{Ne=Qe}),o.subscribe(Qe=>{at=Qe}),u.subscribe(Qe=>{je=Qe}),c.subscribe(Qe=>{ce=Qe}),V.subscribe(Qe=>{$e=Qe}),Ae.subscribe(Qe=>{Me=Qe}),Le.subscribe(Qe=>{_t=Qe}),Ee.subscribe(Qe=>{}),b.subscribe(Qe=>{We=Qe}),xe.subscribe(Qe=>{ut=Qe});function bt(Qe){let dt=document.elementsFromPoint(je.x,je.y).filter(R=>R.classList.contains("thumb")||R.classList.contains("range")),gt=dt.length>0?dt[0]:void 0,st=gt?.getBoundingClientRect();Qe?Ee.set({elem:gt,offset:{offsetX:je.x-st?.x-st?.width/2,offsetY:je.y-st?.y-st?.height/2}}):Ee.set(void 0),D.set(Qe),b.set(je)}function ct(Qe){Et(mergeLeft$1(Qe))}function Et(Qe){if(Ne)if(Pe){let dt=projectXAB(Qe(at),at,ce),gt=norm(sub(dt,ce))<=norm(_t)+1e-5?add(je,setNorm(1e-5,sub(je,ce))):dt;o.set(gt)}else{o.update(Qe);let dt=(N,ne)=>({movementX:ne.z*(N.y-ce.y),movementY:-ne.z*(ce.x-N.x)}),gt=Me.y/Me.x,st=ce.y-ce.x*Me.y/Me.x,R={x:(We.y-st)/gt,y:We.y},g=dt(R,ut),q=Math.abs(Me.y)-.01>Math.abs(ce.y-We.y)?{x:R.x+je.movementX,y:R.y+je.movementY,movementX:g.movementX,movementY:0}:add(at,scale(.01,Me));u.update(mergeLeft$1(q))}else if(Pe){let dt=Me;o.update(Qe);let gt=norm($e)>=norm(dt)+.01?add(je,setNorm(.01,$e)):add(at,setNorm(norm(dt),$e));c.set(gt)}else{let[dt,gt]=[$e,Me];o.update(Qe),u.set(add(at,dt)),c.set(add(at,gt))}}return[{subscribe:o.subscribe,set:ct,update:Et},{subscribe:u.subscribe,set:bt},{subscribe:c.subscribe,set:A.set},{subscribe:Ee.subscribe}]}const examples=[{templateName:"Ojack 1",presetName:"preset0",inputSpace:[["oscillator_frequency",{c0:1e-4,c1:100,a:1,locked:!1}],["oscillator_offset",{c0:1e-4,c1:1,a:1,locked:!1}],["kaleidoscope_shape",{c0:1,c1:20,a:2,locked:!1}],["red",{c0:0,c1:1,a:1,locked:!1}],["green",{c0:0,c1:1,a:1,locked:!1}],["blue",{c0:0,c1:1,a:1,locked:!1}],["rotation_1",{c0:0,c1:1,a:1,locked:!1}],["rotation_2",{c0:0,c1:1,a:1,locked:!1}],["scale_factor",{c0:1e-4,c1:1,a:1,locked:!1}],["modulation_amount",{c0:1e-4,c1:1,a:1,locked:!1}]],synth:r=>n=>n.osc(r.oscillator_frequency,1/r.oscillator_frequency,r.oscillator_offset).kaleid(r.kaleidoscope_shape).color(r.red,r.green,r.blue).rotate(r.rotation_1,r.rotation_2).modulate(n.o0,r.modulation_amount).scale(r.scale_factor).out(n.o0),h_global:prod(BigInt(2**(32*10)),.1,6),h_local:prod(BigInt(2**(32*10)),.5,6)},{templateName:"Puertas III",presetName:"preset0",inputSpace:[["oscillator_1_frequency",{c0:1e-4,c1:100,a:1,locked:!1}],["oscillator_1_offset",{c0:1e-4,c1:1,a:1,locked:!1}],["oscillator_2_frequency",{c0:1e-4,c1:100,a:1,locked:!1}],["oscillator_2_offset",{c0:1e-4,c1:1,a:1,locked:!1}],["kaleidoscope_shape",{c0:1,c1:20,a:1,locked:!1}],["repeatX",{c0:0,c1:5,a:1,locked:!1}],["repeatY",{c0:0,c1:5,a:1,locked:!1}],["modulation_amount",{c0:1e-4,c1:1,a:1,locked:!1}],["shape_modulation_sides",{c0:0,c1:20,a:1,locked:!1}],["shape_modulation_scale",{c0:1e-4,c1:10,a:1,locked:!1}],["shape_modulation_fade",{c0:0,c1:1,a:1,locked:!1}]],synth:r=>n=>n.osc(r.oscillator_1_frequency,1/r.oscillator_1_frequency,r.oscillator_1_offset).modulateScale(n.osc(r.oscillator_2_frequency,1/r.oscillator_2_frequency,r.oscillator_2_offset).kaleid(r.kaleidoscope_shape)).repeat(r.repeatX,r.repeatY).modulate(n.o0,r.modulation_amount).modulateKaleid(n.shape(r.shape_modulation_sides,r.shape_modulation_scale,r.shape_modulation_fade)).out(n.o0),h_global:prod(BigInt(2**(32*10)),.1,6),h_local:prod(BigInt(2**(32*10)),.5,6)},{templateName:"Ojack 2",presetName:"preset0",inputSpace:[["oscillator_1_frequency",{c0:1e-4,c1:100,a:1,locked:!1}],["oscillator_1_offset",{c0:1e-4,c1:1,a:1,locked:!1}],["oscillator_2_frequency",{c0:1e-4,c1:100,a:1,locked:!1}],["oscillator_2_offset",{c0:1e-4,c1:1,a:1,locked:!1}],["oscillator_2_threshold",{c0:0,c1:1,a:1,locked:!1}],["oscillator_2_rotation",{c0:0,c1:1,a:1,locked:!1}],["oscillator_3_frequency",{c0:1e-4,c1:100,a:1,locked:!1}],["oscillator_3_offset",{c0:1e-4,c1:1,a:1,locked:!1}],["oscillator_3_threshold",{c0:0,c1:1,a:1,locked:!1}],["oscillator_3_threshold_tolerance",{c0:0,c1:1,a:1,locked:!1}],["oscillator_3_modulation_amount",{c0:0,c1:1,a:1,locked:!1}],["red",{c0:0,c1:1,a:1,locked:!1}],["green",{c0:0,c1:1,a:1,locked:!1}],["blue",{c0:0,c1:1,a:1,locked:!1}],["rotation",{c0:0,c1:1,a:1,locked:!1}],["scale_factor",{c0:1e-4,c1:1,a:1,locked:!1}],["feedback_rotation",{c0:0,c1:1,a:1,locked:!1}],["feedback_modulation_amount",{c0:0,c1:1,a:1,locked:!1}]],synth:r=>n=>n.osc(r.oscillator_1_frequency,1/r.oscillator_1_frequency,r.oscillator_1_offset).modulate(n.src(n.o0).rotate(r.feedback_rotation),r.feedback_modulation_amount).color(r.red,r.green,r.blue).rotate(r.rotation,0).pixelate(.576,12.888).mult(n.osc(r.oscillator_2_frequency,1/r.oscillator_2_frequency,r.oscillator_2_offset).thresh(r.oscillator_2_threshold).rotate(r.oscillator_2_rotation,0)).modulateRotate(n.osc(r.oscillator_3_frequency,1/r.oscillator_3_frequency,r.oscillator_3_offset).thresh(r.oscillator_3_threshold,r.oscillator_3_threshold_tolerance),r.oscillator_3_modulation_amount).out(n.o0),h_global:prod(BigInt(2**(32*10)),.1,6),h_local:prod(BigInt(2**(32*10)),.5,6)},{templateName:"Grayscale Noise",presetName:"preset0",inputSpace:[["frequency",{c0:1e-4,c1:1e3,a:1,locked:!1}],["offset",{c0:1e-4,c1:1,a:1,locked:!1}],["noise_scale",{c0:.1,c1:10,a:1,locked:!1}],["noise_scale_1",{c0:.1,c1:10,a:1,locked:!1}],["modulation_amount_1",{c0:1e-4,c1:1,a:1,locked:!1}],["modulation_amount_2",{c0:0,c1:1,a:1,locked:!1}]],synth:r=>n=>n.noise(r.noise_scale_1,1/r.noise_scale_1).modulate(n.src(n.o0).modulate(n.osc(r.frequency,1/r.frequency,r.offset),r.modulation_amount_1),r.modulation_amount_2).posterize().out(n.o0),h_global:prod(BigInt(2**(32*10)),.1,6),h_local:prod(BigInt(2**(32*10)),.5,6)},{author:"Asdr\xFAbal Gomez",templateName:"Asdrubal",presetName:"preset0",inputSpace:[["frequency",{c0:1e-4,c1:100,a:1,locked:!1}],["offset",{c0:1e-4,c1:1,a:1,locked:!1}],["noise_scale",{c0:1,c1:10,a:1,locked:!1}],["noise_scale_1",{c0:-10,c1:10,a:0,locked:!1}],["modulation_amount_1",{c0:1e-4,c1:1,a:1,locked:!1}],["modulation_amount_2",{c0:1e-4,c1:1,a:1,locked:!1}]],synth:r=>n=>n.noise(3,.1,6.157).rotate(1,-1.941,-2).mask(n.shape(20)).colorama(.959).modulateScale(n.o0).modulateScale(n.o0,.291).blend(n.o0).blend(n.o0).blend(n.o0).blend(n.o0).out(n.o0)}];/*! Kefir.js v3.8.8
 *  https://github.com/kefirjs/kefir
 */function createObj(r){var n=function(){};return n.prototype=r,new n}function extend(r){var n=arguments.length,s=void 0,o=void 0;for(s=1;s<n;s++)for(o in arguments[s])r[o]=arguments[s][o];return r}function inherit(r,n){var s=arguments.length,o=void 0;for(r.prototype=createObj(n.prototype),r.prototype.constructor=r,o=2;o<s;o++)extend(r.prototype,arguments[o]);return r}var NOTHING=["<nothing>"],END="end",VALUE="value",ERROR="error",ANY="any";function concat(r,n){var s=void 0,o=void 0,u=void 0,c=void 0;if(r.length===0)return n;if(n.length===0)return r;for(c=0,s=new Array(r.length+n.length),o=r.length,u=0;u<o;u++,c++)s[c]=r[u];for(o=n.length,u=0;u<o;u++,c++)s[c]=n[u];return s}function find(r,n){var s=r.length,o=void 0;for(o=0;o<s;o++)if(r[o]===n)return o;return-1}function findByPred(r,n){var s=r.length,o=void 0;for(o=0;o<s;o++)if(n(r[o]))return o;return-1}function cloneArray(r){var n=r.length,s=new Array(n),o=void 0;for(o=0;o<n;o++)s[o]=r[o];return s}function remove(r,n){var s=r.length,o=void 0,u=void 0,c=void 0;if(n>=0&&n<s){if(s===1)return[];for(o=new Array(s-1),u=0,c=0;u<s;u++)u!==n&&(o[c]=r[u],c++);return o}else return r}function map$1(r,n){var s=r.length,o=new Array(s),u=void 0;for(u=0;u<s;u++)o[u]=n(r[u]);return o}function forEach(r,n){var s=r.length,o=void 0;for(o=0;o<s;o++)n(r[o])}function fillArray(r,n){var s=r.length,o=void 0;for(o=0;o<s;o++)r[o]=n}function contains$1(r,n){return find(r,n)!==-1}function slide(r,n,s){var o=Math.min(s,r.length+1),u=r.length-o+1,c=new Array(o),b=void 0;for(b=u;b<o;b++)c[b-u]=r[b];return c[o-1]=n,c}function callSubscriber(r,n,s){r===ANY?n(s):r===s.type&&(r===VALUE||r===ERROR?n(s.value):n())}function Dispatcher(){this._items=[],this._spies=[],this._inLoop=0,this._removedItems=null}extend(Dispatcher.prototype,{add:function(r,n){return this._items=concat(this._items,[{type:r,fn:n}]),this._items.length},remove:function(r,n){var s=findByPred(this._items,function(o){return o.type===r&&o.fn===n});return this._inLoop!==0&&s!==-1&&(this._removedItems===null&&(this._removedItems=[]),this._removedItems.push(this._items[s])),this._items=remove(this._items,s),this._items.length},addSpy:function(r){return this._spies=concat(this._spies,[r]),this._spies.length},removeSpy:function(r){return this._spies=remove(this._spies,this._spies.indexOf(r)),this._spies.length},dispatch:function(r){this._inLoop++;for(var n=0,s=this._spies;this._spies!==null&&n<s.length;n++)s[n](r);for(var o=0,u=this._items;o<u.length&&this._items!==null;o++)this._removedItems!==null&&contains$1(this._removedItems,u[o])||callSubscriber(u[o].type,u[o].fn,r);this._inLoop--,this._inLoop===0&&(this._removedItems=null)},cleanup:function(){this._items=null,this._spies=null}});function Observable(){this._dispatcher=new Dispatcher,this._active=!1,this._alive=!0,this._activating=!1,this._logHandlers=null,this._spyHandlers=null}extend(Observable.prototype,{_name:"observable",_onActivation:function(){},_onDeactivation:function(){},_setActive:function(r){this._active!==r&&(this._active=r,r?(this._activating=!0,this._onActivation(),this._activating=!1):this._onDeactivation())},_clear:function(){this._setActive(!1),this._dispatcher.cleanup(),this._dispatcher=null,this._logHandlers=null},_emit:function(r,n){switch(r){case VALUE:return this._emitValue(n);case ERROR:return this._emitError(n);case END:return this._emitEnd()}},_emitValue:function(r){this._alive&&this._dispatcher.dispatch({type:VALUE,value:r})},_emitError:function(r){this._alive&&this._dispatcher.dispatch({type:ERROR,value:r})},_emitEnd:function(){this._alive&&(this._alive=!1,this._dispatcher.dispatch({type:END}),this._clear())},_on:function(r,n){return this._alive?(this._dispatcher.add(r,n),this._setActive(!0)):callSubscriber(r,n,{type:END}),this},_off:function(r,n){if(this._alive){var s=this._dispatcher.remove(r,n);s===0&&this._setActive(!1)}return this},onValue:function(r){return this._on(VALUE,r)},onError:function(r){return this._on(ERROR,r)},onEnd:function(r){return this._on(END,r)},onAny:function(r){return this._on(ANY,r)},offValue:function(r){return this._off(VALUE,r)},offError:function(r){return this._off(ERROR,r)},offEnd:function(r){return this._off(END,r)},offAny:function(r){return this._off(ANY,r)},observe:function(r,n,s){var o=this,u=!1,c=!r||typeof r=="function"?{value:r,error:n,end:s}:r,b=function(A){A.type===END&&(u=!0),A.type===VALUE&&c.value?c.value(A.value):A.type===ERROR&&c.error?c.error(A.value):A.type===END&&c.end&&c.end(A.value)};return this.onAny(b),{unsubscribe:function(){u||(o.offAny(b),u=!0)},get closed(){return u}}},_ofSameType:function(r,n){return r.prototype.getType()===this.getType()?r:n},setName:function(r,n){return this._name=n?r._name+"."+n:r,this},log:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.toString(),n=void 0,s=function(o){var u="<"+o.type+(n?":current":"")+">";o.type===END?console.log(r,u):console.log(r,u,o.value)};return this._alive&&(this._logHandlers||(this._logHandlers=[]),this._logHandlers.push({name:r,handler:s})),n=!0,this.onAny(s),n=!1,this},offLog:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.toString();if(this._logHandlers){var n=findByPred(this._logHandlers,function(s){return s.name===r});n!==-1&&(this.offAny(this._logHandlers[n].handler),this._logHandlers.splice(n,1))}return this},spy:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.toString(),n=function(s){var o="<"+s.type+">";s.type===END?console.log(r,o):console.log(r,o,s.value)};return this._alive&&(this._spyHandlers||(this._spyHandlers=[]),this._spyHandlers.push({name:r,handler:n}),this._dispatcher.addSpy(n)),this},offSpy:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.toString();if(this._spyHandlers){var n=findByPred(this._spyHandlers,function(s){return s.name===r});n!==-1&&(this._dispatcher.removeSpy(this._spyHandlers[n].handler),this._spyHandlers.splice(n,1))}return this}});Observable.prototype.toString=function(){return"["+this._name+"]"};function Stream(){Observable.call(this)}inherit(Stream,Observable,{_name:"stream",getType:function(){return"stream"}});function Property(){Observable.call(this),this._currentEvent=null}inherit(Property,Observable,{_name:"property",_emitValue:function(r){this._alive&&(this._currentEvent={type:VALUE,value:r},this._activating||this._dispatcher.dispatch({type:VALUE,value:r}))},_emitError:function(r){this._alive&&(this._currentEvent={type:ERROR,value:r},this._activating||this._dispatcher.dispatch({type:ERROR,value:r}))},_emitEnd:function(){this._alive&&(this._alive=!1,this._activating||this._dispatcher.dispatch({type:END}),this._clear())},_on:function(r,n){return this._alive&&(this._dispatcher.add(r,n),this._setActive(!0)),this._currentEvent!==null&&callSubscriber(r,n,this._currentEvent),this._alive||callSubscriber(r,n,{type:END}),this},getType:function(){return"property"}});var neverS=new Stream;neverS._emitEnd();neverS._name="never";function never(){return neverS}function timeBased(r){function n(s,o){var u=this;Stream.call(this),this._wait=s,this._intervalId=null,this._$onTick=function(){return u._onTick()},this._init(o)}return inherit(n,Stream,{_init:function(){},_free:function(){},_onTick:function(){},_onActivation:function(){this._intervalId=setInterval(this._$onTick,this._wait)},_onDeactivation:function(){this._intervalId!==null&&(clearInterval(this._intervalId),this._intervalId=null)},_clear:function(){Stream.prototype._clear.call(this),this._$onTick=null,this._free()}},r),n}var S=timeBased({_name:"later",_init:function(r){var n=r.x;this._x=n},_free:function(){this._x=null},_onTick:function(){this._emitValue(this._x),this._emitEnd()}});function later(r,n){return new S(r,{x:n})}var S$1=timeBased({_name:"interval",_init:function(r){var n=r.x;this._x=n},_free:function(){this._x=null},_onTick:function(){this._emitValue(this._x)}});function interval(r,n){return new S$1(r,{x:n})}var S$2=timeBased({_name:"sequentially",_init:function(r){var n=r.xs;this._xs=cloneArray(n)},_free:function(){this._xs=null},_onTick:function(){this._xs.length===1?(this._emitValue(this._xs[0]),this._emitEnd()):this._emitValue(this._xs.shift())}});function sequentially(r,n){return n.length===0?never():new S$2(r,{xs:n})}var S$3=timeBased({_name:"fromPoll",_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_onTick:function(){var r=this._fn;this._emitValue(r())}});function fromPoll(r,n){return new S$3(r,{fn:n})}function emitter(r){function n(c){return r._emitValue(c),r._active}function s(c){return r._emitError(c),r._active}function o(){return r._emitEnd(),r._active}function u(c){return r._emit(c.type,c.value),r._active}return{value:n,error:s,end:o,event:u,emit:n,emitEvent:u}}var S$4=timeBased({_name:"withInterval",_init:function(r){var n=r.fn;this._fn=n,this._emitter=emitter(this)},_free:function(){this._fn=null,this._emitter=null},_onTick:function(){var r=this._fn;r(this._emitter)}});function withInterval(r,n){return new S$4(r,{fn:n})}function S$5(r){Stream.call(this),this._fn=r,this._unsubscribe=null}inherit(S$5,Stream,{_name:"stream",_onActivation:function(){var r=this._fn,n=r(emitter(this));this._unsubscribe=typeof n=="function"?n:null,this._active||this._callUnsubscribe()},_callUnsubscribe:function(){this._unsubscribe!==null&&(this._unsubscribe(),this._unsubscribe=null)},_onDeactivation:function(){this._callUnsubscribe()},_clear:function(){Stream.prototype._clear.call(this),this._fn=null}});function stream(r){return new S$5(r)}function fromCallback(r){var n=!1;return stream(function(s){n||(r(function(o){s.emit(o),s.end()}),n=!0)}).setName("fromCallback")}function fromNodeCallback(r){var n=!1;return stream(function(s){n||(r(function(o,u){o?s.error(o):s.emit(u),s.end()}),n=!0)}).setName("fromNodeCallback")}function spread(r,n){switch(n){case 0:return function(){return r()};case 1:return function(s){return r(s[0])};case 2:return function(s){return r(s[0],s[1])};case 3:return function(s){return r(s[0],s[1],s[2])};case 4:return function(s){return r(s[0],s[1],s[2],s[3])};default:return function(s){return r.apply(null,s)}}}function apply(r,n,s){var o=s?s.length:0;if(n==null)switch(o){case 0:return r();case 1:return r(s[0]);case 2:return r(s[0],s[1]);case 3:return r(s[0],s[1],s[2]);case 4:return r(s[0],s[1],s[2],s[3]);default:return r.apply(null,s)}else switch(o){case 0:return r.call(n);default:return r.apply(n,s)}}function fromSubUnsub(r,n,s){return stream(function(o){var u=s?function(){o.emit(apply(s,this,arguments))}:function(c){o.emit(c)};return r(u),function(){return n(u)}}).setName("fromSubUnsub")}var pairs=[["addEventListener","removeEventListener"],["addListener","removeListener"],["on","off"]];function fromEvents(r,n,s){for(var o=void 0,u=void 0,c=0;c<pairs.length;c++)if(typeof r[pairs[c][0]]=="function"&&typeof r[pairs[c][1]]=="function"){o=pairs[c][0],u=pairs[c][1];break}if(o===void 0)throw new Error("target don't support any of addEventListener/removeEventListener, addListener/removeListener, on/off method pair");return fromSubUnsub(function(b){return r[o](n,b)},function(b){return r[u](n,b)},s).setName("fromEvents")}function P(r){this._currentEvent={type:"value",value:r,current:!0}}inherit(P,Property,{_name:"constant",_active:!1,_activating:!1,_alive:!1,_dispatcher:null,_logHandlers:null});function constant(r){return new P(r)}function P$1(r){this._currentEvent={type:"error",value:r,current:!0}}inherit(P$1,Property,{_name:"constantError",_active:!1,_activating:!1,_alive:!1,_dispatcher:null,_logHandlers:null});function constantError(r){return new P$1(r)}function createConstructor(r,n){return function(o,u){var c=this;r.call(this),this._source=o,this._name=o._name+"."+n,this._init(u),this._$handleAny=function(b){return c._handleAny(b)}}}function createClassMethods(r){return{_init:function(){},_free:function(){},_handleValue:function(n){this._emitValue(n)},_handleError:function(n){this._emitError(n)},_handleEnd:function(){this._emitEnd()},_handleAny:function(n){switch(n.type){case VALUE:return this._handleValue(n.value);case ERROR:return this._handleError(n.value);case END:return this._handleEnd()}},_onActivation:function(){this._source.onAny(this._$handleAny)},_onDeactivation:function(){this._source.offAny(this._$handleAny)},_clear:function(){r.prototype._clear.call(this),this._source=null,this._$handleAny=null,this._free()}}}function createStream(r,n){var s=createConstructor(Stream,r);return inherit(s,Stream,createClassMethods(Stream),n),s}function createProperty(r,n){var s=createConstructor(Property,r);return inherit(s,Property,createClassMethods(Property),n),s}var P$2=createProperty("toProperty",{_init:function(r){var n=r.fn;this._getInitialCurrent=n},_onActivation:function(){if(this._getInitialCurrent!==null){var r=this._getInitialCurrent;this._emitValue(r())}this._source.onAny(this._$handleAny)}});function toProperty(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(n!==null&&typeof n!="function")throw new Error("You should call toProperty() with a function or no arguments.");return new P$2(r,{fn:n})}var S$6=createStream("changes",{_handleValue:function(r){this._activating||this._emitValue(r)},_handleError:function(r){this._activating||this._emitError(r)}});function changes(r){return new S$6(r)}function fromPromise(r){var n=!1,s=stream(function(o){if(!n){var u=function(A){o.emit(A),o.end()},c=function(A){o.error(A),o.end()},b=r.then(u,c);b&&typeof b.done=="function"&&b.done(),n=!0}});return toProperty(s,null).setName("fromPromise")}function getGlodalPromise(){if(typeof Promise=="function")return Promise;throw new Error("There isn't default Promise, use shim or parameter")}var toPromise=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:getGlodalPromise(),s=null;return new n(function(o,u){r.onAny(function(c){c.type===END&&s!==null?((s.type===VALUE?o:u)(s.value),s=null):s=c})})};function symbolObservablePonyfill(r){var n,s=r.Symbol;return typeof s=="function"?s.observable?n=s.observable:(n=s("observable"),s.observable=n):n="@@observable",n}var root$1;typeof self<"u"?root$1=self:typeof window<"u"?root$1=window:typeof global<"u"?root$1=global:typeof module<"u"?root$1=module:root$1=Function("return this")();var result=symbolObservablePonyfill(root$1),$$observable=result.default?result.default:result;function fromESObservable(r){var n=r[$$observable]?r[$$observable]():r;return stream(function(s){var o=n.subscribe({error:function(u){s.error(u),s.end()},next:function(u){s.emit(u)},complete:function(){s.end()}});return o.unsubscribe?function(){o.unsubscribe()}:o}).setName("fromESObservable")}function ESObservable(r){this._observable=r.takeErrors(1)}extend(ESObservable.prototype,{subscribe:function(r,n,s){var o=this,u=typeof r=="function"?{next:r,error:n,complete:s}:r,c=function(D){D.type===END&&(b=!0),D.type===VALUE&&u.next?u.next(D.value):D.type===ERROR&&u.error?u.error(D.value):D.type===END&&u.complete&&u.complete(D.value)};this._observable.onAny(c);var b=!1,A={unsubscribe:function(){b=!0,o._observable.offAny(c)},get closed(){return b}};return A}});ESObservable.prototype[$$observable]=function(){return this};function toESObservable(){return new ESObservable(this)}function collect(r,n,s){for(var o in r)r.hasOwnProperty(o)&&(n.push(o),s.push(r[o]))}function defaultErrorsCombinator(r){for(var n=void 0,s=0;s<r.length;s++)r[s]!==void 0&&(n===void 0||n.index<r[s].index)&&(n=r[s]);return n.error}function Combine(r,n,s){var o=this;Stream.call(this),this._activeCount=r.length,this._sources=concat(r,n),this._combinator=s,this._aliveCount=0,this._latestValues=new Array(this._sources.length),this._latestErrors=new Array(this._sources.length),fillArray(this._latestValues,NOTHING),this._emitAfterActivation=!1,this._endAfterActivation=!1,this._latestErrorIndex=0,this._$handlers=[];for(var u=function(b){o._$handlers.push(function(A){return o._handleAny(b,A)})},c=0;c<this._sources.length;c++)u(c)}inherit(Combine,Stream,{_name:"combine",_onActivation:function(){this._aliveCount=this._activeCount;for(var r=this._activeCount;r<this._sources.length;r++)this._sources[r].onAny(this._$handlers[r]);for(var n=0;n<this._activeCount;n++)this._sources[n].onAny(this._$handlers[n]);this._emitAfterActivation&&(this._emitAfterActivation=!1,this._emitIfFull()),this._endAfterActivation&&this._emitEnd()},_onDeactivation:function(){var r=this._sources.length,n=void 0;for(n=0;n<r;n++)this._sources[n].offAny(this._$handlers[n])},_emitIfFull:function(){for(var r=!0,n=!1,s=this._latestValues.length,o=new Array(s),u=new Array(s),c=0;c<s;c++)o[c]=this._latestValues[c],u[c]=this._latestErrors[c],o[c]===NOTHING&&(r=!1),u[c]!==void 0&&(n=!0);if(r){var b=this._combinator;this._emitValue(b(o))}n&&this._emitError(defaultErrorsCombinator(u))},_handleAny:function(r,n){n.type===VALUE||n.type===ERROR?(n.type===VALUE&&(this._latestValues[r]=n.value,this._latestErrors[r]=void 0),n.type===ERROR&&(this._latestValues[r]=NOTHING,this._latestErrors[r]={index:this._latestErrorIndex++,error:n.value}),r<this._activeCount&&(this._activating?this._emitAfterActivation=!0:this._emitIfFull())):r<this._activeCount&&(this._aliveCount--,this._aliveCount===0&&(this._activating?this._endAfterActivation=!0:this._emitEnd()))},_clear:function(){Stream.prototype._clear.call(this),this._sources=null,this._latestValues=null,this._latestErrors=null,this._combinator=null,this._$handlers=null}});function combineAsArray(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],s=arguments[2];if(!Array.isArray(n))throw new Error("Combine can only combine active and passive collections of the same type.");return s=s?spread(s,r.length+n.length):function(o){return o},r.length===0?never():new Combine(r,n,s)}function combineAsObject(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments[2];if(typeof n!="object"||Array.isArray(n))throw new Error("Combine can only combine active and passive collections of the same type.");var o=[],u=[],c=[];collect(r,o,u),collect(n,o,c);var b=function(A){for(var D={},V=A.length-1;0<=V;V--)D[o[V]]=A[V];return s?s(D):D};return u.length===0?never():new Combine(u,c,b)}function combine(r,n,s){return typeof n=="function"&&(s=n,n=void 0),Array.isArray(r)?combineAsArray(r,n,s):combineAsObject(r,n,s)}var Observable$2={empty:function(){return never()},concat:function(r,n){return r.merge(n)},of:function(r){return constant(r)},map:function(r,n){return n.map(r)},bimap:function(r,n,s){return s.mapErrors(r).map(n)},ap:function(r,n){return combine([r,n],function(s,o){return s(o)})},chain:function(r,n){return n.flatMap(r)}},staticLand=Object.freeze({Observable:Observable$2}),mixin={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleValue:function(r){var n=this._fn;this._emitValue(n(r))}},S$7=createStream("map",mixin),P$3=createProperty("map",mixin),id$1=function(r){return r};function map$1$1(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:id$1;return new(r._ofSameType(S$7,P$3))(r,{fn:n})}var mixin$1={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleValue:function(r){var n=this._fn;n(r)&&this._emitValue(r)}},S$8=createStream("filter",mixin$1),P$4=createProperty("filter",mixin$1),id$1$1=function(r){return r};function filter(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:id$1$1;return new(r._ofSameType(S$8,P$4))(r,{fn:n})}var mixin$2={_init:function(r){var n=r.n;this._n=n,n<=0&&this._emitEnd()},_handleValue:function(r){this._n!==0&&(this._n--,this._emitValue(r),this._n===0&&this._emitEnd())}},S$9=createStream("take",mixin$2),P$5=createProperty("take",mixin$2);function take(r,n){return new(r._ofSameType(S$9,P$5))(r,{n})}var mixin$3={_init:function(r){var n=r.n;this._n=n,n<=0&&this._emitEnd()},_handleError:function(r){this._n!==0&&(this._n--,this._emitError(r),this._n===0&&this._emitEnd())}},S$10=createStream("takeErrors",mixin$3),P$6=createProperty("takeErrors",mixin$3);function takeErrors(r,n){return new(r._ofSameType(S$10,P$6))(r,{n})}var mixin$4={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleValue:function(r){var n=this._fn;n(r)?this._emitValue(r):this._emitEnd()}},S$11=createStream("takeWhile",mixin$4),P$7=createProperty("takeWhile",mixin$4),id$2=function(r){return r};function takeWhile(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:id$2;return new(r._ofSameType(S$11,P$7))(r,{fn:n})}var mixin$5={_init:function(){this._lastValue=NOTHING},_free:function(){this._lastValue=null},_handleValue:function(r){this._lastValue=r},_handleEnd:function(){this._lastValue!==NOTHING&&this._emitValue(this._lastValue),this._emitEnd()}},S$12=createStream("last",mixin$5),P$8=createProperty("last",mixin$5);function last$1(r){return new(r._ofSameType(S$12,P$8))(r)}var mixin$6={_init:function(r){var n=r.n;this._n=Math.max(0,n)},_handleValue:function(r){this._n===0?this._emitValue(r):this._n--}},S$13=createStream("skip",mixin$6),P$9=createProperty("skip",mixin$6);function skip(r,n){return new(r._ofSameType(S$13,P$9))(r,{n})}var mixin$7={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleValue:function(r){var n=this._fn;this._fn!==null&&!n(r)&&(this._fn=null),this._fn===null&&this._emitValue(r)}},S$14=createStream("skipWhile",mixin$7),P$10=createProperty("skipWhile",mixin$7),id$3=function(r){return r};function skipWhile(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:id$3;return new(r._ofSameType(S$14,P$10))(r,{fn:n})}var mixin$8={_init:function(r){var n=r.fn;this._fn=n,this._prev=NOTHING},_free:function(){this._fn=null,this._prev=null},_handleValue:function(r){var n=this._fn;(this._prev===NOTHING||!n(this._prev,r))&&(this._prev=r,this._emitValue(r))}},S$15=createStream("skipDuplicates",mixin$8),P$11=createProperty("skipDuplicates",mixin$8),eq=function(r,n){return r===n};function skipDuplicates(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:eq;return new(r._ofSameType(S$15,P$11))(r,{fn:n})}var mixin$9={_init:function(r){var n=r.fn,s=r.seed;this._fn=n,this._prev=s},_free:function(){this._prev=null,this._fn=null},_handleValue:function(r){if(this._prev!==NOTHING){var n=this._fn;this._emitValue(n(this._prev,r))}this._prev=r}},S$16=createStream("diff",mixin$9),P$12=createProperty("diff",mixin$9);function defaultFn(r,n){return[r,n]}function diff(r,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:NOTHING;return new(r._ofSameType(S$16,P$12))(r,{fn:n||defaultFn,seed:s})}var P$13=createProperty("scan",{_init:function(r){var n=r.fn,s=r.seed;this._fn=n,this._seed=s,s!==NOTHING&&this._emitValue(s)},_free:function(){this._fn=null,this._seed=null},_handleValue:function(r){var n=this._fn;this._currentEvent===null||this._currentEvent.type===ERROR?this._emitValue(this._seed===NOTHING?r:n(this._seed,r)):this._emitValue(n(this._currentEvent.value,r))}});function scan(r,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:NOTHING;return new P$13(r,{fn:n,seed:s})}var mixin$10={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleValue:function(r){for(var n=this._fn,s=n(r),o=0;o<s.length;o++)this._emitValue(s[o])}},S$17=createStream("flatten",mixin$10),id$4=function(r){return r};function flatten(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:id$4;return new S$17(r,{fn:n})}var END_MARKER={},mixin$11={_init:function(r){var n=this,s=r.wait;this._wait=Math.max(0,s),this._buff=[],this._$shiftBuff=function(){var o=n._buff.shift();o===END_MARKER?n._emitEnd():n._emitValue(o)}},_free:function(){this._buff=null,this._$shiftBuff=null},_handleValue:function(r){this._activating?this._emitValue(r):(this._buff.push(r),setTimeout(this._$shiftBuff,this._wait))},_handleEnd:function(){this._activating?this._emitEnd():(this._buff.push(END_MARKER),setTimeout(this._$shiftBuff,this._wait))}},S$18=createStream("delay",mixin$11),P$14=createProperty("delay",mixin$11);function delay(r,n){return new(r._ofSameType(S$18,P$14))(r,{wait:n})}var now$2=Date.now?function(){return Date.now()}:function(){return new Date().getTime()},mixin$12={_init:function(r){var n=this,s=r.wait,o=r.leading,u=r.trailing;this._wait=Math.max(0,s),this._leading=o,this._trailing=u,this._trailingValue=null,this._timeoutId=null,this._endLater=!1,this._lastCallTime=0,this._$trailingCall=function(){return n._trailingCall()}},_free:function(){this._trailingValue=null,this._$trailingCall=null},_handleValue:function(r){if(this._activating)this._emitValue(r);else{var n=now$2();this._lastCallTime===0&&!this._leading&&(this._lastCallTime=n);var s=this._wait-(n-this._lastCallTime);s<=0?(this._cancelTrailing(),this._lastCallTime=n,this._emitValue(r)):this._trailing&&(this._cancelTrailing(),this._trailingValue=r,this._timeoutId=setTimeout(this._$trailingCall,s))}},_handleEnd:function(){this._activating?this._emitEnd():this._timeoutId?this._endLater=!0:this._emitEnd()},_cancelTrailing:function(){this._timeoutId!==null&&(clearTimeout(this._timeoutId),this._timeoutId=null)},_trailingCall:function(){this._emitValue(this._trailingValue),this._timeoutId=null,this._trailingValue=null,this._lastCallTime=this._leading?now$2():0,this._endLater&&this._emitEnd()}},S$19=createStream("throttle",mixin$12),P$15=createProperty("throttle",mixin$12);function throttle(r,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.leading,u=o===void 0?!0:o,c=s.trailing,b=c===void 0?!0:c;return new(r._ofSameType(S$19,P$15))(r,{wait:n,leading:u,trailing:b})}var mixin$13={_init:function(r){var n=this,s=r.wait,o=r.immediate;this._wait=Math.max(0,s),this._immediate=o,this._lastAttempt=0,this._timeoutId=null,this._laterValue=null,this._endLater=!1,this._$later=function(){return n._later()}},_free:function(){this._laterValue=null,this._$later=null},_handleValue:function(r){this._activating?this._emitValue(r):(this._lastAttempt=now$2(),this._immediate&&!this._timeoutId&&this._emitValue(r),this._timeoutId||(this._timeoutId=setTimeout(this._$later,this._wait)),this._immediate||(this._laterValue=r))},_handleEnd:function(){this._activating?this._emitEnd():this._timeoutId&&!this._immediate?this._endLater=!0:this._emitEnd()},_later:function(){var r=now$2()-this._lastAttempt;if(r<this._wait&&r>=0)this._timeoutId=setTimeout(this._$later,this._wait-r);else{if(this._timeoutId=null,!this._immediate){var n=this._laterValue;this._laterValue=null,this._emitValue(n)}this._endLater&&this._emitEnd()}}},S$20=createStream("debounce",mixin$13),P$16=createProperty("debounce",mixin$13);function debounce(r,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.immediate,u=o===void 0?!1:o;return new(r._ofSameType(S$20,P$16))(r,{wait:n,immediate:u})}var mixin$14={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleError:function(r){var n=this._fn;this._emitError(n(r))}},S$21=createStream("mapErrors",mixin$14),P$17=createProperty("mapErrors",mixin$14),id$5=function(r){return r};function mapErrors(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:id$5;return new(r._ofSameType(S$21,P$17))(r,{fn:n})}var mixin$15={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleError:function(r){var n=this._fn;n(r)&&this._emitError(r)}},S$22=createStream("filterErrors",mixin$15),P$18=createProperty("filterErrors",mixin$15),id$6=function(r){return r};function filterErrors(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:id$6;return new(r._ofSameType(S$22,P$18))(r,{fn:n})}var mixin$16={_handleValue:function(){}},S$23=createStream("ignoreValues",mixin$16),P$19=createProperty("ignoreValues",mixin$16);function ignoreValues(r){return new(r._ofSameType(S$23,P$19))(r)}var mixin$17={_handleError:function(){}},S$24=createStream("ignoreErrors",mixin$17),P$20=createProperty("ignoreErrors",mixin$17);function ignoreErrors(r){return new(r._ofSameType(S$24,P$20))(r)}var mixin$18={_handleEnd:function(){}},S$25=createStream("ignoreEnd",mixin$18),P$21=createProperty("ignoreEnd",mixin$18);function ignoreEnd(r){return new(r._ofSameType(S$25,P$21))(r)}var mixin$19={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleEnd:function(){var r=this._fn;this._emitValue(r()),this._emitEnd()}},S$26=createStream("beforeEnd",mixin$19),P$22=createProperty("beforeEnd",mixin$19);function beforeEnd(r,n){return new(r._ofSameType(S$26,P$22))(r,{fn:n})}var mixin$20={_init:function(r){var n=r.min,s=r.max;this._max=s,this._min=n,this._buff=[]},_free:function(){this._buff=null},_handleValue:function(r){this._buff=slide(this._buff,r,this._max),this._buff.length>=this._min&&this._emitValue(this._buff)}},S$27=createStream("slidingWindow",mixin$20),P$23=createProperty("slidingWindow",mixin$20);function slidingWindow(r,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return new(r._ofSameType(S$27,P$23))(r,{min:s,max:n})}var mixin$21={_init:function(r){var n=r.fn,s=r.flushOnEnd;this._fn=n,this._flushOnEnd=s,this._buff=[]},_free:function(){this._buff=null},_flush:function(){this._buff!==null&&this._buff.length!==0&&(this._emitValue(this._buff),this._buff=[])},_handleValue:function(r){this._buff.push(r);var n=this._fn;n(r)||this._flush()},_handleEnd:function(){this._flushOnEnd&&this._flush(),this._emitEnd()}},S$28=createStream("bufferWhile",mixin$21),P$24=createProperty("bufferWhile",mixin$21),id$7=function(r){return r};function bufferWhile(r,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.flushOnEnd,u=o===void 0?!0:o;return new(r._ofSameType(S$28,P$24))(r,{fn:n||id$7,flushOnEnd:u})}var mixin$22={_init:function(r){var n=r.count,s=r.flushOnEnd;this._count=n,this._flushOnEnd=s,this._buff=[]},_free:function(){this._buff=null},_flush:function(){this._buff!==null&&this._buff.length!==0&&(this._emitValue(this._buff),this._buff=[])},_handleValue:function(r){this._buff.push(r),this._buff.length>=this._count&&this._flush()},_handleEnd:function(){this._flushOnEnd&&this._flush(),this._emitEnd()}},S$29=createStream("bufferWithCount",mixin$22),P$25=createProperty("bufferWithCount",mixin$22);function bufferWhile$1(r,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.flushOnEnd,u=o===void 0?!0:o;return new(r._ofSameType(S$29,P$25))(r,{count:n,flushOnEnd:u})}var mixin$23={_init:function(r){var n=this,s=r.wait,o=r.count,u=r.flushOnEnd;this._wait=s,this._count=o,this._flushOnEnd=u,this._intervalId=null,this._$onTick=function(){return n._flush()},this._buff=[]},_free:function(){this._$onTick=null,this._buff=null},_flush:function(){this._buff!==null&&(this._emitValue(this._buff),this._buff=[])},_handleValue:function(r){this._buff.push(r),this._buff.length>=this._count&&(clearInterval(this._intervalId),this._flush(),this._intervalId=setInterval(this._$onTick,this._wait))},_handleEnd:function(){this._flushOnEnd&&this._buff.length!==0&&this._flush(),this._emitEnd()},_onActivation:function(){this._intervalId=setInterval(this._$onTick,this._wait),this._source.onAny(this._$handleAny)},_onDeactivation:function(){this._intervalId!==null&&(clearInterval(this._intervalId),this._intervalId=null),this._source.offAny(this._$handleAny)}},S$30=createStream("bufferWithTimeOrCount",mixin$23),P$26=createProperty("bufferWithTimeOrCount",mixin$23);function bufferWithTimeOrCount(r,n,s){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},u=o.flushOnEnd,c=u===void 0?!0:u;return new(r._ofSameType(S$30,P$26))(r,{wait:n,count:s,flushOnEnd:c})}function xformForObs(r){return{"@@transducer/step":function(n,s){return r._emitValue(s),null},"@@transducer/result":function(){return r._emitEnd(),null}}}var mixin$24={_init:function(r){var n=r.transducer;this._xform=n(xformForObs(this))},_free:function(){this._xform=null},_handleValue:function(r){this._xform["@@transducer/step"](null,r)!==null&&this._xform["@@transducer/result"](null)},_handleEnd:function(){this._xform["@@transducer/result"](null)}},S$31=createStream("transduce",mixin$24),P$27=createProperty("transduce",mixin$24);function transduce(r,n){return new(r._ofSameType(S$31,P$27))(r,{transducer:n})}var mixin$25={_init:function(r){var n=r.fn;this._handler=n,this._emitter=emitter(this)},_free:function(){this._handler=null,this._emitter=null},_handleAny:function(r){this._handler(this._emitter,r)}},S$32=createStream("withHandler",mixin$25),P$28=createProperty("withHandler",mixin$25);function withHandler(r,n){return new(r._ofSameType(S$32,P$28))(r,{fn:n})}var isArray=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};function Zip(r,n){var s=this;Stream.call(this),this._buffers=map$1(r,function(c){return isArray(c)?cloneArray(c):[]}),this._sources=map$1(r,function(c){return isArray(c)?never():c}),this._combinator=n?spread(n,this._sources.length):function(c){return c},this._aliveCount=0,this._$handlers=[];for(var o=function(c){s._$handlers.push(function(b){return s._handleAny(c,b)})},u=0;u<this._sources.length;u++)o(u)}inherit(Zip,Stream,{_name:"zip",_onActivation:function(){for(;this._isFull();)this._emit();var r=this._sources.length;this._aliveCount=r;for(var n=0;n<r&&this._active;n++)this._sources[n].onAny(this._$handlers[n])},_onDeactivation:function(){for(var r=0;r<this._sources.length;r++)this._sources[r].offAny(this._$handlers[r])},_emit:function(){for(var r=new Array(this._buffers.length),n=0;n<this._buffers.length;n++)r[n]=this._buffers[n].shift();var s=this._combinator;this._emitValue(s(r))},_isFull:function(){for(var r=0;r<this._buffers.length;r++)if(this._buffers[r].length===0)return!1;return!0},_handleAny:function(r,n){n.type===VALUE&&(this._buffers[r].push(n.value),this._isFull()&&this._emit()),n.type===ERROR&&this._emitError(n.value),n.type===END&&(this._aliveCount--,this._aliveCount===0&&this._emitEnd())},_clear:function(){Stream.prototype._clear.call(this),this._sources=null,this._buffers=null,this._combinator=null,this._$handlers=null}});function zip(r,n){return r.length===0?never():new Zip(r,n)}var id$8=function(r){return r};function AbstractPool(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=n.queueLim,o=s===void 0?0:s,u=n.concurLim,c=u===void 0?-1:u,b=n.drop,A=b===void 0?"new":b;Stream.call(this),this._queueLim=o<0?-1:o,this._concurLim=c<0?-1:c,this._drop=A,this._queue=[],this._curSources=[],this._$handleSubAny=function(D){return r._handleSubAny(D)},this._$endHandlers=[],this._currentlyAdding=null,this._concurLim===0&&this._emitEnd()}inherit(AbstractPool,Stream,{_name:"abstractPool",_add:function(r,n){n=n||id$8,this._concurLim===-1||this._curSources.length<this._concurLim?this._addToCur(n(r)):this._queueLim===-1||this._queue.length<this._queueLim?this._addToQueue(n(r)):this._drop==="old"&&(this._removeOldest(),this._add(r,n))},_addAll:function(r){var n=this;forEach(r,function(s){return n._add(s)})},_remove:function(r){this._removeCur(r)===-1&&this._removeQueue(r)},_addToQueue:function(r){this._queue=concat(this._queue,[r])},_addToCur:function(r){if(this._active){if(!r._alive){r._currentEvent&&this._emit(r._currentEvent.type,r._currentEvent.value),this._active&&(this._queue.length!==0?this._pullQueue():this._curSources.length===0&&this._onEmpty());return}this._currentlyAdding=r,r.onAny(this._$handleSubAny),this._currentlyAdding=null,r._alive?(this._curSources=concat(this._curSources,[r]),this._active&&this._subToEnd(r)):this._queue.length!==0?this._pullQueue():this._curSources.length===0&&this._onEmpty()}else this._curSources=concat(this._curSources,[r])},_subToEnd:function(r){var n=this,s=function(){return n._removeCur(r)};this._$endHandlers.push({obs:r,handler:s}),r.onEnd(s)},_subscribe:function(r){r.onAny(this._$handleSubAny),this._active&&this._subToEnd(r)},_unsubscribe:function(r){r.offAny(this._$handleSubAny);var n=findByPred(this._$endHandlers,function(s){return s.obs===r});n!==-1&&(r.offEnd(this._$endHandlers[n].handler),this._$endHandlers.splice(n,1))},_handleSubAny:function(r){r.type===VALUE?this._emitValue(r.value):r.type===ERROR&&this._emitError(r.value)},_removeQueue:function(r){var n=find(this._queue,r);return this._queue=remove(this._queue,n),n},_removeCur:function(r){this._active&&this._unsubscribe(r);var n=find(this._curSources,r);return this._curSources=remove(this._curSources,n),n!==-1&&(this._queue.length!==0?this._pullQueue():this._curSources.length===0&&this._onEmpty()),n},_removeOldest:function(){this._removeCur(this._curSources[0])},_pullQueue:function(){this._queue.length!==0&&(this._queue=cloneArray(this._queue),this._addToCur(this._queue.shift()))},_onActivation:function(){for(var r=0,n=this._curSources;r<n.length&&this._active;r++)this._subscribe(n[r])},_onDeactivation:function(){for(var r=0,n=this._curSources;r<n.length;r++)this._unsubscribe(n[r]);this._currentlyAdding!==null&&this._unsubscribe(this._currentlyAdding)},_isEmpty:function(){return this._curSources.length===0},_onEmpty:function(){},_clear:function(){Stream.prototype._clear.call(this),this._queue=null,this._curSources=null,this._$handleSubAny=null,this._$endHandlers=null}});function Merge(r){AbstractPool.call(this),this._addAll(r),this._initialised=!0}inherit(Merge,AbstractPool,{_name:"merge",_onEmpty:function(){this._initialised&&this._emitEnd()}});function merge(r){return r.length===0?never():new Merge(r)}function S$33(r){var n=this;Stream.call(this),this._generator=r,this._source=null,this._inLoop=!1,this._iteration=0,this._$handleAny=function(s){return n._handleAny(s)}}inherit(S$33,Stream,{_name:"repeat",_handleAny:function(r){r.type===END?(this._source=null,this._getSource()):this._emit(r.type,r.value)},_getSource:function(){if(!this._inLoop){this._inLoop=!0;for(var r=this._generator;this._source===null&&this._alive&&this._active;)this._source=r(this._iteration++),this._source?this._source.onAny(this._$handleAny):this._emitEnd();this._inLoop=!1}},_onActivation:function(){this._source?this._source.onAny(this._$handleAny):this._getSource()},_onDeactivation:function(){this._source&&this._source.offAny(this._$handleAny)},_clear:function(){Stream.prototype._clear.call(this),this._generator=null,this._source=null,this._$handleAny=null}});var repeat=function(r){return new S$33(r)};function concat$1(r){return repeat(function(n){return r.length>n?r[n]:!1}).setName("concat")}function Pool(){AbstractPool.call(this)}inherit(Pool,AbstractPool,{_name:"pool",plug:function(r){return this._add(r),this},unplug:function(r){return this._remove(r),this}});function FlatMap(r,n,s){var o=this;AbstractPool.call(this,s),this._source=r,this._fn=n,this._mainEnded=!1,this._lastCurrent=null,this._$handleMain=function(u){return o._handleMain(u)}}inherit(FlatMap,AbstractPool,{_onActivation:function(){AbstractPool.prototype._onActivation.call(this),this._active&&this._source.onAny(this._$handleMain)},_onDeactivation:function(){AbstractPool.prototype._onDeactivation.call(this),this._source.offAny(this._$handleMain),this._hadNoEvSinceDeact=!0},_handleMain:function(r){if(r.type===VALUE){var n=this._activating&&this._hadNoEvSinceDeact&&this._lastCurrent===r.value;n||this._add(r.value,this._fn),this._lastCurrent=r.value,this._hadNoEvSinceDeact=!1}r.type===ERROR&&this._emitError(r.value),r.type===END&&(this._isEmpty()?this._emitEnd():this._mainEnded=!0)},_onEmpty:function(){this._mainEnded&&this._emitEnd()},_clear:function(){AbstractPool.prototype._clear.call(this),this._source=null,this._lastCurrent=null,this._$handleMain=null}});function FlatMapErrors(r,n){FlatMap.call(this,r,n)}inherit(FlatMapErrors,FlatMap,{_handleMain:function(r){if(r.type===ERROR){var n=this._activating&&this._hadNoEvSinceDeact&&this._lastCurrent===r.value;n||this._add(r.value,this._fn),this._lastCurrent=r.value,this._hadNoEvSinceDeact=!1}r.type===VALUE&&this._emitValue(r.value),r.type===END&&(this._isEmpty()?this._emitEnd():this._mainEnded=!0)}});function createConstructor$1(r,n){return function(o,u,c){var b=this;r.call(this),this._primary=o,this._secondary=u,this._name=o._name+"."+n,this._lastSecondary=NOTHING,this._$handleSecondaryAny=function(A){return b._handleSecondaryAny(A)},this._$handlePrimaryAny=function(A){return b._handlePrimaryAny(A)},this._init(c)}}function createClassMethods$1(r){return{_init:function(){},_free:function(){},_handlePrimaryValue:function(n){this._emitValue(n)},_handlePrimaryError:function(n){this._emitError(n)},_handlePrimaryEnd:function(){this._emitEnd()},_handleSecondaryValue:function(n){this._lastSecondary=n},_handleSecondaryError:function(n){this._emitError(n)},_handleSecondaryEnd:function(){},_handlePrimaryAny:function(n){switch(n.type){case VALUE:return this._handlePrimaryValue(n.value);case ERROR:return this._handlePrimaryError(n.value);case END:return this._handlePrimaryEnd(n.value)}},_handleSecondaryAny:function(n){switch(n.type){case VALUE:return this._handleSecondaryValue(n.value);case ERROR:return this._handleSecondaryError(n.value);case END:this._handleSecondaryEnd(n.value),this._removeSecondary()}},_removeSecondary:function(){this._secondary!==null&&(this._secondary.offAny(this._$handleSecondaryAny),this._$handleSecondaryAny=null,this._secondary=null)},_onActivation:function(){this._secondary!==null&&this._secondary.onAny(this._$handleSecondaryAny),this._active&&this._primary.onAny(this._$handlePrimaryAny)},_onDeactivation:function(){this._secondary!==null&&this._secondary.offAny(this._$handleSecondaryAny),this._primary.offAny(this._$handlePrimaryAny)},_clear:function(){r.prototype._clear.call(this),this._primary=null,this._secondary=null,this._lastSecondary=null,this._$handleSecondaryAny=null,this._$handlePrimaryAny=null,this._free()}}}function createStream$1(r,n){var s=createConstructor$1(Stream,r);return inherit(s,Stream,createClassMethods$1(Stream),n),s}function createProperty$1(r,n){var s=createConstructor$1(Property,r);return inherit(s,Property,createClassMethods$1(Property),n),s}var mixin$26={_handlePrimaryValue:function(r){this._lastSecondary!==NOTHING&&this._lastSecondary&&this._emitValue(r)},_handleSecondaryEnd:function(){(this._lastSecondary===NOTHING||!this._lastSecondary)&&this._emitEnd()}},S$34=createStream$1("filterBy",mixin$26),P$29=createProperty$1("filterBy",mixin$26);function filterBy(r,n){return new(r._ofSameType(S$34,P$29))(r,n)}var id2=function(r,n){return n};function sampledBy(r,n,s){var o=s?function(u,c){return s(c,u)}:id2;return combine([n],[r],o).setName(r,"sampledBy")}var mixin$27={_handlePrimaryValue:function(r){this._lastSecondary!==NOTHING&&this._emitValue(r)},_handleSecondaryEnd:function(){this._lastSecondary===NOTHING&&this._emitEnd()}},S$35=createStream$1("skipUntilBy",mixin$27),P$30=createProperty$1("skipUntilBy",mixin$27);function skipUntilBy(r,n){return new(r._ofSameType(S$35,P$30))(r,n)}var mixin$28={_handleSecondaryValue:function(){this._emitEnd()}},S$36=createStream$1("takeUntilBy",mixin$28),P$31=createProperty$1("takeUntilBy",mixin$28);function takeUntilBy(r,n){return new(r._ofSameType(S$36,P$31))(r,n)}var mixin$29={_init:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=r.flushOnEnd,s=n===void 0?!0:n;this._buff=[],this._flushOnEnd=s},_free:function(){this._buff=null},_flush:function(){this._buff!==null&&(this._emitValue(this._buff),this._buff=[])},_handlePrimaryEnd:function(){this._flushOnEnd&&this._flush(),this._emitEnd()},_onActivation:function(){this._primary.onAny(this._$handlePrimaryAny),this._alive&&this._secondary!==null&&this._secondary.onAny(this._$handleSecondaryAny)},_handlePrimaryValue:function(r){this._buff.push(r)},_handleSecondaryValue:function(){this._flush()},_handleSecondaryEnd:function(){this._flushOnEnd||this._emitEnd()}},S$37=createStream$1("bufferBy",mixin$29),P$32=createProperty$1("bufferBy",mixin$29);function bufferBy(r,n,s){return new(r._ofSameType(S$37,P$32))(r,n,s)}var mixin$30={_init:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=r.flushOnEnd,s=n===void 0?!0:n,o=r.flushOnChange,u=o===void 0?!1:o;this._buff=[],this._flushOnEnd=s,this._flushOnChange=u},_free:function(){this._buff=null},_flush:function(){this._buff!==null&&(this._emitValue(this._buff),this._buff=[])},_handlePrimaryEnd:function(){this._flushOnEnd&&this._flush(),this._emitEnd()},_handlePrimaryValue:function(r){this._buff.push(r),this._lastSecondary!==NOTHING&&!this._lastSecondary&&this._flush()},_handleSecondaryEnd:function(){!this._flushOnEnd&&(this._lastSecondary===NOTHING||this._lastSecondary)&&this._emitEnd()},_handleSecondaryValue:function(r){this._flushOnChange&&!r&&this._flush(),this._lastSecondary=r}},S$38=createStream$1("bufferWhileBy",mixin$30),P$33=createProperty$1("bufferWhileBy",mixin$30);function bufferWhileBy(r,n,s){return new(r._ofSameType(S$38,P$33))(r,n,s)}var f=function(){return!1},t=function(){return!0};function awaiting(r,n){var s=merge([map$1$1(r,t),map$1$1(n,f)]);return s=skipDuplicates(s),s=toProperty(s,f),s.setName(r,"awaiting")}var mixin$31={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleValue:function(r){var n=this._fn,s=n(r);s.convert?this._emitError(s.error):this._emitValue(r)}},S$39=createStream("valuesToErrors",mixin$31),P$34=createProperty("valuesToErrors",mixin$31),defFn=function(r){return{convert:!0,error:r}};function valuesToErrors(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:defFn;return new(r._ofSameType(S$39,P$34))(r,{fn:n})}var mixin$32={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleError:function(r){var n=this._fn,s=n(r);s.convert?this._emitValue(s.value):this._emitError(r)}},S$40=createStream("errorsToValues",mixin$32),P$35=createProperty("errorsToValues",mixin$32),defFn$1=function(r){return{convert:!0,value:r}};function errorsToValues(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:defFn$1;return new(r._ofSameType(S$40,P$35))(r,{fn:n})}var mixin$33={_handleError:function(r){this._emitError(r),this._emitEnd()}},S$41=createStream("endOnError",mixin$33),P$36=createProperty("endOnError",mixin$33);function endOnError(r){return new(r._ofSameType(S$41,P$36))(r)}Observable.prototype.toProperty=function(r){return toProperty(this,r)};Observable.prototype.changes=function(){return changes(this)};Observable.prototype.toPromise=function(r){return toPromise(this,r)};Observable.prototype.toESObservable=toESObservable;Observable.prototype[$$observable]=toESObservable;Observable.prototype.map=function(r){return map$1$1(this,r)};Observable.prototype.filter=function(r){return filter(this,r)};Observable.prototype.take=function(r){return take(this,r)};Observable.prototype.takeErrors=function(r){return takeErrors(this,r)};Observable.prototype.takeWhile=function(r){return takeWhile(this,r)};Observable.prototype.last=function(){return last$1(this)};Observable.prototype.skip=function(r){return skip(this,r)};Observable.prototype.skipWhile=function(r){return skipWhile(this,r)};Observable.prototype.skipDuplicates=function(r){return skipDuplicates(this,r)};Observable.prototype.diff=function(r,n){return diff(this,r,n)};Observable.prototype.scan=function(r,n){return scan(this,r,n)};Observable.prototype.flatten=function(r){return flatten(this,r)};Observable.prototype.delay=function(r){return delay(this,r)};Observable.prototype.throttle=function(r,n){return throttle(this,r,n)};Observable.prototype.debounce=function(r,n){return debounce(this,r,n)};Observable.prototype.mapErrors=function(r){return mapErrors(this,r)};Observable.prototype.filterErrors=function(r){return filterErrors(this,r)};Observable.prototype.ignoreValues=function(){return ignoreValues(this)};Observable.prototype.ignoreErrors=function(){return ignoreErrors(this)};Observable.prototype.ignoreEnd=function(){return ignoreEnd(this)};Observable.prototype.beforeEnd=function(r){return beforeEnd(this,r)};Observable.prototype.slidingWindow=function(r,n){return slidingWindow(this,r,n)};Observable.prototype.bufferWhile=function(r,n){return bufferWhile(this,r,n)};Observable.prototype.bufferWithCount=function(r,n){return bufferWhile$1(this,r,n)};Observable.prototype.bufferWithTimeOrCount=function(r,n,s){return bufferWithTimeOrCount(this,r,n,s)};Observable.prototype.transduce=function(r){return transduce(this,r)};Observable.prototype.withHandler=function(r){return withHandler(this,r)};Observable.prototype.thru=function(r){return r(this)};Observable.prototype.combine=function(r,n){return combine([this,r],n)};Observable.prototype.zip=function(r,n){return zip([this,r],n)};Observable.prototype.merge=function(r){return merge([this,r])};Observable.prototype.concat=function(r){return concat$1([this,r])};var pool=function(){return new Pool};Observable.prototype.flatMap=function(r){return new FlatMap(this,r).setName(this,"flatMap")};Observable.prototype.flatMapLatest=function(r){return new FlatMap(this,r,{concurLim:1,drop:"old"}).setName(this,"flatMapLatest")};Observable.prototype.flatMapFirst=function(r){return new FlatMap(this,r,{concurLim:1}).setName(this,"flatMapFirst")};Observable.prototype.flatMapConcat=function(r){return new FlatMap(this,r,{queueLim:-1,concurLim:1}).setName(this,"flatMapConcat")};Observable.prototype.flatMapConcurLimit=function(r,n){return new FlatMap(this,r,{queueLim:-1,concurLim:n}).setName(this,"flatMapConcurLimit")};Observable.prototype.flatMapErrors=function(r){return new FlatMapErrors(this,r).setName(this,"flatMapErrors")};Observable.prototype.filterBy=function(r){return filterBy(this,r)};Observable.prototype.sampledBy=function(r,n){return sampledBy(this,r,n)};Observable.prototype.skipUntilBy=function(r){return skipUntilBy(this,r)};Observable.prototype.takeUntilBy=function(r){return takeUntilBy(this,r)};Observable.prototype.bufferBy=function(r,n){return bufferBy(this,r,n)};Observable.prototype.bufferWhileBy=function(r,n){return bufferWhileBy(this,r,n)};function warn(r){if(console&&typeof console.warn=="function"){var n=`
Here is an Error object for you containing the call stack:`;console.warn(r,n,new Error)}}Observable.prototype.awaiting=function(r){return warn("You are using deprecated .awaiting() method, see https://github.com/kefirjs/kefir/issues/145"),awaiting(this,r)};Observable.prototype.valuesToErrors=function(r){return warn("You are using deprecated .valuesToErrors() method, see https://github.com/kefirjs/kefir/issues/149"),valuesToErrors(this,r)};Observable.prototype.errorsToValues=function(r){return warn("You are using deprecated .errorsToValues() method, see https://github.com/kefirjs/kefir/issues/149"),errorsToValues(this,r)};Observable.prototype.endOnError=function(){return warn("You are using deprecated .endOnError() method, see https://github.com/kefirjs/kefir/issues/150"),endOnError(this)};var Kefir={Observable,Stream,Property,never,later,interval,sequentially,fromPoll,withInterval,fromCallback,fromNodeCallback,fromEvents,stream,constant,constantError,fromPromise,fromESObservable,combine,zip,merge,concat:concat$1,Pool,pool,repeat,staticLand};Kefir.Kefir=Kefir;const mousedown_=Kefir.fromEvents(window,"mousedown"),mouseup_=Kefir.fromEvents(window,"mouseup");Kefir.fromEvents(window,"keydown").filter(r=>r.shiftKey);Kefir.fromEvents(window,"keyup");const mousemove_=Kefir.fromEvents(window,"mousemove");Kefir.fromEvents(window,"wheel");const asr=(r,n,s)=>r.flatMap(o=>Kefir.constant(o).sampledBy(n,(u,c)=>assoc$1("atk",u,c)).takeUntilBy(s));asr(mousedown_,Kefir.interval(10,{movementX:"test"}),mouseup_);const obs=r=>n=>n.onValue(s=>r(s));asr(mousedown_,mousemove_,mouseup_);var Output=function({regl:r,precision:n,label:s="",width:o,height:u}){this.regl=r,this.precision=n,this.label=s,this.positionBuffer=this.regl.buffer([[-2,0],[0,-2],[2,2]]),this.draw=()=>{},this.init(),this.pingPongIndex=0,this.fbos=Array(2).fill().map(()=>this.regl.framebuffer({color:this.regl.texture({mag:"nearest",width:o,height:u,format:"rgba"}),depthStencil:!1}))};Output.prototype.resize=function(r,n){this.fbos.forEach(s=>{s.resize(r,n)})};Output.prototype.getCurrent=function(){return this.fbos[this.pingPongIndex]};Output.prototype.getTexture=function(){var r=this.pingPongIndex?0:1;return this.fbos[r]};Output.prototype.init=function(){return this.transformIndex=0,this.fragHeader=`
  precision ${this.precision} float;

  uniform float time;
  varying vec2 uv;
  `,this.fragBody="",this.vert=`
  precision ${this.precision} float;
  attribute vec2 position;
  varying vec2 uv;

  void main () {
    uv = position;
    gl_Position = vec4(2.0 * position - 1.0, 0, 1);
  }`,this.attributes={position:this.positionBuffer},this.uniforms={time:this.regl.prop("time"),resolution:this.regl.prop("resolution")},this.frag=`
       ${this.fragHeader}

      void main () {
        vec4 c = vec4(0, 0, 0, 0);
        vec2 st = uv;
        ${this.fragBody}
        gl_FragColor = c;
      }
  `,this};Output.prototype.render=function(r){let n=r[0];var s=this,o=Object.assign(n.uniforms,{prevBuffer:()=>s.fbos[s.pingPongIndex]});s.draw=s.regl({frag:n.frag,vert:s.vert,attributes:s.attributes,uniforms:o,count:3,framebuffer:()=>(s.pingPongIndex=s.pingPongIndex?0:1,s.fbos[s.pingPongIndex])})};Output.prototype.tick=function(r){this.draw(r)};var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var inherits_browser={exports:{}};typeof Object.create=="function"?inherits_browser.exports=function(n,s){s&&(n.super_=s,n.prototype=Object.create(s.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(n,s){if(s){n.super_=s;var o=function(){};o.prototype=s.prototype,n.prototype=new o,n.prototype.constructor=n}};function EventEmitter$1(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var events=EventEmitter$1;EventEmitter$1.EventEmitter=EventEmitter$1;EventEmitter$1.prototype._events=void 0;EventEmitter$1.prototype._maxListeners=void 0;EventEmitter$1.defaultMaxListeners=10;EventEmitter$1.prototype.setMaxListeners=function(r){if(!isNumber(r)||r<0||isNaN(r))throw TypeError("n must be a positive number");return this._maxListeners=r,this};EventEmitter$1.prototype.emit=function(r){var n,s,o,u,c,b;if(this._events||(this._events={}),r==="error"&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(n=arguments[1],n instanceof Error)throw n;var A=new Error('Uncaught, unspecified "error" event. ('+n+")");throw A.context=n,A}if(s=this._events[r],isUndefined(s))return!1;if(isFunction(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),s.apply(this,u)}else if(isObject(s))for(u=Array.prototype.slice.call(arguments,1),b=s.slice(),o=b.length,c=0;c<o;c++)b[c].apply(this,u);return!0};EventEmitter$1.prototype.addListener=function(r,n){var s;if(!isFunction(n))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",r,isFunction(n.listener)?n.listener:n),this._events[r]?isObject(this._events[r])?this._events[r].push(n):this._events[r]=[this._events[r],n]:this._events[r]=n,isObject(this._events[r])&&!this._events[r].warned&&(isUndefined(this._maxListeners)?s=EventEmitter$1.defaultMaxListeners:s=this._maxListeners,s&&s>0&&this._events[r].length>s&&(this._events[r].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[r].length),typeof console.trace=="function"&&console.trace())),this};EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener;EventEmitter$1.prototype.once=function(r,n){if(!isFunction(n))throw TypeError("listener must be a function");var s=!1;function o(){this.removeListener(r,o),s||(s=!0,n.apply(this,arguments))}return o.listener=n,this.on(r,o),this};EventEmitter$1.prototype.removeListener=function(r,n){var s,o,u,c;if(!isFunction(n))throw TypeError("listener must be a function");if(!this._events||!this._events[r])return this;if(s=this._events[r],u=s.length,o=-1,s===n||isFunction(s.listener)&&s.listener===n)delete this._events[r],this._events.removeListener&&this.emit("removeListener",r,n);else if(isObject(s)){for(c=u;c-- >0;)if(s[c]===n||s[c].listener&&s[c].listener===n){o=c;break}if(o<0)return this;s.length===1?(s.length=0,delete this._events[r]):s.splice(o,1),this._events.removeListener&&this.emit("removeListener",r,n)}return this};EventEmitter$1.prototype.removeAllListeners=function(r){var n,s;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[r]&&delete this._events[r],this;if(arguments.length===0){for(n in this._events)n!=="removeListener"&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events={},this}if(s=this._events[r],isFunction(s))this.removeListener(r,s);else if(s)for(;s.length;)this.removeListener(r,s[s.length-1]);return delete this._events[r],this};EventEmitter$1.prototype.listeners=function(r){var n;return!this._events||!this._events[r]?n=[]:isFunction(this._events[r])?n=[this._events[r]]:n=this._events[r].slice(),n};EventEmitter$1.prototype.listenerCount=function(r){if(this._events){var n=this._events[r];if(isFunction(n))return 1;if(n)return n.length}return 0};EventEmitter$1.listenerCount=function(r,n){return r.listenerCount(n)};function isFunction(r){return typeof r=="function"}function isNumber(r){return typeof r=="number"}function isObject(r){return typeof r=="object"&&r!==null}function isUndefined(r){return r===void 0}var browser=performance&&performance.now?function(){return performance.now()}:Date.now||function(){return+new Date},raf$2={exports:{}},performanceNow={exports:{}};(function(){var r,n,s,o,u,c;typeof performance<"u"&&performance!==null&&performance.now?performanceNow.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(performanceNow.exports=function(){return(r()-u)/1e6},n=process.hrtime,r=function(){var b;return b=n(),b[0]*1e9+b[1]},o=r(),c=process.uptime()*1e9,u=o-c):Date.now?(performanceNow.exports=function(){return Date.now()-s},s=Date.now()):(performanceNow.exports=function(){return new Date().getTime()-s},s=new Date().getTime())}).call(commonjsGlobal);var now$1=performanceNow.exports,root=typeof window>"u"?commonjsGlobal:window,vendors=["moz","webkit"],suffix="AnimationFrame",raf$1=root["request"+suffix],caf=root["cancel"+suffix]||root["cancelRequest"+suffix];for(var i=0;!raf$1&&i<vendors.length;i++)raf$1=root[vendors[i]+"Request"+suffix],caf=root[vendors[i]+"Cancel"+suffix]||root[vendors[i]+"CancelRequest"+suffix];if(!raf$1||!caf){var last=0,id=0,queue=[],frameDuration=1e3/60;raf$1=function(r){if(queue.length===0){var n=now$1(),s=Math.max(0,frameDuration-(n-last));last=s+n,setTimeout(function(){var o=queue.slice(0);queue.length=0;for(var u=0;u<o.length;u++)if(!o[u].cancelled)try{o[u].callback(last)}catch(c){setTimeout(function(){throw c},0)}},Math.round(s))}return queue.push({handle:++id,callback:r,cancelled:!1}),id},caf=function(r){for(var n=0;n<queue.length;n++)queue[n].handle===r&&(queue[n].cancelled=!0)}}raf$2.exports=function(r){return raf$1.call(root,r)};raf$2.exports.cancel=function(){caf.apply(root,arguments)};raf$2.exports.polyfill=function(r){r||(r=root),r.requestAnimationFrame=raf$1,r.cancelAnimationFrame=caf};var inherits=inherits_browser.exports,EventEmitter=events.EventEmitter,now=browser,raf=raf$2.exports,rafLoop=Engine;function Engine(r){if(!(this instanceof Engine))return new Engine(r);this.running=!1,this.last=now(),this._frame=0,this._tick=this.tick.bind(this),r&&this.on("tick",r)}inherits(Engine,EventEmitter);Engine.prototype.start=function(){if(!this.running)return this.running=!0,this.last=now(),this._frame=raf(this._tick),this};Engine.prototype.stop=function(){return this.running=!1,this._frame!==0&&raf.cancel(this._frame),this._frame=0,this};Engine.prototype.tick=function(){this._frame=raf(this._tick);var r=now(),n=r-this.last;this.emit("tick",n),this.last=r};function Webcam(r){return navigator.mediaDevices.enumerateDevices().then(n=>n.filter(s=>s.kind==="videoinput")).then(n=>{let s={audio:!1,video:!0};return n[r]&&(s.video={deviceId:{exact:n[r].deviceId}}),window.navigator.mediaDevices.getUserMedia(s)}).then(n=>{const s=document.createElement("video");return s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.setAttribute("playsinline",""),s.srcObject=n,new Promise((o,u)=>{s.addEventListener("loadedmetadata",()=>{s.play().then(()=>o({video:s}))})})}).catch(console.log.bind(console))}function Screen(r){return new Promise(function(n,s){navigator.mediaDevices.getDisplayMedia(r).then(o=>{const u=document.createElement("video");u.srcObject=o,u.addEventListener("loadedmetadata",()=>{u.play(),n({video:u})})}).catch(o=>s(o))})}class HydraSource{constructor({regl:n,width:s,height:o,pb:u,label:c=""}){this.label=c,this.regl=n,this.src=null,this.dynamic=!0,this.width=s,this.height=o,this.tex=this.regl.texture({shape:[1,1]}),this.pb=u}init(n,s){"src"in n&&(this.src=n.src,this.tex=this.regl.texture({data:this.src,...s})),"dynamic"in n&&(this.dynamic=n.dynamic)}initCam(n,s){const o=this;Webcam(n).then(u=>{o.src=u.video,o.dynamic=!0,o.tex=o.regl.texture({data:o.src,...s})}).catch(u=>console.log("could not get camera",u))}initVideo(n="",s){const o=document.createElement("video");o.crossOrigin="anonymous",o.autoplay=!0,o.loop=!0,o.muted=!0,o.addEventListener("loadeddata",()=>{this.src=o,o.play(),this.tex=this.regl.texture({data:this.src,...s}),this.dynamic=!0}),o.src=n}initImage(n="",s){const o=document.createElement("img");o.crossOrigin="anonymous",o.src=n,o.onload=()=>{this.src=o,this.dynamic=!1,this.tex=this.regl.texture({data:this.src,...s})}}initStream(n,s){let o=this;n&&this.pb&&(this.pb.initSource(n),this.pb.on("got video",function(u,c){u===n&&(o.src=c,o.dynamic=!0,o.tex=o.regl.texture({data:o.src,...s}))}))}initScreen(n=0,s){const o=this;Screen().then(function(u){o.src=u.video,o.tex=o.regl.texture({data:o.src,...s}),o.dynamic=!0}).catch(u=>console.log("could not get screen",u))}resize(n,s){this.width=n,this.height=s}clear(){this.src&&this.src.srcObject&&this.src.srcObject.getTracks&&this.src.srcObject.getTracks().forEach(n=>n.stop()),this.src=null,this.tex=this.regl.texture({shape:[1,1]})}tick(n){this.src!==null&&this.dynamic===!0&&(this.src.videoWidth&&this.src.videoWidth!==this.tex.width&&(console.log(this.src.videoWidth,this.src.videoHeight,this.tex.width,this.tex.height),this.tex.resize(this.src.videoWidth,this.src.videoHeight)),this.src.width&&this.src.width!==this.tex.width&&this.tex.resize(this.src.width,this.src.height),this.tex.subimage(this.src))}getTexture(){return this.tex}}const mouse={};function mouseButtons(r){if(typeof r=="object"){if("buttons"in r)return r.buttons;if("which"in r){var n=r.which;if(n===2)return 4;if(n===3)return 2;if(n>0)return 1<<n-1}else if("button"in r){var n=r.button;if(n===1)return 4;if(n===2)return 2;if(n>=0)return 1<<n}}return 0}mouse.buttons=mouseButtons;function mouseElement(r){return r.target||r.srcElement||window}mouse.element=mouseElement;function mouseRelativeX(r){return typeof r=="object"&&"pageX"in r?r.pageX:0}mouse.x=mouseRelativeX;function mouseRelativeY(r){return typeof r=="object"&&"pageY"in r?r.pageY:0}mouse.y=mouseRelativeY;function mouseListen(r,n){n||(n=r,r=window);var s=0,o=0,u=0,c={shift:!1,alt:!1,control:!1,meta:!1},b=!1;function A(ce){var $e=!1;return"altKey"in ce&&($e=$e||ce.altKey!==c.alt,c.alt=!!ce.altKey),"shiftKey"in ce&&($e=$e||ce.shiftKey!==c.shift,c.shift=!!ce.shiftKey),"ctrlKey"in ce&&($e=$e||ce.ctrlKey!==c.control,c.control=!!ce.ctrlKey),"metaKey"in ce&&($e=$e||ce.metaKey!==c.meta,c.meta=!!ce.metaKey),$e}function D(ce,$e){var Me=mouse.x($e),_t=mouse.y($e);"buttons"in $e&&(ce=$e.buttons|0),(ce!==s||Me!==o||_t!==u||A($e))&&(s=ce|0,o=Me||0,u=_t||0,n&&n(s,o,u,c))}function V(ce){D(0,ce)}function Ae(){(s||o||u||c.shift||c.alt||c.meta||c.control)&&(o=u=0,s=0,c.shift=c.alt=c.control=c.meta=!1,n&&n(0,0,0,c))}function Le(ce){A(ce)&&n&&n(s,o,u,c)}function Ee(ce){mouse.buttons(ce)===0?D(0,ce):D(s,ce)}function xe(ce){D(s|mouse.buttons(ce),ce)}function Pe(ce){D(s&~mouse.buttons(ce),ce)}function Ne(){b||(b=!0,r.addEventListener("mousemove",Ee),r.addEventListener("mousedown",xe),r.addEventListener("mouseup",Pe),r.addEventListener("mouseleave",V),r.addEventListener("mouseenter",V),r.addEventListener("mouseout",V),r.addEventListener("mouseover",V),r.addEventListener("blur",Ae),r.addEventListener("keyup",Le),r.addEventListener("keydown",Le),r.addEventListener("keypress",Le),r!==window&&(window.addEventListener("blur",Ae),window.addEventListener("keyup",Le),window.addEventListener("keydown",Le),window.addEventListener("keypress",Le)))}function at(){!b||(b=!1,r.removeEventListener("mousemove",Ee),r.removeEventListener("mousedown",xe),r.removeEventListener("mouseup",Pe),r.removeEventListener("mouseleave",V),r.removeEventListener("mouseenter",V),r.removeEventListener("mouseout",V),r.removeEventListener("mouseover",V),r.removeEventListener("blur",Ae),r.removeEventListener("keyup",Le),r.removeEventListener("keydown",Le),r.removeEventListener("keypress",Le),r!==window&&(window.removeEventListener("blur",Ae),window.removeEventListener("keyup",Le),window.removeEventListener("keydown",Le),window.removeEventListener("keypress",Le)))}Ne();var je={element:r};return Object.defineProperties(je,{enabled:{get:function(){return b},set:function(ce){ce?Ne():at()},enumerable:!0},buttons:{get:function(){return s},enumerable:!0},x:{get:function(){return o},enumerable:!0},y:{get:function(){return u},enumerable:!0},mods:{get:function(){return c},enumerable:!0}}),je}var meyda_min={exports:{}};(function(r,n){(function(s,o){r.exports=o()})(commonjsGlobal,function(){function s(R,g,q){if(q||arguments.length===2)for(var N,ne=0,ye=g.length;ne<ye;ne++)!N&&ne in g||(N||(N=Array.prototype.slice.call(g,0,ne)),N[ne]=g[ne]);return R.concat(N||Array.prototype.slice.call(g))}var o=Object.freeze({__proto__:null,blackman:function(R){for(var g=new Float32Array(R),q=2*Math.PI/(R-1),N=2*q,ne=0;ne<R/2;ne++)g[ne]=.42-.5*Math.cos(ne*q)+.08*Math.cos(ne*N);for(ne=Math.ceil(R/2);ne>0;ne--)g[R-ne]=g[ne-1];return g},sine:function(R){for(var g=Math.PI/(R-1),q=new Float32Array(R),N=0;N<R;N++)q[N]=Math.sin(g*N);return q},hanning:function(R){for(var g=new Float32Array(R),q=0;q<R;q++)g[q]=.5-.5*Math.cos(2*Math.PI*q/(R-1));return g},hamming:function(R){for(var g=new Float32Array(R),q=0;q<R;q++)g[q]=.54-.46*Math.cos(2*Math.PI*(q/R-1));return g}}),u={};function c(R){for(;R%2==0&&R>1;)R/=2;return R===1}function b(R,g){if(g!=="rect"){if(g!==""&&g||(g="hanning"),u[g]||(u[g]={}),!u[g][R.length])try{u[g][R.length]=o[g](R.length)}catch{throw new Error("Invalid windowing function")}R=function(q,N){for(var ne=[],ye=0;ye<Math.min(q.length,N.length);ye++)ne[ye]=q[ye]*N[ye];return ne}(R,u[g][R.length])}return R}function A(R,g,q){for(var N=new Float32Array(R),ne=0;ne<N.length;ne++)N[ne]=ne*g/q,N[ne]=13*Math.atan(N[ne]/1315.8)+3.5*Math.atan(Math.pow(N[ne]/7518,2));return N}function D(R){return Float32Array.from(R)}function V(R){return 1125*Math.log(1+R/700)}function Ae(R,g,q){for(var N,ne=new Float32Array(R+2),ye=new Float32Array(R+2),ze=g/2,Ie=V(0),He=(V(ze)-Ie)/(R+1),Ue=new Array(R+2),Xe=0;Xe<ne.length;Xe++)ne[Xe]=Xe*He,ye[Xe]=(N=ne[Xe],700*(Math.exp(N/1125)-1)),Ue[Xe]=Math.floor((q+1)*ye[Xe]/g);for(var ue=new Array(R),ke=0;ke<ue.length;ke++){for(ue[ke]=new Array(q/2+1).fill(0),Xe=Ue[ke];Xe<Ue[ke+1];Xe++)ue[ke][Xe]=(Xe-Ue[ke])/(Ue[ke+1]-Ue[ke]);for(Xe=Ue[ke+1];Xe<Ue[ke+2];Xe++)ue[ke][Xe]=(Ue[ke+2]-Xe)/(Ue[ke+2]-Ue[ke+1])}return ue}function Le(R,g,q,N,ne,ye,ze){N===void 0&&(N=5),ne===void 0&&(ne=2),ye===void 0&&(ye=!0),ze===void 0&&(ze=440);var Ie=Math.floor(q/2)+1,He=new Array(q).fill(0).map(function(wt,Pt){return R*function(It,Bt){return Math.log2(16*It/Bt)}(g*Pt/q,ze)});He[0]=He[1]-1.5*R;var Ue,Xe,ue,ke=He.slice(1).map(function(wt,Pt){return Math.max(wt-He[Pt])},1).concat([1]),lt=Math.round(R/2),Se=new Array(R).fill(0).map(function(wt,Pt){return He.map(function(It){return(10*R+lt+It-Pt)%R-lt})}),yt=Se.map(function(wt,Pt){return wt.map(function(It,Bt){return Math.exp(-.5*Math.pow(2*Se[Pt][Bt]/ke[Bt],2))})});if(Xe=(Ue=yt)[0].map(function(){return 0}),ue=Ue.reduce(function(wt,Pt){return Pt.forEach(function(It,Bt){wt[Bt]+=Math.pow(It,2)}),wt},Xe).map(Math.sqrt),yt=Ue.map(function(wt,Pt){return wt.map(function(It,Bt){return It/(ue[Bt]||1)})}),ne){var Kt=He.map(function(wt){return Math.exp(-.5*Math.pow((wt/R-N)/ne,2))});yt=yt.map(function(wt){return wt.map(function(Pt,It){return Pt*Kt[It]})})}return ye&&(yt=s(s([],yt.slice(3),!0),yt.slice(0,3),!0)),yt.map(function(wt){return wt.slice(0,Ie)})}function Ee(R,g){for(var q=0,N=0,ne=0;ne<g.length;ne++)q+=Math.pow(ne,R)*Math.abs(g[ne]),N+=g[ne];return q/N}function xe(R){var g=R.ampSpectrum,q=R.barkScale,N=R.numberOfBarkBands,ne=N===void 0?24:N;if(typeof g!="object"||typeof q!="object")throw new TypeError;var ye=ne,ze=new Float32Array(ye),Ie=0,He=g,Ue=new Int32Array(ye+1);Ue[0]=0;for(var Xe=q[He.length-1]/ye,ue=1,ke=0;ke<He.length;ke++)for(;q[ke]>Xe;)Ue[ue++]=ke,Xe=ue*q[He.length-1]/ye;for(Ue[ye]=He.length-1,ke=0;ke<ye;ke++){for(var lt=0,Se=Ue[ke];Se<Ue[ke+1];Se++)lt+=He[Se];ze[ke]=Math.pow(lt,.23)}for(ke=0;ke<ze.length;ke++)Ie+=ze[ke];return{specific:ze,total:Ie}}function Pe(R){var g=R.ampSpectrum;if(typeof g!="object")throw new TypeError;for(var q=new Float32Array(g.length),N=0;N<q.length;N++)q[N]=Math.pow(g[N],2);return q}function Ne(R){var g=R.ampSpectrum,q=R.melFilterBank,N=R.bufferSize;if(typeof g!="object")throw new TypeError("Valid ampSpectrum is required to generate melBands");if(typeof q!="object")throw new TypeError("Valid melFilterBank is required to generate melBands");for(var ne=Pe({ampSpectrum:g}),ye=q.length,ze=Array(ye),Ie=new Float32Array(ye),He=0;He<Ie.length;He++){ze[He]=new Float32Array(N/2),Ie[He]=0;for(var Ue=0;Ue<N/2;Ue++)ze[He][Ue]=q[He][Ue]*ne[Ue],Ie[He]+=ze[He][Ue];Ie[He]=Math.log(Ie[He]+1)}return Array.prototype.slice.call(Ie)}function at(R){return R&&R.__esModule&&Object.prototype.hasOwnProperty.call(R,"default")?R.default:R}var je={exports:{}},ce=null,$e=function(R,g){var q=R.length;return g=g||2,ce&&ce[q]||function(N){(ce=ce||{})[N]=new Array(N*N);for(var ne=Math.PI/N,ye=0;ye<N;ye++)for(var ze=0;ze<N;ze++)ce[N][ze+ye*N]=Math.cos(ne*(ze+.5)*ye)}(q),R.map(function(){return 0}).map(function(N,ne){return g*R.reduce(function(ye,ze,Ie,He){return ye+ze*ce[q][Ie+ne*q]},0)})};(function(R){R.exports=$e})(je);var Me=at(je.exports),_t=Object.freeze({__proto__:null,buffer:function(R){return R.signal},rms:function(R){var g=R.signal;if(typeof g!="object")throw new TypeError;for(var q=0,N=0;N<g.length;N++)q+=Math.pow(g[N],2);return q/=g.length,q=Math.sqrt(q)},energy:function(R){var g=R.signal;if(typeof g!="object")throw new TypeError;for(var q=0,N=0;N<g.length;N++)q+=Math.pow(Math.abs(g[N]),2);return q},complexSpectrum:function(R){return R.complexSpectrum},spectralSlope:function(R){var g=R.ampSpectrum,q=R.sampleRate,N=R.bufferSize;if(typeof g!="object")throw new TypeError;for(var ne=0,ye=0,ze=new Float32Array(g.length),Ie=0,He=0,Ue=0;Ue<g.length;Ue++){ne+=g[Ue];var Xe=Ue*q/N;ze[Ue]=Xe,Ie+=Xe*Xe,ye+=Xe,He+=Xe*g[Ue]}return(g.length*He-ye*ne)/(ne*(Ie-Math.pow(ye,2)))},spectralCentroid:function(R){var g=R.ampSpectrum;if(typeof g!="object")throw new TypeError;return Ee(1,g)},spectralRolloff:function(R){var g=R.ampSpectrum,q=R.sampleRate;if(typeof g!="object")throw new TypeError;for(var N=g,ne=q/(2*(N.length-1)),ye=0,ze=0;ze<N.length;ze++)ye+=N[ze];for(var Ie=.99*ye,He=N.length-1;ye>Ie&&He>=0;)ye-=N[He],--He;return(He+1)*ne},spectralFlatness:function(R){var g=R.ampSpectrum;if(typeof g!="object")throw new TypeError;for(var q=0,N=0,ne=0;ne<g.length;ne++)q+=Math.log(g[ne]),N+=g[ne];return Math.exp(q/g.length)*g.length/N},spectralSpread:function(R){var g=R.ampSpectrum;if(typeof g!="object")throw new TypeError;return Math.sqrt(Ee(2,g)-Math.pow(Ee(1,g),2))},spectralSkewness:function(R){var g=R.ampSpectrum;if(typeof g!="object")throw new TypeError;var q=Ee(1,g),N=Ee(2,g),ne=Ee(3,g);return(2*Math.pow(q,3)-3*q*N+ne)/Math.pow(Math.sqrt(N-Math.pow(q,2)),3)},spectralKurtosis:function(R){var g=R.ampSpectrum;if(typeof g!="object")throw new TypeError;var q=g,N=Ee(1,q),ne=Ee(2,q),ye=Ee(3,q),ze=Ee(4,q);return(-3*Math.pow(N,4)+6*N*ne-4*N*ye+ze)/Math.pow(Math.sqrt(ne-Math.pow(N,2)),4)},amplitudeSpectrum:function(R){return R.ampSpectrum},zcr:function(R){var g=R.signal;if(typeof g!="object")throw new TypeError;for(var q=0,N=1;N<g.length;N++)(g[N-1]>=0&&g[N]<0||g[N-1]<0&&g[N]>=0)&&q++;return q},loudness:xe,perceptualSpread:function(R){for(var g=xe({ampSpectrum:R.ampSpectrum,barkScale:R.barkScale}),q=0,N=0;N<g.specific.length;N++)g.specific[N]>q&&(q=g.specific[N]);return Math.pow((g.total-q)/g.total,2)},perceptualSharpness:function(R){for(var g=xe({ampSpectrum:R.ampSpectrum,barkScale:R.barkScale}),q=g.specific,N=0,ne=0;ne<q.length;ne++)N+=ne<15?(ne+1)*q[ne+1]:.066*Math.exp(.171*(ne+1));return N*=.11/g.total},powerSpectrum:Pe,mfcc:function(R){var g=R.ampSpectrum,q=R.melFilterBank,N=R.numberOfMFCCCoefficients,ne=R.bufferSize,ye=Math.min(40,Math.max(1,N||13));if(q.length<ye)throw new Error("Insufficient filter bank for requested number of coefficients");var ze=Ne({ampSpectrum:g,melFilterBank:q,bufferSize:ne});return Me(ze).slice(0,ye)},chroma:function(R){var g=R.ampSpectrum,q=R.chromaFilterBank;if(typeof g!="object")throw new TypeError("Valid ampSpectrum is required to generate chroma");if(typeof q!="object")throw new TypeError("Valid chromaFilterBank is required to generate chroma");var N=q.map(function(ye,ze){return g.reduce(function(Ie,He,Ue){return Ie+He*ye[Ue]},0)}),ne=Math.max.apply(Math,N);return ne?N.map(function(ye){return ye/ne}):N},spectralFlux:function(R){var g=R.signal,q=R.previousSignal,N=R.bufferSize;if(typeof g!="object"||typeof q!="object")throw new TypeError;for(var ne=0,ye=-N/2;ye<g.length/2-1;ye++)x=Math.abs(g[ye])-Math.abs(q[ye]),ne+=(x+Math.abs(x))/2;return ne},spectralCrest:function(R){var g=R.ampSpectrum;if(typeof g!="object")throw new TypeError;var q=0,N=-1/0;return g.forEach(function(ne){q+=Math.pow(ne,2),N=ne>N?ne:N}),q/=g.length,q=Math.sqrt(q),N/q},melBands:Ne});function We(R){if(Array.isArray(R)){for(var g=0,q=Array(R.length);g<R.length;g++)q[g]=R[g];return q}return Array.from(R)}var ut={},bt={},ct={bitReverseArray:function(R){if(ut[R]===void 0){for(var g=(R-1).toString(2).length,q="0".repeat(g),N={},ne=0;ne<R;ne++){var ye=ne.toString(2);ye=q.substr(ye.length)+ye,ye=[].concat(We(ye)).reverse().join(""),N[ne]=parseInt(ye,2)}ut[R]=N}return ut[R]},multiply:function(R,g){return{real:R.real*g.real-R.imag*g.imag,imag:R.real*g.imag+R.imag*g.real}},add:function(R,g){return{real:R.real+g.real,imag:R.imag+g.imag}},subtract:function(R,g){return{real:R.real-g.real,imag:R.imag-g.imag}},euler:function(R,g){var q=-2*Math.PI*R/g;return{real:Math.cos(q),imag:Math.sin(q)}},conj:function(R){return R.imag*=-1,R},constructComplexArray:function(R){var g={};g.real=R.real===void 0?R.slice():R.real.slice();var q=g.real.length;return bt[q]===void 0&&(bt[q]=Array.apply(null,Array(q)).map(Number.prototype.valueOf,0)),g.imag=bt[q].slice(),g}},Et=function(R){var g={};R.real===void 0||R.imag===void 0?g=ct.constructComplexArray(R):(g.real=R.real.slice(),g.imag=R.imag.slice());var q=g.real.length,N=Math.log2(q);if(Math.round(N)!=N)throw new Error("Input size must be a power of 2.");if(g.real.length!=g.imag.length)throw new Error("Real and imaginary components must have the same length.");for(var ne=ct.bitReverseArray(q),ye={real:[],imag:[]},ze=0;ze<q;ze++)ye.real[ne[ze]]=g.real[ze],ye.imag[ne[ze]]=g.imag[ze];for(var Ie=0;Ie<q;Ie++)g.real[Ie]=ye.real[Ie],g.imag[Ie]=ye.imag[Ie];for(var He=1;He<=N;He++)for(var Ue=Math.pow(2,He),Xe=0;Xe<Ue/2;Xe++)for(var ue=ct.euler(Xe,Ue),ke=0;ke<q/Ue;ke++){var lt=Ue*ke+Xe,Se=Ue*ke+Xe+Ue/2,yt={real:g.real[lt],imag:g.imag[lt]},Kt={real:g.real[Se],imag:g.imag[Se]},wt=ct.multiply(ue,Kt),Pt=ct.subtract(yt,wt);g.real[Se]=Pt.real,g.imag[Se]=Pt.imag;var It=ct.add(wt,yt);g.real[lt]=It.real,g.imag[lt]=It.imag}return g},Qe=Et,dt=function(){function R(g,q){var N=this;if(this._m=q,!g.audioContext)throw this._m.errors.noAC;if(g.bufferSize&&!c(g.bufferSize))throw this._m._errors.notPow2;if(!g.source)throw this._m._errors.noSource;this._m.audioContext=g.audioContext,this._m.bufferSize=g.bufferSize||this._m.bufferSize||256,this._m.hopSize=g.hopSize||this._m.hopSize||this._m.bufferSize,this._m.sampleRate=g.sampleRate||this._m.audioContext.sampleRate||44100,this._m.callback=g.callback,this._m.windowingFunction=g.windowingFunction||"hanning",this._m.featureExtractors=_t,this._m.EXTRACTION_STARTED=g.startImmediately||!1,this._m.channel=typeof g.channel=="number"?g.channel:0,this._m.inputs=g.inputs||1,this._m.outputs=g.outputs||1,this._m.numberOfMFCCCoefficients=g.numberOfMFCCCoefficients||this._m.numberOfMFCCCoefficients||13,this._m.numberOfBarkBands=g.numberOfBarkBands||this._m.numberOfBarkBands||24,this._m.spn=this._m.audioContext.createScriptProcessor(this._m.bufferSize,this._m.inputs,this._m.outputs),this._m.spn.connect(this._m.audioContext.destination),this._m._featuresToExtract=g.featureExtractors||[],this._m.barkScale=A(this._m.bufferSize,this._m.sampleRate,this._m.bufferSize),this._m.melFilterBank=Ae(Math.max(this._m.melBands,this._m.numberOfMFCCCoefficients),this._m.sampleRate,this._m.bufferSize),this._m.inputData=null,this._m.previousInputData=null,this._m.frame=null,this._m.previousFrame=null,this.setSource(g.source),this._m.spn.onaudioprocess=function(ne){var ye;N._m.inputData!==null&&(N._m.previousInputData=N._m.inputData),N._m.inputData=ne.inputBuffer.getChannelData(N._m.channel),N._m.previousInputData?((ye=new Float32Array(N._m.previousInputData.length+N._m.inputData.length-N._m.hopSize)).set(N._m.previousInputData.slice(N._m.hopSize)),ye.set(N._m.inputData,N._m.previousInputData.length-N._m.hopSize)):ye=N._m.inputData,function(ze,Ie,He){if(ze.length<Ie)throw new Error("Buffer is too short for frame length");if(He<1)throw new Error("Hop length cannot be less that 1");if(Ie<1)throw new Error("Frame length cannot be less that 1");var Ue=1+Math.floor((ze.length-Ie)/He);return new Array(Ue).fill(0).map(function(Xe,ue){return ze.slice(ue*He,ue*He+Ie)})}(ye,N._m.bufferSize,N._m.hopSize).forEach(function(ze){N._m.frame=ze;var Ie=N._m.extract(N._m._featuresToExtract,N._m.frame,N._m.previousFrame);typeof N._m.callback=="function"&&N._m.EXTRACTION_STARTED&&N._m.callback(Ie),N._m.previousFrame=N._m.frame})}}return R.prototype.start=function(g){this._m._featuresToExtract=g||this._m._featuresToExtract,this._m.EXTRACTION_STARTED=!0},R.prototype.stop=function(){this._m.EXTRACTION_STARTED=!1},R.prototype.setSource=function(g){this._m.source&&this._m.source.disconnect(this._m.spn),this._m.source=g,this._m.source.connect(this._m.spn)},R.prototype.setChannel=function(g){g<=this._m.inputs?this._m.channel=g:console.error("Channel ".concat(g," does not exist. Make sure you've provided a value for 'inputs' that is greater than ").concat(g," when instantiating the MeydaAnalyzer"))},R.prototype.get=function(g){return this._m.inputData?this._m.extract(g||this._m._featuresToExtract,this._m.inputData,this._m.previousInputData):null},R}(),gt={audioContext:null,spn:null,bufferSize:512,sampleRate:44100,melBands:26,chromaBands:12,callback:null,windowingFunction:"hanning",featureExtractors:_t,EXTRACTION_STARTED:!1,numberOfMFCCCoefficients:13,numberOfBarkBands:24,_featuresToExtract:[],windowing:b,_errors:{notPow2:new Error("Meyda: Buffer size must be a power of 2, e.g. 64 or 512"),featureUndef:new Error("Meyda: No features defined."),invalidFeatureFmt:new Error("Meyda: Invalid feature format"),invalidInput:new Error("Meyda: Invalid input."),noAC:new Error("Meyda: No AudioContext specified."),noSource:new Error("Meyda: No source node specified.")},createMeydaAnalyzer:function(R){return new dt(R,Object.assign({},gt))},listAvailableFeatureExtractors:function(){return Object.keys(this.featureExtractors)},extract:function(R,g,q){var N=this;if(!g)throw this._errors.invalidInput;if(typeof g!="object")throw this._errors.invalidInput;if(!R)throw this._errors.featureUndef;if(!c(g.length))throw this._errors.notPow2;this.barkScale!==void 0&&this.barkScale.length==this.bufferSize||(this.barkScale=A(this.bufferSize,this.sampleRate,this.bufferSize)),this.melFilterBank!==void 0&&this.barkScale.length==this.bufferSize&&this.melFilterBank.length==this.melBands||(this.melFilterBank=Ae(Math.max(this.melBands,this.numberOfMFCCCoefficients),this.sampleRate,this.bufferSize)),this.chromaFilterBank!==void 0&&this.chromaFilterBank.length==this.chromaBands||(this.chromaFilterBank=Le(this.chromaBands,this.sampleRate,this.bufferSize)),"buffer"in g&&g.buffer===void 0?this.signal=D(g):this.signal=g;var ne=st(g,this.windowingFunction,this.bufferSize);if(this.signal=ne.windowedSignal,this.complexSpectrum=ne.complexSpectrum,this.ampSpectrum=ne.ampSpectrum,q){var ye=st(q,this.windowingFunction,this.bufferSize);this.previousSignal=ye.windowedSignal,this.previousComplexSpectrum=ye.complexSpectrum,this.previousAmpSpectrum=ye.ampSpectrum}var ze=function(Ie){return N.featureExtractors[Ie]({ampSpectrum:N.ampSpectrum,chromaFilterBank:N.chromaFilterBank,complexSpectrum:N.complexSpectrum,signal:N.signal,bufferSize:N.bufferSize,sampleRate:N.sampleRate,barkScale:N.barkScale,melFilterBank:N.melFilterBank,previousSignal:N.previousSignal,previousAmpSpectrum:N.previousAmpSpectrum,previousComplexSpectrum:N.previousComplexSpectrum,numberOfMFCCCoefficients:N.numberOfMFCCCoefficients,numberOfBarkBands:N.numberOfBarkBands})};if(typeof R=="object")return R.reduce(function(Ie,He){var Ue;return Object.assign({},Ie,((Ue={})[He]=ze(He),Ue))},{});if(typeof R=="string")return ze(R);throw this._errors.invalidFeatureFmt}},st=function(R,g,q){var N={};R.buffer===void 0?N.signal=D(R):N.signal=R,N.windowedSignal=b(N.signal,g),N.complexSpectrum=Qe(N.windowedSignal),N.ampSpectrum=new Float32Array(q/2);for(var ne=0;ne<q/2;ne++)N.ampSpectrum[ne]=Math.sqrt(Math.pow(N.complexSpectrum.real[ne],2)+Math.pow(N.complexSpectrum.imag[ne],2));return N};return typeof window<"u"&&(window.Meyda=gt),gt})})(meyda_min);const Meyda=getDefaultExportFromCjs(meyda_min.exports);class Audio{constructor({numBins:n=4,cutoff:s=2,smooth:o=.4,max:u=15,scale:c=10,isDrawing:b=!1,parentEl:A=document.body}){this.vol=0,this.scale=c,this.max=u,this.cutoff=s,this.smooth=o,this.setBins(n),this.beat={holdFrames:20,threshold:40,_cutoff:0,decay:.98,_framesSinceBeat:0},this.onBeat=()=>{},this.canvas=document.createElement("canvas"),this.canvas.width=100,this.canvas.height=80,this.canvas.style.width="100px",this.canvas.style.height="80px",this.canvas.style.position="absolute",this.canvas.style.right="0px",this.canvas.style.bottom="0px",A.appendChild(this.canvas),this.isDrawing=b,this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#DFFFFF",this.ctx.strokeStyle="#0ff",this.ctx.lineWidth=.5,window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then(D=>{this.stream=D,this.context=new AudioContext;let V=this.context.createMediaStreamSource(D);this.meyda=Meyda.createMeydaAnalyzer({audioContext:this.context,source:V,featureExtractors:["loudness"]})}).catch(D=>console.log("ERROR",D))}detectBeat(n){n>this.beat._cutoff&&n>this.beat.threshold?(this.onBeat(),this.beat._cutoff=n*1.2,this.beat._framesSinceBeat=0):this.beat._framesSinceBeat<=this.beat.holdFrames?this.beat._framesSinceBeat++:(this.beat._cutoff*=this.beat.decay,this.beat._cutoff=Math.max(this.beat._cutoff,this.beat.threshold))}tick(){if(this.meyda){var n=this.meyda.get();if(n&&n!==null){this.vol=n.loudness.total,this.detectBeat(this.vol);const s=(u,c)=>u+c;let o=Math.floor(n.loudness.specific.length/this.bins.length);this.prevBins=this.bins.slice(0),this.bins=this.bins.map((u,c)=>n.loudness.specific.slice(c*o,(c+1)*o).reduce(s)).map((u,c)=>u*(1-this.settings[c].smooth)+this.prevBins[c]*this.settings[c].smooth),this.fft=this.bins.map((u,c)=>Math.max(0,(u-this.settings[c].cutoff)/this.settings[c].scale)),this.isDrawing&&this.draw()}}}setCutoff(n){this.cutoff=n,this.settings=this.settings.map(s=>(s.cutoff=n,s))}setSmooth(n){this.smooth=n,this.settings=this.settings.map(s=>(s.smooth=n,s))}setBins(n){this.bins=Array(n).fill(0),this.prevBins=Array(n).fill(0),this.fft=Array(n).fill(0),this.settings=Array(n).fill(0).map(()=>({cutoff:this.cutoff,scale:this.scale,smooth:this.smooth})),this.bins.forEach((s,o)=>{window["a"+o]=(u=1,c=0)=>()=>a.fft[o]*u+c})}setScale(n){this.scale=n,this.settings=this.settings.map(s=>(s.scale=n,s))}setMax(n){this.max=n,console.log("set max is deprecated")}hide(){this.isDrawing=!1,this.canvas.style.display="none"}show(){this.isDrawing=!0,this.canvas.style.display="block"}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var n=this.canvas.width/this.bins.length,s=this.canvas.height/(this.max*2);this.bins.forEach((o,u)=>{var c=o*s;this.ctx.fillRect(u*n,this.canvas.height-c,n,c);var b=this.canvas.height-s*this.settings[u].cutoff;this.ctx.beginPath(),this.ctx.moveTo(u*n,b),this.ctx.lineTo((u+1)*n,b),this.ctx.stroke();var A=this.canvas.height-s*(this.settings[u].scale+this.settings[u].cutoff);this.ctx.beginPath(),this.ctx.moveTo(u*n,A),this.ctx.lineTo((u+1)*n,A),this.ctx.stroke()})}}class VideoRecorder{constructor(n){this.mediaSource=new MediaSource,this.stream=n,this.output=document.createElement("video"),this.output.autoplay=!0,this.output.loop=!0;let s=this;this.mediaSource.addEventListener("sourceopen",()=>{console.log("MediaSource opened"),s.sourceBuffer=s.mediaSource.addSourceBuffer('video/webm; codecs="vp8"'),console.log("Source buffer: ",sourceBuffer)})}start(){let n={mimeType:"video/webm;codecs=vp9"};this.recordedBlobs=[];try{this.mediaRecorder=new MediaRecorder(this.stream,n)}catch(s){console.log("Unable to create MediaRecorder with options Object: ",s);try{n={mimeType:"video/webm,codecs=vp9"},this.mediaRecorder=new MediaRecorder(this.stream,n)}catch(o){console.log("Unable to create MediaRecorder with options Object: ",o);try{n="video/vp8",this.mediaRecorder=new MediaRecorder(this.stream,n)}catch(u){alert(`MediaRecorder is not supported by this browser.

Try Firefox 29 or later, or Chrome 47 or later, with Enable experimental Web Platform features enabled from chrome://flags.`),console.error("Exception while creating MediaRecorder:",u);return}}}console.log("Created MediaRecorder",this.mediaRecorder,"with options",n),this.mediaRecorder.onstop=this._handleStop.bind(this),this.mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this.mediaRecorder.start(100),console.log("MediaRecorder started",this.mediaRecorder)}stop(){this.mediaRecorder.stop()}_handleStop(){const n=new Blob(this.recordedBlobs,{type:this.mediaRecorder.mimeType}),s=window.URL.createObjectURL(n);this.output.src=s;const o=document.createElement("a");o.style.display="none",o.href=s;let u=new Date;o.download=`hydra-${u.getFullYear()}-${u.getMonth()+1}-${u.getDate()}-${u.getHours()}.${u.getMinutes()}.${u.getSeconds()}.webm`,document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),window.URL.revokeObjectURL(s)},300)}_handleDataAvailable(n){n.data&&n.data.size>0&&this.recordedBlobs.push(n.data)}}const easing={linear:function(r){return r},easeInQuad:function(r){return r*r},easeOutQuad:function(r){return r*(2-r)},easeInOutQuad:function(r){return r<.5?2*r*r:-1+(4-2*r)*r},easeInCubic:function(r){return r*r*r},easeOutCubic:function(r){return--r*r*r+1},easeInOutCubic:function(r){return r<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1},easeInQuart:function(r){return r*r*r*r},easeOutQuart:function(r){return 1- --r*r*r*r},easeInOutQuart:function(r){return r<.5?8*r*r*r*r:1-8*--r*r*r*r},easeInQuint:function(r){return r*r*r*r*r},easeOutQuint:function(r){return 1+--r*r*r*r*r},easeInOutQuint:function(r){return r<.5?16*r*r*r*r*r:1+16*--r*r*r*r*r},sin:function(r){return(1+Math.sin(Math.PI*r-Math.PI/2))/2}};var map=(r,n,s,o,u)=>(r-n)*(u-o)/(s-n)+o;const ArrayUtils={init:()=>{Array.prototype.fast=function(r=1){return this._speed=r,this},Array.prototype.smooth=function(r=1){return this._smooth=r,this},Array.prototype.ease=function(r="linear"){return typeof r=="function"?(this._smooth=1,this._ease=r):easing[r]&&(this._smooth=1,this._ease=easing[r]),this},Array.prototype.offset=function(r=.5){return this._offset=r%1,this},Array.prototype.fit=function(r=0,n=1){let s=Math.min(...this),o=Math.max(...this);var u=this.map(c=>map(c,s,o,r,n));return u._speed=this._speed,u._smooth=this._smooth,u._ease=this._ease,u}},getValue:(r=[])=>({time:n,bpm:s})=>{let o=r._speed?r._speed:1,u=r._smooth?r._smooth:0,c=n*o*(s/60)+(r._offset||0);if(u!==0){let b=r._ease?r._ease:easing.linear,A=c-u/2,D=r[Math.floor(A%r.length)],V=r[Math.floor((A+1)%r.length)],Ae=Math.min(A%1/u,1);return b(Ae)*(V-D)+D}else return r[Math.floor(c%r.length)],r[Math.floor(c%r.length)]}},Sandbox=parent=>{var initialCode="",sandbox=createSandbox(initialCode),addToContext=(r,n)=>{initialCode+=`
      var ${r} = ${n}
    `,sandbox=createSandbox(initialCode)};return{addToContext,eval:r=>sandbox.eval(r)};function createSandbox(initial){eval(initial);var localEval=function(code){eval(code)};return{eval:localEval}}};class EvalSandbox{constructor(n,s,o=[]){this.makeGlobal=s,this.sandbox=Sandbox(),this.parent=n;var u=Object.keys(n);u.forEach(c=>this.add(c)),this.userProps=o}add(n){this.makeGlobal&&(window[n]=this.parent[n]),this.sandbox.addToContext(n,`parent.${n}`)}set(n,s){this.makeGlobal&&(window[n]=s),this.parent[n]=s}tick(){this.makeGlobal&&this.userProps.forEach(n=>{this.parent[n]=window[n]})}eval(n){this.sandbox.eval(n)}}const DEFAULT_CONVERSIONS={float:{vec4:{name:"sum",args:[[1,1,1,1]]},vec2:{name:"sum",args:[[1,1]]}}},ensure_decimal_dot=r=>(r=r.toString(),r.indexOf(".")<0&&(r+="."),r);function formatArguments(r,n,s){const o=r.transform.inputs,u=r.userArgs,{generators:c}=r.synth,{src:b}=c;return o.map((A,D)=>{const V={value:A.default,type:A.type,isUniform:!1,name:A.name,vecLen:0};if(V.type==="float"&&(V.value=ensure_decimal_dot(A.default)),A.type.startsWith("vec"))try{V.vecLen=Number.parseInt(A.type.substr(3))}catch{console.log(`Error determining length of vector input type ${A.type} (${A.name})`)}if(u.length>D&&(V.value=u[D],typeof u[D]=="function"?(V.value=(Ee,xe,Pe)=>{try{const Ne=u[D](xe);return typeof Ne=="number"?Ne:(console.warn("function does not return a number",u[D]),A.default)}catch(Ne){return console.warn("ERROR",Ne),A.default}},V.isUniform=!0):u[D].constructor===Array&&(V.value=(Ee,xe,Pe)=>ArrayUtils.getValue(u[D])(xe),V.isUniform=!0)),!(n<0)){if(V.value&&V.value.transforms){const Ee=V.value.transforms[V.value.transforms.length-1];if(Ee.transform.glsl_return_type!==A.type){const xe=DEFAULT_CONVERSIONS[A.type];if(typeof xe<"u"){const Pe=xe[Ee.transform.glsl_return_type];if(typeof Pe<"u"){const{name:Ne,args:at}=Pe;V.value=V.value[Ne](...at)}}}V.isUniform=!1}else if(V.type==="float"&&typeof V.value=="number")V.value=ensure_decimal_dot(V.value);else if(V.type.startsWith("vec")&&typeof V.value=="object"&&Array.isArray(V.value))V.isUniform=!1,V.value=`${V.type}(${V.value.map(ensure_decimal_dot).join(", ")})`;else if(A.type==="sampler2D"){var Ae=V.value;V.value=()=>Ae.getTexture(),V.isUniform=!0}else if(V.value.getTexture&&A.type==="vec4"){var Le=V.value;V.value=b(Le),V.isUniform=!1}V.isUniform&&(V.name+=n)}return V})}function generateGlsl(r){var n={uniforms:[],glslFunctions:[],fragColor:""},s=generateGlsl$1(r,n)("st");n.fragColor=s;let o={};return n.uniforms.forEach(u=>o[u.name]=u),n.uniforms=Object.values(o),n}function generateGlsl$1(r,n){var s=()=>"";return r.forEach(o=>{var u=formatArguments(o,n.uniforms.length);u.forEach(A=>{A.isUniform&&n.uniforms.push(A)}),contains(o,n.glslFunctions)||n.glslFunctions.push(o);var c=s;if(o.transform.type==="src")s=A=>`${shaderString(A,o.name,u,n)}`;else if(o.transform.type==="coord")s=A=>`${c(`${shaderString(A,o.name,u,n)}`)}`;else if(o.transform.type==="color")s=A=>`${shaderString(`${c(A)}`,o.name,u,n)}`;else if(o.transform.type==="combine"){var b=u[0].value&&u[0].value.transforms?A=>`${generateGlsl$1(u[0].value.transforms,n)(A)}`:u[0].isUniform?()=>u[0].name:()=>u[0].value;s=A=>`${shaderString(`${c(A)}, ${b(A)}`,o.name,u.slice(1),n)}`}else if(o.transform.type==="combineCoord"){var b=u[0].value&&u[0].value.transforms?D=>`${generateGlsl$1(u[0].value.transforms,n)(D)}`:u[0].isUniform?()=>u[0].name:()=>u[0].value;s=D=>`${c(`${shaderString(`${D}, ${b(D)}`,o.name,u.slice(1),n)}`)}`}}),s}function shaderString(r,n,s,o){const u=s.map(c=>c.isUniform?c.name:c.value&&c.value.transforms?`${generateGlsl$1(c.value.transforms,o)("st")}`:c.value).reduce((c,b)=>`${c}, ${b}`,"");return`${n}(${r}${u})`}function contains(r,n){for(var s=0;s<n.length;s++)if(r.name==n[s].name)return!0;return!1}const utilityGlsl={_luminance:{type:"util",glsl:`float _luminance(vec3 rgb){
      const vec3 W = vec3(0.2125, 0.7154, 0.0721);
      return dot(rgb, W);
    }`},_noise:{type:"util",glsl:`
    //	Simplex 3D Noise
    //	by Ian McEwan, Ashima Arts
    vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
  vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}

  float _noise(vec3 v){
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);

  // First corner
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;

  // Other corners
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );

    //  x0 = x0 - 0. + 0.0 * C
    vec3 x1 = x0 - i1 + 1.0 * C.xxx;
    vec3 x2 = x0 - i2 + 2.0 * C.xxx;
    vec3 x3 = x0 - 1. + 3.0 * C.xxx;

  // Permutations
    i = mod(i, 289.0 );
    vec4 p = permute( permute( permute(
               i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
             + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
             + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));

  // Gradients
  // ( N*N points uniformly over a square, mapped onto an octahedron.)
    float n_ = 1.0/7.0; // N=7
    vec3  ns = n_ * D.wyz - D.xzx;

    vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)

    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)

    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);

    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );

    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));

    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;

    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);

  //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;

  // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
  }
    `},_rgbToHsv:{type:"util",glsl:`vec3 _rgbToHsv(vec3 c){
            vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
            vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
            vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

            float d = q.x - min(q.w, q.y);
            float e = 1.0e-10;
            return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
        }`},_hsvToRgb:{type:"util",glsl:`vec3 _hsvToRgb(vec3 c){
        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
    }`}};var GlslSource=function(r){return this.transforms=[],this.transforms.push(r),this.defaultOutput=r.defaultOutput,this.synth=r.synth,this.type="GlslSource",this.defaultUniforms=r.defaultUniforms,this};GlslSource.prototype.addTransform=function(r){this.transforms.push(r)};GlslSource.prototype.out=function(r){var n=r||this.defaultOutput,s=this.glsl(n);if(this.synth.currentFunctions=[],n)try{n.render(s)}catch(o){console.log("shader could not compile",o)}};GlslSource.prototype.glsl=function(){var r=[],n=[];return this.transforms.forEach(s=>{s.transform.type==="renderpass"?console.warn("no support for renderpass"):n.push(s)}),n.length>0&&r.push(this.compile(n)),r};GlslSource.prototype.compile=function(r){var n=generateGlsl(r,this.synth),s={};n.uniforms.forEach(u=>{s[u.name]=u.value});var o=`
  precision ${this.defaultOutput.precision} float;
  ${Object.values(n.uniforms).map(u=>{let c=u.type;switch(u.type){case"texture":c="sampler2D";break}return`
      uniform ${c} ${u.name};`}).join("")}
  uniform float time;
  uniform vec2 resolution;
  varying vec2 uv;
  uniform sampler2D prevBuffer;

  ${Object.values(utilityGlsl).map(u=>`
            ${u.glsl}
          `).join("")}

  ${n.glslFunctions.map(u=>`
            ${u.transform.glsl}
          `).join("")}

  void main () {
    vec4 c = vec4(1, 0, 0, 1);
    vec2 st = gl_FragCoord.xy/resolution.xy;
    gl_FragColor = ${n.fragColor};
  }
  `;return{frag:o,uniforms:Object.assign({},this.defaultUniforms,s)}};const glslFunctions=()=>[{name:"noise",type:"src",inputs:[{type:"float",name:"scale",default:10},{type:"float",name:"offset",default:.1}],glsl:"   return vec4(vec3(_noise(vec3(_st*scale, offset*time))), 1.0);"},{name:"voronoi",type:"src",inputs:[{type:"float",name:"scale",default:5},{type:"float",name:"speed",default:.3},{type:"float",name:"blending",default:.3}],glsl:`   vec3 color = vec3(.0);
   // Scale
   _st *= scale;
   // Tile the space
   vec2 i_st = floor(_st);
   vec2 f_st = fract(_st);
   float m_dist = 10.;  // minimun distance
   vec2 m_point;        // minimum point
   for (int j=-1; j<=1; j++ ) {
   for (int i=-1; i<=1; i++ ) {
   vec2 neighbor = vec2(float(i),float(j));
   vec2 p = i_st + neighbor;
   vec2 point = fract(sin(vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3))))*43758.5453);
   point = 0.5 + 0.5*sin(time*speed + 6.2831*point);
   vec2 diff = neighbor + point - f_st;
   float dist = length(diff);
   if( dist < m_dist ) {
   m_dist = dist;
   m_point = point;
   }
   }
   }
   // Assign a color using the closest point position
   color += dot(m_point,vec2(.3,.6));
   color *= 1.0 - blending*m_dist;
   return vec4(color, 1.0);`},{name:"osc",type:"src",inputs:[{type:"float",name:"frequency",default:60},{type:"float",name:"sync",default:.1},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st;
   float r = sin((st.x-offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   float g = sin((st.x+time*sync)*frequency)*0.5 + 0.5;
   float b = sin((st.x+offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   return vec4(r, g, b, 1.0);`},{name:"shape",type:"src",inputs:[{type:"float",name:"sides",default:3},{type:"float",name:"radius",default:.3},{type:"float",name:"smoothing",default:.01}],glsl:`   vec2 st = _st * 2. - 1.;
   // Angle and radius from the current pixel
   float a = atan(st.x,st.y)+3.1416;
   float r = (2.*3.1416)/sides;
   float d = cos(floor(.5+a/r)*r-a)*length(st);
   return vec4(vec3(1.0-smoothstep(radius,radius + smoothing + 0.0000001,d)), 1.0);`},{name:"gradient",type:"src",inputs:[{type:"float",name:"speed",default:0}],glsl:"   return vec4(_st, sin(time*speed), 1.0);"},{name:"src",type:"src",inputs:[{type:"sampler2D",name:"tex",default:NaN}],glsl:`   //  vec2 uv = gl_FragCoord.xy/vec2(1280., 720.);
   return texture2D(tex, fract(_st));`},{name:"solid",type:"src",inputs:[{type:"float",name:"r",default:0},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:1}],glsl:"   return vec4(r, g, b, a);"},{name:"rotate",type:"coord",inputs:[{type:"float",name:"angle",default:10},{type:"float",name:"speed",default:0}],glsl:`   vec2 xy = _st - vec2(0.5);
   float ang = angle + speed *time;
   xy = mat2(cos(ang),-sin(ang), sin(ang),cos(ang))*xy;
   xy += 0.5;
   return xy;`},{name:"scale",type:"coord",inputs:[{type:"float",name:"amount",default:1.5},{type:"float",name:"xMult",default:1},{type:"float",name:"yMult",default:1},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:`   vec2 xy = _st - vec2(offsetX, offsetY);
   xy*=(1.0/vec2(amount*xMult, amount*yMult));
   xy+=vec2(offsetX, offsetY);
   return xy;
   `},{name:"pixelate",type:"coord",inputs:[{type:"float",name:"pixelX",default:20},{type:"float",name:"pixelY",default:20}],glsl:`   vec2 xy = vec2(pixelX, pixelY);
   return (floor(_st * xy) + 0.5)/xy;`},{name:"posterize",type:"color",inputs:[{type:"float",name:"bins",default:3},{type:"float",name:"gamma",default:.6}],glsl:`   vec4 c2 = pow(_c0, vec4(gamma));
   c2 *= vec4(bins);
   c2 = floor(c2);
   c2/= vec4(bins);
   c2 = pow(c2, vec4(1.0/gamma));
   return vec4(c2.xyz, _c0.a);`},{name:"shift",type:"color",inputs:[{type:"float",name:"r",default:.5},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:0}],glsl:`   vec4 c2 = vec4(_c0);
   c2.r = fract(c2.r + r);
   c2.g = fract(c2.g + g);
   c2.b = fract(c2.b + b);
   c2.a = fract(c2.a + a);
   return vec4(c2.rgba);`},{name:"repeat",type:"coord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:0},{type:"float",name:"offsetY",default:0}],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) * offsetX;
   st.y += step(1., mod(st.x,2.0)) * offsetY;
   return fract(st);`},{name:"modulateRepeat",type:"combineCoord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offsetX;
   st.y += step(1., mod(st.x,2.0)) + _c0.g * offsetY;
   return fract(st);`},{name:"repeatX",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0))* offset;
   return fract(st);`},{name:"modulateRepeatX",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0)) + _c0.r * offset;
   return fract(st);`},{name:"repeatY",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st * vec2(1.0, reps);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0))* offset;
   return fract(st);`},{name:"modulateRepeatY",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offset;
   return fract(st);`},{name:"kaleid",type:"coord",inputs:[{type:"float",name:"nSides",default:4}],glsl:`   vec2 st = _st;
   st -= 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return r*vec2(cos(a), sin(a));`},{name:"modulateKaleid",type:"combineCoord",inputs:[{type:"float",name:"nSides",default:4}],glsl:`   vec2 st = _st - 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return (_c0.r+r)*vec2(cos(a), sin(a));`},{name:"scroll",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"scrollY",default:.5},{type:"float",name:"speedX",default:0},{type:"float",name:"speedY",default:0}],glsl:`
   _st.x += scrollX + time*speedX;
   _st.y += scrollY + time*speedY;
   return fract(_st);`},{name:"scrollX",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.x += scrollX + time*speed;
   return fract(_st);`},{name:"modulateScrollX",type:"combineCoord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.x += _c0.r*scrollX + time*speed;
   return fract(_st);`},{name:"scrollY",type:"coord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.y += scrollY + time*speed;
   return fract(_st);`},{name:"modulateScrollY",type:"combineCoord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.y += _c0.r*scrollY + time*speed;
   return fract(_st);`},{name:"add",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0+_c1)*amount + _c0*(1.0-amount);"},{name:"sub",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0-_c1)*amount + _c0*(1.0-amount);"},{name:"layer",type:"combine",inputs:[],glsl:"   return vec4(mix(_c0.rgb, _c1.rgb, _c1.a), clamp(_c0.a + _c1.a, 0.0, 1.0));"},{name:"blend",type:"combine",inputs:[{type:"float",name:"amount",default:.5}],glsl:"   return _c0*(1.0-amount)+_c1*amount;"},{name:"mult",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _c0*(1.0-amount)+(_c0*_c1)*amount;"},{name:"diff",type:"combine",inputs:[],glsl:"   return vec4(abs(_c0.rgb-_c1.rgb), max(_c0.a, _c1.a));"},{name:"modulate",type:"combineCoord",inputs:[{type:"float",name:"amount",default:.1}],glsl:`   //  return fract(st+(_c0.xy-0.5)*amount);
   return _st + _c0.xy*amount;`},{name:"modulateScale",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:1}],glsl:`   vec2 xy = _st - vec2(0.5);
   xy*=(1.0/vec2(offset + multiple*_c0.r, offset + multiple*_c0.g));
   xy+=vec2(0.5);
   return xy;`},{name:"modulatePixelate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:10},{type:"float",name:"offset",default:3}],glsl:`   vec2 xy = vec2(offset + _c0.x*multiple, offset + _c0.y*multiple);
   return (floor(_st * xy) + 0.5)/xy;`},{name:"modulateRotate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:0}],glsl:`   vec2 xy = _st - vec2(0.5);
   float angle = offset + _c0.x * multiple;
   xy = mat2(cos(angle),-sin(angle), sin(angle),cos(angle))*xy;
   xy += 0.5;
   return xy;`},{name:"modulateHue",type:"combineCoord",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _st + (vec2(_c0.g - _c0.r, _c0.b - _c0.g) * amount * 1.0/resolution);"},{name:"invert",type:"color",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return vec4((1.0-_c0.rgb)*amount + _c0.rgb*(1.0-amount), _c0.a);"},{name:"contrast",type:"color",inputs:[{type:"float",name:"amount",default:1.6}],glsl:`   vec4 c = (_c0-vec4(0.5))*vec4(amount) + vec4(0.5);
   return vec4(c.rgb, _c0.a);`},{name:"brightness",type:"color",inputs:[{type:"float",name:"amount",default:.4}],glsl:"   return vec4(_c0.rgb + vec3(amount), _c0.a);"},{name:"mask",type:"combine",inputs:[],glsl:`   float a = _luminance(_c1.rgb);
  return vec4(_c0.rgb*a, a*_c0.a);`},{name:"luma",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.1}],glsl:`   float a = smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb));
   return vec4(_c0.rgb*a, a);`},{name:"thresh",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.04}],glsl:"   return vec4(vec3(smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb))), _c0.a);"},{name:"color",type:"color",inputs:[{type:"float",name:"r",default:1},{type:"float",name:"g",default:1},{type:"float",name:"b",default:1},{type:"float",name:"a",default:1}],glsl:`   vec4 c = vec4(r, g, b, a);
   vec4 pos = step(0.0, c); // detect whether negative
   // if > 0, return r * _c0
   // if < 0 return (1.0-r) * _c0
   return vec4(mix((1.0-_c0)*abs(c), c*_c0, pos));`},{name:"saturate",type:"color",inputs:[{type:"float",name:"amount",default:2}],glsl:`   const vec3 W = vec3(0.2125, 0.7154, 0.0721);
   vec3 intensity = vec3(dot(_c0.rgb, W));
   return vec4(mix(intensity, _c0.rgb, amount), _c0.a);`},{name:"hue",type:"color",inputs:[{type:"float",name:"hue",default:.4}],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c.r += hue;
   //  c.r = fract(c.r);
   return vec4(_hsvToRgb(c), _c0.a);`},{name:"colorama",type:"color",inputs:[{type:"float",name:"amount",default:.005}],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c += vec3(amount);
   c = _hsvToRgb(c);
   c = fract(c);
   return vec4(c, _c0.a);`},{name:"prev",type:"src",inputs:[],glsl:"   return texture2D(prevBuffer, fract(_st));"},{name:"sum",type:"color",inputs:[{type:"vec4",name:"scale",default:1}],glsl:`   vec4 v = _c0 * s;
   return v.r + v.g + v.b + v.a;
   }
   float sum(vec2 _st, vec4 s) { // vec4 is not a typo, because argument type is not overloaded
   vec2 v = _st.xy * s.xy;
   return v.x + v.y;`},{name:"r",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.r * scale + offset);"},{name:"g",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.g * scale + offset);"},{name:"b",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.b * scale + offset);"},{name:"a",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.a * scale + offset);"}];class GeneratorFactory{constructor({defaultUniforms:n,defaultOutput:s,extendTransforms:o=[],changeListener:u=()=>{}}={}){this.defaultOutput=s,this.defaultUniforms=n,this.changeListener=u,this.extendTransforms=o,this.generators={},this.init()}init(){const n=glslFunctions();return this.glslTransforms={},this.generators=Object.entries(this.generators).reduce((s,[o,u])=>(this.changeListener({type:"remove",synth:this,method:o}),s),{}),this.sourceClass=(()=>class extends GlslSource{})(),Array.isArray(this.extendTransforms)?n.concat(this.extendTransforms):typeof this.extendTransforms=="object"&&this.extendTransforms.type&&n.push(this.extendTransforms),n.map(s=>this.setFunction(s))}_addMethod(n,s){const o=this;if(this.glslTransforms[n]=s,s.type==="src"){const u=(...c)=>new this.sourceClass({name:n,transform:s,userArgs:c,defaultOutput:this.defaultOutput,defaultUniforms:this.defaultUniforms,synth:o});return this.generators[n]=u,this.changeListener({type:"add",synth:this,method:n}),u}else this.sourceClass.prototype[n]=function(...u){return this.transforms.push({name:n,transform:s,userArgs:u,synth:o}),this}}setFunction(n){var s=processGlsl(n);s&&this._addMethod(n.name,s)}}const typeLookup={src:{returnType:"vec4",args:["vec2 _st"]},coord:{returnType:"vec2",args:["vec2 _st"]},color:{returnType:"vec4",args:["vec4 _c0"]},combine:{returnType:"vec4",args:["vec4 _c0","vec4 _c1"]},combineCoord:{returnType:"vec2",args:["vec2 _st","vec4 _c0"]}};function processGlsl(r){let n=typeLookup[r.type];if(n){let s=n.args.map(b=>b).join(", "),o=r.inputs.map(b=>`${b.type} ${b.name}`).join(", "),u=`${s}${o.length>0?", "+o:""}`,c=`
  ${n.returnType} ${r.name}(${u}) {
      ${r.glsl}
  }
`;return(r.type==="combine"||r.type==="combineCoord")&&r.inputs.unshift({name:"color",type:"vec4"}),Object.assign({},r,{glsl:c})}else console.warn(`type ${r.type} not recognized`,r)}var regl$1={exports:{}};(function(r,n){(function(s,o){r.exports=o()})(commonjsGlobal,function(){var s=function(l){return l instanceof Uint8Array||l instanceof Uint16Array||l instanceof Uint32Array||l instanceof Int8Array||l instanceof Int16Array||l instanceof Int32Array||l instanceof Float32Array||l instanceof Float64Array||l instanceof Uint8ClampedArray},o=function(l,d){for(var E=Object.keys(d),j=0;j<E.length;++j)l[E[j]]=d[E[j]];return l},u=`
`;function c(l){return typeof atob<"u"?atob(l):"base64:"+l}function b(l){var d=new Error("(regl) "+l);throw console.error(d),d}function A(l,d){l||b(d)}function D(l){return l?": "+l:""}function V(l,d,E){l in d||b("unknown parameter ("+l+")"+D(E)+". possible values: "+Object.keys(d).join())}function Ae(l,d){s(l)||b("invalid parameter type"+D(d)+". must be a typed array")}function Le(l,d){switch(d){case"number":return typeof l=="number";case"object":return typeof l=="object";case"string":return typeof l=="string";case"boolean":return typeof l=="boolean";case"function":return typeof l=="function";case"undefined":return typeof l>"u";case"symbol":return typeof l=="symbol"}}function Ee(l,d,E){Le(l,d)||b("invalid parameter type"+D(E)+". expected "+d+", got "+typeof l)}function xe(l,d){l>=0&&(l|0)===l||b("invalid parameter type, ("+l+")"+D(d)+". must be a nonnegative integer")}function Pe(l,d,E){d.indexOf(l)<0&&b("invalid value"+D(E)+". must be one of: "+d)}var Ne=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function at(l){Object.keys(l).forEach(function(d){Ne.indexOf(d)<0&&b('invalid regl constructor argument "'+d+'". must be one of '+Ne)})}function je(l,d){for(l=l+"";l.length<d;)l=" "+l;return l}function ce(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function $e(l,d){this.number=l,this.line=d,this.errors=[]}function Me(l,d,E){this.file=l,this.line=d,this.message=E}function _t(){var l=new Error,d=(l.stack||l).toString(),E=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(d);if(E)return E[1];var j=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(d);return j?j[1]:"unknown"}function We(){var l=new Error,d=(l.stack||l).toString(),E=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(d);if(E)return E[1];var j=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(d);return j?j[1]:"unknown"}function ut(l,d){var E=l.split(`
`),j=1,Q=0,z={unknown:new ce,0:new ce};z.unknown.name=z[0].name=d||_t(),z.unknown.lines.push(new $e(0,""));for(var W=0;W<E.length;++W){var ie=E[W],se=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(ie);if(se)switch(se[1]){case"line":var he=/(\d+)(\s+\d+)?/.exec(se[2]);he&&(j=he[1]|0,he[2]&&(Q=he[2]|0,Q in z||(z[Q]=new ce)));break;case"define":var oe=/SHADER_NAME(_B64)?\s+(.*)$/.exec(se[2]);oe&&(z[Q].name=oe[1]?c(oe[2]):oe[2]);break}z[Q].lines.push(new $e(j++,ie))}return Object.keys(z).forEach(function(me){var be=z[me];be.lines.forEach(function(ae){be.index[ae.number]=ae})}),z}function bt(l){var d=[];return l.split(`
`).forEach(function(E){if(!(E.length<5)){var j=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(E);j?d.push(new Me(j[1]|0,j[2]|0,j[3].trim())):E.length>0&&d.push(new Me("unknown",0,E))}}),d}function ct(l,d){d.forEach(function(E){var j=l[E.file];if(j){var Q=j.index[E.line];if(Q){Q.errors.push(E),j.hasErrors=!0;return}}l.unknown.hasErrors=!0,l.unknown.lines[0].errors.push(E)})}function Et(l,d,E,j,Q){if(!l.getShaderParameter(d,l.COMPILE_STATUS)){var z=l.getShaderInfoLog(d),W=j===l.FRAGMENT_SHADER?"fragment":"vertex";q(E,"string",W+" shader source must be a string",Q);var ie=ut(E,Q),se=bt(z);ct(ie,se),Object.keys(ie).forEach(function(he){var oe=ie[he];if(!oe.hasErrors)return;var me=[""],be=[""];function ae(pe,M){me.push(pe),be.push(M||"")}ae("file number "+he+": "+oe.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),oe.lines.forEach(function(pe){if(pe.errors.length>0){ae(je(pe.number,4)+"|  ","background-color:yellow; font-weight:bold"),ae(pe.line+u,"color:red; background-color:yellow; font-weight:bold");var M=0;pe.errors.forEach(function(X){var le=X.message,we=/^\s*'(.*)'\s*:\s*(.*)$/.exec(le);if(we){var ee=we[1];switch(le=we[2],ee){case"assign":ee="=";break}M=Math.max(pe.line.indexOf(ee,M),0)}else M=0;ae(je("| ",6)),ae(je("^^^",M+3)+u,"font-weight:bold"),ae(je("| ",6)),ae(le+u,"font-weight:bold")}),ae(je("| ",6)+u)}else ae(je(pe.number,4)+"|  "),ae(pe.line+u,"color:red")}),typeof document<"u"&&!window.chrome?(be[0]=me.join("%c"),console.log.apply(console,be)):console.log(me.join(""))}),A.raise("Error compiling "+W+" shader, "+ie[0].name)}}function Qe(l,d,E,j,Q){if(!l.getProgramParameter(d,l.LINK_STATUS)){var z=l.getProgramInfoLog(d),W=ut(E,Q),ie=ut(j,Q),se='Error linking program with vertex shader, "'+ie[0].name+'", and fragment shader "'+W[0].name+'"';typeof document<"u"?console.log("%c"+se+u+"%c"+z,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(se+u+z),A.raise(se)}}function dt(l){l._commandRef=_t()}function gt(l,d,E,j){dt(l);function Q(se){return se?j.id(se):0}l._fragId=Q(l.static.frag),l._vertId=Q(l.static.vert);function z(se,he){Object.keys(he).forEach(function(oe){se[j.id(oe)]=!0})}var W=l._uniformSet={};z(W,d.static),z(W,d.dynamic);var ie=l._attributeSet={};z(ie,E.static),z(ie,E.dynamic),l._hasCount="count"in l.static||"count"in l.dynamic||"elements"in l.static||"elements"in l.dynamic}function st(l,d){var E=We();b(l+" in command "+(d||_t())+(E==="unknown"?"":" called from "+E))}function R(l,d,E){l||st(d,E||_t())}function g(l,d,E,j){l in d||st("unknown parameter ("+l+")"+D(E)+". possible values: "+Object.keys(d).join(),j||_t())}function q(l,d,E,j){Le(l,d)||st("invalid parameter type"+D(E)+". expected "+d+", got "+typeof l,j||_t())}function N(l){l()}function ne(l,d,E){l.texture?Pe(l.texture._texture.internalformat,d,"unsupported texture format for attachment"):Pe(l.renderbuffer._renderbuffer.format,E,"unsupported renderbuffer format for attachment")}var ye=33071,ze=9728,Ie=9984,He=9985,Ue=9986,Xe=9987,ue=5120,ke=5121,lt=5122,Se=5123,yt=5124,Kt=5125,wt=5126,Pt=32819,It=32820,Bt=33635,kr=34042,Kn=36193,qt={};qt[ue]=qt[ke]=1,qt[lt]=qt[Se]=qt[Kn]=qt[Bt]=qt[Pt]=qt[It]=2,qt[yt]=qt[Kt]=qt[wt]=qt[kr]=4;function hn(l,d){return l===It||l===Pt||l===Bt?2:l===kr?4:qt[l]*d}function _r(l){return!(l&l-1)&&!!l}function dn(l,d,E){var j,Q=d.width,z=d.height,W=d.channels;A(Q>0&&Q<=E.maxTextureSize&&z>0&&z<=E.maxTextureSize,"invalid texture shape"),(l.wrapS!==ye||l.wrapT!==ye)&&A(_r(Q)&&_r(z),"incompatible wrap mode for texture, both width and height must be power of 2"),d.mipmask===1?Q!==1&&z!==1&&A(l.minFilter!==Ie&&l.minFilter!==Ue&&l.minFilter!==He&&l.minFilter!==Xe,"min filter requires mipmap"):(A(_r(Q)&&_r(z),"texture must be a square power of 2 to support mipmapping"),A(d.mipmask===(Q<<1)-1,"missing or incomplete mipmap data")),d.type===wt&&(E.extensions.indexOf("oes_texture_float_linear")<0&&A(l.minFilter===ze&&l.magFilter===ze,"filter not supported, must enable oes_texture_float_linear"),A(!l.genMipmaps,"mipmap generation not supported with float textures"));var ie=d.images;for(j=0;j<16;++j)if(ie[j]){var se=Q>>j,he=z>>j;A(d.mipmask&1<<j,"missing mipmap data");var oe=ie[j];if(A(oe.width===se&&oe.height===he,"invalid shape for mip images"),A(oe.format===d.format&&oe.internalformat===d.internalformat&&oe.type===d.type,"incompatible type for mip image"),!oe.compressed)if(oe.data){var me=Math.ceil(hn(oe.type,W)*se/oe.unpackAlignment)*oe.unpackAlignment;A(oe.data.byteLength===me*he,"invalid data for image, buffer size is inconsistent with image format")}else oe.element||oe.copy}else l.genMipmaps||A((d.mipmask&1<<j)===0,"extra mipmap data");d.compressed&&A(!l.genMipmaps,"mipmap generation for compressed images not supported")}function Qn(l,d,E,j){var Q=l.width,z=l.height,W=l.channels;A(Q>0&&Q<=j.maxTextureSize&&z>0&&z<=j.maxTextureSize,"invalid texture shape"),A(Q===z,"cube map must be square"),A(d.wrapS===ye&&d.wrapT===ye,"wrap mode not supported by cube map");for(var ie=0;ie<E.length;++ie){var se=E[ie];A(se.width===Q&&se.height===z,"inconsistent cube map face shape"),d.genMipmaps&&(A(!se.compressed,"can not generate mipmap for compressed textures"),A(se.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var he=se.images,oe=0;oe<16;++oe){var me=he[oe];if(me){var be=Q>>oe,ae=z>>oe;A(se.mipmask&1<<oe,"missing mipmap data"),A(me.width===be&&me.height===ae,"invalid shape for mip images"),A(me.format===l.format&&me.internalformat===l.internalformat&&me.type===l.type,"incompatible type for mip image"),me.compressed||(me.data?A(me.data.byteLength===be*ae*Math.max(hn(me.type,W),me.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):me.element||me.copy)}}}}var p=o(A,{optional:N,raise:b,commandRaise:st,command:R,parameter:V,commandParameter:g,constructor:at,type:Ee,commandType:q,isTypedArray:Ae,nni:xe,oneOf:Pe,shaderError:Et,linkError:Qe,callSite:We,saveCommandRef:dt,saveDrawInfo:gt,framebufferFormat:ne,guessCommand:_t,texture2D:dn,textureCube:Qn}),Zn=0,Jn=0,ei=5,ti=6;function ur(l,d){this.id=Zn++,this.type=l,this.data=d}function mn(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function vr(l){if(l.length===0)return[];var d=l.charAt(0),E=l.charAt(l.length-1);if(l.length>1&&d===E&&(d==='"'||d==="'"))return['"'+mn(l.substr(1,l.length-2))+'"'];var j=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(l);if(j)return vr(l.substr(0,j.index)).concat(vr(j[1])).concat(vr(l.substr(j.index+j[0].length)));var Q=l.split(".");if(Q.length===1)return['"'+mn(l)+'"'];for(var z=[],W=0;W<Q.length;++W)z=z.concat(vr(Q[W]));return z}function pn(l){return"["+vr(l).join("][")+"]"}function ri(l,d){return new ur(l,pn(d+""))}function ni(l){return typeof l=="function"&&!l._reglType||l instanceof ur}function _n(l,d){if(typeof l=="function")return new ur(Jn,l);if(typeof l=="number"||typeof l=="boolean")return new ur(ei,l);if(Array.isArray(l))return new ur(ti,l.map((E,j)=>_n(E,d+"["+j+"]")));if(l instanceof ur)return l;p(!1,"invalid option type in uniform "+d)}var Ht={DynamicVariable:ur,define:ri,isDynamic:ni,unbox:_n,accessor:pn},Hr={next:typeof requestAnimationFrame=="function"?function(l){return requestAnimationFrame(l)}:function(l){return setTimeout(l,16)},cancel:typeof cancelAnimationFrame=="function"?function(l){return cancelAnimationFrame(l)}:clearTimeout},vn=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ii(){var l={"":0},d=[""];return{id:function(E){var j=l[E];return j||(j=l[E]=d.length,d.push(E),j)},str:function(E){return d[E]}}}function ai(l,d,E){var j=document.createElement("canvas");o(j.style,{border:0,margin:0,padding:0,top:0,left:0}),l.appendChild(j),l===document.body&&(j.style.position="absolute",o(l.style,{margin:0,padding:0}));function Q(){var ie=window.innerWidth,se=window.innerHeight;if(l!==document.body){var he=l.getBoundingClientRect();ie=he.right-he.left,se=he.bottom-he.top}j.width=E*ie,j.height=E*se,o(j.style,{width:ie+"px",height:se+"px"})}var z;l!==document.body&&typeof ResizeObserver=="function"?(z=new ResizeObserver(function(){setTimeout(Q)}),z.observe(l)):window.addEventListener("resize",Q,!1);function W(){z?z.disconnect():window.removeEventListener("resize",Q),l.removeChild(j)}return Q(),{canvas:j,onDestroy:W}}function si(l,d){function E(j){try{return l.getContext(j,d)}catch{return null}}return E("webgl")||E("experimental-webgl")||E("webgl-experimental")}function oi(l){return typeof l.nodeName=="string"&&typeof l.appendChild=="function"&&typeof l.getBoundingClientRect=="function"}function ui(l){return typeof l.drawArrays=="function"||typeof l.drawElements=="function"}function yn(l){return typeof l=="string"?l.split():(p(Array.isArray(l),"invalid extension array"),l)}function bn(l){return typeof l=="string"?(p(typeof document<"u","not supported outside of DOM"),document.querySelector(l)):l}function De(l){var d=l||{},E,j,Q,z,W={},ie=[],se=[],he=typeof window>"u"?1:window.devicePixelRatio,oe=!1,me=function(pe){pe&&p.raise(pe)},be=function(){};if(typeof d=="string"?(p(typeof document<"u","selector queries only supported in DOM enviroments"),E=document.querySelector(d),p(E,"invalid query string for element")):typeof d=="object"?oi(d)?E=d:ui(d)?(z=d,Q=z.canvas):(p.constructor(d),"gl"in d?z=d.gl:"canvas"in d?Q=bn(d.canvas):"container"in d&&(j=bn(d.container)),"attributes"in d&&(W=d.attributes,p.type(W,"object","invalid context attributes")),"extensions"in d&&(ie=yn(d.extensions)),"optionalExtensions"in d&&(se=yn(d.optionalExtensions)),"onDone"in d&&(p.type(d.onDone,"function","invalid or missing onDone callback"),me=d.onDone),"profile"in d&&(oe=!!d.profile),"pixelRatio"in d&&(he=+d.pixelRatio,p(he>0,"invalid pixel ratio"))):p.raise("invalid arguments to regl"),E&&(E.nodeName.toLowerCase()==="canvas"?Q=E:j=E),!z){if(!Q){p(typeof document<"u","must manually specify webgl context outside of DOM environments");var ae=ai(j||document.body,me,he);if(!ae)return null;Q=ae.canvas,be=ae.onDestroy}W.premultipliedAlpha===void 0&&(W.premultipliedAlpha=!0),z=si(Q,W)}return z?{gl:z,canvas:Q,container:j,extensions:ie,optionalExtensions:se,pixelRatio:he,profile:oe,onDone:me,onDestroy:be}:(be(),me("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Dt(l,d){var E={};function j(W){p.type(W,"string","extension name must be string");var ie=W.toLowerCase(),se;try{se=E[ie]=l.getExtension(ie)}catch{}return!!se}for(var Q=0;Q<d.extensions.length;++Q){var z=d.extensions[Q];if(!j(z))return d.onDestroy(),d.onDone('"'+z+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return d.optionalExtensions.forEach(j),{extensions:E,restore:function(){Object.keys(E).forEach(function(W){if(E[W]&&!j(W))throw new Error("(regl): error restoring extension "+W)})}}}function Ot(l,d){for(var E=Array(l),j=0;j<l;++j)E[j]=d(j);return E}var nr=5120,gn=5121,Wr=5122,ia=5123,Zs=5124,Js=5125,eo=5126;function to(l){for(var d=16;d<=1<<28;d*=16)if(l<=d)return d;return 0}function aa(l){var d,E;return d=(l>65535)<<4,l>>>=d,E=(l>255)<<3,l>>>=E,d|=E,E=(l>15)<<2,l>>>=E,d|=E,E=(l>3)<<1,l>>>=E,d|=E,d|l>>1}function sa(){var l=Ot(8,function(){return[]});function d(z){var W=to(z),ie=l[aa(W)>>2];return ie.length>0?ie.pop():new ArrayBuffer(W)}function E(z){l[aa(z.byteLength)>>2].push(z)}function j(z,W){var ie=null;switch(z){case nr:ie=new Int8Array(d(W),0,W);break;case gn:ie=new Uint8Array(d(W),0,W);break;case Wr:ie=new Int16Array(d(2*W),0,W);break;case ia:ie=new Uint16Array(d(2*W),0,W);break;case Zs:ie=new Int32Array(d(4*W),0,W);break;case Js:ie=new Uint32Array(d(4*W),0,W);break;case eo:ie=new Float32Array(d(4*W),0,W);break;default:return null}return ie.length!==W?ie.subarray(0,W):ie}function Q(z){E(z.buffer)}return{alloc:d,free:E,allocType:j,freeType:Q}}var kt=sa();kt.zero=sa();var ro=3408,no=3410,io=3411,ao=3412,so=3413,oo=3414,uo=3415,fo=33901,lo=33902,co=3379,ho=3386,mo=34921,po=36347,_o=36348,vo=35661,yo=35660,bo=34930,go=36349,Eo=34076,wo=34024,So=7936,xo=7937,Ao=7938,To=35724,$o=34047,Oo=36063,ko=34852,En=3553,oa=34067,Lo=34069,Co=33984,Xr=6408,fi=5126,ua=5121,li=36160,Ro=36053,Po=36064,Io=16384,Fo=function(l,d){var E=1;d.ext_texture_filter_anisotropic&&(E=l.getParameter($o));var j=1,Q=1;d.webgl_draw_buffers&&(j=l.getParameter(ko),Q=l.getParameter(Oo));var z=!!d.oes_texture_float;if(z){var W=l.createTexture();l.bindTexture(En,W),l.texImage2D(En,0,Xr,1,1,0,Xr,fi,null);var ie=l.createFramebuffer();if(l.bindFramebuffer(li,ie),l.framebufferTexture2D(li,Po,En,W,0),l.bindTexture(En,null),l.checkFramebufferStatus(li)!==Ro)z=!1;else{l.viewport(0,0,1,1),l.clearColor(1,0,0,1),l.clear(Io);var se=kt.allocType(fi,4);l.readPixels(0,0,1,1,Xr,fi,se),l.getError()?z=!1:(l.deleteFramebuffer(ie),l.deleteTexture(W),z=se[0]===1),kt.freeType(se)}}var he=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),oe=!0;if(!he){var me=l.createTexture(),be=kt.allocType(ua,36);l.activeTexture(Co),l.bindTexture(oa,me),l.texImage2D(Lo,0,Xr,3,3,0,Xr,ua,be),kt.freeType(be),l.bindTexture(oa,null),l.deleteTexture(me),oe=!l.getError()}return{colorBits:[l.getParameter(no),l.getParameter(io),l.getParameter(ao),l.getParameter(so)],depthBits:l.getParameter(oo),stencilBits:l.getParameter(uo),subpixelBits:l.getParameter(ro),extensions:Object.keys(d).filter(function(ae){return!!d[ae]}),maxAnisotropic:E,maxDrawbuffers:j,maxColorAttachments:Q,pointSizeDims:l.getParameter(fo),lineWidthDims:l.getParameter(lo),maxViewportDims:l.getParameter(ho),maxCombinedTextureUnits:l.getParameter(vo),maxCubeMapSize:l.getParameter(Eo),maxRenderbufferSize:l.getParameter(wo),maxTextureUnits:l.getParameter(bo),maxTextureSize:l.getParameter(co),maxAttributes:l.getParameter(mo),maxVertexUniforms:l.getParameter(po),maxVertexTextureUnits:l.getParameter(yo),maxVaryingVectors:l.getParameter(_o),maxFragmentUniforms:l.getParameter(go),glsl:l.getParameter(To),renderer:l.getParameter(xo),vendor:l.getParameter(So),version:l.getParameter(Ao),readFloat:z,npotTextureCube:oe}};function er(l){return!!l&&typeof l=="object"&&Array.isArray(l.shape)&&Array.isArray(l.stride)&&typeof l.offset=="number"&&l.shape.length===l.stride.length&&(Array.isArray(l.data)||s(l.data))}var Qt=function(l){return Object.keys(l).map(function(d){return l[d]})},wn={shape:Do,flatten:Bo};function No(l,d,E){for(var j=0;j<d;++j)E[j]=l[j]}function Mo(l,d,E,j){for(var Q=0,z=0;z<d;++z)for(var W=l[z],ie=0;ie<E;++ie)j[Q++]=W[ie]}function fa(l,d,E,j,Q,z){for(var W=z,ie=0;ie<d;++ie)for(var se=l[ie],he=0;he<E;++he)for(var oe=se[he],me=0;me<j;++me)Q[W++]=oe[me]}function la(l,d,E,j,Q){for(var z=1,W=E+1;W<d.length;++W)z*=d[W];var ie=d[E];if(d.length-E===4){var se=d[E+1],he=d[E+2],oe=d[E+3];for(W=0;W<ie;++W)fa(l[W],se,he,oe,j,Q),Q+=z}else for(W=0;W<ie;++W)la(l[W],d,E+1,j,Q),Q+=z}function Bo(l,d,E,j){var Q=1;if(d.length)for(var z=0;z<d.length;++z)Q*=d[z];else Q=0;var W=j||kt.allocType(E,Q);switch(d.length){case 0:break;case 1:No(l,d[0],W);break;case 2:Mo(l,d[0],d[1],W);break;case 3:fa(l,d[0],d[1],d[2],W,0);break;default:la(l,d,0,W,0)}return W}function Do(l){for(var d=[],E=l;E.length;E=E[0])d.push(E.length);return d}var ci={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Go=5120,Uo=5122,Vo=5124,zo=5121,jo=5123,qo=5125,Ho=5126,Wo=5126,yr={int8:Go,int16:Uo,int32:Vo,uint8:zo,uint16:jo,uint32:qo,float:Ho,float32:Wo},Xo=35048,Yo=35040,Sn={dynamic:Xo,stream:Yo,static:35044},hi=wn.flatten,ca=wn.shape,ha=35044,Ko=35040,di=5121,mi=5126,cr=[];cr[5120]=1,cr[5122]=2,cr[5124]=4,cr[5121]=1,cr[5123]=2,cr[5125]=4,cr[5126]=4;function xn(l){return ci[Object.prototype.toString.call(l)]|0}function da(l,d){for(var E=0;E<d.length;++E)l[E]=d[E]}function ma(l,d,E,j,Q,z,W){for(var ie=0,se=0;se<E;++se)for(var he=0;he<j;++he)l[ie++]=d[Q*se+z*he+W]}function Qo(l,d,E,j){var Q=0,z={};function W(M){this.id=Q++,this.buffer=l.createBuffer(),this.type=M,this.usage=ha,this.byteLength=0,this.dimension=1,this.dtype=di,this.persistentData=null,E.profile&&(this.stats={size:0})}W.prototype.bind=function(){l.bindBuffer(this.type,this.buffer)},W.prototype.destroy=function(){be(this)};var ie=[];function se(M,X){var le=ie.pop();return le||(le=new W(M)),le.bind(),me(le,X,Ko,0,1,!1),le}function he(M){ie.push(M)}function oe(M,X,le){M.byteLength=X.byteLength,l.bufferData(M.type,X,le)}function me(M,X,le,we,ee,Te){var re;if(M.usage=le,Array.isArray(X)){if(M.dtype=we||mi,X.length>0){var _e;if(Array.isArray(X[0])){re=ca(X);for(var te=1,ve=1;ve<re.length;++ve)te*=re[ve];M.dimension=te,_e=hi(X,re,M.dtype),oe(M,_e,le),Te?M.persistentData=_e:kt.freeType(_e)}else if(typeof X[0]=="number"){M.dimension=ee;var Be=kt.allocType(M.dtype,X.length);da(Be,X),oe(M,Be,le),Te?M.persistentData=Be:kt.freeType(Be)}else s(X[0])?(M.dimension=X[0].length,M.dtype=we||xn(X[0])||mi,_e=hi(X,[X.length,X[0].length],M.dtype),oe(M,_e,le),Te?M.persistentData=_e:kt.freeType(_e)):p.raise("invalid buffer data")}}else if(s(X))M.dtype=we||xn(X),M.dimension=ee,oe(M,X,le),Te&&(M.persistentData=new Uint8Array(new Uint8Array(X.buffer)));else if(er(X)){re=X.shape;var Ye=X.stride,ge=X.offset,de=0,J=0,qe=0,Je=0;re.length===1?(de=re[0],J=1,qe=Ye[0],Je=0):re.length===2?(de=re[0],J=re[1],qe=Ye[0],Je=Ye[1]):p.raise("invalid shape"),M.dtype=we||xn(X.data)||mi,M.dimension=J;var Ce=kt.allocType(M.dtype,de*J);ma(Ce,X.data,de,J,qe,Je,ge),oe(M,Ce,le),Te?M.persistentData=Ce:kt.freeType(Ce)}else X instanceof ArrayBuffer?(M.dtype=di,M.dimension=ee,oe(M,X,le),Te&&(M.persistentData=new Uint8Array(new Uint8Array(X)))):p.raise("invalid buffer data")}function be(M){d.bufferCount--,j(M);var X=M.buffer;p(X,"buffer must not be deleted already"),l.deleteBuffer(X),M.buffer=null,delete z[M.id]}function ae(M,X,le,we){d.bufferCount++;var ee=new W(X);z[ee.id]=ee;function Te(te){var ve=ha,Be=null,Ye=0,ge=0,de=1;return Array.isArray(te)||s(te)||er(te)||te instanceof ArrayBuffer?Be=te:typeof te=="number"?Ye=te|0:te&&(p.type(te,"object","buffer arguments must be an object, a number or an array"),"data"in te&&(p(Be===null||Array.isArray(Be)||s(Be)||er(Be),"invalid data for buffer"),Be=te.data),"usage"in te&&(p.parameter(te.usage,Sn,"invalid buffer usage"),ve=Sn[te.usage]),"type"in te&&(p.parameter(te.type,yr,"invalid buffer type"),ge=yr[te.type]),"dimension"in te&&(p.type(te.dimension,"number","invalid dimension"),de=te.dimension|0),"length"in te&&(p.nni(Ye,"buffer length must be a nonnegative integer"),Ye=te.length|0)),ee.bind(),Be?me(ee,Be,ve,ge,de,we):(Ye&&l.bufferData(ee.type,Ye,ve),ee.dtype=ge||di,ee.usage=ve,ee.dimension=de,ee.byteLength=Ye),E.profile&&(ee.stats.size=ee.byteLength*cr[ee.dtype]),Te}function re(te,ve){p(ve+te.byteLength<=ee.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+te.byteLength+" starting from offset "+ve+" to a buffer of size "+ee.byteLength),l.bufferSubData(ee.type,ve,te)}function _e(te,ve){var Be=(ve||0)|0,Ye;if(ee.bind(),s(te)||te instanceof ArrayBuffer)re(te,Be);else if(Array.isArray(te)){if(te.length>0)if(typeof te[0]=="number"){var ge=kt.allocType(ee.dtype,te.length);da(ge,te),re(ge,Be),kt.freeType(ge)}else if(Array.isArray(te[0])||s(te[0])){Ye=ca(te);var de=hi(te,Ye,ee.dtype);re(de,Be),kt.freeType(de)}else p.raise("invalid buffer data")}else if(er(te)){Ye=te.shape;var J=te.stride,qe=0,Je=0,Ce=0,nt=0;Ye.length===1?(qe=Ye[0],Je=1,Ce=J[0],nt=0):Ye.length===2?(qe=Ye[0],Je=Ye[1],Ce=J[0],nt=J[1]):p.raise("invalid shape");var Ke=Array.isArray(te.data)?ee.dtype:xn(te.data),rt=kt.allocType(Ke,qe*Je);ma(rt,te.data,qe,Je,Ce,nt,te.offset),re(rt,Be),kt.freeType(rt)}else p.raise("invalid data for buffer subdata");return Te}return le||Te(M),Te._reglType="buffer",Te._buffer=ee,Te.subdata=_e,E.profile&&(Te.stats=ee.stats),Te.destroy=function(){be(ee)},Te}function pe(){Qt(z).forEach(function(M){M.buffer=l.createBuffer(),l.bindBuffer(M.type,M.buffer),l.bufferData(M.type,M.persistentData||M.byteLength,M.usage)})}return E.profile&&(d.getTotalBufferSize=function(){var M=0;return Object.keys(z).forEach(function(X){M+=z[X].stats.size}),M}),{create:ae,createStream:se,destroyStream:he,clear:function(){Qt(z).forEach(be),ie.forEach(be)},getBuffer:function(M){return M&&M._buffer instanceof W?M._buffer:null},restore:pe,_initBuffer:me}}var Zo=0,Jo=0,eu=1,tu=1,ru=4,nu=4,Lr={points:Zo,point:Jo,lines:eu,line:tu,triangles:ru,triangle:nu,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},iu=0,au=1,Yr=4,su=5120,Cr=5121,pa=5122,Rr=5123,_a=5124,br=5125,pi=34963,ou=35040,uu=35044;function fu(l,d,E,j){var Q={},z=0,W={uint8:Cr,uint16:Rr};d.oes_element_index_uint&&(W.uint32=br);function ie(pe){this.id=z++,Q[this.id]=this,this.buffer=pe,this.primType=Yr,this.vertCount=0,this.type=0}ie.prototype.bind=function(){this.buffer.bind()};var se=[];function he(pe){var M=se.pop();return M||(M=new ie(E.create(null,pi,!0,!1)._buffer)),me(M,pe,ou,-1,-1,0,0),M}function oe(pe){se.push(pe)}function me(pe,M,X,le,we,ee,Te){pe.buffer.bind();var re;if(M){var _e=Te;!Te&&(!s(M)||er(M)&&!s(M.data))&&(_e=d.oes_element_index_uint?br:Rr),E._initBuffer(pe.buffer,M,X,_e,3)}else l.bufferData(pi,ee,X),pe.buffer.dtype=re||Cr,pe.buffer.usage=X,pe.buffer.dimension=3,pe.buffer.byteLength=ee;if(re=Te,!Te){switch(pe.buffer.dtype){case Cr:case su:re=Cr;break;case Rr:case pa:re=Rr;break;case br:case _a:re=br;break;default:p.raise("unsupported type for element array")}pe.buffer.dtype=re}pe.type=re,p(re!==br||!!d.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var te=we;te<0&&(te=pe.buffer.byteLength,re===Rr?te>>=1:re===br&&(te>>=2)),pe.vertCount=te;var ve=le;if(le<0){ve=Yr;var Be=pe.buffer.dimension;Be===1&&(ve=iu),Be===2&&(ve=au),Be===3&&(ve=Yr)}pe.primType=ve}function be(pe){j.elementsCount--,p(pe.buffer!==null,"must not double destroy elements"),delete Q[pe.id],pe.buffer.destroy(),pe.buffer=null}function ae(pe,M){var X=E.create(null,pi,!0),le=new ie(X._buffer);j.elementsCount++;function we(ee){if(!ee)X(),le.primType=Yr,le.vertCount=0,le.type=Cr;else if(typeof ee=="number")X(ee),le.primType=Yr,le.vertCount=ee|0,le.type=Cr;else{var Te=null,re=uu,_e=-1,te=-1,ve=0,Be=0;Array.isArray(ee)||s(ee)||er(ee)?Te=ee:(p.type(ee,"object","invalid arguments for elements"),"data"in ee&&(Te=ee.data,p(Array.isArray(Te)||s(Te)||er(Te),"invalid data for element buffer")),"usage"in ee&&(p.parameter(ee.usage,Sn,"invalid element buffer usage"),re=Sn[ee.usage]),"primitive"in ee&&(p.parameter(ee.primitive,Lr,"invalid element buffer primitive"),_e=Lr[ee.primitive]),"count"in ee&&(p(typeof ee.count=="number"&&ee.count>=0,"invalid vertex count for elements"),te=ee.count|0),"type"in ee&&(p.parameter(ee.type,W,"invalid buffer type"),Be=W[ee.type]),"length"in ee?ve=ee.length|0:(ve=te,Be===Rr||Be===pa?ve*=2:(Be===br||Be===_a)&&(ve*=4))),me(le,Te,re,_e,te,ve,Be)}return we}return we(pe),we._reglType="elements",we._elements=le,we.subdata=function(ee,Te){return X.subdata(ee,Te),we},we.destroy=function(){be(le)},we}return{create:ae,createStream:he,destroyStream:oe,getElements:function(pe){return typeof pe=="function"&&pe._elements instanceof ie?pe._elements:null},clear:function(){Qt(Q).forEach(be)}}}var va=new Float32Array(1),lu=new Uint32Array(va.buffer),cu=5123;function ya(l){for(var d=kt.allocType(cu,l.length),E=0;E<l.length;++E)if(isNaN(l[E]))d[E]=65535;else if(l[E]===1/0)d[E]=31744;else if(l[E]===-1/0)d[E]=64512;else{va[0]=l[E];var j=lu[0],Q=j>>>31<<15,z=(j<<1>>>24)-127,W=j>>13&(1<<10)-1;if(z<-24)d[E]=Q;else if(z<-14){var ie=-14-z;d[E]=Q+(W+(1<<10)>>ie)}else z>15?d[E]=Q+31744:d[E]=Q+(z+15<<10)+W}return d}function At(l){return Array.isArray(l)||s(l)}var ba=function(l){return!(l&l-1)&&!!l},hu=34467,ir=3553,_i=34067,An=34069,gr=6408,vi=6406,Tn=6407,Kr=6409,$n=6410,ga=32854,yi=32855,Ea=36194,du=32819,mu=32820,pu=33635,_u=34042,bi=6402,On=34041,gi=35904,Ei=35906,Pr=36193,wi=33776,Si=33777,xi=33778,Ai=33779,wa=35986,Sa=35987,xa=34798,Aa=35840,Ta=35841,$a=35842,Oa=35843,ka=36196,Ir=5121,Ti=5123,$i=5125,Qr=5126,vu=10242,yu=10243,bu=10497,Oi=33071,gu=33648,Eu=10240,wu=10241,ki=9728,Su=9729,Li=9984,La=9985,Ca=9986,Ci=9987,xu=33170,kn=4352,Au=4353,Tu=4354,$u=34046,Ou=3317,ku=37440,Lu=37441,Cu=37443,Ra=37444,Zr=33984,Ru=[Li,Ca,La,Ci],Ln=[0,Kr,$n,Tn,gr],Zt={};Zt[Kr]=Zt[vi]=Zt[bi]=1,Zt[On]=Zt[$n]=2,Zt[Tn]=Zt[gi]=3,Zt[gr]=Zt[Ei]=4;function Fr(l){return"[object "+l+"]"}var Pa=Fr("HTMLCanvasElement"),Ia=Fr("OffscreenCanvas"),Fa=Fr("CanvasRenderingContext2D"),Na=Fr("ImageBitmap"),Ma=Fr("HTMLImageElement"),Ba=Fr("HTMLVideoElement"),Pu=Object.keys(ci).concat([Pa,Ia,Fa,Na,Ma,Ba]),Nr=[];Nr[Ir]=1,Nr[Qr]=4,Nr[Pr]=2,Nr[Ti]=2,Nr[$i]=4;var Vt=[];Vt[ga]=2,Vt[yi]=2,Vt[Ea]=2,Vt[On]=4,Vt[wi]=.5,Vt[Si]=.5,Vt[xi]=1,Vt[Ai]=1,Vt[wa]=.5,Vt[Sa]=1,Vt[xa]=1,Vt[Aa]=.5,Vt[Ta]=.25,Vt[$a]=.5,Vt[Oa]=.25,Vt[ka]=.5;function Da(l){return Array.isArray(l)&&(l.length===0||typeof l[0]=="number")}function Ga(l){if(!Array.isArray(l))return!1;var d=l.length;return!(d===0||!At(l[0]))}function Er(l){return Object.prototype.toString.call(l)}function Ua(l){return Er(l)===Pa}function Va(l){return Er(l)===Ia}function Iu(l){return Er(l)===Fa}function Fu(l){return Er(l)===Na}function Nu(l){return Er(l)===Ma}function Mu(l){return Er(l)===Ba}function Ri(l){if(!l)return!1;var d=Er(l);return Pu.indexOf(d)>=0?!0:Da(l)||Ga(l)||er(l)}function za(l){return ci[Object.prototype.toString.call(l)]|0}function Bu(l,d){var E=d.length;switch(l.type){case Ir:case Ti:case $i:case Qr:var j=kt.allocType(l.type,E);j.set(d),l.data=j;break;case Pr:l.data=ya(d);break;default:p.raise("unsupported texture type, must specify a typed array")}}function ja(l,d){return kt.allocType(l.type===Pr?Qr:l.type,d)}function qa(l,d){l.type===Pr?(l.data=ya(d),kt.freeType(d)):l.data=d}function Du(l,d,E,j,Q,z){for(var W=l.width,ie=l.height,se=l.channels,he=W*ie*se,oe=ja(l,he),me=0,be=0;be<ie;++be)for(var ae=0;ae<W;++ae)for(var pe=0;pe<se;++pe)oe[me++]=d[E*ae+j*be+Q*pe+z];qa(l,oe)}function Cn(l,d,E,j,Q,z){var W;if(typeof Vt[l]<"u"?W=Vt[l]:W=Zt[l]*Nr[d],z&&(W*=6),Q){for(var ie=0,se=E;se>=1;)ie+=W*se*se,se/=2;return ie}else return W*E*j}function Gu(l,d,E,j,Q,z,W){var ie={"don't care":kn,"dont care":kn,nice:Tu,fast:Au},se={repeat:bu,clamp:Oi,mirror:gu},he={nearest:ki,linear:Su},oe=o({mipmap:Ci,"nearest mipmap nearest":Li,"linear mipmap nearest":La,"nearest mipmap linear":Ca,"linear mipmap linear":Ci},he),me={none:0,browser:Ra},be={uint8:Ir,rgba4:du,rgb565:pu,"rgb5 a1":mu},ae={alpha:vi,luminance:Kr,"luminance alpha":$n,rgb:Tn,rgba:gr,rgba4:ga,"rgb5 a1":yi,rgb565:Ea},pe={};d.ext_srgb&&(ae.srgb=gi,ae.srgba=Ei),d.oes_texture_float&&(be.float32=be.float=Qr),d.oes_texture_half_float&&(be.float16=be["half float"]=Pr),d.webgl_depth_texture&&(o(ae,{depth:bi,"depth stencil":On}),o(be,{uint16:Ti,uint32:$i,"depth stencil":_u})),d.webgl_compressed_texture_s3tc&&o(pe,{"rgb s3tc dxt1":wi,"rgba s3tc dxt1":Si,"rgba s3tc dxt3":xi,"rgba s3tc dxt5":Ai}),d.webgl_compressed_texture_atc&&o(pe,{"rgb atc":wa,"rgba atc explicit alpha":Sa,"rgba atc interpolated alpha":xa}),d.webgl_compressed_texture_pvrtc&&o(pe,{"rgb pvrtc 4bppv1":Aa,"rgb pvrtc 2bppv1":Ta,"rgba pvrtc 4bppv1":$a,"rgba pvrtc 2bppv1":Oa}),d.webgl_compressed_texture_etc1&&(pe["rgb etc1"]=ka);var M=Array.prototype.slice.call(l.getParameter(hu));Object.keys(pe).forEach(function(y){var H=pe[y];M.indexOf(H)>=0&&(ae[y]=H)});var X=Object.keys(ae);E.textureFormats=X;var le=[];Object.keys(ae).forEach(function(y){var H=ae[y];le[H]=y});var we=[];Object.keys(be).forEach(function(y){var H=be[y];we[H]=y});var ee=[];Object.keys(he).forEach(function(y){var H=he[y];ee[H]=y});var Te=[];Object.keys(oe).forEach(function(y){var H=oe[y];Te[H]=y});var re=[];Object.keys(se).forEach(function(y){var H=se[y];re[H]=y});var _e=X.reduce(function(y,H){var U=ae[H];return U===Kr||U===vi||U===Kr||U===$n||U===bi||U===On||d.ext_srgb&&(U===gi||U===Ei)?y[U]=U:U===yi||H.indexOf("rgba")>=0?y[U]=gr:y[U]=Tn,y},{});function te(){this.internalformat=gr,this.format=gr,this.type=Ir,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Ra,this.width=0,this.height=0,this.channels=0}function ve(y,H){y.internalformat=H.internalformat,y.format=H.format,y.type=H.type,y.compressed=H.compressed,y.premultiplyAlpha=H.premultiplyAlpha,y.flipY=H.flipY,y.unpackAlignment=H.unpackAlignment,y.colorSpace=H.colorSpace,y.width=H.width,y.height=H.height,y.channels=H.channels}function Be(y,H){if(!(typeof H!="object"||!H)){if("premultiplyAlpha"in H&&(p.type(H.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),y.premultiplyAlpha=H.premultiplyAlpha),"flipY"in H&&(p.type(H.flipY,"boolean","invalid texture flip"),y.flipY=H.flipY),"alignment"in H&&(p.oneOf(H.alignment,[1,2,4,8],"invalid texture unpack alignment"),y.unpackAlignment=H.alignment),"colorSpace"in H&&(p.parameter(H.colorSpace,me,"invalid colorSpace"),y.colorSpace=me[H.colorSpace]),"type"in H){var U=H.type;p(d.oes_texture_float||!(U==="float"||U==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),p(d.oes_texture_half_float||!(U==="half float"||U==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),p(d.webgl_depth_texture||!(U==="uint16"||U==="uint32"||U==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),p.parameter(U,be,"invalid texture type"),y.type=be[U]}var Oe=y.width,it=y.height,_=y.channels,h=!1;"shape"in H?(p(Array.isArray(H.shape)&&H.shape.length>=2,"shape must be an array"),Oe=H.shape[0],it=H.shape[1],H.shape.length===3&&(_=H.shape[2],p(_>0&&_<=4,"invalid number of channels"),h=!0),p(Oe>=0&&Oe<=E.maxTextureSize,"invalid width"),p(it>=0&&it<=E.maxTextureSize,"invalid height")):("radius"in H&&(Oe=it=H.radius,p(Oe>=0&&Oe<=E.maxTextureSize,"invalid radius")),"width"in H&&(Oe=H.width,p(Oe>=0&&Oe<=E.maxTextureSize,"invalid width")),"height"in H&&(it=H.height,p(it>=0&&it<=E.maxTextureSize,"invalid height")),"channels"in H&&(_=H.channels,p(_>0&&_<=4,"invalid number of channels"),h=!0)),y.width=Oe|0,y.height=it|0,y.channels=_|0;var $=!1;if("format"in H){var I=H.format;p(d.webgl_depth_texture||!(I==="depth"||I==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),p.parameter(I,ae,"invalid texture format");var B=y.internalformat=ae[I];y.format=_e[B],I in be&&("type"in H||(y.type=be[I])),I in pe&&(y.compressed=!0),$=!0}!h&&$?y.channels=Zt[y.format]:h&&!$?y.channels!==Ln[y.format]&&(y.format=y.internalformat=Ln[y.channels]):$&&h&&p(y.channels===Zt[y.format],"number of channels inconsistent with specified format")}}function Ye(y){l.pixelStorei(ku,y.flipY),l.pixelStorei(Lu,y.premultiplyAlpha),l.pixelStorei(Cu,y.colorSpace),l.pixelStorei(Ou,y.unpackAlignment)}function ge(){te.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function de(y,H){var U=null;if(Ri(H)?U=H:H&&(p.type(H,"object","invalid pixel data type"),Be(y,H),"x"in H&&(y.xOffset=H.x|0),"y"in H&&(y.yOffset=H.y|0),Ri(H.data)&&(U=H.data)),p(!y.compressed||U instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),H.copy){p(!U,"can not specify copy and data field for the same texture");var Oe=Q.viewportWidth,it=Q.viewportHeight;y.width=y.width||Oe-y.xOffset,y.height=y.height||it-y.yOffset,y.needsCopy=!0,p(y.xOffset>=0&&y.xOffset<Oe&&y.yOffset>=0&&y.yOffset<it&&y.width>0&&y.width<=Oe&&y.height>0&&y.height<=it,"copy texture read out of bounds")}else if(!U)y.width=y.width||1,y.height=y.height||1,y.channels=y.channels||4;else if(s(U))y.channels=y.channels||4,y.data=U,!("type"in H)&&y.type===Ir&&(y.type=za(U));else if(Da(U))y.channels=y.channels||4,Bu(y,U),y.alignment=1,y.needsFree=!0;else if(er(U)){var _=U.data;!Array.isArray(_)&&y.type===Ir&&(y.type=za(_));var h=U.shape,$=U.stride,I,B,k,O,L,v;h.length===3?(k=h[2],v=$[2]):(p(h.length===2,"invalid ndarray pixel data, must be 2 or 3D"),k=1,v=1),I=h[0],B=h[1],O=$[0],L=$[1],y.alignment=1,y.width=I,y.height=B,y.channels=k,y.format=y.internalformat=Ln[k],y.needsFree=!0,Du(y,_,O,L,v,U.offset)}else if(Ua(U)||Va(U)||Iu(U))Ua(U)||Va(U)?y.element=U:y.element=U.canvas,y.width=y.element.width,y.height=y.element.height,y.channels=4;else if(Fu(U))y.element=U,y.width=U.width,y.height=U.height,y.channels=4;else if(Nu(U))y.element=U,y.width=U.naturalWidth,y.height=U.naturalHeight,y.channels=4;else if(Mu(U))y.element=U,y.width=U.videoWidth,y.height=U.videoHeight,y.channels=4;else if(Ga(U)){var w=y.width||U[0].length,m=y.height||U.length,C=y.channels;At(U[0][0])?C=C||U[0][0].length:C=C||1;for(var G=wn.shape(U),K=1,Z=0;Z<G.length;++Z)K*=G[Z];var Y=ja(y,K);wn.flatten(U,G,"",Y),qa(y,Y),y.alignment=1,y.width=w,y.height=m,y.channels=C,y.format=y.internalformat=Ln[C],y.needsFree=!0}y.type===Qr?p(E.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):y.type===Pr&&p(E.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function J(y,H,U){var Oe=y.element,it=y.data,_=y.internalformat,h=y.format,$=y.type,I=y.width,B=y.height;Ye(y),Oe?l.texImage2D(H,U,h,h,$,Oe):y.compressed?l.compressedTexImage2D(H,U,_,I,B,0,it):y.needsCopy?(j(),l.copyTexImage2D(H,U,h,y.xOffset,y.yOffset,I,B,0)):l.texImage2D(H,U,h,I,B,0,h,$,it||null)}function qe(y,H,U,Oe,it){var _=y.element,h=y.data,$=y.internalformat,I=y.format,B=y.type,k=y.width,O=y.height;Ye(y),_?l.texSubImage2D(H,it,U,Oe,I,B,_):y.compressed?l.compressedTexSubImage2D(H,it,U,Oe,$,k,O,h):y.needsCopy?(j(),l.copyTexSubImage2D(H,it,U,Oe,y.xOffset,y.yOffset,k,O)):l.texSubImage2D(H,it,U,Oe,k,O,I,B,h)}var Je=[];function Ce(){return Je.pop()||new ge}function nt(y){y.needsFree&&kt.freeType(y.data),ge.call(y),Je.push(y)}function Ke(){te.call(this),this.genMipmaps=!1,this.mipmapHint=kn,this.mipmask=0,this.images=Array(16)}function rt(y,H,U){var Oe=y.images[0]=Ce();y.mipmask=1,Oe.width=y.width=H,Oe.height=y.height=U,Oe.channels=y.channels=4}function mt(y,H){var U=null;if(Ri(H))U=y.images[0]=Ce(),ve(U,y),de(U,H),y.mipmask=1;else if(Be(y,H),Array.isArray(H.mipmap))for(var Oe=H.mipmap,it=0;it<Oe.length;++it)U=y.images[it]=Ce(),ve(U,y),U.width>>=it,U.height>>=it,de(U,Oe[it]),y.mipmask|=1<<it;else U=y.images[0]=Ce(),ve(U,y),de(U,H),y.mipmask=1;ve(y,y.images[0]),y.compressed&&(y.internalformat===wi||y.internalformat===Si||y.internalformat===xi||y.internalformat===Ai)&&p(y.width%4===0&&y.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ct(y,H){for(var U=y.images,Oe=0;Oe<U.length;++Oe){if(!U[Oe])return;J(U[Oe],H,Oe)}}var Gt=[];function ft(){var y=Gt.pop()||new Ke;te.call(y),y.mipmask=0;for(var H=0;H<16;++H)y.images[H]=null;return y}function Ft(y){for(var H=y.images,U=0;U<H.length;++U)H[U]&&nt(H[U]),H[U]=null;Gt.push(y)}function St(){this.minFilter=ki,this.magFilter=ki,this.wrapS=Oi,this.wrapT=Oi,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=kn}function Rt(y,H){if("min"in H){var U=H.min;p.parameter(U,oe),y.minFilter=oe[U],Ru.indexOf(y.minFilter)>=0&&!("faces"in H)&&(y.genMipmaps=!0)}if("mag"in H){var Oe=H.mag;p.parameter(Oe,he),y.magFilter=he[Oe]}var it=y.wrapS,_=y.wrapT;if("wrap"in H){var h=H.wrap;typeof h=="string"?(p.parameter(h,se),it=_=se[h]):Array.isArray(h)&&(p.parameter(h[0],se),p.parameter(h[1],se),it=se[h[0]],_=se[h[1]])}else{if("wrapS"in H){var $=H.wrapS;p.parameter($,se),it=se[$]}if("wrapT"in H){var I=H.wrapT;p.parameter(I,se),_=se[I]}}if(y.wrapS=it,y.wrapT=_,"anisotropic"in H){var B=H.anisotropic;p(typeof B=="number"&&B>=1&&B<=E.maxAnisotropic,"aniso samples must be between 1 and "),y.anisotropic=H.anisotropic}if("mipmap"in H){var k=!1;switch(typeof H.mipmap){case"string":p.parameter(H.mipmap,ie,"invalid mipmap hint"),y.mipmapHint=ie[H.mipmap],y.genMipmaps=!0,k=!0;break;case"boolean":k=y.genMipmaps=H.mipmap;break;case"object":p(Array.isArray(H.mipmap),"invalid mipmap type"),y.genMipmaps=!1,k=!0;break;default:p.raise("invalid mipmap type")}k&&!("min"in H)&&(y.minFilter=Li)}}function Nt(y,H){l.texParameteri(H,wu,y.minFilter),l.texParameteri(H,Eu,y.magFilter),l.texParameteri(H,vu,y.wrapS),l.texParameteri(H,yu,y.wrapT),d.ext_texture_filter_anisotropic&&l.texParameteri(H,$u,y.anisotropic),y.genMipmaps&&(l.hint(xu,y.mipmapHint),l.generateMipmap(H))}var Mt=0,Ut={},zt=E.maxTextureUnits,Tt=Array(zt).map(function(){return null});function et(y){te.call(this),this.mipmask=0,this.internalformat=gr,this.id=Mt++,this.refCount=1,this.target=y,this.texture=l.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new St,W.profile&&(this.stats={size:0})}function jt(y){l.activeTexture(Zr),l.bindTexture(y.target,y.texture)}function vt(){var y=Tt[0];y?l.bindTexture(y.target,y.texture):l.bindTexture(ir,null)}function Ge(y){var H=y.texture;p(H,"must not double destroy texture");var U=y.unit,Oe=y.target;U>=0&&(l.activeTexture(Zr+U),l.bindTexture(Oe,null),Tt[U]=null),l.deleteTexture(H),y.texture=null,y.params=null,y.pixels=null,y.refCount=0,delete Ut[y.id],z.textureCount--}o(et.prototype,{bind:function(){var y=this;y.bindCount+=1;var H=y.unit;if(H<0){for(var U=0;U<zt;++U){var Oe=Tt[U];if(Oe){if(Oe.bindCount>0)continue;Oe.unit=-1}Tt[U]=y,H=U;break}H>=zt&&p.raise("insufficient number of texture units"),W.profile&&z.maxTextureUnits<H+1&&(z.maxTextureUnits=H+1),y.unit=H,l.activeTexture(Zr+H),l.bindTexture(y.target,y.texture)}return H},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Ge(this)}});function ot(y,H){var U=new et(ir);Ut[U.id]=U,z.textureCount++;function Oe(h,$){var I=U.texInfo;St.call(I);var B=ft();return typeof h=="number"?typeof $=="number"?rt(B,h|0,$|0):rt(B,h|0,h|0):h?(p.type(h,"object","invalid arguments to regl.texture"),Rt(I,h),mt(B,h)):rt(B,1,1),I.genMipmaps&&(B.mipmask=(B.width<<1)-1),U.mipmask=B.mipmask,ve(U,B),p.texture2D(I,B,E),U.internalformat=B.internalformat,Oe.width=B.width,Oe.height=B.height,jt(U),Ct(B,ir),Nt(I,ir),vt(),Ft(B),W.profile&&(U.stats.size=Cn(U.internalformat,U.type,B.width,B.height,I.genMipmaps,!1)),Oe.format=le[U.internalformat],Oe.type=we[U.type],Oe.mag=ee[I.magFilter],Oe.min=Te[I.minFilter],Oe.wrapS=re[I.wrapS],Oe.wrapT=re[I.wrapT],Oe}function it(h,$,I,B){p(!!h,"must specify image data");var k=$|0,O=I|0,L=B|0,v=Ce();return ve(v,U),v.width=0,v.height=0,de(v,h),v.width=v.width||(U.width>>L)-k,v.height=v.height||(U.height>>L)-O,p(U.type===v.type&&U.format===v.format&&U.internalformat===v.internalformat,"incompatible format for texture.subimage"),p(k>=0&&O>=0&&k+v.width<=U.width&&O+v.height<=U.height,"texture.subimage write out of bounds"),p(U.mipmask&1<<L,"missing mipmap data"),p(v.data||v.element||v.needsCopy,"missing image data"),jt(U),qe(v,ir,k,O,L),vt(),nt(v),Oe}function _(h,$){var I=h|0,B=$|0||I;if(I===U.width&&B===U.height)return Oe;Oe.width=U.width=I,Oe.height=U.height=B,jt(U);for(var k=0;U.mipmask>>k;++k){var O=I>>k,L=B>>k;if(!O||!L)break;l.texImage2D(ir,k,U.format,O,L,0,U.format,U.type,null)}return vt(),W.profile&&(U.stats.size=Cn(U.internalformat,U.type,I,B,!1,!1)),Oe}return Oe(y,H),Oe.subimage=it,Oe.resize=_,Oe._reglType="texture2d",Oe._texture=U,W.profile&&(Oe.stats=U.stats),Oe.destroy=function(){U.decRef()},Oe}function ht(y,H,U,Oe,it,_){var h=new et(_i);Ut[h.id]=h,z.cubeCount++;var $=new Array(6);function I(O,L,v,w,m,C){var G,K=h.texInfo;for(St.call(K),G=0;G<6;++G)$[G]=ft();if(typeof O=="number"||!O){var Z=O|0||1;for(G=0;G<6;++G)rt($[G],Z,Z)}else if(typeof O=="object")if(L)mt($[0],O),mt($[1],L),mt($[2],v),mt($[3],w),mt($[4],m),mt($[5],C);else if(Rt(K,O),Be(h,O),"faces"in O){var Y=O.faces;for(p(Array.isArray(Y)&&Y.length===6,"cube faces must be a length 6 array"),G=0;G<6;++G)p(typeof Y[G]=="object"&&!!Y[G],"invalid input for cube map face"),ve($[G],h),mt($[G],Y[G])}else for(G=0;G<6;++G)mt($[G],O);else p.raise("invalid arguments to cube map");for(ve(h,$[0]),E.npotTextureCube||p(ba(h.width)&&ba(h.height),"your browser does not support non power or two texture dimensions"),K.genMipmaps?h.mipmask=($[0].width<<1)-1:h.mipmask=$[0].mipmask,p.textureCube(h,K,$,E),h.internalformat=$[0].internalformat,I.width=$[0].width,I.height=$[0].height,jt(h),G=0;G<6;++G)Ct($[G],An+G);for(Nt(K,_i),vt(),W.profile&&(h.stats.size=Cn(h.internalformat,h.type,I.width,I.height,K.genMipmaps,!0)),I.format=le[h.internalformat],I.type=we[h.type],I.mag=ee[K.magFilter],I.min=Te[K.minFilter],I.wrapS=re[K.wrapS],I.wrapT=re[K.wrapT],G=0;G<6;++G)Ft($[G]);return I}function B(O,L,v,w,m){p(!!L,"must specify image data"),p(typeof O=="number"&&O===(O|0)&&O>=0&&O<6,"invalid face");var C=v|0,G=w|0,K=m|0,Z=Ce();return ve(Z,h),Z.width=0,Z.height=0,de(Z,L),Z.width=Z.width||(h.width>>K)-C,Z.height=Z.height||(h.height>>K)-G,p(h.type===Z.type&&h.format===Z.format&&h.internalformat===Z.internalformat,"incompatible format for texture.subimage"),p(C>=0&&G>=0&&C+Z.width<=h.width&&G+Z.height<=h.height,"texture.subimage write out of bounds"),p(h.mipmask&1<<K,"missing mipmap data"),p(Z.data||Z.element||Z.needsCopy,"missing image data"),jt(h),qe(Z,An+O,C,G,K),vt(),nt(Z),I}function k(O){var L=O|0;if(L!==h.width){I.width=h.width=L,I.height=h.height=L,jt(h);for(var v=0;v<6;++v)for(var w=0;h.mipmask>>w;++w)l.texImage2D(An+v,w,h.format,L>>w,L>>w,0,h.format,h.type,null);return vt(),W.profile&&(h.stats.size=Cn(h.internalformat,h.type,I.width,I.height,!1,!0)),I}}return I(y,H,U,Oe,it,_),I.subimage=B,I.resize=k,I._reglType="textureCube",I._texture=h,W.profile&&(I.stats=h.stats),I.destroy=function(){h.decRef()},I}function $t(){for(var y=0;y<zt;++y)l.activeTexture(Zr+y),l.bindTexture(ir,null),Tt[y]=null;Qt(Ut).forEach(Ge),z.cubeCount=0,z.textureCount=0}W.profile&&(z.getTotalTextureSize=function(){var y=0;return Object.keys(Ut).forEach(function(H){y+=Ut[H].stats.size}),y});function sr(){for(var y=0;y<zt;++y){var H=Tt[y];H&&(H.bindCount=0,H.unit=-1,Tt[y]=null)}Qt(Ut).forEach(function(U){U.texture=l.createTexture(),l.bindTexture(U.target,U.texture);for(var Oe=0;Oe<32;++Oe)if((U.mipmask&1<<Oe)!==0)if(U.target===ir)l.texImage2D(ir,Oe,U.internalformat,U.width>>Oe,U.height>>Oe,0,U.internalformat,U.type,null);else for(var it=0;it<6;++it)l.texImage2D(An+it,Oe,U.internalformat,U.width>>Oe,U.height>>Oe,0,U.internalformat,U.type,null);Nt(U.texInfo,U.target)})}function Or(){for(var y=0;y<zt;++y){var H=Tt[y];H&&(H.bindCount=0,H.unit=-1,Tt[y]=null),l.activeTexture(Zr+y),l.bindTexture(ir,null),l.bindTexture(_i,null)}}return{create2D:ot,createCube:ht,clear:$t,getTexture:function(y){return null},restore:sr,refresh:Or}}var hr=36161,Rn=32854,Ha=32855,Wa=36194,Xa=33189,Ya=36168,Ka=34041,Qa=35907,Za=34836,Ja=34842,es=34843,tr=[];tr[Rn]=2,tr[Ha]=2,tr[Wa]=2,tr[Xa]=2,tr[Ya]=1,tr[Ka]=4,tr[Qa]=4,tr[Za]=16,tr[Ja]=8,tr[es]=6;function ts(l,d,E){return tr[l]*d*E}var Uu=function(l,d,E,j,Q){var z={rgba4:Rn,rgb565:Wa,"rgb5 a1":Ha,depth:Xa,stencil:Ya,"depth stencil":Ka};d.ext_srgb&&(z.srgba=Qa),d.ext_color_buffer_half_float&&(z.rgba16f=Ja,z.rgb16f=es),d.webgl_color_buffer_float&&(z.rgba32f=Za);var W=[];Object.keys(z).forEach(function(ae){var pe=z[ae];W[pe]=ae});var ie=0,se={};function he(ae){this.id=ie++,this.refCount=1,this.renderbuffer=ae,this.format=Rn,this.width=0,this.height=0,Q.profile&&(this.stats={size:0})}he.prototype.decRef=function(){--this.refCount<=0&&oe(this)};function oe(ae){var pe=ae.renderbuffer;p(pe,"must not double destroy renderbuffer"),l.bindRenderbuffer(hr,null),l.deleteRenderbuffer(pe),ae.renderbuffer=null,ae.refCount=0,delete se[ae.id],j.renderbufferCount--}function me(ae,pe){var M=new he(l.createRenderbuffer());se[M.id]=M,j.renderbufferCount++;function X(we,ee){var Te=0,re=0,_e=Rn;if(typeof we=="object"&&we){var te=we;if("shape"in te){var ve=te.shape;p(Array.isArray(ve)&&ve.length>=2,"invalid renderbuffer shape"),Te=ve[0]|0,re=ve[1]|0}else"radius"in te&&(Te=re=te.radius|0),"width"in te&&(Te=te.width|0),"height"in te&&(re=te.height|0);"format"in te&&(p.parameter(te.format,z,"invalid renderbuffer format"),_e=z[te.format])}else typeof we=="number"?(Te=we|0,typeof ee=="number"?re=ee|0:re=Te):we?p.raise("invalid arguments to renderbuffer constructor"):Te=re=1;if(p(Te>0&&re>0&&Te<=E.maxRenderbufferSize&&re<=E.maxRenderbufferSize,"invalid renderbuffer size"),!(Te===M.width&&re===M.height&&_e===M.format))return X.width=M.width=Te,X.height=M.height=re,M.format=_e,l.bindRenderbuffer(hr,M.renderbuffer),l.renderbufferStorage(hr,_e,Te,re),p(l.getError()===0,"invalid render buffer format"),Q.profile&&(M.stats.size=ts(M.format,M.width,M.height)),X.format=W[M.format],X}function le(we,ee){var Te=we|0,re=ee|0||Te;return Te===M.width&&re===M.height||(p(Te>0&&re>0&&Te<=E.maxRenderbufferSize&&re<=E.maxRenderbufferSize,"invalid renderbuffer size"),X.width=M.width=Te,X.height=M.height=re,l.bindRenderbuffer(hr,M.renderbuffer),l.renderbufferStorage(hr,M.format,Te,re),p(l.getError()===0,"invalid render buffer format"),Q.profile&&(M.stats.size=ts(M.format,M.width,M.height))),X}return X(ae,pe),X.resize=le,X._reglType="renderbuffer",X._renderbuffer=M,Q.profile&&(X.stats=M.stats),X.destroy=function(){M.decRef()},X}Q.profile&&(j.getTotalRenderbufferSize=function(){var ae=0;return Object.keys(se).forEach(function(pe){ae+=se[pe].stats.size}),ae});function be(){Qt(se).forEach(function(ae){ae.renderbuffer=l.createRenderbuffer(),l.bindRenderbuffer(hr,ae.renderbuffer),l.renderbufferStorage(hr,ae.format,ae.width,ae.height)}),l.bindRenderbuffer(hr,null)}return{create:me,clear:function(){Qt(se).forEach(oe)},restore:be}},fr=36160,Pi=36161,wr=3553,Pn=34069,rs=36064,ns=36096,as=36128,ss=33306,os=36053,Vu=36054,zu=36055,ju=36057,qu=36061,Hu=36193,Wu=5121,Xu=5126,us=6407,fs=6408,Yu=6402,Ku=[us,fs],Ii=[];Ii[fs]=4,Ii[us]=3;var In=[];In[Wu]=1,In[Xu]=4,In[Hu]=2;var Qu=32854,Zu=32855,Ju=36194,ef=33189,tf=36168,ls=34041,rf=35907,nf=34836,af=34842,sf=34843,of=[Qu,Zu,Ju,rf,af,sf,nf],Mr={};Mr[os]="complete",Mr[Vu]="incomplete attachment",Mr[ju]="incomplete dimensions",Mr[zu]="incomplete, missing attachment",Mr[qu]="unsupported";function uf(l,d,E,j,Q,z){var W={cur:null,next:null,dirty:!1,setFBO:null},ie=["rgba"],se=["rgba4","rgb565","rgb5 a1"];d.ext_srgb&&se.push("srgba"),d.ext_color_buffer_half_float&&se.push("rgba16f","rgb16f"),d.webgl_color_buffer_float&&se.push("rgba32f");var he=["uint8"];d.oes_texture_half_float&&he.push("half float","float16"),d.oes_texture_float&&he.push("float","float32");function oe(ge,de,J){this.target=ge,this.texture=de,this.renderbuffer=J;var qe=0,Je=0;de?(qe=de.width,Je=de.height):J&&(qe=J.width,Je=J.height),this.width=qe,this.height=Je}function me(ge){ge&&(ge.texture&&ge.texture._texture.decRef(),ge.renderbuffer&&ge.renderbuffer._renderbuffer.decRef())}function be(ge,de,J){if(!!ge)if(ge.texture){var qe=ge.texture._texture,Je=Math.max(1,qe.width),Ce=Math.max(1,qe.height);p(Je===de&&Ce===J,"inconsistent width/height for supplied texture"),qe.refCount+=1}else{var nt=ge.renderbuffer._renderbuffer;p(nt.width===de&&nt.height===J,"inconsistent width/height for renderbuffer"),nt.refCount+=1}}function ae(ge,de){de&&(de.texture?l.framebufferTexture2D(fr,ge,de.target,de.texture._texture.texture,0):l.framebufferRenderbuffer(fr,ge,Pi,de.renderbuffer._renderbuffer.renderbuffer))}function pe(ge){var de=wr,J=null,qe=null,Je=ge;typeof ge=="object"&&(Je=ge.data,"target"in ge&&(de=ge.target|0)),p.type(Je,"function","invalid attachment data");var Ce=Je._reglType;return Ce==="texture2d"?(J=Je,p(de===wr)):Ce==="textureCube"?(J=Je,p(de>=Pn&&de<Pn+6,"invalid cube map target")):Ce==="renderbuffer"?(qe=Je,de=Pi):p.raise("invalid regl object for attachment"),new oe(de,J,qe)}function M(ge,de,J,qe,Je){if(J){var Ce=j.create2D({width:ge,height:de,format:qe,type:Je});return Ce._texture.refCount=0,new oe(wr,Ce,null)}else{var nt=Q.create({width:ge,height:de,format:qe});return nt._renderbuffer.refCount=0,new oe(Pi,null,nt)}}function X(ge){return ge&&(ge.texture||ge.renderbuffer)}function le(ge,de,J){ge&&(ge.texture?ge.texture.resize(de,J):ge.renderbuffer&&ge.renderbuffer.resize(de,J),ge.width=de,ge.height=J)}var we=0,ee={};function Te(){this.id=we++,ee[this.id]=this,this.framebuffer=l.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function re(ge){ge.colorAttachments.forEach(me),me(ge.depthAttachment),me(ge.stencilAttachment),me(ge.depthStencilAttachment)}function _e(ge){var de=ge.framebuffer;p(de,"must not double destroy framebuffer"),l.deleteFramebuffer(de),ge.framebuffer=null,z.framebufferCount--,delete ee[ge.id]}function te(ge){var de;l.bindFramebuffer(fr,ge.framebuffer);var J=ge.colorAttachments;for(de=0;de<J.length;++de)ae(rs+de,J[de]);for(de=J.length;de<E.maxColorAttachments;++de)l.framebufferTexture2D(fr,rs+de,wr,null,0);l.framebufferTexture2D(fr,ss,wr,null,0),l.framebufferTexture2D(fr,ns,wr,null,0),l.framebufferTexture2D(fr,as,wr,null,0),ae(ns,ge.depthAttachment),ae(as,ge.stencilAttachment),ae(ss,ge.depthStencilAttachment);var qe=l.checkFramebufferStatus(fr);!l.isContextLost()&&qe!==os&&p.raise("framebuffer configuration not supported, status = "+Mr[qe]),l.bindFramebuffer(fr,W.next?W.next.framebuffer:null),W.cur=W.next,l.getError()}function ve(ge,de){var J=new Te;z.framebufferCount++;function qe(Ce,nt){var Ke;p(W.next!==J,"can not update framebuffer which is currently in use");var rt=0,mt=0,Ct=!0,Gt=!0,ft=null,Ft=!0,St="rgba",Rt="uint8",Nt=1,Mt=null,Ut=null,zt=null,Tt=!1;if(typeof Ce=="number")rt=Ce|0,mt=nt|0||rt;else if(!Ce)rt=mt=1;else{p.type(Ce,"object","invalid arguments for framebuffer");var et=Ce;if("shape"in et){var jt=et.shape;p(Array.isArray(jt)&&jt.length>=2,"invalid shape for framebuffer"),rt=jt[0],mt=jt[1]}else"radius"in et&&(rt=mt=et.radius),"width"in et&&(rt=et.width),"height"in et&&(mt=et.height);("color"in et||"colors"in et)&&(ft=et.color||et.colors,Array.isArray(ft)&&p(ft.length===1||d.webgl_draw_buffers,"multiple render targets not supported")),ft||("colorCount"in et&&(Nt=et.colorCount|0,p(Nt>0,"invalid color buffer count")),"colorTexture"in et&&(Ft=!!et.colorTexture,St="rgba4"),"colorType"in et&&(Rt=et.colorType,Ft?(p(d.oes_texture_float||!(Rt==="float"||Rt==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),p(d.oes_texture_half_float||!(Rt==="half float"||Rt==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Rt==="half float"||Rt==="float16"?(p(d.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),St="rgba16f"):(Rt==="float"||Rt==="float32")&&(p(d.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),St="rgba32f"),p.oneOf(Rt,he,"invalid color type")),"colorFormat"in et&&(St=et.colorFormat,ie.indexOf(St)>=0?Ft=!0:se.indexOf(St)>=0?Ft=!1:Ft?p.oneOf(et.colorFormat,ie,"invalid color format for texture"):p.oneOf(et.colorFormat,se,"invalid color format for renderbuffer"))),("depthTexture"in et||"depthStencilTexture"in et)&&(Tt=!!(et.depthTexture||et.depthStencilTexture),p(!Tt||d.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in et&&(typeof et.depth=="boolean"?Ct=et.depth:(Mt=et.depth,Gt=!1)),"stencil"in et&&(typeof et.stencil=="boolean"?Gt=et.stencil:(Ut=et.stencil,Ct=!1)),"depthStencil"in et&&(typeof et.depthStencil=="boolean"?Ct=Gt=et.depthStencil:(zt=et.depthStencil,Ct=!1,Gt=!1))}var vt=null,Ge=null,ot=null,ht=null;if(Array.isArray(ft))vt=ft.map(pe);else if(ft)vt=[pe(ft)];else for(vt=new Array(Nt),Ke=0;Ke<Nt;++Ke)vt[Ke]=M(rt,mt,Ft,St,Rt);p(d.webgl_draw_buffers||vt.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),p(vt.length<=E.maxColorAttachments,"too many color attachments, not supported"),rt=rt||vt[0].width,mt=mt||vt[0].height,Mt?Ge=pe(Mt):Ct&&!Gt&&(Ge=M(rt,mt,Tt,"depth","uint32")),Ut?ot=pe(Ut):Gt&&!Ct&&(ot=M(rt,mt,!1,"stencil","uint8")),zt?ht=pe(zt):!Mt&&!Ut&&Gt&&Ct&&(ht=M(rt,mt,Tt,"depth stencil","depth stencil")),p(!!Mt+!!Ut+!!zt<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var $t=null;for(Ke=0;Ke<vt.length;++Ke)if(be(vt[Ke],rt,mt),p(!vt[Ke]||vt[Ke].texture&&Ku.indexOf(vt[Ke].texture._texture.format)>=0||vt[Ke].renderbuffer&&of.indexOf(vt[Ke].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ke+" is invalid"),vt[Ke]&&vt[Ke].texture){var sr=Ii[vt[Ke].texture._texture.format]*In[vt[Ke].texture._texture.type];$t===null?$t=sr:p($t===sr,"all color attachments much have the same number of bits per pixel.")}return be(Ge,rt,mt),p(!Ge||Ge.texture&&Ge.texture._texture.format===Yu||Ge.renderbuffer&&Ge.renderbuffer._renderbuffer.format===ef,"invalid depth attachment for framebuffer object"),be(ot,rt,mt),p(!ot||ot.renderbuffer&&ot.renderbuffer._renderbuffer.format===tf,"invalid stencil attachment for framebuffer object"),be(ht,rt,mt),p(!ht||ht.texture&&ht.texture._texture.format===ls||ht.renderbuffer&&ht.renderbuffer._renderbuffer.format===ls,"invalid depth-stencil attachment for framebuffer object"),re(J),J.width=rt,J.height=mt,J.colorAttachments=vt,J.depthAttachment=Ge,J.stencilAttachment=ot,J.depthStencilAttachment=ht,qe.color=vt.map(X),qe.depth=X(Ge),qe.stencil=X(ot),qe.depthStencil=X(ht),qe.width=J.width,qe.height=J.height,te(J),qe}function Je(Ce,nt){p(W.next!==J,"can not resize a framebuffer which is currently in use");var Ke=Math.max(Ce|0,1),rt=Math.max(nt|0||Ke,1);if(Ke===J.width&&rt===J.height)return qe;for(var mt=J.colorAttachments,Ct=0;Ct<mt.length;++Ct)le(mt[Ct],Ke,rt);return le(J.depthAttachment,Ke,rt),le(J.stencilAttachment,Ke,rt),le(J.depthStencilAttachment,Ke,rt),J.width=qe.width=Ke,J.height=qe.height=rt,te(J),qe}return qe(ge,de),o(qe,{resize:Je,_reglType:"framebuffer",_framebuffer:J,destroy:function(){_e(J),re(J)},use:function(Ce){W.setFBO({framebuffer:qe},Ce)}})}function Be(ge){var de=Array(6);function J(Je){var Ce;p(de.indexOf(W.next)<0,"can not update framebuffer which is currently in use");var nt={color:null},Ke=0,rt=null,mt="rgba",Ct="uint8",Gt=1;if(typeof Je=="number")Ke=Je|0;else if(!Je)Ke=1;else{p.type(Je,"object","invalid arguments for framebuffer");var ft=Je;if("shape"in ft){var Ft=ft.shape;p(Array.isArray(Ft)&&Ft.length>=2,"invalid shape for framebuffer"),p(Ft[0]===Ft[1],"cube framebuffer must be square"),Ke=Ft[0]}else"radius"in ft&&(Ke=ft.radius|0),"width"in ft?(Ke=ft.width|0,"height"in ft&&p(ft.height===Ke,"must be square")):"height"in ft&&(Ke=ft.height|0);("color"in ft||"colors"in ft)&&(rt=ft.color||ft.colors,Array.isArray(rt)&&p(rt.length===1||d.webgl_draw_buffers,"multiple render targets not supported")),rt||("colorCount"in ft&&(Gt=ft.colorCount|0,p(Gt>0,"invalid color buffer count")),"colorType"in ft&&(p.oneOf(ft.colorType,he,"invalid color type"),Ct=ft.colorType),"colorFormat"in ft&&(mt=ft.colorFormat,p.oneOf(ft.colorFormat,ie,"invalid color format for texture"))),"depth"in ft&&(nt.depth=ft.depth),"stencil"in ft&&(nt.stencil=ft.stencil),"depthStencil"in ft&&(nt.depthStencil=ft.depthStencil)}var St;if(rt)if(Array.isArray(rt))for(St=[],Ce=0;Ce<rt.length;++Ce)St[Ce]=rt[Ce];else St=[rt];else{St=Array(Gt);var Rt={radius:Ke,format:mt,type:Ct};for(Ce=0;Ce<Gt;++Ce)St[Ce]=j.createCube(Rt)}for(nt.color=Array(St.length),Ce=0;Ce<St.length;++Ce){var Nt=St[Ce];p(typeof Nt=="function"&&Nt._reglType==="textureCube","invalid cube map"),Ke=Ke||Nt.width,p(Nt.width===Ke&&Nt.height===Ke,"invalid cube map shape"),nt.color[Ce]={target:Pn,data:St[Ce]}}for(Ce=0;Ce<6;++Ce){for(var Mt=0;Mt<St.length;++Mt)nt.color[Mt].target=Pn+Ce;Ce>0&&(nt.depth=de[0].depth,nt.stencil=de[0].stencil,nt.depthStencil=de[0].depthStencil),de[Ce]?de[Ce](nt):de[Ce]=ve(nt)}return o(J,{width:Ke,height:Ke,color:St})}function qe(Je){var Ce,nt=Je|0;if(p(nt>0&&nt<=E.maxCubeMapSize,"invalid radius for cube fbo"),nt===J.width)return J;var Ke=J.color;for(Ce=0;Ce<Ke.length;++Ce)Ke[Ce].resize(nt);for(Ce=0;Ce<6;++Ce)de[Ce].resize(nt);return J.width=J.height=nt,J}return J(ge),o(J,{faces:de,resize:qe,_reglType:"framebufferCube",destroy:function(){de.forEach(function(Je){Je.destroy()})}})}function Ye(){W.cur=null,W.next=null,W.dirty=!0,Qt(ee).forEach(function(ge){ge.framebuffer=l.createFramebuffer(),te(ge)})}return o(W,{getFramebuffer:function(ge){if(typeof ge=="function"&&ge._reglType==="framebuffer"){var de=ge._framebuffer;if(de instanceof Te)return de}return null},create:ve,createCube:Be,clear:function(){Qt(ee).forEach(_e)},restore:Ye})}var ff=5126,cs=34962;function Fi(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=ff,this.offset=0,this.stride=0,this.divisor=0}function lf(l,d,E,j,Q){for(var z=E.maxAttributes,W=new Array(z),ie=0;ie<z;++ie)W[ie]=new Fi;var se=0,he={},oe={Record:Fi,scope:{},state:W,currentVAO:null,targetVAO:null,restore:be()?ee:function(){},createVAO:Te,getVAO:pe,destroyBuffer:me,setVAO:be()?M:X,clear:be()?le:function(){}};function me(re){for(var _e=0;_e<W.length;++_e){var te=W[_e];te.buffer===re&&(l.disableVertexAttribArray(_e),te.buffer=null)}}function be(){return d.oes_vertex_array_object}function ae(){return d.angle_instanced_arrays}function pe(re){return typeof re=="function"&&re._vao?re._vao:null}function M(re){if(re!==oe.currentVAO){var _e=be();re?_e.bindVertexArrayOES(re.vao):_e.bindVertexArrayOES(null),oe.currentVAO=re}}function X(re){if(re!==oe.currentVAO){if(re)re.bindAttrs();else for(var _e=ae(),te=0;te<W.length;++te){var ve=W[te];ve.buffer?(l.enableVertexAttribArray(te),l.vertexAttribPointer(te,ve.size,ve.type,ve.normalized,ve.stride,ve.offfset),_e&&ve.divisor&&_e.vertexAttribDivisorANGLE(te,ve.divisor)):(l.disableVertexAttribArray(te),l.vertexAttrib4f(te,ve.x,ve.y,ve.z,ve.w))}oe.currentVAO=re}}function le(){Qt(he).forEach(function(re){re.destroy()})}function we(){this.id=++se,this.attributes=[];var re=be();re?this.vao=re.createVertexArrayOES():this.vao=null,he[this.id]=this,this.buffers=[]}we.prototype.bindAttrs=function(){for(var re=ae(),_e=this.attributes,te=0;te<_e.length;++te){var ve=_e[te];ve.buffer?(l.enableVertexAttribArray(te),l.bindBuffer(cs,ve.buffer.buffer),l.vertexAttribPointer(te,ve.size,ve.type,ve.normalized,ve.stride,ve.offset),re&&ve.divisor&&re.vertexAttribDivisorANGLE(te,ve.divisor)):(l.disableVertexAttribArray(te),l.vertexAttrib4f(te,ve.x,ve.y,ve.z,ve.w))}for(var Be=_e.length;Be<z;++Be)l.disableVertexAttribArray(Be)},we.prototype.refresh=function(){var re=be();re&&(re.bindVertexArrayOES(this.vao),this.bindAttrs(),oe.currentVAO=this)},we.prototype.destroy=function(){if(this.vao){var re=be();this===oe.currentVAO&&(oe.currentVAO=null,re.bindVertexArrayOES(null)),re.deleteVertexArrayOES(this.vao),this.vao=null}he[this.id]&&(delete he[this.id],j.vaoCount-=1)};function ee(){var re=be();re&&Qt(he).forEach(function(_e){_e.refresh()})}function Te(re){var _e=new we;j.vaoCount+=1;function te(ve){p(Array.isArray(ve),"arguments to vertex array constructor must be an array"),p(ve.length<z,"too many attributes"),p(ve.length>0,"must specify at least one attribute");var Be={},Ye=_e.attributes;Ye.length=ve.length;for(var ge=0;ge<ve.length;++ge){var de=ve[ge],J=Ye[ge]=new Fi,qe=de.data||de;if(Array.isArray(qe)||s(qe)||er(qe)){var Je;_e.buffers[ge]&&(Je=_e.buffers[ge],s(qe)&&Je._buffer.byteLength>=qe.byteLength?Je.subdata(qe):(Je.destroy(),_e.buffers[ge]=null)),_e.buffers[ge]||(Je=_e.buffers[ge]=Q.create(de,cs,!1,!0)),J.buffer=Q.getBuffer(Je),J.size=J.buffer.dimension|0,J.normalized=!1,J.type=J.buffer.dtype,J.offset=0,J.stride=0,J.divisor=0,J.state=1,Be[ge]=1}else Q.getBuffer(de)?(J.buffer=Q.getBuffer(de),J.size=J.buffer.dimension|0,J.normalized=!1,J.type=J.buffer.dtype,J.offset=0,J.stride=0,J.divisor=0,J.state=1):Q.getBuffer(de.buffer)?(J.buffer=Q.getBuffer(de.buffer),J.size=(+de.size||J.buffer.dimension)|0,J.normalized=!!de.normalized||!1,"type"in de?(p.parameter(de.type,yr,"invalid buffer type"),J.type=yr[de.type]):J.type=J.buffer.dtype,J.offset=(de.offset||0)|0,J.stride=(de.stride||0)|0,J.divisor=(de.divisor||0)|0,J.state=1,p(J.size>=1&&J.size<=4,"size must be between 1 and 4"),p(J.offset>=0,"invalid offset"),p(J.stride>=0&&J.stride<=255,"stride must be between 0 and 255"),p(J.divisor>=0,"divisor must be positive"),p(!J.divisor||!!d.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in de?(p(ge>0,"first attribute must not be a constant"),J.x=+de.x||0,J.y=+de.y||0,J.z=+de.z||0,J.w=+de.w||0,J.state=2):p(!1,"invalid attribute spec for location "+ge)}for(var Ce=0;Ce<_e.buffers.length;++Ce)!Be[Ce]&&_e.buffers[Ce]&&(_e.buffers[Ce].destroy(),_e.buffers[Ce]=null);return _e.refresh(),te}return te.destroy=function(){for(var ve=0;ve<_e.buffers.length;++ve)_e.buffers[ve]&&_e.buffers[ve].destroy();_e.buffers.length=0,_e.destroy()},te._vao=_e,te._reglType="vao",te(re)}return oe}var hs=35632,cf=35633,hf=35718,df=35721;function mf(l,d,E,j){var Q={},z={};function W(M,X,le,we){this.name=M,this.id=X,this.location=le,this.info=we}function ie(M,X){for(var le=0;le<M.length;++le)if(M[le].id===X.id){M[le].location=X.location;return}M.push(X)}function se(M,X,le){var we=M===hs?Q:z,ee=we[X];if(!ee){var Te=d.str(X);ee=l.createShader(M),l.shaderSource(ee,Te),l.compileShader(ee),p.shaderError(l,ee,Te,M,le),we[X]=ee}return ee}var he={},oe=[],me=0;function be(M,X){this.id=me++,this.fragId=M,this.vertId=X,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,j.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function ae(M,X,le){var we,ee,Te=se(hs,M.fragId),re=se(cf,M.vertId),_e=M.program=l.createProgram();if(l.attachShader(_e,Te),l.attachShader(_e,re),le)for(we=0;we<le.length;++we){var te=le[we];l.bindAttribLocation(_e,te[0],te[1])}l.linkProgram(_e),p.linkError(l,_e,d.str(M.fragId),d.str(M.vertId),X);var ve=l.getProgramParameter(_e,hf);j.profile&&(M.stats.uniformsCount=ve);var Be=M.uniforms;for(we=0;we<ve;++we)if(ee=l.getActiveUniform(_e,we),ee)if(ee.size>1)for(var Ye=0;Ye<ee.size;++Ye){var ge=ee.name.replace("[0]","["+Ye+"]");ie(Be,new W(ge,d.id(ge),l.getUniformLocation(_e,ge),ee))}else ie(Be,new W(ee.name,d.id(ee.name),l.getUniformLocation(_e,ee.name),ee));var de=l.getProgramParameter(_e,df);j.profile&&(M.stats.attributesCount=de);var J=M.attributes;for(we=0;we<de;++we)ee=l.getActiveAttrib(_e,we),ee&&ie(J,new W(ee.name,d.id(ee.name),l.getAttribLocation(_e,ee.name),ee))}j.profile&&(E.getMaxUniformsCount=function(){var M=0;return oe.forEach(function(X){X.stats.uniformsCount>M&&(M=X.stats.uniformsCount)}),M},E.getMaxAttributesCount=function(){var M=0;return oe.forEach(function(X){X.stats.attributesCount>M&&(M=X.stats.attributesCount)}),M});function pe(){Q={},z={};for(var M=0;M<oe.length;++M)ae(oe[M],null,oe[M].attributes.map(function(X){return[X.location,X.name]}))}return{clear:function(){var M=l.deleteShader.bind(l);Qt(Q).forEach(M),Q={},Qt(z).forEach(M),z={},oe.forEach(function(X){l.deleteProgram(X.program)}),oe.length=0,he={},E.shaderCount=0},program:function(M,X,le,we){p.command(M>=0,"missing vertex shader",le),p.command(X>=0,"missing fragment shader",le);var ee=he[X];ee||(ee=he[X]={});var Te=ee[M];if(Te&&(Te.refCount++,!we))return Te;var re=new be(X,M);return E.shaderCount++,ae(re,le,we),Te||(ee[M]=re),oe.push(re),o(re,{destroy:function(){if(re.refCount--,re.refCount<=0){l.deleteProgram(re.program);var _e=oe.indexOf(re);oe.splice(_e,1),E.shaderCount--}ee[re.vertId].refCount<=0&&(l.deleteShader(z[re.vertId]),delete z[re.vertId],delete he[re.fragId][re.vertId]),Object.keys(he[re.fragId]).length||(l.deleteShader(Q[re.fragId]),delete Q[re.fragId],delete he[re.fragId])}})},restore:pe,shader:se,frag:-1,vert:-1}}var pf=6408,Jr=5121,_f=3333,Fn=5126;function vf(l,d,E,j,Q,z,W){function ie(oe){var me;d.next===null?(p(Q.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),me=Jr):(p(d.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),me=d.next.colorAttachments[0].texture._texture.type,z.oes_texture_float?(p(me===Jr||me===Fn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),me===Fn&&p(W.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):p(me===Jr,"Reading from a framebuffer is only allowed for the type 'uint8'"));var be=0,ae=0,pe=j.framebufferWidth,M=j.framebufferHeight,X=null;s(oe)?X=oe:oe&&(p.type(oe,"object","invalid arguments to regl.read()"),be=oe.x|0,ae=oe.y|0,p(be>=0&&be<j.framebufferWidth,"invalid x offset for regl.read"),p(ae>=0&&ae<j.framebufferHeight,"invalid y offset for regl.read"),pe=(oe.width||j.framebufferWidth-be)|0,M=(oe.height||j.framebufferHeight-ae)|0,X=oe.data||null),X&&(me===Jr?p(X instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):me===Fn&&p(X instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),p(pe>0&&pe+be<=j.framebufferWidth,"invalid width for read pixels"),p(M>0&&M+ae<=j.framebufferHeight,"invalid height for read pixels"),E();var le=pe*M*4;return X||(me===Jr?X=new Uint8Array(le):me===Fn&&(X=X||new Float32Array(le))),p.isTypedArray(X,"data buffer for regl.read() must be a typedarray"),p(X.byteLength>=le,"data buffer for regl.read() too small"),l.pixelStorei(_f,4),l.readPixels(be,ae,pe,M,pf,me,X),X}function se(oe){var me;return d.setFBO({framebuffer:oe.framebuffer},function(){me=ie(oe)}),me}function he(oe){return!oe||!("framebuffer"in oe)?ie(oe):se(oe)}return he}function Br(l){return Array.prototype.slice.call(l)}function Dr(l){return Br(l).join("")}function yf(){var l=0,d=[],E=[];function j(me){for(var be=0;be<E.length;++be)if(E[be]===me)return d[be];var ae="g"+l++;return d.push(ae),E.push(me),ae}function Q(){var me=[];function be(){me.push.apply(me,Br(arguments))}var ae=[];function pe(){var M="v"+l++;return ae.push(M),arguments.length>0&&(me.push(M,"="),me.push.apply(me,Br(arguments)),me.push(";")),M}return o(be,{def:pe,toString:function(){return Dr([ae.length>0?"var "+ae.join(",")+";":"",Dr(me)])}})}function z(){var me=Q(),be=Q(),ae=me.toString,pe=be.toString;function M(X,le){be(X,le,"=",me.def(X,le),";")}return o(function(){me.apply(me,Br(arguments))},{def:me.def,entry:me,exit:be,save:M,set:function(X,le,we){M(X,le),me(X,le,"=",we,";")},toString:function(){return ae()+pe()}})}function W(){var me=Dr(arguments),be=z(),ae=z(),pe=be.toString,M=ae.toString;return o(be,{then:function(){return be.apply(be,Br(arguments)),this},else:function(){return ae.apply(ae,Br(arguments)),this},toString:function(){var X=M();return X&&(X="else{"+X+"}"),Dr(["if(",me,"){",pe(),"}",X])}})}var ie=Q(),se={};function he(me,be){var ae=[];function pe(){var ee="a"+ae.length;return ae.push(ee),ee}be=be||0;for(var M=0;M<be;++M)pe();var X=z(),le=X.toString,we=se[me]=o(X,{arg:pe,toString:function(){return Dr(["function(",ae.join(),"){",le(),"}"])}});return we}function oe(){var me=['"use strict";',ie,"return {"];Object.keys(se).forEach(function(pe){me.push('"',pe,'":',se[pe].toString(),",")}),me.push("}");var be=Dr(me).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),ae=Function.apply(null,d.concat(be));return ae.apply(null,E)}return{global:ie,link:j,block:Q,proc:he,scope:z,cond:W,compile:oe}}var Gr="xyzw".split(""),ds=5121,Ur=1,Ni=2,Mi=0,Bi=1,Di=2,Gi=3,Nn=4,ms=5,ps=6,_s="dither",vs="blend.enable",ys="blend.color",Ui="blend.equation",Vi="blend.func",bs="depth.enable",gs="depth.func",Es="depth.range",ws="depth.mask",zi="colorMask",Ss="cull.enable",xs="cull.face",ji="frontFace",qi="lineWidth",As="polygonOffset.enable",Hi="polygonOffset.offset",Ts="sample.alpha",$s="sample.enable",Wi="sample.coverage",Os="stencil.enable",ks="stencil.mask",Xi="stencil.func",Yi="stencil.opFront",en="stencil.opBack",Ls="scissor.enable",Mn="scissor.box",lr="viewport",tn="profile",Sr="framebuffer",rn="vert",nn="frag",xr="elements",Ar="primitive",Tr="count",Bn="offset",Dn="instances",an="vao",Ki="Width",Qi="Height",Vr=Sr+Ki,zr=Sr+Qi,bf=lr+Ki,gf=lr+Qi,Cs="drawingBuffer",Rs=Cs+Ki,Ps=Cs+Qi,Ef=[Vi,Ui,Xi,Yi,en,Wi,lr,Mn,Hi],jr=34962,wf=34963,Sf=35632,xf=35633,Is=3553,Af=34067,Tf=2884,$f=3042,Of=3024,kf=2960,Lf=2929,Cf=3089,Rf=32823,Pf=32926,If=32928,Zi=5126,Gn=35664,Un=35665,Vn=35666,Ji=5124,zn=35667,jn=35668,qn=35669,ea=35670,Hn=35671,Wn=35672,Xn=35673,sn=35674,on=35675,un=35676,fn=35678,ln=35680,Fs=4,cn=1028,$r=1029,Ns=2304,ta=2305,Ff=32775,Nf=32776,Mf=519,dr=7680,Ms=0,Bs=1,Ds=32774,Bf=513,Gs=36160,Df=36064,ar={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Us=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],qr={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},mr={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Vs={frag:Sf,vert:xf},ra={cw:Ns,ccw:ta};function Yn(l){return Array.isArray(l)||s(l)||er(l)}function zs(l){return l.sort(function(d,E){return d===lr?-1:E===lr?1:d<E?-1:1})}function Wt(l,d,E,j){this.thisDep=l,this.contextDep=d,this.propDep=E,this.append=j}function pr(l){return l&&!(l.thisDep||l.contextDep||l.propDep)}function Lt(l){return new Wt(!1,!1,!1,l)}function Yt(l,d){var E=l.type;if(E===Mi){var j=l.data.length;return new Wt(!0,j>=1,j>=2,d)}else if(E===Nn){var Q=l.data;return new Wt(Q.thisDep,Q.contextDep,Q.propDep,d)}else{if(E===ms)return new Wt(!1,!1,!1,d);if(E===ps){for(var z=!1,W=!1,ie=!1,se=0;se<l.data.length;++se){var he=l.data[se];if(he.type===Bi)ie=!0;else if(he.type===Di)W=!0;else if(he.type===Gi)z=!0;else if(he.type===Mi){z=!0;var oe=he.data;oe>=1&&(W=!0),oe>=2&&(ie=!0)}else he.type===Nn&&(z=z||he.data.thisDep,W=W||he.data.contextDep,ie=ie||he.data.propDep)}return new Wt(z,W,ie,d)}else return new Wt(E===Gi,E===Di,E===Bi,d)}}var js=new Wt(!1,!1,!1,function(){});function Gf(l,d,E,j,Q,z,W,ie,se,he,oe,me,be,ae,pe){var M=he.Record,X={add:32774,subtract:32778,"reverse subtract":32779};E.ext_blend_minmax&&(X.min=Ff,X.max=Nf);var le=E.angle_instanced_arrays,we=E.webgl_draw_buffers,ee={dirty:!0,profile:pe.profile},Te={},re=[],_e={},te={};function ve(_){return _.replace(".","_")}function Be(_,h,$){var I=ve(_);re.push(_),Te[I]=ee[I]=!!$,_e[I]=h}function Ye(_,h,$){var I=ve(_);re.push(_),Array.isArray($)?(ee[I]=$.slice(),Te[I]=$.slice()):ee[I]=Te[I]=$,te[I]=h}Be(_s,Of),Be(vs,$f),Ye(ys,"blendColor",[0,0,0,0]),Ye(Ui,"blendEquationSeparate",[Ds,Ds]),Ye(Vi,"blendFuncSeparate",[Bs,Ms,Bs,Ms]),Be(bs,Lf,!0),Ye(gs,"depthFunc",Bf),Ye(Es,"depthRange",[0,1]),Ye(ws,"depthMask",!0),Ye(zi,zi,[!0,!0,!0,!0]),Be(Ss,Tf),Ye(xs,"cullFace",$r),Ye(ji,ji,ta),Ye(qi,qi,1),Be(As,Rf),Ye(Hi,"polygonOffset",[0,0]),Be(Ts,Pf),Be($s,If),Ye(Wi,"sampleCoverage",[1,!1]),Be(Os,kf),Ye(ks,"stencilMask",-1),Ye(Xi,"stencilFunc",[Mf,0,-1]),Ye(Yi,"stencilOpSeparate",[cn,dr,dr,dr]),Ye(en,"stencilOpSeparate",[$r,dr,dr,dr]),Be(Ls,Cf),Ye(Mn,"scissor",[0,0,l.drawingBufferWidth,l.drawingBufferHeight]),Ye(lr,lr,[0,0,l.drawingBufferWidth,l.drawingBufferHeight]);var ge={gl:l,context:be,strings:d,next:Te,current:ee,draw:me,elements:z,buffer:Q,shader:oe,attributes:he.state,vao:he,uniforms:se,framebuffer:ie,extensions:E,timer:ae,isBufferArgs:Yn},de={primTypes:Lr,compareFuncs:qr,blendFuncs:ar,blendEquations:X,stencilOps:mr,glTypes:yr,orientationType:ra};p.optional(function(){ge.isArrayLike=At}),we&&(de.backBuffer=[$r],de.drawBuffer=Ot(j.maxDrawbuffers,function(_){return _===0?[0]:Ot(_,function(h){return Df+h})}));var J=0;function qe(){var _=yf(),h=_.link,$=_.global;_.id=J++,_.batchId="0";var I=h(ge),B=_.shared={props:"a0"};Object.keys(ge).forEach(function(w){B[w]=$.def(I,".",w)}),p.optional(function(){_.CHECK=h(p),_.commandStr=p.guessCommand(),_.command=h(_.commandStr),_.assert=function(w,m,C){w("if(!(",m,"))",this.CHECK,".commandRaise(",h(C),",",this.command,");")},de.invalidBlendCombinations=Us});var k=_.next={},O=_.current={};Object.keys(te).forEach(function(w){Array.isArray(ee[w])&&(k[w]=$.def(B.next,".",w),O[w]=$.def(B.current,".",w))});var L=_.constants={};Object.keys(de).forEach(function(w){L[w]=$.def(JSON.stringify(de[w]))}),_.invoke=function(w,m){switch(m.type){case Mi:var C=["this",B.context,B.props,_.batchId];return w.def(h(m.data),".call(",C.slice(0,Math.max(m.data.length+1,4)),")");case Bi:return w.def(B.props,m.data);case Di:return w.def(B.context,m.data);case Gi:return w.def("this",m.data);case Nn:return m.data.append(_,w),m.data.ref;case ms:return m.data.toString();case ps:return m.data.map(function(G){return _.invoke(w,G)})}},_.attribCache={};var v={};return _.scopeAttrib=function(w){var m=d.id(w);if(m in v)return v[m];var C=he.scope[m];C||(C=he.scope[m]=new M);var G=v[m]=h(C);return G},_}function Je(_){var h=_.static,$=_.dynamic,I;if(tn in h){var B=!!h[tn];I=Lt(function(O,L){return B}),I.enable=B}else if(tn in $){var k=$[tn];I=Yt(k,function(O,L){return O.invoke(L,k)})}return I}function Ce(_,h){var $=_.static,I=_.dynamic;if(Sr in $){var B=$[Sr];return B?(B=ie.getFramebuffer(B),p.command(B,"invalid framebuffer object"),Lt(function(O,L){var v=O.link(B),w=O.shared;L.set(w.framebuffer,".next",v);var m=w.context;return L.set(m,"."+Vr,v+".width"),L.set(m,"."+zr,v+".height"),v})):Lt(function(O,L){var v=O.shared;L.set(v.framebuffer,".next","null");var w=v.context;return L.set(w,"."+Vr,w+"."+Rs),L.set(w,"."+zr,w+"."+Ps),"null"})}else if(Sr in I){var k=I[Sr];return Yt(k,function(O,L){var v=O.invoke(L,k),w=O.shared,m=w.framebuffer,C=L.def(m,".getFramebuffer(",v,")");p.optional(function(){O.assert(L,"!"+v+"||"+C,"invalid framebuffer object")}),L.set(m,".next",C);var G=w.context;return L.set(G,"."+Vr,C+"?"+C+".width:"+G+"."+Rs),L.set(G,"."+zr,C+"?"+C+".height:"+G+"."+Ps),C})}else return null}function nt(_,h,$){var I=_.static,B=_.dynamic;function k(v){if(v in I){var w=I[v];p.commandType(w,"object","invalid "+v,$.commandStr);var m=!0,C=w.x|0,G=w.y|0,K,Z;return"width"in w?(K=w.width|0,p.command(K>=0,"invalid "+v,$.commandStr)):m=!1,"height"in w?(Z=w.height|0,p.command(Z>=0,"invalid "+v,$.commandStr)):m=!1,new Wt(!m&&h&&h.thisDep,!m&&h&&h.contextDep,!m&&h&&h.propDep,function(Fe,tt){var Re=Fe.shared.context,Ve=K;"width"in w||(Ve=tt.def(Re,".",Vr,"-",C));var Ze=Z;return"height"in w||(Ze=tt.def(Re,".",zr,"-",G)),[C,G,Ve,Ze]})}else if(v in B){var Y=B[v],fe=Yt(Y,function(Fe,tt){var Re=Fe.invoke(tt,Y);p.optional(function(){Fe.assert(tt,Re+"&&typeof "+Re+'==="object"',"invalid "+v)});var Ve=Fe.shared.context,Ze=tt.def(Re,".x|0"),pt=tt.def(Re,".y|0"),xt=tt.def('"width" in ',Re,"?",Re,".width|0:","(",Ve,".",Vr,"-",Ze,")"),Xt=tt.def('"height" in ',Re,"?",Re,".height|0:","(",Ve,".",zr,"-",pt,")");return p.optional(function(){Fe.assert(tt,xt+">=0&&"+Xt+">=0","invalid "+v)}),[Ze,pt,xt,Xt]});return h&&(fe.thisDep=fe.thisDep||h.thisDep,fe.contextDep=fe.contextDep||h.contextDep,fe.propDep=fe.propDep||h.propDep),fe}else return h?new Wt(h.thisDep,h.contextDep,h.propDep,function(Fe,tt){var Re=Fe.shared.context;return[0,0,tt.def(Re,".",Vr),tt.def(Re,".",zr)]}):null}var O=k(lr);if(O){var L=O;O=new Wt(O.thisDep,O.contextDep,O.propDep,function(v,w){var m=L.append(v,w),C=v.shared.context;return w.set(C,"."+bf,m[2]),w.set(C,"."+gf,m[3]),m})}return{viewport:O,scissor_box:k(Mn)}}function Ke(_,h){var $=_.static,I=typeof $[nn]=="string"&&typeof $[rn]=="string";if(I){if(Object.keys(h.dynamic).length>0)return null;var B=h.static,k=Object.keys(B);if(k.length>0&&typeof B[k[0]]=="number"){for(var O=[],L=0;L<k.length;++L)p(typeof B[k[L]]=="number","must specify all vertex attribute locations when using vaos"),O.push([B[k[L]]|0,k[L]]);return O}}return null}function rt(_,h,$){var I=_.static,B=_.dynamic;function k(m){if(m in I){var C=d.id(I[m]);p.optional(function(){oe.shader(Vs[m],C,p.guessCommand())});var G=Lt(function(){return C});return G.id=C,G}else if(m in B){var K=B[m];return Yt(K,function(Z,Y){var fe=Z.invoke(Y,K),Fe=Y.def(Z.shared.strings,".id(",fe,")");return p.optional(function(){Y(Z.shared.shader,".shader(",Vs[m],",",Fe,",",Z.command,");")}),Fe})}return null}var O=k(nn),L=k(rn),v=null,w;return pr(O)&&pr(L)?(v=oe.program(L.id,O.id,null,$),w=Lt(function(m,C){return m.link(v)})):w=new Wt(O&&O.thisDep||L&&L.thisDep,O&&O.contextDep||L&&L.contextDep,O&&O.propDep||L&&L.propDep,function(m,C){var G=m.shared.shader,K;O?K=O.append(m,C):K=C.def(G,".",nn);var Z;L?Z=L.append(m,C):Z=C.def(G,".",rn);var Y=G+".program("+Z+","+K;return p.optional(function(){Y+=","+m.command}),C.def(Y+")")}),{frag:O,vert:L,progVar:w,program:v}}function mt(_,h){var $=_.static,I=_.dynamic;function B(){if(xr in $){var m=$[xr];Yn(m)?m=z.getElements(z.create(m,!0)):m&&(m=z.getElements(m),p.command(m,"invalid elements",h.commandStr));var C=Lt(function(K,Z){if(m){var Y=K.link(m);return K.ELEMENTS=Y,Y}return K.ELEMENTS=null,null});return C.value=m,C}else if(xr in I){var G=I[xr];return Yt(G,function(K,Z){var Y=K.shared,fe=Y.isBufferArgs,Fe=Y.elements,tt=K.invoke(Z,G),Re=Z.def("null"),Ve=Z.def(fe,"(",tt,")"),Ze=K.cond(Ve).then(Re,"=",Fe,".createStream(",tt,");").else(Re,"=",Fe,".getElements(",tt,");");return p.optional(function(){K.assert(Ze.else,"!"+tt+"||"+Re,"invalid elements")}),Z.entry(Ze),Z.exit(K.cond(Ve).then(Fe,".destroyStream(",Re,");")),K.ELEMENTS=Re,Re})}return null}var k=B();function O(){if(Ar in $){var m=$[Ar];return p.commandParameter(m,Lr,"invalid primitve",h.commandStr),Lt(function(G,K){return Lr[m]})}else if(Ar in I){var C=I[Ar];return Yt(C,function(G,K){var Z=G.constants.primTypes,Y=G.invoke(K,C);return p.optional(function(){G.assert(K,Y+" in "+Z,"invalid primitive, must be one of "+Object.keys(Lr))}),K.def(Z,"[",Y,"]")})}else if(k)return pr(k)?k.value?Lt(function(G,K){return K.def(G.ELEMENTS,".primType")}):Lt(function(){return Fs}):new Wt(k.thisDep,k.contextDep,k.propDep,function(G,K){var Z=G.ELEMENTS;return K.def(Z,"?",Z,".primType:",Fs)});return null}function L(m,C){if(m in $){var G=$[m]|0;return p.command(!C||G>=0,"invalid "+m,h.commandStr),Lt(function(Z,Y){return C&&(Z.OFFSET=G),G})}else if(m in I){var K=I[m];return Yt(K,function(Z,Y){var fe=Z.invoke(Y,K);return C&&(Z.OFFSET=fe,p.optional(function(){Z.assert(Y,fe+">=0","invalid "+m)})),fe})}else if(C&&k)return Lt(function(Z,Y){return Z.OFFSET="0",0});return null}var v=L(Bn,!0);function w(){if(Tr in $){var m=$[Tr]|0;return p.command(typeof m=="number"&&m>=0,"invalid vertex count",h.commandStr),Lt(function(){return m})}else if(Tr in I){var C=I[Tr];return Yt(C,function(Z,Y){var fe=Z.invoke(Y,C);return p.optional(function(){Z.assert(Y,"typeof "+fe+'==="number"&&'+fe+">=0&&"+fe+"===("+fe+"|0)","invalid vertex count")}),fe})}else if(k)if(pr(k)){if(k)return v?new Wt(v.thisDep,v.contextDep,v.propDep,function(Z,Y){var fe=Y.def(Z.ELEMENTS,".vertCount-",Z.OFFSET);return p.optional(function(){Z.assert(Y,fe+">=0","invalid vertex offset/element buffer too small")}),fe}):Lt(function(Z,Y){return Y.def(Z.ELEMENTS,".vertCount")});var G=Lt(function(){return-1});return p.optional(function(){G.MISSING=!0}),G}else{var K=new Wt(k.thisDep||v.thisDep,k.contextDep||v.contextDep,k.propDep||v.propDep,function(Z,Y){var fe=Z.ELEMENTS;return Z.OFFSET?Y.def(fe,"?",fe,".vertCount-",Z.OFFSET,":-1"):Y.def(fe,"?",fe,".vertCount:-1")});return p.optional(function(){K.DYNAMIC=!0}),K}return null}return{elements:k,primitive:O(),count:w(),instances:L(Dn,!1),offset:v}}function Ct(_,h){var $=_.static,I=_.dynamic,B={};return re.forEach(function(k){var O=ve(k);function L(v,w){if(k in $){var m=v($[k]);B[O]=Lt(function(){return m})}else if(k in I){var C=I[k];B[O]=Yt(C,function(G,K){return w(G,K,G.invoke(K,C))})}}switch(k){case Ss:case vs:case _s:case Os:case bs:case Ls:case As:case Ts:case $s:case ws:return L(function(v){return p.commandType(v,"boolean",k,h.commandStr),v},function(v,w,m){return p.optional(function(){v.assert(w,"typeof "+m+'==="boolean"',"invalid flag "+k,v.commandStr)}),m});case gs:return L(function(v){return p.commandParameter(v,qr,"invalid "+k,h.commandStr),qr[v]},function(v,w,m){var C=v.constants.compareFuncs;return p.optional(function(){v.assert(w,m+" in "+C,"invalid "+k+", must be one of "+Object.keys(qr))}),w.def(C,"[",m,"]")});case Es:return L(function(v){return p.command(At(v)&&v.length===2&&typeof v[0]=="number"&&typeof v[1]=="number"&&v[0]<=v[1],"depth range is 2d array",h.commandStr),v},function(v,w,m){p.optional(function(){v.assert(w,v.shared.isArrayLike+"("+m+")&&"+m+".length===2&&typeof "+m+'[0]==="number"&&typeof '+m+'[1]==="number"&&'+m+"[0]<="+m+"[1]","depth range must be a 2d array")});var C=w.def("+",m,"[0]"),G=w.def("+",m,"[1]");return[C,G]});case Vi:return L(function(v){p.commandType(v,"object","blend.func",h.commandStr);var w="srcRGB"in v?v.srcRGB:v.src,m="srcAlpha"in v?v.srcAlpha:v.src,C="dstRGB"in v?v.dstRGB:v.dst,G="dstAlpha"in v?v.dstAlpha:v.dst;return p.commandParameter(w,ar,O+".srcRGB",h.commandStr),p.commandParameter(m,ar,O+".srcAlpha",h.commandStr),p.commandParameter(C,ar,O+".dstRGB",h.commandStr),p.commandParameter(G,ar,O+".dstAlpha",h.commandStr),p.command(Us.indexOf(w+", "+C)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+w+", "+C+")",h.commandStr),[ar[w],ar[C],ar[m],ar[G]]},function(v,w,m){var C=v.constants.blendFuncs;p.optional(function(){v.assert(w,m+"&&typeof "+m+'==="object"',"invalid blend func, must be an object")});function G(Re,Ve){var Ze=w.def('"',Re,Ve,'" in ',m,"?",m,".",Re,Ve,":",m,".",Re);return p.optional(function(){v.assert(w,Ze+" in "+C,"invalid "+k+"."+Re+Ve+", must be one of "+Object.keys(ar))}),Ze}var K=G("src","RGB"),Z=G("dst","RGB");p.optional(function(){var Re=v.constants.invalidBlendCombinations;v.assert(w,Re+".indexOf("+K+'+", "+'+Z+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Y=w.def(C,"[",K,"]"),fe=w.def(C,"[",G("src","Alpha"),"]"),Fe=w.def(C,"[",Z,"]"),tt=w.def(C,"[",G("dst","Alpha"),"]");return[Y,Fe,fe,tt]});case Ui:return L(function(v){if(typeof v=="string")return p.commandParameter(v,X,"invalid "+k,h.commandStr),[X[v],X[v]];if(typeof v=="object")return p.commandParameter(v.rgb,X,k+".rgb",h.commandStr),p.commandParameter(v.alpha,X,k+".alpha",h.commandStr),[X[v.rgb],X[v.alpha]];p.commandRaise("invalid blend.equation",h.commandStr)},function(v,w,m){var C=v.constants.blendEquations,G=w.def(),K=w.def(),Z=v.cond("typeof ",m,'==="string"');return p.optional(function(){function Y(fe,Fe,tt){v.assert(fe,tt+" in "+C,"invalid "+Fe+", must be one of "+Object.keys(X))}Y(Z.then,k,m),v.assert(Z.else,m+"&&typeof "+m+'==="object"',"invalid "+k),Y(Z.else,k+".rgb",m+".rgb"),Y(Z.else,k+".alpha",m+".alpha")}),Z.then(G,"=",K,"=",C,"[",m,"];"),Z.else(G,"=",C,"[",m,".rgb];",K,"=",C,"[",m,".alpha];"),w(Z),[G,K]});case ys:return L(function(v){return p.command(At(v)&&v.length===4,"blend.color must be a 4d array",h.commandStr),Ot(4,function(w){return+v[w]})},function(v,w,m){return p.optional(function(){v.assert(w,v.shared.isArrayLike+"("+m+")&&"+m+".length===4","blend.color must be a 4d array")}),Ot(4,function(C){return w.def("+",m,"[",C,"]")})});case ks:return L(function(v){return p.commandType(v,"number",O,h.commandStr),v|0},function(v,w,m){return p.optional(function(){v.assert(w,"typeof "+m+'==="number"',"invalid stencil.mask")}),w.def(m,"|0")});case Xi:return L(function(v){p.commandType(v,"object",O,h.commandStr);var w=v.cmp||"keep",m=v.ref||0,C="mask"in v?v.mask:-1;return p.commandParameter(w,qr,k+".cmp",h.commandStr),p.commandType(m,"number",k+".ref",h.commandStr),p.commandType(C,"number",k+".mask",h.commandStr),[qr[w],m,C]},function(v,w,m){var C=v.constants.compareFuncs;p.optional(function(){function Y(){v.assert(w,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Y(m+"&&typeof ",m,'==="object"'),Y('!("cmp" in ',m,")||(",m,".cmp in ",C,")")});var G=w.def('"cmp" in ',m,"?",C,"[",m,".cmp]",":",dr),K=w.def(m,".ref|0"),Z=w.def('"mask" in ',m,"?",m,".mask|0:-1");return[G,K,Z]});case Yi:case en:return L(function(v){p.commandType(v,"object",O,h.commandStr);var w=v.fail||"keep",m=v.zfail||"keep",C=v.zpass||"keep";return p.commandParameter(w,mr,k+".fail",h.commandStr),p.commandParameter(m,mr,k+".zfail",h.commandStr),p.commandParameter(C,mr,k+".zpass",h.commandStr),[k===en?$r:cn,mr[w],mr[m],mr[C]]},function(v,w,m){var C=v.constants.stencilOps;p.optional(function(){v.assert(w,m+"&&typeof "+m+'==="object"',"invalid "+k)});function G(K){return p.optional(function(){v.assert(w,'!("'+K+'" in '+m+")||("+m+"."+K+" in "+C+")","invalid "+k+"."+K+", must be one of "+Object.keys(mr))}),w.def('"',K,'" in ',m,"?",C,"[",m,".",K,"]:",dr)}return[k===en?$r:cn,G("fail"),G("zfail"),G("zpass")]});case Hi:return L(function(v){p.commandType(v,"object",O,h.commandStr);var w=v.factor|0,m=v.units|0;return p.commandType(w,"number",O+".factor",h.commandStr),p.commandType(m,"number",O+".units",h.commandStr),[w,m]},function(v,w,m){p.optional(function(){v.assert(w,m+"&&typeof "+m+'==="object"',"invalid "+k)});var C=w.def(m,".factor|0"),G=w.def(m,".units|0");return[C,G]});case xs:return L(function(v){var w=0;return v==="front"?w=cn:v==="back"&&(w=$r),p.command(!!w,O,h.commandStr),w},function(v,w,m){return p.optional(function(){v.assert(w,m+'==="front"||'+m+'==="back"',"invalid cull.face")}),w.def(m,'==="front"?',cn,":",$r)});case qi:return L(function(v){return p.command(typeof v=="number"&&v>=j.lineWidthDims[0]&&v<=j.lineWidthDims[1],"invalid line width, must be a positive number between "+j.lineWidthDims[0]+" and "+j.lineWidthDims[1],h.commandStr),v},function(v,w,m){return p.optional(function(){v.assert(w,"typeof "+m+'==="number"&&'+m+">="+j.lineWidthDims[0]+"&&"+m+"<="+j.lineWidthDims[1],"invalid line width")}),m});case ji:return L(function(v){return p.commandParameter(v,ra,O,h.commandStr),ra[v]},function(v,w,m){return p.optional(function(){v.assert(w,m+'==="cw"||'+m+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),w.def(m+'==="cw"?'+Ns+":"+ta)});case zi:return L(function(v){return p.command(At(v)&&v.length===4,"color.mask must be length 4 array",h.commandStr),v.map(function(w){return!!w})},function(v,w,m){return p.optional(function(){v.assert(w,v.shared.isArrayLike+"("+m+")&&"+m+".length===4","invalid color.mask")}),Ot(4,function(C){return"!!"+m+"["+C+"]"})});case Wi:return L(function(v){p.command(typeof v=="object"&&v,O,h.commandStr);var w="value"in v?v.value:1,m=!!v.invert;return p.command(typeof w=="number"&&w>=0&&w<=1,"sample.coverage.value must be a number between 0 and 1",h.commandStr),[w,m]},function(v,w,m){p.optional(function(){v.assert(w,m+"&&typeof "+m+'==="object"',"invalid sample.coverage")});var C=w.def('"value" in ',m,"?+",m,".value:1"),G=w.def("!!",m,".invert");return[C,G]})}}),B}function Gt(_,h){var $=_.static,I=_.dynamic,B={};return Object.keys($).forEach(function(k){var O=$[k],L;if(typeof O=="number"||typeof O=="boolean")L=Lt(function(){return O});else if(typeof O=="function"){var v=O._reglType;v==="texture2d"||v==="textureCube"?L=Lt(function(w){return w.link(O)}):v==="framebuffer"||v==="framebufferCube"?(p.command(O.color.length>0,'missing color attachment for framebuffer sent to uniform "'+k+'"',h.commandStr),L=Lt(function(w){return w.link(O.color[0])})):p.commandRaise('invalid data for uniform "'+k+'"',h.commandStr)}else At(O)?L=Lt(function(w){var m=w.global.def("[",Ot(O.length,function(C){return p.command(typeof O[C]=="number"||typeof O[C]=="boolean","invalid uniform "+k,w.commandStr),O[C]}),"]");return m}):p.commandRaise('invalid or missing data for uniform "'+k+'"',h.commandStr);L.value=O,B[k]=L}),Object.keys(I).forEach(function(k){var O=I[k];B[k]=Yt(O,function(L,v){return L.invoke(v,O)})}),B}function ft(_,h){var $=_.static,I=_.dynamic,B={};return Object.keys($).forEach(function(k){var O=$[k],L=d.id(k),v=new M;if(Yn(O))v.state=Ur,v.buffer=Q.getBuffer(Q.create(O,jr,!1,!0)),v.type=0;else{var w=Q.getBuffer(O);if(w)v.state=Ur,v.buffer=w,v.type=0;else if(p.command(typeof O=="object"&&O,"invalid data for attribute "+k,h.commandStr),"constant"in O){var m=O.constant;v.buffer="null",v.state=Ni,typeof m=="number"?v.x=m:(p.command(At(m)&&m.length>0&&m.length<=4,"invalid constant for attribute "+k,h.commandStr),Gr.forEach(function(Fe,tt){tt<m.length&&(v[Fe]=m[tt])}))}else{Yn(O.buffer)?w=Q.getBuffer(Q.create(O.buffer,jr,!1,!0)):w=Q.getBuffer(O.buffer),p.command(!!w,'missing buffer for attribute "'+k+'"',h.commandStr);var C=O.offset|0;p.command(C>=0,'invalid offset for attribute "'+k+'"',h.commandStr);var G=O.stride|0;p.command(G>=0&&G<256,'invalid stride for attribute "'+k+'", must be integer betweeen [0, 255]',h.commandStr);var K=O.size|0;p.command(!("size"in O)||K>0&&K<=4,'invalid size for attribute "'+k+'", must be 1,2,3,4',h.commandStr);var Z=!!O.normalized,Y=0;"type"in O&&(p.commandParameter(O.type,yr,"invalid type for attribute "+k,h.commandStr),Y=yr[O.type]);var fe=O.divisor|0;"divisor"in O&&(p.command(fe===0||le,'cannot specify divisor for attribute "'+k+'", instancing not supported',h.commandStr),p.command(fe>=0,'invalid divisor for attribute "'+k+'"',h.commandStr)),p.optional(function(){var Fe=h.commandStr,tt=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(O).forEach(function(Re){p.command(tt.indexOf(Re)>=0,'unknown parameter "'+Re+'" for attribute pointer "'+k+'" (valid parameters are '+tt+")",Fe)})}),v.buffer=w,v.state=Ur,v.size=K,v.normalized=Z,v.type=Y||w.dtype,v.offset=C,v.stride=G,v.divisor=fe}}B[k]=Lt(function(Fe,tt){var Re=Fe.attribCache;if(L in Re)return Re[L];var Ve={isStream:!1};return Object.keys(v).forEach(function(Ze){Ve[Ze]=v[Ze]}),v.buffer&&(Ve.buffer=Fe.link(v.buffer),Ve.type=Ve.type||Ve.buffer+".dtype"),Re[L]=Ve,Ve})}),Object.keys(I).forEach(function(k){var O=I[k];function L(v,w){var m=v.invoke(w,O),C=v.shared,G=v.constants,K=C.isBufferArgs,Z=C.buffer;p.optional(function(){v.assert(w,m+"&&(typeof "+m+'==="object"||typeof '+m+'==="function")&&('+K+"("+m+")||"+Z+".getBuffer("+m+")||"+Z+".getBuffer("+m+".buffer)||"+K+"("+m+'.buffer)||("constant" in '+m+"&&(typeof "+m+'.constant==="number"||'+C.isArrayLike+"("+m+".constant))))",'invalid dynamic attribute "'+k+'"')});var Y={isStream:w.def(!1)},fe=new M;fe.state=Ur,Object.keys(fe).forEach(function(Ve){Y[Ve]=w.def(""+fe[Ve])});var Fe=Y.buffer,tt=Y.type;w("if(",K,"(",m,")){",Y.isStream,"=true;",Fe,"=",Z,".createStream(",jr,",",m,");",tt,"=",Fe,".dtype;","}else{",Fe,"=",Z,".getBuffer(",m,");","if(",Fe,"){",tt,"=",Fe,".dtype;",'}else if("constant" in ',m,"){",Y.state,"=",Ni,";","if(typeof "+m+'.constant === "number"){',Y[Gr[0]],"=",m,".constant;",Gr.slice(1).map(function(Ve){return Y[Ve]}).join("="),"=0;","}else{",Gr.map(function(Ve,Ze){return Y[Ve]+"="+m+".constant.length>"+Ze+"?"+m+".constant["+Ze+"]:0;"}).join(""),"}}else{","if(",K,"(",m,".buffer)){",Fe,"=",Z,".createStream(",jr,",",m,".buffer);","}else{",Fe,"=",Z,".getBuffer(",m,".buffer);","}",tt,'="type" in ',m,"?",G.glTypes,"[",m,".type]:",Fe,".dtype;",Y.normalized,"=!!",m,".normalized;");function Re(Ve){w(Y[Ve],"=",m,".",Ve,"|0;")}return Re("size"),Re("offset"),Re("stride"),Re("divisor"),w("}}"),w.exit("if(",Y.isStream,"){",Z,".destroyStream(",Fe,");","}"),Y}B[k]=Yt(O,L)}),B}function Ft(_,h){var $=_.static,I=_.dynamic;if(an in $){var B=$[an];return B!==null&&he.getVAO(B)===null&&(B=he.createVAO(B)),Lt(function(O){return O.link(he.getVAO(B))})}else if(an in I){var k=I[an];return Yt(k,function(O,L){var v=O.invoke(L,k);return L.def(O.shared.vao+".getVAO("+v+")")})}return null}function St(_){var h=_.static,$=_.dynamic,I={};return Object.keys(h).forEach(function(B){var k=h[B];I[B]=Lt(function(O,L){return typeof k=="number"||typeof k=="boolean"?""+k:O.link(k)})}),Object.keys($).forEach(function(B){var k=$[B];I[B]=Yt(k,function(O,L){return O.invoke(L,k)})}),I}function Rt(_,h,$,I,B){var k=_.static,O=_.dynamic;p.optional(function(){var Re=[Sr,rn,nn,xr,Ar,Bn,Tr,Dn,tn,an].concat(re);function Ve(Ze){Object.keys(Ze).forEach(function(pt){p.command(Re.indexOf(pt)>=0,'unknown parameter "'+pt+'"',B.commandStr)})}Ve(k),Ve(O)});var L=Ke(_,h),v=Ce(_),w=nt(_,v,B),m=mt(_,B),C=Ct(_,B),G=rt(_,B,L);function K(Re){var Ve=w[Re];Ve&&(C[Re]=Ve)}K(lr),K(ve(Mn));var Z=Object.keys(C).length>0,Y={framebuffer:v,draw:m,shader:G,state:C,dirty:Z,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Y.profile=Je(_),Y.uniforms=Gt($,B),Y.drawVAO=Y.scopeVAO=Ft(_),!Y.drawVAO&&G.program&&!L&&E.angle_instanced_arrays){var fe=!0,Fe=G.program.attributes.map(function(Re){var Ve=h.static[Re];return fe=fe&&!!Ve,Ve});if(fe&&Fe.length>0){var tt=he.getVAO(he.createVAO(Fe));Y.drawVAO=new Wt(null,null,null,function(Re,Ve){return Re.link(tt)}),Y.useVAO=!0}}return L?Y.useVAO=!0:Y.attributes=ft(h,B),Y.context=St(I),Y}function Nt(_,h,$){var I=_.shared,B=I.context,k=_.scope();Object.keys($).forEach(function(O){h.save(B,"."+O);var L=$[O],v=L.append(_,h);Array.isArray(v)?k(B,".",O,"=[",v.join(),"];"):k(B,".",O,"=",v,";")}),h(k)}function Mt(_,h,$,I){var B=_.shared,k=B.gl,O=B.framebuffer,L;we&&(L=h.def(B.extensions,".webgl_draw_buffers"));var v=_.constants,w=v.drawBuffer,m=v.backBuffer,C;$?C=$.append(_,h):C=h.def(O,".next"),I||h("if(",C,"!==",O,".cur){"),h("if(",C,"){",k,".bindFramebuffer(",Gs,",",C,".framebuffer);"),we&&h(L,".drawBuffersWEBGL(",w,"[",C,".colorAttachments.length]);"),h("}else{",k,".bindFramebuffer(",Gs,",null);"),we&&h(L,".drawBuffersWEBGL(",m,");"),h("}",O,".cur=",C,";"),I||h("}")}function Ut(_,h,$){var I=_.shared,B=I.gl,k=_.current,O=_.next,L=I.current,v=I.next,w=_.cond(L,".dirty");re.forEach(function(m){var C=ve(m);if(!(C in $.state)){var G,K;if(C in O){G=O[C],K=k[C];var Z=Ot(ee[C].length,function(fe){return w.def(G,"[",fe,"]")});w(_.cond(Z.map(function(fe,Fe){return fe+"!=="+K+"["+Fe+"]"}).join("||")).then(B,".",te[C],"(",Z,");",Z.map(function(fe,Fe){return K+"["+Fe+"]="+fe}).join(";"),";"))}else{G=w.def(v,".",C);var Y=_.cond(G,"!==",L,".",C);w(Y),C in _e?Y(_.cond(G).then(B,".enable(",_e[C],");").else(B,".disable(",_e[C],");"),L,".",C,"=",G,";"):Y(B,".",te[C],"(",G,");",L,".",C,"=",G,";")}}}),Object.keys($.state).length===0&&w(L,".dirty=false;"),h(w)}function zt(_,h,$,I){var B=_.shared,k=_.current,O=B.current,L=B.gl;zs(Object.keys($)).forEach(function(v){var w=$[v];if(!(I&&!I(w))){var m=w.append(_,h);if(_e[v]){var C=_e[v];pr(w)?m?h(L,".enable(",C,");"):h(L,".disable(",C,");"):h(_.cond(m).then(L,".enable(",C,");").else(L,".disable(",C,");")),h(O,".",v,"=",m,";")}else if(At(m)){var G=k[v];h(L,".",te[v],"(",m,");",m.map(function(K,Z){return G+"["+Z+"]="+K}).join(";"),";")}else h(L,".",te[v],"(",m,");",O,".",v,"=",m,";")}})}function Tt(_,h){le&&(_.instancing=h.def(_.shared.extensions,".angle_instanced_arrays"))}function et(_,h,$,I,B){var k=_.shared,O=_.stats,L=k.current,v=k.timer,w=$.profile;function m(){return typeof performance>"u"?"Date.now()":"performance.now()"}var C,G;function K(Re){C=h.def(),Re(C,"=",m(),";"),typeof B=="string"?Re(O,".count+=",B,";"):Re(O,".count++;"),ae&&(I?(G=h.def(),Re(G,"=",v,".getNumPendingQueries();")):Re(v,".beginQuery(",O,");"))}function Z(Re){Re(O,".cpuTime+=",m(),"-",C,";"),ae&&(I?Re(v,".pushScopeStats(",G,",",v,".getNumPendingQueries(),",O,");"):Re(v,".endQuery();"))}function Y(Re){var Ve=h.def(L,".profile");h(L,".profile=",Re,";"),h.exit(L,".profile=",Ve,";")}var fe;if(w){if(pr(w)){w.enable?(K(h),Z(h.exit),Y("true")):Y("false");return}fe=w.append(_,h),Y(fe)}else fe=h.def(L,".profile");var Fe=_.block();K(Fe),h("if(",fe,"){",Fe,"}");var tt=_.block();Z(tt),h.exit("if(",fe,"){",tt,"}")}function jt(_,h,$,I,B){var k=_.shared;function O(v){switch(v){case Gn:case zn:case Hn:return 2;case Un:case jn:case Wn:return 3;case Vn:case qn:case Xn:return 4;default:return 1}}function L(v,w,m){var C=k.gl,G=h.def(v,".location"),K=h.def(k.attributes,"[",G,"]"),Z=m.state,Y=m.buffer,fe=[m.x,m.y,m.z,m.w],Fe=["buffer","normalized","offset","stride"];function tt(){h("if(!",K,".buffer){",C,".enableVertexAttribArray(",G,");}");var Ve=m.type,Ze;if(m.size?Ze=h.def(m.size,"||",w):Ze=w,h("if(",K,".type!==",Ve,"||",K,".size!==",Ze,"||",Fe.map(function(xt){return K+"."+xt+"!=="+m[xt]}).join("||"),"){",C,".bindBuffer(",jr,",",Y,".buffer);",C,".vertexAttribPointer(",[G,Ze,Ve,m.normalized,m.stride,m.offset],");",K,".type=",Ve,";",K,".size=",Ze,";",Fe.map(function(xt){return K+"."+xt+"="+m[xt]+";"}).join(""),"}"),le){var pt=m.divisor;h("if(",K,".divisor!==",pt,"){",_.instancing,".vertexAttribDivisorANGLE(",[G,pt],");",K,".divisor=",pt,";}")}}function Re(){h("if(",K,".buffer){",C,".disableVertexAttribArray(",G,");",K,".buffer=null;","}if(",Gr.map(function(Ve,Ze){return K+"."+Ve+"!=="+fe[Ze]}).join("||"),"){",C,".vertexAttrib4f(",G,",",fe,");",Gr.map(function(Ve,Ze){return K+"."+Ve+"="+fe[Ze]+";"}).join(""),"}")}Z===Ur?tt():Z===Ni?Re():(h("if(",Z,"===",Ur,"){"),tt(),h("}else{"),Re(),h("}"))}I.forEach(function(v){var w=v.name,m=$.attributes[w],C;if(m){if(!B(m))return;C=m.append(_,h)}else{if(!B(js))return;var G=_.scopeAttrib(w);p.optional(function(){_.assert(h,G+".state","missing attribute "+w)}),C={},Object.keys(new M).forEach(function(K){C[K]=h.def(G,".",K)})}L(_.link(v),O(v.info.type),C)})}function vt(_,h,$,I,B){for(var k=_.shared,O=k.gl,L,v=0;v<I.length;++v){var w=I[v],m=w.name,C=w.info.type,G=$.uniforms[m],K=_.link(w),Z=K+".location",Y;if(G){if(!B(G))continue;if(pr(G)){var fe=G.value;if(p.command(fe!==null&&typeof fe<"u",'missing uniform "'+m+'"',_.commandStr),C===fn||C===ln){p.command(typeof fe=="function"&&(C===fn&&(fe._reglType==="texture2d"||fe._reglType==="framebuffer")||C===ln&&(fe._reglType==="textureCube"||fe._reglType==="framebufferCube")),"invalid texture for uniform "+m,_.commandStr);var Fe=_.link(fe._texture||fe.color[0]._texture);h(O,".uniform1i(",Z,",",Fe+".bind());"),h.exit(Fe,".unbind();")}else if(C===sn||C===on||C===un){p.optional(function(){p.command(At(fe),"invalid matrix for uniform "+m,_.commandStr),p.command(C===sn&&fe.length===4||C===on&&fe.length===9||C===un&&fe.length===16,"invalid length for matrix uniform "+m,_.commandStr)});var tt=_.global.def("new Float32Array(["+Array.prototype.slice.call(fe)+"])"),Re=2;C===on?Re=3:C===un&&(Re=4),h(O,".uniformMatrix",Re,"fv(",Z,",false,",tt,");")}else{switch(C){case Zi:p.commandType(fe,"number","uniform "+m,_.commandStr),L="1f";break;case Gn:p.command(At(fe)&&fe.length===2,"uniform "+m,_.commandStr),L="2f";break;case Un:p.command(At(fe)&&fe.length===3,"uniform "+m,_.commandStr),L="3f";break;case Vn:p.command(At(fe)&&fe.length===4,"uniform "+m,_.commandStr),L="4f";break;case ea:p.commandType(fe,"boolean","uniform "+m,_.commandStr),L="1i";break;case Ji:p.commandType(fe,"number","uniform "+m,_.commandStr),L="1i";break;case Hn:p.command(At(fe)&&fe.length===2,"uniform "+m,_.commandStr),L="2i";break;case zn:p.command(At(fe)&&fe.length===2,"uniform "+m,_.commandStr),L="2i";break;case Wn:p.command(At(fe)&&fe.length===3,"uniform "+m,_.commandStr),L="3i";break;case jn:p.command(At(fe)&&fe.length===3,"uniform "+m,_.commandStr),L="3i";break;case Xn:p.command(At(fe)&&fe.length===4,"uniform "+m,_.commandStr),L="4i";break;case qn:p.command(At(fe)&&fe.length===4,"uniform "+m,_.commandStr),L="4i";break}h(O,".uniform",L,"(",Z,",",At(fe)?Array.prototype.slice.call(fe):fe,");")}continue}else Y=G.append(_,h)}else{if(!B(js))continue;Y=h.def(k.uniforms,"[",d.id(m),"]")}C===fn?(p(!Array.isArray(Y),"must specify a scalar prop for textures"),h("if(",Y,"&&",Y,'._reglType==="framebuffer"){',Y,"=",Y,".color[0];","}")):C===ln&&(p(!Array.isArray(Y),"must specify a scalar prop for cube maps"),h("if(",Y,"&&",Y,'._reglType==="framebufferCube"){',Y,"=",Y,".color[0];","}")),p.optional(function(){function Xt(rr,Qs){_.assert(h,rr,'bad data or missing for uniform "'+m+'".  '+Qs)}function na(rr){p(!Array.isArray(Y),"must not specify an array type for uniform"),Xt("typeof "+Y+'==="'+rr+'"',"invalid type, expected "+rr)}function Jt(rr,Qs){Array.isArray(Y)?p(Y.length===rr,"must have length "+rr):Xt(k.isArrayLike+"("+Y+")&&"+Y+".length==="+rr,"invalid vector, should have length "+rr,_.commandStr)}function Ks(rr){p(!Array.isArray(Y),"must not specify a value type"),Xt("typeof "+Y+'==="function"&&'+Y+'._reglType==="texture'+(rr===Is?"2d":"Cube")+'"',"invalid texture type",_.commandStr)}switch(C){case Ji:na("number");break;case zn:Jt(2);break;case jn:Jt(3);break;case qn:Jt(4);break;case Zi:na("number");break;case Gn:Jt(2);break;case Un:Jt(3);break;case Vn:Jt(4);break;case ea:na("boolean");break;case Hn:Jt(2);break;case Wn:Jt(3);break;case Xn:Jt(4);break;case sn:Jt(4);break;case on:Jt(9);break;case un:Jt(16);break;case fn:Ks(Is);break;case ln:Ks(Af);break}});var Ve=1;switch(C){case fn:case ln:var Ze=h.def(Y,"._texture");h(O,".uniform1i(",Z,",",Ze,".bind());"),h.exit(Ze,".unbind();");continue;case Ji:case ea:L="1i";break;case zn:case Hn:L="2i",Ve=2;break;case jn:case Wn:L="3i",Ve=3;break;case qn:case Xn:L="4i",Ve=4;break;case Zi:L="1f";break;case Gn:L="2f",Ve=2;break;case Un:L="3f",Ve=3;break;case Vn:L="4f",Ve=4;break;case sn:L="Matrix2fv";break;case on:L="Matrix3fv";break;case un:L="Matrix4fv";break}if(h(O,".uniform",L,"(",Z,","),L.charAt(0)==="M"){var pt=Math.pow(C-sn+2,2),xt=_.global.def("new Float32Array(",pt,")");Array.isArray(Y)?h("false,(",Ot(pt,function(Xt){return xt+"["+Xt+"]="+Y[Xt]}),",",xt,")"):h("false,(Array.isArray(",Y,")||",Y," instanceof Float32Array)?",Y,":(",Ot(pt,function(Xt){return xt+"["+Xt+"]="+Y+"["+Xt+"]"}),",",xt,")")}else Ve>1?h(Ot(Ve,function(Xt){return Array.isArray(Y)?Y[Xt]:Y+"["+Xt+"]"})):(p(!Array.isArray(Y),"uniform value must not be an array"),h(Y));h(");")}}function Ge(_,h,$,I){var B=_.shared,k=B.gl,O=B.draw,L=I.draw;function v(){var Ze=L.elements,pt,xt=h;return Ze?((Ze.contextDep&&I.contextDynamic||Ze.propDep)&&(xt=$),pt=Ze.append(_,xt)):pt=xt.def(O,".",xr),pt&&xt("if("+pt+")"+k+".bindBuffer("+wf+","+pt+".buffer.buffer);"),pt}function w(){var Ze=L.count,pt,xt=h;return Ze?((Ze.contextDep&&I.contextDynamic||Ze.propDep)&&(xt=$),pt=Ze.append(_,xt),p.optional(function(){Ze.MISSING&&_.assert(h,"false","missing vertex count"),Ze.DYNAMIC&&_.assert(xt,pt+">=0","missing vertex count")})):(pt=xt.def(O,".",Tr),p.optional(function(){_.assert(xt,pt+">=0","missing vertex count")})),pt}var m=v();function C(Ze){var pt=L[Ze];return pt?pt.contextDep&&I.contextDynamic||pt.propDep?pt.append(_,$):pt.append(_,h):h.def(O,".",Ze)}var G=C(Ar),K=C(Bn),Z=w();if(typeof Z=="number"){if(Z===0)return}else $("if(",Z,"){"),$.exit("}");var Y,fe;le&&(Y=C(Dn),fe=_.instancing);var Fe=m+".type",tt=L.elements&&pr(L.elements);function Re(){function Ze(){$(fe,".drawElementsInstancedANGLE(",[G,Z,Fe,K+"<<(("+Fe+"-"+ds+")>>1)",Y],");")}function pt(){$(fe,".drawArraysInstancedANGLE(",[G,K,Z,Y],");")}m?tt?Ze():($("if(",m,"){"),Ze(),$("}else{"),pt(),$("}")):pt()}function Ve(){function Ze(){$(k+".drawElements("+[G,Z,Fe,K+"<<(("+Fe+"-"+ds+")>>1)"]+");")}function pt(){$(k+".drawArrays("+[G,K,Z]+");")}m?tt?Ze():($("if(",m,"){"),Ze(),$("}else{"),pt(),$("}")):pt()}le&&(typeof Y!="number"||Y>=0)?typeof Y=="string"?($("if(",Y,">0){"),Re(),$("}else if(",Y,"<0){"),Ve(),$("}")):Re():Ve()}function ot(_,h,$,I,B){var k=qe(),O=k.proc("body",B);return p.optional(function(){k.commandStr=h.commandStr,k.command=k.link(h.commandStr)}),le&&(k.instancing=O.def(k.shared.extensions,".angle_instanced_arrays")),_(k,O,$,I),k.compile().body}function ht(_,h,$,I){Tt(_,h),$.useVAO?$.drawVAO?h(_.shared.vao,".setVAO(",$.drawVAO.append(_,h),");"):h(_.shared.vao,".setVAO(",_.shared.vao,".targetVAO);"):(h(_.shared.vao,".setVAO(null);"),jt(_,h,$,I.attributes,function(){return!0})),vt(_,h,$,I.uniforms,function(){return!0}),Ge(_,h,h,$)}function $t(_,h){var $=_.proc("draw",1);Tt(_,$),Nt(_,$,h.context),Mt(_,$,h.framebuffer),Ut(_,$,h),zt(_,$,h.state),et(_,$,h,!1,!0);var I=h.shader.progVar.append(_,$);if($(_.shared.gl,".useProgram(",I,".program);"),h.shader.program)ht(_,$,h,h.shader.program);else{$(_.shared.vao,".setVAO(null);");var B=_.global.def("{}"),k=$.def(I,".id"),O=$.def(B,"[",k,"]");$(_.cond(O).then(O,".call(this,a0);").else(O,"=",B,"[",k,"]=",_.link(function(L){return ot(ht,_,h,L,1)}),"(",I,");",O,".call(this,a0);"))}Object.keys(h.state).length>0&&$(_.shared.current,".dirty=true;")}function sr(_,h,$,I){_.batchId="a1",Tt(_,h);function B(){return!0}jt(_,h,$,I.attributes,B),vt(_,h,$,I.uniforms,B),Ge(_,h,h,$)}function Or(_,h,$,I){Tt(_,h);var B=$.contextDep,k=h.def(),O="a0",L="a1",v=h.def();_.shared.props=v,_.batchId=k;var w=_.scope(),m=_.scope();h(w.entry,"for(",k,"=0;",k,"<",L,";++",k,"){",v,"=",O,"[",k,"];",m,"}",w.exit);function C(Fe){return Fe.contextDep&&B||Fe.propDep}function G(Fe){return!C(Fe)}if($.needsContext&&Nt(_,m,$.context),$.needsFramebuffer&&Mt(_,m,$.framebuffer),zt(_,m,$.state,C),$.profile&&C($.profile)&&et(_,m,$,!1,!0),I)$.useVAO?$.drawVAO?C($.drawVAO)?m(_.shared.vao,".setVAO(",$.drawVAO.append(_,m),");"):w(_.shared.vao,".setVAO(",$.drawVAO.append(_,w),");"):w(_.shared.vao,".setVAO(",_.shared.vao,".targetVAO);"):(w(_.shared.vao,".setVAO(null);"),jt(_,w,$,I.attributes,G),jt(_,m,$,I.attributes,C)),vt(_,w,$,I.uniforms,G),vt(_,m,$,I.uniforms,C),Ge(_,w,m,$);else{var K=_.global.def("{}"),Z=$.shader.progVar.append(_,m),Y=m.def(Z,".id"),fe=m.def(K,"[",Y,"]");m(_.shared.gl,".useProgram(",Z,".program);","if(!",fe,"){",fe,"=",K,"[",Y,"]=",_.link(function(Fe){return ot(sr,_,$,Fe,2)}),"(",Z,");}",fe,".call(this,a0[",k,"],",k,");")}}function y(_,h){var $=_.proc("batch",2);_.batchId="0",Tt(_,$);var I=!1,B=!0;Object.keys(h.context).forEach(function(K){I=I||h.context[K].propDep}),I||(Nt(_,$,h.context),B=!1);var k=h.framebuffer,O=!1;k?(k.propDep?I=O=!0:k.contextDep&&I&&(O=!0),O||Mt(_,$,k)):Mt(_,$,null),h.state.viewport&&h.state.viewport.propDep&&(I=!0);function L(K){return K.contextDep&&I||K.propDep}Ut(_,$,h),zt(_,$,h.state,function(K){return!L(K)}),(!h.profile||!L(h.profile))&&et(_,$,h,!1,"a1"),h.contextDep=I,h.needsContext=B,h.needsFramebuffer=O;var v=h.shader.progVar;if(v.contextDep&&I||v.propDep)Or(_,$,h,null);else{var w=v.append(_,$);if($(_.shared.gl,".useProgram(",w,".program);"),h.shader.program)Or(_,$,h,h.shader.program);else{$(_.shared.vao,".setVAO(null);");var m=_.global.def("{}"),C=$.def(w,".id"),G=$.def(m,"[",C,"]");$(_.cond(G).then(G,".call(this,a0,a1);").else(G,"=",m,"[",C,"]=",_.link(function(K){return ot(Or,_,h,K,2)}),"(",w,");",G,".call(this,a0,a1);"))}}Object.keys(h.state).length>0&&$(_.shared.current,".dirty=true;")}function H(_,h){var $=_.proc("scope",3);_.batchId="a2";var I=_.shared,B=I.current;Nt(_,$,h.context),h.framebuffer&&h.framebuffer.append(_,$),zs(Object.keys(h.state)).forEach(function(O){var L=h.state[O],v=L.append(_,$);At(v)?v.forEach(function(w,m){$.set(_.next[O],"["+m+"]",w)}):$.set(I.next,"."+O,v)}),et(_,$,h,!0,!0),[xr,Bn,Tr,Dn,Ar].forEach(function(O){var L=h.draw[O];!L||$.set(I.draw,"."+O,""+L.append(_,$))}),Object.keys(h.uniforms).forEach(function(O){var L=h.uniforms[O].append(_,$);Array.isArray(L)&&(L="["+L.join()+"]"),$.set(I.uniforms,"["+d.id(O)+"]",L)}),Object.keys(h.attributes).forEach(function(O){var L=h.attributes[O].append(_,$),v=_.scopeAttrib(O);Object.keys(new M).forEach(function(w){$.set(v,"."+w,L[w])})}),h.scopeVAO&&$.set(I.vao,".targetVAO",h.scopeVAO.append(_,$));function k(O){var L=h.shader[O];L&&$.set(I.shader,"."+O,L.append(_,$))}k(rn),k(nn),Object.keys(h.state).length>0&&($(B,".dirty=true;"),$.exit(B,".dirty=true;")),$("a1(",_.shared.context,",a0,",_.batchId,");")}function U(_){if(!(typeof _!="object"||At(_))){for(var h=Object.keys(_),$=0;$<h.length;++$)if(Ht.isDynamic(_[h[$]]))return!0;return!1}}function Oe(_,h,$){var I=h.static[$];if(!I||!U(I))return;var B=_.global,k=Object.keys(I),O=!1,L=!1,v=!1,w=_.global.def("{}");k.forEach(function(C){var G=I[C];if(Ht.isDynamic(G)){typeof G=="function"&&(G=I[C]=Ht.unbox(G));var K=Yt(G,null);O=O||K.thisDep,v=v||K.propDep,L=L||K.contextDep}else{switch(B(w,".",C,"="),typeof G){case"number":B(G);break;case"string":B('"',G,'"');break;case"object":Array.isArray(G)&&B("[",G.join(),"]");break;default:B(_.link(G));break}B(";")}});function m(C,G){k.forEach(function(K){var Z=I[K];if(!!Ht.isDynamic(Z)){var Y=C.invoke(G,Z);G(w,".",K,"=",Y,";")}})}h.dynamic[$]=new Ht.DynamicVariable(Nn,{thisDep:O,contextDep:L,propDep:v,ref:w,append:m}),delete h.static[$]}function it(_,h,$,I,B){var k=qe();k.stats=k.link(B),Object.keys(h.static).forEach(function(L){Oe(k,h,L)}),Ef.forEach(function(L){Oe(k,_,L)});var O=Rt(_,h,$,I,k);return $t(k,O),H(k,O),y(k,O),o(k.compile(),{destroy:function(){O.shader.program.destroy()}})}return{next:Te,current:ee,procs:function(){var _=qe(),h=_.proc("poll"),$=_.proc("refresh"),I=_.block();h(I),$(I);var B=_.shared,k=B.gl,O=B.next,L=B.current;I(L,".dirty=false;"),Mt(_,h),Mt(_,$,null,!0);var v;le&&(v=_.link(le)),E.oes_vertex_array_object&&$(_.link(E.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var w=0;w<j.maxAttributes;++w){var m=$.def(B.attributes,"[",w,"]"),C=_.cond(m,".buffer");C.then(k,".enableVertexAttribArray(",w,");",k,".bindBuffer(",jr,",",m,".buffer.buffer);",k,".vertexAttribPointer(",w,",",m,".size,",m,".type,",m,".normalized,",m,".stride,",m,".offset);").else(k,".disableVertexAttribArray(",w,");",k,".vertexAttrib4f(",w,",",m,".x,",m,".y,",m,".z,",m,".w);",m,".buffer=null;"),$(C),le&&$(v,".vertexAttribDivisorANGLE(",w,",",m,".divisor);")}return $(_.shared.vao,".currentVAO=null;",_.shared.vao,".setVAO(",_.shared.vao,".targetVAO);"),Object.keys(_e).forEach(function(G){var K=_e[G],Z=I.def(O,".",G),Y=_.block();Y("if(",Z,"){",k,".enable(",K,")}else{",k,".disable(",K,")}",L,".",G,"=",Z,";"),$(Y),h("if(",Z,"!==",L,".",G,"){",Y,"}")}),Object.keys(te).forEach(function(G){var K=te[G],Z=ee[G],Y,fe,Fe=_.block();if(Fe(k,".",K,"("),At(Z)){var tt=Z.length;Y=_.global.def(O,".",G),fe=_.global.def(L,".",G),Fe(Ot(tt,function(Re){return Y+"["+Re+"]"}),");",Ot(tt,function(Re){return fe+"["+Re+"]="+Y+"["+Re+"];"}).join("")),h("if(",Ot(tt,function(Re){return Y+"["+Re+"]!=="+fe+"["+Re+"]"}).join("||"),"){",Fe,"}")}else Y=I.def(O,".",G),fe=I.def(L,".",G),Fe(Y,");",L,".",G,"=",Y,";"),h("if(",Y,"!==",fe,"){",Fe,"}");$(Fe)}),_.compile()}(),compile:it}}function Uf(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Vf=34918,zf=34919,qs=35007,jf=function(l,d){if(!d.ext_disjoint_timer_query)return null;var E=[];function j(){return E.pop()||d.ext_disjoint_timer_query.createQueryEXT()}function Q(le){E.push(le)}var z=[];function W(le){var we=j();d.ext_disjoint_timer_query.beginQueryEXT(qs,we),z.push(we),ae(z.length-1,z.length,le)}function ie(){d.ext_disjoint_timer_query.endQueryEXT(qs)}function se(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var he=[];function oe(){return he.pop()||new se}function me(le){he.push(le)}var be=[];function ae(le,we,ee){var Te=oe();Te.startQueryIndex=le,Te.endQueryIndex=we,Te.sum=0,Te.stats=ee,be.push(Te)}var pe=[],M=[];function X(){var le,we,ee=z.length;if(ee!==0){M.length=Math.max(M.length,ee+1),pe.length=Math.max(pe.length,ee+1),pe[0]=0,M[0]=0;var Te=0;for(le=0,we=0;we<z.length;++we){var re=z[we];d.ext_disjoint_timer_query.getQueryObjectEXT(re,zf)?(Te+=d.ext_disjoint_timer_query.getQueryObjectEXT(re,Vf),Q(re)):z[le++]=re,pe[we+1]=Te,M[we+1]=le}for(z.length=le,le=0,we=0;we<be.length;++we){var _e=be[we],te=_e.startQueryIndex,ve=_e.endQueryIndex;_e.sum+=pe[ve]-pe[te];var Be=M[te],Ye=M[ve];Ye===Be?(_e.stats.gpuTime+=_e.sum/1e6,me(_e)):(_e.startQueryIndex=Be,_e.endQueryIndex=Ye,be[le++]=_e)}be.length=le}}return{beginQuery:W,endQuery:ie,pushScopeStats:ae,update:X,getNumPendingQueries:function(){return z.length},clear:function(){E.push.apply(E,z);for(var le=0;le<E.length;le++)d.ext_disjoint_timer_query.deleteQueryEXT(E[le]);z.length=0,E.length=0},restore:function(){z.length=0,E.length=0}}},qf=16384,Hf=256,Wf=1024,Xf=34962,Hs="webglcontextlost",Ws="webglcontextrestored",Xs=1,Yf=2,Kf=3;function Ys(l,d){for(var E=0;E<l.length;++E)if(l[E]===d)return E;return-1}function Qf(l){var d=De(l);if(!d)return null;var E=d.gl,j=E.getContextAttributes(),Q=E.isContextLost(),z=Dt(E,d);if(!z)return null;var W=ii(),ie=Uf(),se=z.extensions,he=jf(E,se),oe=vn(),me=E.drawingBufferWidth,be=E.drawingBufferHeight,ae={tick:0,time:0,viewportWidth:me,viewportHeight:be,framebufferWidth:me,framebufferHeight:be,drawingBufferWidth:me,drawingBufferHeight:be,pixelRatio:d.pixelRatio},pe={},M={elements:null,primitive:4,count:-1,offset:0,instances:-1},X=Fo(E,se),le=Qo(E,ie,d,ee),we=lf(E,se,X,ie,le);function ee(Ge){return we.destroyBuffer(Ge)}var Te=fu(E,se,le,ie),re=mf(E,W,ie,d),_e=Gu(E,se,X,function(){Be.procs.poll()},ae,ie,d),te=Uu(E,se,X,ie,d),ve=uf(E,se,X,_e,te,ie),Be=Gf(E,W,se,X,le,Te,_e,ve,pe,we,re,M,ae,he,d),Ye=vf(E,ve,Be.procs.poll,ae,j,se,X),ge=Be.next,de=E.canvas,J=[],qe=[],Je=[],Ce=[d.onDestroy],nt=null;function Ke(){if(J.length===0){he&&he.update(),nt=null;return}nt=Hr.next(Ke),zt();for(var Ge=J.length-1;Ge>=0;--Ge){var ot=J[Ge];ot&&ot(ae,null,0)}E.flush(),he&&he.update()}function rt(){!nt&&J.length>0&&(nt=Hr.next(Ke))}function mt(){nt&&(Hr.cancel(Ke),nt=null)}function Ct(Ge){Ge.preventDefault(),Q=!0,mt(),qe.forEach(function(ot){ot()})}function Gt(Ge){E.getError(),Q=!1,z.restore(),re.restore(),le.restore(),_e.restore(),te.restore(),ve.restore(),we.restore(),he&&he.restore(),Be.procs.refresh(),rt(),Je.forEach(function(ot){ot()})}de&&(de.addEventListener(Hs,Ct,!1),de.addEventListener(Ws,Gt,!1));function ft(){J.length=0,mt(),de&&(de.removeEventListener(Hs,Ct),de.removeEventListener(Ws,Gt)),re.clear(),ve.clear(),te.clear(),_e.clear(),Te.clear(),le.clear(),we.clear(),he&&he.clear(),Ce.forEach(function(Ge){Ge()})}function Ft(Ge){p(!!Ge,"invalid args to regl({...})"),p.type(Ge,"object","invalid args to regl({...})");function ot(B){var k=o({},B);delete k.uniforms,delete k.attributes,delete k.context,delete k.vao,"stencil"in k&&k.stencil.op&&(k.stencil.opBack=k.stencil.opFront=k.stencil.op,delete k.stencil.op);function O(L){if(L in k){var v=k[L];delete k[L],Object.keys(v).forEach(function(w){k[L+"."+w]=v[w]})}}return O("blend"),O("depth"),O("cull"),O("stencil"),O("polygonOffset"),O("scissor"),O("sample"),"vao"in B&&(k.vao=B.vao),k}function ht(B,k){var O={},L={};return Object.keys(B).forEach(function(v){var w=B[v];if(Ht.isDynamic(w)){L[v]=Ht.unbox(w,v);return}else if(k&&Array.isArray(w)){for(var m=0;m<w.length;++m)if(Ht.isDynamic(w[m])){L[v]=Ht.unbox(w,v);return}}O[v]=w}),{dynamic:L,static:O}}var $t=ht(Ge.context||{},!0),sr=ht(Ge.uniforms||{},!0),Or=ht(Ge.attributes||{},!1),y=ht(ot(Ge),!1),H={gpuTime:0,cpuTime:0,count:0},U=Be.compile(y,Or,sr,$t,H),Oe=U.draw,it=U.batch,_=U.scope,h=[];function $(B){for(;h.length<B;)h.push(null);return h}function I(B,k){var O;if(Q&&p.raise("context lost"),typeof B=="function")return _.call(this,null,B,0);if(typeof k=="function")if(typeof B=="number")for(O=0;O<B;++O)_.call(this,null,k,O);else if(Array.isArray(B))for(O=0;O<B.length;++O)_.call(this,B[O],k,O);else return _.call(this,B,k,0);else if(typeof B=="number"){if(B>0)return it.call(this,$(B|0),B|0)}else if(Array.isArray(B)){if(B.length)return it.call(this,B,B.length)}else return Oe.call(this,B)}return o(I,{stats:H,destroy:function(){U.destroy()}})}var St=ve.setFBO=Ft({framebuffer:Ht.define.call(null,Xs,"framebuffer")});function Rt(Ge,ot){var ht=0;Be.procs.poll();var $t=ot.color;$t&&(E.clearColor(+$t[0]||0,+$t[1]||0,+$t[2]||0,+$t[3]||0),ht|=qf),"depth"in ot&&(E.clearDepth(+ot.depth),ht|=Hf),"stencil"in ot&&(E.clearStencil(ot.stencil|0),ht|=Wf),p(!!ht,"called regl.clear with no buffer specified"),E.clear(ht)}function Nt(Ge){if(p(typeof Ge=="object"&&Ge,"regl.clear() takes an object as input"),"framebuffer"in Ge)if(Ge.framebuffer&&Ge.framebuffer_reglType==="framebufferCube")for(var ot=0;ot<6;++ot)St(o({framebuffer:Ge.framebuffer.faces[ot]},Ge),Rt);else St(Ge,Rt);else Rt(null,Ge)}function Mt(Ge){p.type(Ge,"function","regl.frame() callback must be a function"),J.push(Ge);function ot(){var ht=Ys(J,Ge);p(ht>=0,"cannot cancel a frame twice");function $t(){var sr=Ys(J,$t);J[sr]=J[J.length-1],J.length-=1,J.length<=0&&mt()}J[ht]=$t}return rt(),{cancel:ot}}function Ut(){var Ge=ge.viewport,ot=ge.scissor_box;Ge[0]=Ge[1]=ot[0]=ot[1]=0,ae.viewportWidth=ae.framebufferWidth=ae.drawingBufferWidth=Ge[2]=ot[2]=E.drawingBufferWidth,ae.viewportHeight=ae.framebufferHeight=ae.drawingBufferHeight=Ge[3]=ot[3]=E.drawingBufferHeight}function zt(){ae.tick+=1,ae.time=et(),Ut(),Be.procs.poll()}function Tt(){_e.refresh(),Ut(),Be.procs.refresh(),he&&he.update()}function et(){return(vn()-oe)/1e3}Tt();function jt(Ge,ot){p.type(ot,"function","listener callback must be a function");var ht;switch(Ge){case"frame":return Mt(ot);case"lost":ht=qe;break;case"restore":ht=Je;break;case"destroy":ht=Ce;break;default:p.raise("invalid event, must be one of frame,lost,restore,destroy")}return ht.push(ot),{cancel:function(){for(var $t=0;$t<ht.length;++$t)if(ht[$t]===ot){ht[$t]=ht[ht.length-1],ht.pop();return}}}}var vt=o(Ft,{clear:Nt,prop:Ht.define.bind(null,Xs),context:Ht.define.bind(null,Yf),this:Ht.define.bind(null,Kf),draw:Ft({}),buffer:function(Ge){return le.create(Ge,Xf,!1,!1)},elements:function(Ge){return Te.create(Ge,!1)},texture:_e.create2D,cube:_e.createCube,renderbuffer:te.create,framebuffer:ve.create,framebufferCube:ve.createCube,vao:we.createVAO,attributes:j,frame:Mt,on:jt,limits:X,hasExtension:function(Ge){return X.extensions.indexOf(Ge.toLowerCase())>=0},read:Ye,destroy:ft,_gl:E,_refresh:Tt,poll:function(){zt(),he&&he.update()},now:et,stats:ie});return d.onDone(null,vt),vt}return Qf})})(regl$1);const regl=regl$1.exports,Mouse=mouseListen();class HydraRenderer{constructor({pb:n=null,width:s=1280,height:o=720,numSources:u=4,numOutputs:c=4,makeGlobal:b=!0,autoLoop:A=!0,detectAudio:D=!0,enableStreamCapture:V=!0,canvas:Ae,precision:Le,extendTransforms:Ee={}}={}){if(ArrayUtils.init(),this.pb=n,this.width=s,this.height=o,this.renderAll=!1,this.detectAudio=D,this._initCanvas(Ae),this.synth={time:0,bpm:30,width:this.width,height:this.height,fps:void 0,stats:{fps:0},speed:1,mouse:Mouse,render:this._render.bind(this),setResolution:this.setResolution.bind(this),update:Pe=>{},hush:this.hush.bind(this),tick:this.tick.bind(this)},b&&(window.loadScript=this.loadScript),this.timeSinceLastUpdate=0,this._time=0,Le&&["lowp","mediump","highp"].includes(Le.toLowerCase()))this.precision=Le.toLowerCase();else{let Pe=(/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!window.MSStream;this.precision=Pe?"highp":"mediump"}if(this.extendTransforms=Ee,this.saveFrame=!1,this.captureStream=null,this.generator=void 0,this._initRegl(),this._initOutputs(c),this._initSources(u),this._generateGlslTransforms(),this.synth.screencap=()=>{this.saveFrame=!0},V)try{this.captureStream=this.canvas.captureStream(25),this.synth.vidRecorder=new VideoRecorder(this.captureStream)}catch(Pe){console.warn(`[hydra-synth warning]
new MediaSource() is not currently supported on iOS.`),console.error(Pe)}D&&this._initAudio(),A&&rafLoop(this.tick.bind(this)).start(),this.sandbox=new EvalSandbox(this.synth,b,["speed","update","bpm","fps"])}eval(n){this.sandbox.eval(n)}getScreenImage(n){this.imageCallback=n,this.saveFrame=!0}hush(){this.s.forEach(n=>{n.clear()}),this.o.forEach(n=>{this.synth.solid(0,0,0,0).out(n)}),this.synth.render(this.o[0]),this.sandbox.set("update",n=>{})}loadScript(n=""){return new Promise((o,u)=>{var c=document.createElement("script");c.onload=function(){console.log(`loaded script ${n}`),o()},c.onerror=b=>{console.log(`error loading script ${n}`,"log-error"),o()},c.src=n,document.head.appendChild(c)})}setResolution(n,s){this.canvas.width=n,this.canvas.height=s,this.width=n,this.height=s,this.sandbox.set("width",n),this.sandbox.set("height",s),console.log(this.width),this.o.forEach(o=>{o.resize(n,s)}),this.s.forEach(o=>{o.resize(n,s)}),this.regl._refresh(),console.log(this.canvas.width)}canvasToImage(n){const s=document.createElement("a");s.style.display="none";let o=new Date;s.download=`hydra-${o.getFullYear()}-${o.getMonth()+1}-${o.getDate()}-${o.getHours()}.${o.getMinutes()}.${o.getSeconds()}.png`,document.body.appendChild(s);var u=this;this.canvas.toBlob(c=>{u.imageCallback?(u.imageCallback(c),delete u.imageCallback):(s.href=URL.createObjectURL(c),console.log(s.href),s.click())},"image/png"),setTimeout(()=>{document.body.removeChild(s),window.URL.revokeObjectURL(s.href)},300)}_initAudio(){this.synth.a=new Audio({numBins:4,parentEl:this.canvas.parentNode})}_initCanvas(n){n?(this.canvas=n,this.width=n.width,this.height=n.height):(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.imageRendering="pixelated",document.body.appendChild(this.canvas))}_initRegl(){this.regl=regl({canvas:this.canvas,pixelRatio:1}),this.regl.clear({color:[0,0,0,1]}),this.renderAll=this.regl({frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform sampler2D tex0;
      uniform sampler2D tex1;
      uniform sampler2D tex2;
      uniform sampler2D tex3;

      void main () {
        vec2 st = vec2(1.0 - uv.x, uv.y);
        st*= vec2(2);
        vec2 q = floor(st).xy*(vec2(2.0, 1.0));
        int quad = int(q.x) + int(q.y);
        st.x += step(1., mod(st.y,2.0));
        st.y += step(1., mod(st.x,2.0));
        st = fract(st);
        if(quad==0){
          gl_FragColor = texture2D(tex0, st);
        } else if(quad==1){
          gl_FragColor = texture2D(tex1, st);
        } else if (quad==2){
          gl_FragColor = texture2D(tex2, st);
        } else {
          gl_FragColor = texture2D(tex3, st);
        }

      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),tex1:this.regl.prop("tex1"),tex2:this.regl.prop("tex2"),tex3:this.regl.prop("tex3")},count:3,depth:{enable:!1}}),this.renderFbo=this.regl({frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform vec2 resolution;
      uniform sampler2D tex0;

      void main () {
        gl_FragColor = texture2D(tex0, vec2(1.0 - uv.x, uv.y));
      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),resolution:this.regl.prop("resolution")},count:3,depth:{enable:!1}})}_initOutputs(n){const s=this;this.o=Array(n).fill().map((o,u)=>{var c=new Output({regl:this.regl,width:this.width,height:this.height,precision:this.precision,label:`o${u}`});return c.id=u,s.synth["o"+u]=c,c}),this.output=this.o[0]}_initSources(n){this.s=[];for(var s=0;s<n;s++)this.createSource(s)}createSource(n){let s=new HydraSource({regl:this.regl,pb:this.pb,width:this.width,height:this.height,label:`s${n}`});return this.synth["s"+this.s.length]=s,this.s.push(s),s}_generateGlslTransforms(){var n=this;this.generator=new GeneratorFactory({defaultOutput:this.o[0],defaultUniforms:this.o[0].uniforms,extendTransforms:this.extendTransforms,changeListener:({type:s,method:o,synth:u})=>{s==="add"&&(n.synth[o]=u.generators[o],n.sandbox&&n.sandbox.add(o))}}),this.synth.setFunction=this.generator.setFunction.bind(this.generator)}_render(n){n?(this.output=n,this.isRenderingAll=!1):this.isRenderingAll=!0}tick(n,s){if(this.sandbox.tick(),this.detectAudio===!0&&this.synth.a.tick(),this.sandbox.set("time",this.synth.time+=n*.001*this.synth.speed),this.timeSinceLastUpdate+=n,!this.synth.fps||this.timeSinceLastUpdate>=1e3/this.synth.fps){if(this.synth.stats.fps=Math.ceil(1e3/this.timeSinceLastUpdate),this.synth.update)try{this.synth.update(this.timeSinceLastUpdate)}catch(o){console.log(o)}for(let o=0;o<this.s.length;o++)this.s[o].tick(this.synth.time);for(let o=0;o<this.o.length;o++)this.o[o].tick({time:this.synth.time,mouse:this.synth.mouse,bpm:this.synth.bpm,resolution:[this.canvas.width,this.canvas.height]});this.isRenderingAll?this.renderAll({tex0:this.o[0].getCurrent(),tex1:this.o[1].getCurrent(),tex2:this.o[2].getCurrent(),tex3:this.o[3].getCurrent(),resolution:[this.canvas.width,this.canvas.height]}):this.renderFbo({tex0:this.output.getCurrent(),resolution:[this.canvas.width,this.canvas.height]}),this.timeSinceLastUpdate=0}this.saveFrame===!0&&(this.canvasToImage(),this.saveFrame=!1)}}function create_fragment$4(r){let n;return{c(){n=element("canvas"),attr(n,"width",r[0]),attr(n,"height",r[1])},m(s,o){insert$2(s,n,o),r[6](n)},p(s,[o]){o&1&&attr(n,"width",s[0]),o&2&&attr(n,"height",s[1])},i:noop,o:noop,d(s){s&&detach(n),r[6](null)}}}function instance$5(r,n,s){let o,{synth:u}=n,{data:c}=n,{w:b}=n,{h:A}=n,{autoloop:D}=n,V,Ae;onMount(()=>{Ae=new HydraRenderer({makeGlobal:!1,autoLoop:{autoloop:D},detectAudio:!1,precision:"highp",canvas:o}),V=Ae.synth}),afterUpdate(()=>u(c)(V));function Le(Ee){binding_callbacks[Ee?"unshift":"push"](()=>{o=Ee,s(2,o)})}return r.$$set=Ee=>{"synth"in Ee&&s(3,u=Ee.synth),"data"in Ee&&s(4,c=Ee.data),"w"in Ee&&s(0,b=Ee.w),"h"in Ee&&s(1,A=Ee.h),"autoloop"in Ee&&s(5,D=Ee.autoloop)},[b,A,o,u,c,D,Le]}class HydraViewer extends SvelteComponent{constructor(n){super(),init(this,n,instance$5,create_fragment$4,safe_not_equal,{synth:3,data:4,w:0,h:1,autoloop:5})}}function instance$4(r,n,s){let o,u,c;component_subscribe(r,EventStore,D=>s(4,c=D));let{name:b,equipped:A}=n;return createEventDispatcher(),r.$$set=D=>{"name"in D&&s(0,b=D.name),"equipped"in D&&s(1,A=D.equipped)},r.$$.update=()=>{r.$$.dirty&16&&s(3,o=document.elementsFromPoint(c.x,c.y).filter(D=>D.classList.contains("thumb")||D.classList.contains("range"))),r.$$.dirty&8&&s(2,u=o.length>0?o[0]:void 0),r.$$.dirty&20},[b,A,u,o,c]}class ICursor extends SvelteComponent{constructor(n){super(),init(this,n,instance$4,null,safe_not_equal,{name:0,equipped:1})}}const ILever_svelte_svelte_type_style_lang="";function create_fragment$3(r){let n,s,o,u,c,b,A,D,V,Ae,Le,Ee,xe,Pe,Ne,at,je;return{c(){n=svg_element("svg"),s=svg_element("line"),A=svg_element("line"),Ee=space(),xe=element("div"),Pe=space(),Ne=element("div"),attr(s,"x1",o=r[3].x+2*r[4].x+"px"),attr(s,"y1",u=r[3].y+2*r[4].y+"px"),attr(s,"x2",c=r[2].x+2*r[4].x+"px"),attr(s,"y2",b=r[2].y+2*r[4].y+"px"),attr(s,"stroke","white"),attr(s,"stroke-width","2px"),attr(A,"x1",D=r[3].x+"px"),attr(A,"y1",V=r[3].y+"px"),attr(A,"x2",Ae=r[2].x+"px"),attr(A,"y2",Le=r[2].y+"px"),attr(A,"stroke","black"),attr(A,"stroke-width","1px"),set_style(n,"position","absolute"),set_style(n,"top","0"),set_style(n,"left","0"),attr(n,"width","100vw"),attr(n,"height","100vh"),toggle_class(n,"inactive",!r[0]),attr(xe,"class","round green svelte-1haa3xp"),set_style(xe,"left",r[1].x+"px"),set_style(xe,"top",r[1].y+"px"),set_style(xe,"position","fixed"),toggle_class(xe,"inactive",!r[0]),attr(Ne,"class","round blue svelte-1haa3xp"),set_style(Ne,"left",r[3].x+"px"),set_style(Ne,"top",r[3].y+"px"),set_style(Ne,"position","fixed"),toggle_class(Ne,"inactive",!r[0])},m(ce,$e){insert$2(ce,n,$e),append(n,s),append(n,A),insert$2(ce,Ee,$e),insert$2(ce,xe,$e),insert$2(ce,Pe,$e),insert$2(ce,Ne,$e),at||(je=[listen(window,"mousedown",r[12]),listen(window,"mouseup",r[13]),listen(window,"keydown",r[14]),listen(window,"keyup",r[15])],at=!0)},p(ce,[$e]){$e&24&&o!==(o=ce[3].x+2*ce[4].x+"px")&&attr(s,"x1",o),$e&24&&u!==(u=ce[3].y+2*ce[4].y+"px")&&attr(s,"y1",u),$e&20&&c!==(c=ce[2].x+2*ce[4].x+"px")&&attr(s,"x2",c),$e&20&&b!==(b=ce[2].y+2*ce[4].y+"px")&&attr(s,"y2",b),$e&8&&D!==(D=ce[3].x+"px")&&attr(A,"x1",D),$e&8&&V!==(V=ce[3].y+"px")&&attr(A,"y1",V),$e&4&&Ae!==(Ae=ce[2].x+"px")&&attr(A,"x2",Ae),$e&4&&Le!==(Le=ce[2].y+"px")&&attr(A,"y2",Le),$e&1&&toggle_class(n,"inactive",!ce[0]),$e&2&&set_style(xe,"left",ce[1].x+"px"),$e&2&&set_style(xe,"top",ce[1].y+"px"),$e&1&&toggle_class(xe,"inactive",!ce[0]),$e&8&&set_style(Ne,"left",ce[3].x+"px"),$e&8&&set_style(Ne,"top",ce[3].y+"px"),$e&1&&toggle_class(Ne,"inactive",!ce[0])},i:noop,o:noop,d(ce){ce&&detach(n),ce&&detach(Ee),ce&&detach(xe),ce&&detach(Pe),ce&&detach(Ne),at=!1,run_all(je)}}}function instance$3(r,n,s){let o,u,c,b,A,D;component_subscribe(r,EventStore,Me=>s(10,u=Me));let{name:V,equipped:Ae}=n;const Le=createEventDispatcher(),[Ee,xe,Pe,Ne]=AlignmentStore({x:0,y:0,movementX:0,movementY:0},{x:0,y:0-10,movementX:0,movementY:0,mXPrev:0},{x:0,y:0-50,movementX:0,movementY:0});component_subscribe(r,Ee,Me=>s(2,A=Me)),component_subscribe(r,xe,Me=>s(1,b=Me)),component_subscribe(r,Pe,Me=>s(3,D=Me)),component_subscribe(r,Ne,Me=>s(11,c=Me));const at=Me=>{Ae&&xe.set(!0)},je=Me=>{Ae&&xe.set(!1)},ce=Me=>{Ae&&Me.shiftKey&&Pe.set(!0)},$e=Me=>{Ae&&!Me.shiftKey&&Pe.set(!1)};return r.$$set=Me=>{"name"in Me&&s(9,V=Me.name),"equipped"in Me&&s(0,Ae=Me.equipped)},r.$$.update=()=>{if(r.$$.dirty&1024&&Ee.set(pick$1(["x","y","movementX","movementY"],u)),r.$$.dirty&12&&s(4,o={x:unit(sub(D,A)).y,y:-unit(sub(D,A)).x}),r.$$.dirty&3075&&Ae){let Me={targetPath:c?.elem?.dataset?.path,targetStore:c?.elem?.dataset?.store,offset:c?.offset,P2:b};c?.elem!=null&&Le("effect",mergeRight$1(u,Me))}},onMount(()=>{}),[Ae,b,A,D,o,Ee,xe,Pe,Ne,V,u,c,at,je,ce,$e]}class ILever extends SvelteComponent{constructor(n){super(),init(this,n,instance$3,create_fragment$3,safe_not_equal,{name:9,equipped:0})}}function create_fragment$2(r){let n,s,o,u;return{c(){n=element("div"),s=text(r[1]),attr(n,"class","infobox instrument"),set_style(n,"top",r[3].y+20+"px"),set_style(n,"left",r[3].x+20+"px"),toggle_class(n,"inactive",!r[2])},m(c,b){insert$2(c,n,b),append(n,s),o||(u=listen(window,"click",r[5]),o=!0)},p(c,[b]){b&2&&set_data(s,c[1]),b&8&&set_style(n,"top",c[3].y+20+"px"),b&8&&set_style(n,"left",c[3].x+20+"px"),b&4&&toggle_class(n,"inactive",!c[2])},i:noop,o:noop,d(c){c&&detach(n),o=!1,u()}}}function instance$2(r,n,s){let o;component_subscribe(r,EventStore,V=>s(3,o=V));let{ev:u,name:c,equipped:b}=n;const A=createEventDispatcher(),D=V=>b?A("effect",u):V;return r.$$set=V=>{"ev"in V&&s(0,u=V.ev),"name"in V&&s(1,c=V.name),"equipped"in V&&s(2,b=V.equipped)},[u,c,b,o,A,D]}class IFix extends SvelteComponent{constructor(n){super(),init(this,n,instance$2,create_fragment$2,safe_not_equal,{ev:0,name:1,equipped:2})}}function create_fragment$1(r){let n,s,o,u;return{c(){n=element("div"),s=text(r[0]),attr(n,"class","infobox instrument"),set_style(n,"top",r[2].y+20+"px"),set_style(n,"left",r[2].x+20+"px"),toggle_class(n,"inactive",!r[1])},m(c,b){insert$2(c,n,b),append(n,s),o||(u=listen(window,"mousedown",r[5]),o=!0)},p(c,[b]){b&1&&set_data(s,c[0]),b&4&&set_style(n,"top",c[2].y+20+"px"),b&4&&set_style(n,"left",c[2].x+20+"px"),b&2&&toggle_class(n,"inactive",!c[1])},i:noop,o:noop,d(c){c&&detach(n),o=!1,u()}}}function instance$1(r,n,s){let o,u;component_subscribe(r,EventStore,V=>s(2,u=V));let{name:c,equipped:b}=n;const A=createEventDispatcher(),D=V=>{b&&console.log("test"),b&&A("effect",o)};return r.$$set=V=>{"name"in V&&s(0,c=V.name),"equipped"in V&&s(1,b=V.equipped)},r.$$.update=()=>{r.$$.dirty&4&&s(3,o=u)},[c,b,u,o,A,D]}class IEraser extends SvelteComponent{constructor(n){super(),init(this,n,instance$1,create_fragment$1,safe_not_equal,{name:0,equipped:1})}}var lib={};Object.defineProperty(lib,"__esModule",{value:!0});class RandomGenerator{constructor(n){var s,o,u;if(this.a=BigInt(13),this.b=BigInt(7),this.c=BigInt(17),n.seed<BigInt(0))throw new Error("negative seed value is not acceptable.");this.seed=n.seed,this.limit=n.limit,this.a=(s=n.a)!==null&&s!==void 0?s:BigInt(13),this.b=(o=n.b)!==null&&o!==void 0?o:BigInt(7),this.c=(u=n.c)!==null&&u!==void 0?u:BigInt(17),this.previous=this.limit^this.seed;const c=n.discards||RandomGenerator.defaultDiscards;for(let b=0;b<c;b++)this.next()}next(){return this.fetch(!0)}look(){return this.fetch(!1)}fetch(n){let s=this.previous;return s=(s^s<<this.a)%this.limit,s=(s^s>>this.b)%this.limit,s=(s^s<<this.c)%this.limit,n&&(this.previous=s),s}}var RandomGenerator_1=lib.RandomGenerator=RandomGenerator;RandomGenerator.defaultDiscards=100;function get_each_context(r,n,s){const o=r.slice();return o[68]=n[s],o}function get_each_context_1(r,n,s){const o=r.slice();return o[71]=n[s][0],o[5]=n[s][1].equipped,o[72]=n[s][1].component,o[73]=n[s][1].ev,o[74]=n[s][1].effect,o}function get_each_context_2(r,n,s){const o=r.slice();return o[71]=n[s][0],o[5]=n[s][1].equipped,o}function get_each_context_3(r,n,s){const o=r.slice();return o[79]=n[s][0],o[80]=n[s][1].a,o[81]=n[s][1].b,o[82]=n[s][1].c0,o[83]=n[s][1].c1,o[84]=n[s][1].z,o[85]=n[s][1].locked,o}function get_each_context_4(r,n,s){const o=r.slice();return o[68]=n[s].templateName,o[88]=n[s].presetName,o[89]=n[s].synth,o[90]=n[s].inputSpace,o[91]=n[s].h_global,o[92]=n[s].h_local,o[94]=s,o}function create_each_block_4(r){let n,s,o,u,c=r[88]+"",b,A,D,V,Ae,Le,Ee,xe,Pe;return D=new HydraViewer({props:{synth:r[89],data:pluck$1("a",fromPairs$1(r[90])),w:150,h:150,autoloop:!1}}),{c(){n=element("label"),s=element("input"),o=space(),u=element("span"),b=text(c),A=space(),create_component(D.$$.fragment),V=space(),attr(s,"type","radio"),s.__value=r[94],s.value=s.__value,r[45][0].push(s),attr(n,"class",Ae="erasable canvas "+r[21]),attr(n,"value",Le=r[88]),toggle_class(n,"hidden",r[68]!=r[0])},m(Ne,at){insert$2(Ne,n,at),append(n,s),s.checked=s.__value===r[1],append(n,o),append(n,u),append(u,b),append(n,A),mount_component(D,n,null),append(n,V),Ee=!0,xe||(Pe=listen(s,"change",r[44]),xe=!0)},p(Ne,at){at[0]&2&&(s.checked=s.__value===Ne[1]),(!Ee||at[0]&17)&&c!==(c=Ne[88]+"")&&set_data(b,c);const je={};at[0]&17&&(je.synth=Ne[89]),at[0]&17&&(je.data=pluck$1("a",fromPairs$1(Ne[90]))),D.$set(je),(!Ee||at[0]&2097152&&Ae!==(Ae="erasable canvas "+Ne[21]))&&attr(n,"class",Ae),(!Ee||at[0]&17&&Le!==(Le=Ne[88]))&&attr(n,"value",Le),(!Ee||at[0]&2097169)&&toggle_class(n,"hidden",Ne[68]!=Ne[0])},i(Ne){Ee||(transition_in(D.$$.fragment,Ne),Ee=!0)},o(Ne){transition_out(D.$$.fragment,Ne),Ee=!1},d(Ne){Ne&&detach(n),r[45][0].splice(r[45][0].indexOf(s),1),destroy_component(D),xe=!1,Pe()}}}function create_if_block(r){let n,s,o,u,c,b,A,D,V,Ae,Le,Ee,xe,Pe,Ne,at,je,ce,$e,Me,_t,We,ut,bt;return{c(){n=element("ul"),s=element("li"),o=element("div"),o.textContent="Global macro",u=space(),c=element("div"),c.textContent="min",b=space(),A=element("div"),D=element("div"),Le=space(),Ee=element("div"),Ee.textContent="max",xe=space(),Pe=element("li"),Ne=element("div"),Ne.textContent="Local macro",at=space(),je=element("div"),je.textContent="min",ce=space(),$e=element("div"),Me=element("div"),ut=space(),bt=element("div"),bt.textContent="max",attr(o,"class","param-name"),attr(D,"class","thumb unlocked"),attr(D,"data-store","0"),attr(D,"data-path","h b"),set_style(D,"left",wasm_functions.rescale_index(r[22].toString(),r[25],r[26].length)*r[8]-3+"px"),add_render_callback(()=>r[46].call(D)),attr(A,"class","track"),add_render_callback(()=>r[47].call(A)),attr(s,"class","macro slider-grid"),attr(Ne,"class","param-name"),attr(Me,"data-store","1"),attr(Me,"data-path","h a"),attr(Me,"class","thumb unlocked"),set_style(Me,"left",wasm_functions.rescale_index(r[23].toString(),r[25],r[26].length)*r[8]-3+"px"),add_render_callback(()=>r[48].call(Me)),attr($e,"class","track"),add_render_callback(()=>r[49].call($e)),attr(Pe,"class","macro slider-grid"),attr(n,"class","sliders macro ")},m(ct,Et){insert$2(ct,n,Et),append(n,s),append(s,o),append(s,u),append(s,c),append(s,b),append(s,A),append(A,D),V=add_resize_listener(D,r[46].bind(D)),Ae=add_resize_listener(A,r[47].bind(A)),append(s,Le),append(s,Ee),append(n,xe),append(n,Pe),append(Pe,Ne),append(Pe,at),append(Pe,je),append(Pe,ce),append(Pe,$e),append($e,Me),_t=add_resize_listener(Me,r[48].bind(Me)),We=add_resize_listener($e,r[49].bind($e)),append(Pe,ut),append(Pe,bt)},p(ct,Et){Et[0]&104857856&&set_style(D,"left",wasm_functions.rescale_index(ct[22].toString(),ct[25],ct[26].length)*ct[8]-3+"px"),Et[0]&109052160&&set_style(Me,"left",wasm_functions.rescale_index(ct[23].toString(),ct[25],ct[26].length)*ct[8]-3+"px")},d(ct){ct&&detach(n),V(),Ae(),_t(),We()}}}function create_each_block_3(r){let n,s,o=r[79].replaceAll("_"," ")+"",u,c,b,A,D=r[82]+"",V,Ae,Le,Ee,xe,Pe,Ne,at,je,ce,$e,Me,_t,We,ut,bt,ct,Et=r[83]+"",Qe,dt,gt,st,R;return{c(){n=element("li"),s=element("div"),u=text(o),b=space(),A=element("div"),V=text(D),Le=space(),Ee=element("div"),xe=element("div"),at=space(),je=element("div"),ce=space(),$e=element("div"),bt=space(),ct=element("div"),Qe=text(Et),gt=space(),attr(s,"class","param-name "),attr(s,"data-store","2"),attr(s,"data-path",c=r[79]),toggle_class(s,"unlocked",!r[85]),attr(A,"data-store","2"),attr(A,"data-path",Ae=r[79]+" c0"),attr(A,"class","bound c0"),toggle_class(A,"unlocked",!r[85]),attr(xe,"data-store","2"),attr(xe,"data-path",Pe=r[79]+" b"),attr(xe,"class","range"),set_style(xe,"width",r[8]*r[84]/(r[83]-r[82])+"px"),set_style(xe,"left",r[8]*(r[81]-r[84]/2-r[82])/(r[83]-r[82])+"px"),add_render_callback(()=>r[50].call(xe)),toggle_class(xe,"unlocked",!r[85]),attr(je,"class","middle"),set_style(je,"width",2+"px"),set_style(je,"left",scale$1(r[82],r[83],0,r[8],r[81])+"px"),attr($e,"data-store","2"),attr($e,"data-path",Me=r[79]+" a"),attr($e,"class","thumb"),set_style($e,"left","calc("+100*(r[80]-r[82])/(r[83]-r[82])+"% - 5px)"),add_render_callback(()=>r[51].call($e)),toggle_class($e,"unlocked",!r[85]),attr(Ee,"data-path",We=r[79]),attr(Ee,"class","track"),add_render_callback(()=>r[52].call(Ee)),attr(ct,"data-store","2"),attr(ct,"data-path",dt=r[79]+" c1"),attr(ct,"class","bound c1"),toggle_class(ct,"unlocked",!r[85]),attr(n,"class",st="erasable slider-grid "+r[21]),attr(n,"data-path",R=r[79]),attr(n,"data-store","2"),toggle_class(n,"fixed",r[85])},m(g,q){insert$2(g,n,q),append(n,s),append(s,u),append(n,b),append(n,A),append(A,V),append(n,Le),append(n,Ee),append(Ee,xe),Ne=add_resize_listener(xe,r[50].bind(xe)),append(Ee,at),append(Ee,je),append(Ee,ce),append(Ee,$e),_t=add_resize_listener($e,r[51].bind($e)),ut=add_resize_listener(Ee,r[52].bind(Ee)),append(n,bt),append(n,ct),append(ct,Qe),append(n,gt)},p(g,q){q[0]&8&&o!==(o=g[79].replaceAll("_"," ")+"")&&set_data(u,o),q[0]&8&&c!==(c=g[79])&&attr(s,"data-path",c),q[0]&8&&toggle_class(s,"unlocked",!g[85]),q[0]&8&&D!==(D=g[82]+"")&&set_data(V,D),q[0]&8&&Ae!==(Ae=g[79]+" c0")&&attr(A,"data-path",Ae),q[0]&8&&toggle_class(A,"unlocked",!g[85]),q[0]&8&&Pe!==(Pe=g[79]+" b")&&attr(xe,"data-path",Pe),q[0]&264&&set_style(xe,"width",g[8]*g[84]/(g[83]-g[82])+"px"),q[0]&264&&set_style(xe,"left",g[8]*(g[81]-g[84]/2-g[82])/(g[83]-g[82])+"px"),q[0]&8&&toggle_class(xe,"unlocked",!g[85]),q[0]&264&&set_style(je,"left",scale$1(g[82],g[83],0,g[8],g[81])+"px"),q[0]&8&&Me!==(Me=g[79]+" a")&&attr($e,"data-path",Me),q[0]&8&&set_style($e,"left","calc("+100*(g[80]-g[82])/(g[83]-g[82])+"% - 5px)"),q[0]&8&&toggle_class($e,"unlocked",!g[85]),q[0]&8&&We!==(We=g[79])&&attr(Ee,"data-path",We),q[0]&8&&Et!==(Et=g[83]+"")&&set_data(Qe,Et),q[0]&8&&dt!==(dt=g[79]+" c1")&&attr(ct,"data-path",dt),q[0]&8&&toggle_class(ct,"unlocked",!g[85]),q[0]&2097152&&st!==(st="erasable slider-grid "+g[21])&&attr(n,"class",st),q[0]&8&&R!==(R=g[79])&&attr(n,"data-path",R),q[0]&2097160&&toggle_class(n,"fixed",g[85])},d(g){g&&detach(n),Ne(),_t(),ut()}}}function create_each_block_2(r){let n,s=r[71]+"",o,u,c;function b(){return r[53](r[71])}return{c(){n=element("div"),o=text(s),toggle_class(n,"equipped",r[5])},m(A,D){insert$2(A,n,D),append(n,o),u||(c=listen(n,"mouseenter",b),u=!0)},p(A,D){r=A,D[0]&4&&s!==(s=r[71]+"")&&set_data(o,s),D[0]&4&&toggle_class(n,"equipped",r[5])},d(A){A&&detach(n),u=!1,c()}}}function create_each_block_1(r){let n,s,o;var u=r[72];function c(b){return{props:{equipped:b[5],ev:b[73],name:b[71]}}}return u&&(n=new u(c(r)),n.$on("effect",function(){is_function(r[74])&&r[74].apply(this,arguments)})),{c(){n&&create_component(n.$$.fragment),s=empty$2()},m(b,A){n&&mount_component(n,b,A),insert$2(b,s,A),o=!0},p(b,A){r=b;const D={};if(A[0]&4&&(D.equipped=r[5]),A[0]&4&&(D.ev=r[73]),A[0]&4&&(D.name=r[71]),u!==(u=r[72])){if(n){group_outros();const V=n;transition_out(V.$$.fragment,1,0,()=>{destroy_component(V,1)}),check_outros()}u?(n=new u(c(r)),n.$on("effect",function(){is_function(r[74])&&r[74].apply(this,arguments)}),create_component(n.$$.fragment),transition_in(n.$$.fragment,1),mount_component(n,s.parentNode,s)):n=null}else u&&n.$set(D)},i(b){o||(n&&transition_in(n.$$.fragment,b),o=!0)},o(b){n&&transition_out(n.$$.fragment,b),o=!1},d(b){b&&detach(s),n&&destroy_component(n,b)}}}function create_each_block(r){let n,s=r[68]+"",o,u;return{c(){n=element("option"),o=text(s),n.__value=u=r[68],n.value=n.__value},m(c,b){insert$2(c,n,b),append(n,o)},p(c,b){b[0]&16&&s!==(s=c[68]+"")&&set_data(o,s),b[0]&16&&u!==(u=c[68])&&(n.__value=u,n.value=n.__value)},d(c){c&&detach(n)}}}function create_fragment(r){let n,s,o,u,c,b,A,D,V,Ae,Le,Ee,xe,Pe,Ne,at,je,ce,$e,Me,_t,We,ut,bt,ct,Et,Qe,dt;add_render_callback(r[42]);let gt=r[4][r[0]],st=[];for(let ue=0;ue<gt.length;ue+=1)st[ue]=create_each_block_4(get_each_context_4(r,gt,ue));const R=ue=>transition_out(st[ue],1,1,()=>{st[ue]=null});let g=r[12]!="default"&&create_if_block(r),q=Object.entries(r[3]),N=[];for(let ue=0;ue<q.length;ue+=1)N[ue]=create_each_block_3(get_each_context_3(r,q,ue));Le=new HydraViewer({props:{synth:r[4][r[0]][r[1]].synth,data:r[27],w:1e3,h:1e3,autoloop:!0}});let ne=Object.entries(r[2]),ye=[];for(let ue=0;ue<ne.length;ue+=1)ye[ue]=create_each_block_2(get_each_context_2(r,ne,ue));let ze=Object.entries(r[2]),Ie=[];for(let ue=0;ue<ze.length;ue+=1)Ie[ue]=create_each_block_1(get_each_context_1(r,ze,ue));const He=ue=>transition_out(Ie[ue],1,1,()=>{Ie[ue]=null});let Ue=keys$1(r[4]),Xe=[];for(let ue=0;ue<Ue.length;ue+=1)Xe[ue]=create_each_block(get_each_context(r,Ue,ue));return{c(){n=element("main"),s=element("div"),o=element("button"),o.innerHTML="<u>save</u>",u=space();for(let ue=0;ue<st.length;ue+=1)st[ue].c();c=space(),b=element("div"),g&&g.c(),A=space(),D=element("ul");for(let ue=0;ue<N.length;ue+=1)N[ue].c();V=space(),Ae=element("div"),create_component(Le.$$.fragment),Ee=space(),xe=element("div"),Pe=element("div");for(let ue=0;ue<ye.length;ue+=1)ye[ue].c();Ne=space();for(let ue=0;ue<Ie.length;ue+=1)Ie[ue].c();at=space(),je=element("div"),ce=element("select"),$e=element("option"),$e.textContent="Hilbert",Me=element("option"),Me.textContent="Random Walk",_t=element("option"),_t.textContent="Default",We=space(),ut=element("select");for(let ue=0;ue<Xe.length;ue+=1)Xe[ue].c();bt=space(),ct=element("button"),ct.textContent="Export",attr(o,"id","save"),attr(o,"data-path",""),attr(s,"class","snapshots"),attr(D,"class","sliders single"),attr(b,"class","ui"),attr(Ae,"class","viewport"),attr(Pe,"class","palette"),set_style(Pe,"left",r[24].x+"px"),set_style(Pe,"top",r[24].y+"px"),toggle_class(Pe,"hidden",!r[11]),set_style(xe,"width","100vw"),set_style(xe,"background","none"),set_style(xe,"position","absolute"),set_style(xe,"z-index","1000"),set_style(xe,"top","0"),set_style(xe,"left","0"),$e.__value="hilbert",$e.value=$e.__value,Me.__value="random",Me.value=Me.__value,_t.__value="default",_t.value=_t.__value,attr(ce,"name","UI Mode"),attr(ce,"id","select-ui"),r[12]===void 0&&add_render_callback(()=>r[54].call(ce)),attr(ut,"name","Presets"),attr(ut,"id","select-template"),r[0]===void 0&&add_render_callback(()=>r[55].call(ut)),attr(je,"class","config"),attr(n,"class","grid"),attr(n,"id","main")},m(ue,ke){insert$2(ue,n,ke),append(n,s),append(s,o),append(s,u);for(let lt=0;lt<st.length;lt+=1)st[lt].m(s,null);append(n,c),append(n,b),g&&g.m(b,null),append(b,A),append(b,D);for(let lt=0;lt<N.length;lt+=1)N[lt].m(D,null);append(n,V),append(n,Ae),mount_component(Le,Ae,null),append(n,Ee),append(n,xe),append(xe,Pe);for(let lt=0;lt<ye.length;lt+=1)ye[lt].m(Pe,null);append(xe,Ne);for(let lt=0;lt<Ie.length;lt+=1)Ie[lt].m(xe,null);append(n,at),append(n,je),append(je,ce),append(ce,$e),append(ce,Me),append(ce,_t),select_option(ce,r[12]),append(je,We),append(je,ut);for(let lt=0;lt<Xe.length;lt+=1)Xe[lt].m(ut,null);select_option(ut,r[0]),append(je,bt),append(je,ct),Et=!0,Qe||(dt=[listen(window,"keydown",r[35]),listen(window,"keyup",r[36]),listen(window,"keydown",r[37]),listen(window,"keyup",r[38]),listen(window,"mousemove",r[39]),listen(window,"resize",r[40]),listen(window,"wheel",r[41]),listen(window,"resize",r[42]),listen(o,"click",r[43]),listen(ce,"change",r[54]),listen(ut,"change",r[55])],Qe=!0)},p(ue,ke){if(ke[0]&2097171){gt=ue[4][ue[0]];let Se;for(Se=0;Se<gt.length;Se+=1){const yt=get_each_context_4(ue,gt,Se);st[Se]?(st[Se].p(yt,ke),transition_in(st[Se],1)):(st[Se]=create_each_block_4(yt),st[Se].c(),transition_in(st[Se],1),st[Se].m(s,null))}for(group_outros(),Se=gt.length;Se<st.length;Se+=1)R(Se);check_outros()}if(ue[12]!="default"?g?g.p(ue,ke):(g=create_if_block(ue),g.c(),g.m(b,A)):g&&(g.d(1),g=null),ke[0]&2106120){q=Object.entries(ue[3]);let Se;for(Se=0;Se<q.length;Se+=1){const yt=get_each_context_3(ue,q,Se);N[Se]?N[Se].p(yt,ke):(N[Se]=create_each_block_3(yt),N[Se].c(),N[Se].m(D,null))}for(;Se<N.length;Se+=1)N[Se].d(1);N.length=q.length}const lt={};if(ke[0]&19&&(lt.synth=ue[4][ue[0]][ue[1]].synth),ke[0]&134217728&&(lt.data=ue[27]),Le.$set(lt),ke[0]&4|ke[1]&4){ne=Object.entries(ue[2]);let Se;for(Se=0;Se<ne.length;Se+=1){const yt=get_each_context_2(ue,ne,Se);ye[Se]?ye[Se].p(yt,ke):(ye[Se]=create_each_block_2(yt),ye[Se].c(),ye[Se].m(Pe,null))}for(;Se<ye.length;Se+=1)ye[Se].d(1);ye.length=ne.length}if((!Et||ke[0]&16777216)&&set_style(Pe,"left",ue[24].x+"px"),(!Et||ke[0]&16777216)&&set_style(Pe,"top",ue[24].y+"px"),(!Et||ke[0]&2048)&&toggle_class(Pe,"hidden",!ue[11]),ke[0]&4){ze=Object.entries(ue[2]);let Se;for(Se=0;Se<ze.length;Se+=1){const yt=get_each_context_1(ue,ze,Se);Ie[Se]?(Ie[Se].p(yt,ke),transition_in(Ie[Se],1)):(Ie[Se]=create_each_block_1(yt),Ie[Se].c(),transition_in(Ie[Se],1),Ie[Se].m(xe,null))}for(group_outros(),Se=ze.length;Se<Ie.length;Se+=1)He(Se);check_outros()}if(ke[0]&4096&&select_option(ce,ue[12]),ke[0]&16){Ue=keys$1(ue[4]);let Se;for(Se=0;Se<Ue.length;Se+=1){const yt=get_each_context(ue,Ue,Se);Xe[Se]?Xe[Se].p(yt,ke):(Xe[Se]=create_each_block(yt),Xe[Se].c(),Xe[Se].m(ut,null))}for(;Se<Xe.length;Se+=1)Xe[Se].d(1);Xe.length=Ue.length}ke[0]&17&&select_option(ut,ue[0])},i(ue){if(!Et){for(let ke=0;ke<gt.length;ke+=1)transition_in(st[ke]);transition_in(Le.$$.fragment,ue);for(let ke=0;ke<ze.length;ke+=1)transition_in(Ie[ke]);Et=!0}},o(ue){st=st.filter(Boolean);for(let ke=0;ke<st.length;ke+=1)transition_out(st[ke]);transition_out(Le.$$.fragment,ue),Ie=Ie.filter(Boolean);for(let ke=0;ke<Ie.length;ke+=1)transition_out(Ie[ke]);Et=!1},d(ue){ue&&detach(n),destroy_each(st,ue),g&&g.d(),destroy_each(N,ue),destroy_component(Le),destroy_each(ye,ue),destroy_each(Ie,ue),destroy_each(Xe,ue),Qe=!1,run_all(dt)}}}function cursor_effect(r){console.log(r)}function instance(r,n,s){let o,u,c,b,A,D,V,Ae,Le,Ee,xe=noop,Pe=()=>(xe(),xe=subscribe(A,De=>s(3,Ee=De)),A),Ne,at,je,ce,$e=noop,Me=()=>($e(),$e=subscribe(c,De=>s(22,ce=De)),c),_t,We=noop,ut=()=>(We(),We=subscribe(b,De=>s(23,_t=De)),b),bt,ct,Et=noop,Qe=()=>(Et(),Et=subscribe(Le,De=>s(60,ct=De)),Le),dt,gt,st=noop,R=()=>(st(),st=subscribe(D,De=>s(25,gt=De)),D),g,q=noop,N=()=>(q(),q=subscribe(V,De=>s(26,g=De)),V),ne,ye=noop,ze=()=>(ye(),ye=subscribe(Ae,De=>s(27,ne=De)),Ae);component_subscribe(r,EventStore,De=>s(58,at=De)),r.$$.on_destroy.push(()=>xe()),r.$$.on_destroy.push(()=>$e()),r.$$.on_destroy.push(()=>We()),r.$$.on_destroy.push(()=>Et()),r.$$.on_destroy.push(()=>st()),r.$$.on_destroy.push(()=>q()),r.$$.on_destroy.push(()=>ye()),new RandomGenerator_1({seed:BigInt(123456789),limit:BigInt(10)**BigInt(64)});let Ie="Grayscale Noise",He=0,Ue,Xe,ue,ke,lt,Se,yt,Kt=6;const wt=writable(examples);component_subscribe(r,wt,De=>s(59,bt=De));const Pt=derived(wt,groupBy$1(prop$1("templateName")));component_subscribe(r,Pt,De=>s(4,je=De));const It=writable({x:0,y:0});component_subscribe(r,It,De=>s(24,dt=De));let Bt={fix:{name:"fix",equipped:!1,component:IFix,ff:"willFix",effect:Kn},lever:{name:"lever",equipped:!1,component:ILever,ff:"willNone",effect:qt},cursor:{name:"none",equipped:!0,component:ICursor,ff:"willNone",effect:cursor_effect},eraser:{name:"erase",equipped:!1,component:IEraser,ff:"willErase",effect:hn},zoom:{name:"zoom",equipped:!1,component:IEraser,ff:"",effect:Qn}};const kr=writable(1);component_subscribe(r,kr,De=>s(57,Ne=De));function Kn(De){let Dt=De?.detail;const[Ot,nr]=stringToPath(Dt?.target?.dataset?.path??"");Dt?.target?.dataset?.store==2&&A.update(modifyPath$1([Ot,"locked"],not$1))}function qt(De){let[Dt,Ot]=[De.detail.P2,De.detail.offset],[nr,gn]=stringToPath(De.detail.targetPath),Wr=lerp(lt,lt+ue,__,__,Dt.x-Ot.offsetX);De.detail.targetStore==0?c.set(Wr(0n,ct)):De.detail.targetStore==1?b.set(Wr(0n,ct)):De.detail.targetStore==2&&A.evolve(deepObjOf([nr,gn],ia=>Wr(Ee[nr].c0,Ee[nr].c1)))}function hn(De){let Dt=document.elementsFromPoint(De.detail.x,De.detail.y).filter(nr=>nr.tagName=="LABEL")[0].getAttribute("value"),Ot=findIndex$1(allPass$1([propEq$1("presetName",Dt),propEq$1("templateName",Ie)]),bt);bt.filter(nr=>nr.templateName==Ie).length>1&&wt.update(remove$2(Ot,1))}function _r(){let De=assignDefaultName(pluck$1("presetName",groupBy$1(prop$1("templateName"),bt))),Dt={templateName:Ie,presetName:De,inputSpace:toPairs$1(Ee),h_local:_t,h_global:ce,synth:je[Ie][He].synth};wt.update(insert$1(-1,Dt))}function dn(De){s(2,Bt=mapObjIndexed$1((Dt,Ot)=>modify$1("equipped",Ot==De?T$1:F$1,Dt),Bt))}function Qn(De){console.log(De);let Dt=clamp$1(1e-6,1,Ne+scale$1(0,Ue*100,1e-6,1,-at.wheelDeltaY));A.evolve(map$3(always$1(objOf$1("z",multiply$1(Dt/Ne))),Ee)),kr.set(Dt)}function p(De){s(2,Bt[o]=assoc$1("ev",De,Bt[o]),Bt)}onMount(()=>{mousemove_.thru(obs(p)),s(10,lt=document.getElementsByClassName("track")[0].getBoundingClientRect().left)});const Zn=[[]],Jn=De=>UIOptions.update(assoc$1("noscroll",De.shiftKey)),ei=De=>UIOptions.update(assoc$1("noscroll",De.shiftKey)),ti=De=>{s(11,Se=(De.key==" "||Se)&&!0),document.getElementById("select-ui").blur(),document.getElementById("select-template").blur()},ur=De=>{s(11,Se=De.key==" "?!1:Se||!1),document.getElementById("save").blur()},mn=De=>{Se?It.update(Dt=>Dt):set_store_value(It,dt={x:De.x,y:De.y},dt),p(De),EventStore.update(mergeLeft$1(pick$1(["x","y","movementX","movementY"],De)))},vr=De=>{let Dt=document.getElementsByClassName("track")[0].getBoundingClientRect().left;s(10,lt=Dt)},pn=De=>{EventStore.update(assoc$1("wheelDeltaX",De.deltaX)),EventStore.update(assoc$1("wheelDeltaY",De.deltaY))};function ri(){s(6,Ue=window.innerHeight),s(7,Xe=window.innerWidth)}const ni=()=>_r();function _n(){He=this.__value,s(1,He)}function Ht(){Kt=this.clientWidth,s(13,Kt)}function Hr(){ue=this.clientWidth,s(8,ue)}function vn(){Kt=this.clientWidth,s(13,Kt)}function ii(){ue=this.clientWidth,s(8,ue)}function ai(){ke=this.clientWidth,s(9,ke)}function si(){Kt=this.clientWidth,s(13,Kt)}function oi(){ue=this.clientWidth,s(8,ue)}const ui=De=>dn(De);function yn(){yt=select_value(this),s(12,yt)}function bn(){Ie=select_value(this),s(0,Ie)}return r.$$.update=()=>{r.$$.dirty[0]&4&&s(5,o=keys$1(pickBy$1((De,Dt)=>De.equipped,Bt))[0]),r.$$.dirty[0]&36&&s(21,u=Bt[o].ff),r.$$.dirty[0]&19&&Me(s(16,[c,b,A,D,V,Ae,Le]=MuesliStore(je[Ie][He]),c,ut(s(15,b)),Pe(s(14,A)),R(s(20,D)),N(s(19,V)),ze(s(18,Ae)),Qe(s(17,Le)))),r.$$.dirty[0]&8&&toPairs$1(Ee)},[Ie,He,Bt,Ee,je,o,Ue,Xe,ue,ke,lt,Se,yt,Kt,A,b,c,Le,Ae,V,D,u,ce,_t,dt,gt,g,ne,wt,Pt,It,kr,_r,dn,p,Jn,ei,ti,ur,mn,vr,pn,ri,ni,_n,Zn,Ht,Hr,vn,ii,ai,si,oi,ui,yn,bn]}class App extends SvelteComponent{constructor(n){super(),init(this,n,instance,create_fragment,safe_not_equal,{},null,[-1,-1,-1,-1])}}let wasm_functions={forward:void 0,inverse:void 0,rescale_index:void 0};async function loadApp(){await init$1(),wasm_functions.forward=hilbert_axes_wasm_from_str,wasm_functions.inverse=hilbert_index_wasm_to_str,wasm_functions.rescale_index=rescale_hilbert_from_str,new App({target:document.getElementById("app")})}loadApp()});export default Jf();
