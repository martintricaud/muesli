var Zf=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports);var Jf=Zf((exports,module)=>{(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))o(u);new MutationObserver(u=>{for(const c of u)if(c.type==="childList")for(const b of c.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&o(b)}).observe(document,{childList:!0,subtree:!0});function s(u){const c={};return u.integrity&&(c.integrity=u.integrity),u.referrerpolicy&&(c.referrerPolicy=u.referrerpolicy),u.crossorigin==="use-credentials"?c.credentials="include":u.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(u){if(u.ep)return;u.ep=!0;const c=s(u);fetch(u.href,c)}})();let wasm;const cachedTextDecoder=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});cachedTextDecoder.decode();let cachedUint8Memory0=new Uint8Array;function getUint8Memory0(){return cachedUint8Memory0.byteLength===0&&(cachedUint8Memory0=new Uint8Array(wasm.memory.buffer)),cachedUint8Memory0}function getStringFromWasm0(r,n){return cachedTextDecoder.decode(getUint8Memory0().subarray(r,r+n))}let WASM_VECTOR_LEN=0;const cachedTextEncoder=new TextEncoder("utf-8"),encodeString=typeof cachedTextEncoder.encodeInto=="function"?function(r,n){return cachedTextEncoder.encodeInto(r,n)}:function(r,n){const s=cachedTextEncoder.encode(r);return n.set(s),{read:r.length,written:s.length}};function passStringToWasm0(r,n,s){if(s===void 0){const O=cachedTextEncoder.encode(r),B=n(O.length);return getUint8Memory0().subarray(B,B+O.length).set(O),WASM_VECTOR_LEN=O.length,B}let o=r.length,u=n(o);const c=getUint8Memory0();let b=0;for(;b<o;b++){const O=r.charCodeAt(b);if(O>127)break;c[u+b]=O}if(b!==o){b!==0&&(r=r.slice(b)),u=s(u,o,o=b+r.length*3);const O=getUint8Memory0().subarray(u+b,u+o);b+=encodeString(r,O).written}return WASM_VECTOR_LEN=b,u}let cachedInt32Memory0=new Int32Array;function getInt32Memory0(){return cachedInt32Memory0.byteLength===0&&(cachedInt32Memory0=new Int32Array(wasm.memory.buffer)),cachedInt32Memory0}let cachedUint32Memory0=new Uint32Array;function getUint32Memory0(){return cachedUint32Memory0.byteLength===0&&(cachedUint32Memory0=new Uint32Array(wasm.memory.buffer)),cachedUint32Memory0}function getArrayU32FromWasm0(r,n){return getUint32Memory0().subarray(r/4,r/4+n)}function hilbert_axes_wasm_from_str(r,n,s){try{const b=wasm.__wbindgen_add_to_stack_pointer(-16),O=passStringToWasm0(r,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),B=WASM_VECTOR_LEN;wasm.hilbert_axes_wasm_from_str(b,O,B,n,s);var o=getInt32Memory0()[b/4+0],u=getInt32Memory0()[b/4+1],c=getArrayU32FromWasm0(o,u).slice();return wasm.__wbindgen_free(o,u*4),c}finally{wasm.__wbindgen_add_to_stack_pointer(16)}}function passArray32ToWasm0(r,n){const s=n(r.length*4);return getUint32Memory0().set(r,s/4),WASM_VECTOR_LEN=r.length,s}function hilbert_index_wasm_to_str(r,n){try{const u=wasm.__wbindgen_add_to_stack_pointer(-16),c=passArray32ToWasm0(r,wasm.__wbindgen_malloc),b=WASM_VECTOR_LEN;wasm.hilbert_index_wasm_to_str(u,c,b,n);var s=getInt32Memory0()[u/4+0],o=getInt32Memory0()[u/4+1];return getStringFromWasm0(s,o)}finally{wasm.__wbindgen_add_to_stack_pointer(16),wasm.__wbindgen_free(s,o)}}function rescale_hilbert_from_str(r,n,s){const o=passStringToWasm0(r,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),u=WASM_VECTOR_LEN;return wasm.rescale_hilbert_from_str(o,u,n,s)}async function load(r,n){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,n)}catch(o){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const s=await r.arrayBuffer();return await WebAssembly.instantiate(s,n)}else{const s=await WebAssembly.instantiate(r,n);return s instanceof WebAssembly.Instance?{instance:s,module:r}:s}}function getImports(){const r={};return r.wbg={},r.wbg.__wbindgen_throw=function(n,s){throw new Error(getStringFromWasm0(n,s))},r}function finalizeInit(r,n){return wasm=r.exports,init$1.__wbindgen_wasm_module=n,cachedInt32Memory0=new Int32Array,cachedUint32Memory0=new Uint32Array,cachedUint8Memory0=new Uint8Array,wasm}async function init$1(r){typeof r>"u"&&(r=new URL("/muesli/assets/hilbert_bg.2059dff0.wasm",self.location));const n=getImports();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:s,module:o}=await load(await r,n);return finalizeInit(s,o)}const app="";function noop(){}function run(r){return r()}function blank_object(){return Object.create(null)}function run_all(r){r.forEach(run)}function is_function(r){return typeof r=="function"}function safe_not_equal(r,n){return r!=r?n==n:r!==n||r&&typeof r=="object"||typeof r=="function"}function is_empty(r){return Object.keys(r).length===0}function subscribe(r,...n){if(r==null)return noop;const s=r.subscribe(...n);return s.unsubscribe?()=>s.unsubscribe():s}function component_subscribe(r,n,s){r.$$.on_destroy.push(subscribe(n,s))}function set_store_value(r,n,s){return r.set(s),n}function append(r,n){r.appendChild(n)}function insert$2(r,n,s){r.insertBefore(n,s||null)}function detach(r){r.parentNode.removeChild(r)}function destroy_each(r,n){for(let s=0;s<r.length;s+=1)r[s]&&r[s].d(n)}function element(r){return document.createElement(r)}function text(r){return document.createTextNode(r)}function space(){return text(" ")}function empty$2(){return text("")}function listen(r,n,s,o){return r.addEventListener(n,s,o),()=>r.removeEventListener(n,s,o)}function attr(r,n,s){s==null?r.removeAttribute(n):r.getAttribute(n)!==s&&r.setAttribute(n,s)}function children(r){return Array.from(r.childNodes)}function set_data(r,n){n=""+n,r.wholeText!==n&&(r.data=n)}function set_style(r,n,s,o){s===null?r.style.removeProperty(n):r.style.setProperty(n,s,o?"important":"")}function select_option(r,n){for(let s=0;s<r.options.length;s+=1){const o=r.options[s];if(o.__value===n){o.selected=!0;return}}r.selectedIndex=-1}function select_value(r){const n=r.querySelector(":checked")||r.options[0];return n&&n.__value}let crossorigin;function is_crossorigin(){if(crossorigin===void 0){crossorigin=!1;try{typeof window<"u"&&window.parent&&window.parent.document}catch{crossorigin=!0}}return crossorigin}function add_resize_listener(r,n){getComputedStyle(r).position==="static"&&(r.style.position="relative");const o=element("iframe");o.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),o.setAttribute("aria-hidden","true"),o.tabIndex=-1;const u=is_crossorigin();let c;return u?(o.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",c=listen(window,"message",b=>{b.source===o.contentWindow&&n()})):(o.src="about:blank",o.onload=()=>{c=listen(o.contentWindow,"resize",n)}),append(r,o),()=>{(u||c&&o.contentWindow)&&c(),detach(o)}}function toggle_class(r,n,s){r.classList[s?"add":"remove"](n)}function custom_event(r,n,{bubbles:s=!1,cancelable:o=!1}={}){const u=document.createEvent("CustomEvent");return u.initCustomEvent(r,s,o,n),u}let current_component;function set_current_component(r){current_component=r}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function onMount(r){get_current_component().$$.on_mount.push(r)}function afterUpdate(r){get_current_component().$$.after_update.push(r)}function createEventDispatcher(){const r=get_current_component();return(n,s,{cancelable:o=!1}={})=>{const u=r.$$.callbacks[n];if(u){const c=custom_event(n,s,{cancelable:o});return u.slice().forEach(b=>{b.call(r,c)}),!c.defaultPrevented}return!0}}const dirty_components=[],binding_callbacks=[],render_callbacks=[],flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function add_render_callback(r){render_callbacks.push(r)}const seen_callbacks=new Set;let flushidx=0;function flush(){const r=current_component;do{for(;flushidx<dirty_components.length;){const n=dirty_components[flushidx];flushidx++,set_current_component(n),update(n.$$)}for(set_current_component(null),dirty_components.length=0,flushidx=0;binding_callbacks.length;)binding_callbacks.pop()();for(let n=0;n<render_callbacks.length;n+=1){const s=render_callbacks[n];seen_callbacks.has(s)||(seen_callbacks.add(s),s())}render_callbacks.length=0}while(dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,seen_callbacks.clear(),set_current_component(r)}function update(r){if(r.fragment!==null){r.update(),run_all(r.before_update);const n=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,n),r.after_update.forEach(add_render_callback)}}const outroing=new Set;let outros;function group_outros(){outros={r:0,c:[],p:outros}}function check_outros(){outros.r||run_all(outros.c),outros=outros.p}function transition_in(r,n){r&&r.i&&(outroing.delete(r),r.i(n))}function transition_out(r,n,s,o){if(r&&r.o){if(outroing.has(r))return;outroing.add(r),outros.c.push(()=>{outroing.delete(r),o&&(s&&r.d(1),o())}),r.o(n)}else o&&o()}function create_component(r){r&&r.c()}function mount_component(r,n,s,o){const{fragment:u,on_mount:c,on_destroy:b,after_update:O}=r.$$;u&&u.m(n,s),o||add_render_callback(()=>{const B=c.map(run).filter(is_function);b?b.push(...B):run_all(B),r.$$.on_mount=[]}),O.forEach(add_render_callback)}function destroy_component(r,n){const s=r.$$;s.fragment!==null&&(run_all(s.on_destroy),s.fragment&&s.fragment.d(n),s.on_destroy=s.fragment=null,s.ctx=[])}function make_dirty(r,n){r.$$.dirty[0]===-1&&(dirty_components.push(r),schedule_update(),r.$$.dirty.fill(0)),r.$$.dirty[n/31|0]|=1<<n%31}function init(r,n,s,o,u,c,b,O=[-1]){const B=current_component;set_current_component(r);const M=r.$$={fragment:null,ctx:null,props:c,update:noop,not_equal:u,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(B?B.$$.context:[])),callbacks:blank_object(),dirty:O,skip_bound:!1,root:n.target||B.$$.root};b&&b(M.root);let xe=!1;if(M.ctx=s?s(r,n.props||{},(Ce,ge,...we)=>{const Re=we.length?we[0]:ge;return M.ctx&&u(M.ctx[Ce],M.ctx[Ce]=Re)&&(!M.skip_bound&&M.bound[Ce]&&M.bound[Ce](Re),xe&&make_dirty(r,Ce)),ge}):[],M.update(),xe=!0,run_all(M.before_update),M.fragment=o?o(M.ctx):!1,n.target){if(n.hydrate){const Ce=children(n.target);M.fragment&&M.fragment.l(Ce),Ce.forEach(detach)}else M.fragment&&M.fragment.c();n.intro&&transition_in(r.$$.fragment),mount_component(r,n.target,n.anchor,n.customElement),flush()}set_current_component(B)}class SvelteComponent{$destroy(){destroy_component(this,1),this.$destroy=noop}$on(n,s){const o=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return o.push(s),()=>{const u=o.indexOf(s);u!==-1&&o.splice(u,1)}}$set(n){this.$$set&&!is_empty(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}}const subscriber_queue=[];function readable(r,n){return{subscribe:writable(r,n).subscribe}}function writable(r,n=noop){let s;const o=new Set;function u(O){if(safe_not_equal(r,O)&&(r=O,s)){const B=!subscriber_queue.length;for(const M of o)M[1](),subscriber_queue.push(M,r);if(B){for(let M=0;M<subscriber_queue.length;M+=2)subscriber_queue[M][0](subscriber_queue[M+1]);subscriber_queue.length=0}}}function c(O){u(O(r))}function b(O,B=noop){const M=[O,B];return o.add(M),o.size===1&&(s=n(u)||noop),O(r),()=>{o.delete(M),o.size===0&&(s(),s=null)}}return{set:u,update:c,subscribe:b}}function derived(r,n,s){const o=!Array.isArray(r),u=o?[r]:r,c=n.length<2;return readable(s,b=>{let O=!1;const B=[];let M=0,xe=noop;const Ce=()=>{if(M)return;xe();const we=n(o?B[0]:B,b);c?b(we):xe=is_function(we)?we:noop},ge=u.map((we,Re)=>subscribe(we,ft=>{B[Re]=ft,M&=~(1<<Re),O&&Ce()},()=>{M|=1<<Re}));return O=!0,Ce(),function(){run_all(ge),xe()}})}var F=function(){return!1};const F$1=F;var T=function(){return!0};const T$1=T,__={"@@functional/placeholder":!0};function _isPlaceholder(r){return r!=null&&typeof r=="object"&&r["@@functional/placeholder"]===!0}function _curry1(r){return function n(s){return arguments.length===0||_isPlaceholder(s)?n:r.apply(this,arguments)}}function _curry2(r){return function n(s,o){switch(arguments.length){case 0:return n;case 1:return _isPlaceholder(s)?n:_curry1(function(u){return r(s,u)});default:return _isPlaceholder(s)&&_isPlaceholder(o)?n:_isPlaceholder(s)?_curry1(function(u){return r(u,o)}):_isPlaceholder(o)?_curry1(function(u){return r(s,u)}):r(s,o)}}}function _arity(r,n){switch(r){case 0:return function(){return n.apply(this,arguments)};case 1:return function(s){return n.apply(this,arguments)};case 2:return function(s,o){return n.apply(this,arguments)};case 3:return function(s,o,u){return n.apply(this,arguments)};case 4:return function(s,o,u,c){return n.apply(this,arguments)};case 5:return function(s,o,u,c,b){return n.apply(this,arguments)};case 6:return function(s,o,u,c,b,O){return n.apply(this,arguments)};case 7:return function(s,o,u,c,b,O,B){return n.apply(this,arguments)};case 8:return function(s,o,u,c,b,O,B,M){return n.apply(this,arguments)};case 9:return function(s,o,u,c,b,O,B,M,xe){return n.apply(this,arguments)};case 10:return function(s,o,u,c,b,O,B,M,xe,Ce){return n.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function _curryN(r,n,s){return function(){for(var o=[],u=0,c=r,b=0;b<n.length||u<arguments.length;){var O;b<n.length&&(!_isPlaceholder(n[b])||u>=arguments.length)?O=n[b]:(O=arguments[u],u+=1),o[b]=O,_isPlaceholder(O)||(c-=1),b+=1}return c<=0?s.apply(this,o):_arity(c,_curryN(r,o,s))}}var curryN=_curry2(function(n,s){return n===1?_curry1(s):_arity(n,_curryN(n,[],s))});const curryN$1=curryN;function _curry3(r){return function n(s,o,u){switch(arguments.length){case 0:return n;case 1:return _isPlaceholder(s)?n:_curry2(function(c,b){return r(s,c,b)});case 2:return _isPlaceholder(s)&&_isPlaceholder(o)?n:_isPlaceholder(s)?_curry2(function(c,b){return r(c,o,b)}):_isPlaceholder(o)?_curry2(function(c,b){return r(s,c,b)}):_curry1(function(c){return r(s,o,c)});default:return _isPlaceholder(s)&&_isPlaceholder(o)&&_isPlaceholder(u)?n:_isPlaceholder(s)&&_isPlaceholder(o)?_curry2(function(c,b){return r(c,b,u)}):_isPlaceholder(s)&&_isPlaceholder(u)?_curry2(function(c,b){return r(c,o,b)}):_isPlaceholder(o)&&_isPlaceholder(u)?_curry2(function(c,b){return r(s,c,b)}):_isPlaceholder(s)?_curry1(function(c){return r(c,o,u)}):_isPlaceholder(o)?_curry1(function(c){return r(s,c,u)}):_isPlaceholder(u)?_curry1(function(c){return r(s,o,c)}):r(s,o,u)}}}const _isArray=Array.isArray||function(n){return n!=null&&n.length>=0&&Object.prototype.toString.call(n)==="[object Array]"};function _isTransformer(r){return r!=null&&typeof r["@@transducer/step"]=="function"}function _dispatchable(r,n,s){return function(){if(arguments.length===0)return s();var o=arguments[arguments.length-1];if(!_isArray(o)){for(var u=0;u<r.length;){if(typeof o[r[u]]=="function")return o[r[u]].apply(o,Array.prototype.slice.call(arguments,0,-1));u+=1}if(_isTransformer(o)){var c=n.apply(null,Array.prototype.slice.call(arguments,0,-1));return c(o)}}return s.apply(this,arguments)}}function _reduced(r){return r&&r["@@transducer/reduced"]?r:{"@@transducer/value":r,"@@transducer/reduced":!0}}const _xfBase={init:function(){return this.xf["@@transducer/init"]()},result:function(r){return this.xf["@@transducer/result"](r)}};var max=_curry2(function(n,s){return s>n?s:n});const max$1=max;function _map(r,n){for(var s=0,o=n.length,u=Array(o);s<o;)u[s]=r(n[s]),s+=1;return u}function _isString(r){return Object.prototype.toString.call(r)==="[object String]"}var _isArrayLike=_curry1(function(n){return _isArray(n)?!0:!n||typeof n!="object"||_isString(n)?!1:n.length===0?!0:n.length>0?n.hasOwnProperty(0)&&n.hasOwnProperty(n.length-1):!1});const _isArrayLike$1=_isArrayLike;var XWrap=function(){function r(n){this.f=n}return r.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},r.prototype["@@transducer/result"]=function(n){return n},r.prototype["@@transducer/step"]=function(n,s){return this.f(n,s)},r}();function _xwrap(r){return new XWrap(r)}var bind=_curry2(function(n,s){return _arity(n.length,function(){return n.apply(s,arguments)})});const bind$1=bind;function _arrayReduce(r,n,s){for(var o=0,u=s.length;o<u;){if(n=r["@@transducer/step"](n,s[o]),n&&n["@@transducer/reduced"]){n=n["@@transducer/value"];break}o+=1}return r["@@transducer/result"](n)}function _iterableReduce(r,n,s){for(var o=s.next();!o.done;){if(n=r["@@transducer/step"](n,o.value),n&&n["@@transducer/reduced"]){n=n["@@transducer/value"];break}o=s.next()}return r["@@transducer/result"](n)}function _methodReduce(r,n,s,o){return r["@@transducer/result"](s[o](bind$1(r["@@transducer/step"],r),n))}var symIterator=typeof Symbol<"u"?Symbol.iterator:"@@iterator";function _reduce(r,n,s){if(typeof r=="function"&&(r=_xwrap(r)),_isArrayLike$1(s))return _arrayReduce(r,n,s);if(typeof s["fantasy-land/reduce"]=="function")return _methodReduce(r,n,s,"fantasy-land/reduce");if(s[symIterator]!=null)return _iterableReduce(r,n,s[symIterator]());if(typeof s.next=="function")return _iterableReduce(r,n,s);if(typeof s.reduce=="function")return _methodReduce(r,n,s,"reduce");throw new TypeError("reduce: list must be array or iterable")}var XMap=function(){function r(n,s){this.xf=s,this.f=n}return r.prototype["@@transducer/init"]=_xfBase.init,r.prototype["@@transducer/result"]=_xfBase.result,r.prototype["@@transducer/step"]=function(n,s){return this.xf["@@transducer/step"](n,this.f(s))},r}(),_xmap=_curry2(function(n,s){return new XMap(n,s)});const _xmap$1=_xmap;function _has(r,n){return Object.prototype.hasOwnProperty.call(n,r)}var toString$2=Object.prototype.toString,_isArguments=function(){return toString$2.call(arguments)==="[object Arguments]"?function(n){return toString$2.call(n)==="[object Arguments]"}:function(n){return _has("callee",n)}}();const _isArguments$1=_isArguments;var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],hasArgsEnumBug=function(){return arguments.propertyIsEnumerable("length")}(),contains$2=function(n,s){for(var o=0;o<n.length;){if(n[o]===s)return!0;o+=1}return!1},keys=_curry1(typeof Object.keys=="function"&&!hasArgsEnumBug?function(n){return Object(n)!==n?[]:Object.keys(n)}:function(n){if(Object(n)!==n)return[];var s,o,u=[],c=hasArgsEnumBug&&_isArguments$1(n);for(s in n)_has(s,n)&&(!c||s!=="length")&&(u[u.length]=s);if(hasEnumBug)for(o=nonEnumerableProps.length-1;o>=0;)s=nonEnumerableProps[o],_has(s,n)&&!contains$2(u,s)&&(u[u.length]=s),o-=1;return u});const keys$1=keys;var map$2=_curry2(_dispatchable(["fantasy-land/map","map"],_xmap$1,function(n,s){switch(Object.prototype.toString.call(s)){case"[object Function]":return curryN$1(s.length,function(){return n.call(this,s.apply(this,arguments))});case"[object Object]":return _reduce(function(o,u){return o[u]=n(s[u]),o},{},keys$1(s));default:return _map(n,s)}}));const map$3=map$2,_isInteger=Number.isInteger||function(n){return n<<0===n};var nth=_curry2(function(n,s){var o=n<0?s.length+n:n;return _isString(s)?s.charAt(o):s[o]});const nth$1=nth;var prop=_curry2(function(n,s){if(s!=null)return _isInteger(n)?nth$1(n,s):s[n]});const prop$1=prop;var pluck=_curry2(function(n,s){return map$3(prop$1(n),s)});const pluck$1=pluck;var reduce=_curry3(_reduce);const reduce$1=reduce;var always=_curry1(function(n){return function(){return n}});const always$1=always;var and=_curry2(function(n,s){return n&&s});const and$1=and;function _assoc(r,n,s){if(_isInteger(r)&&_isArray(s)){var o=[].concat(s);return o[r]=n,o}var u={};for(var c in s)u[c]=s[c];return u[r]=n,u}var isNil=_curry1(function(n){return n==null});const isNil$1=isNil;var assocPath=_curry3(function r(n,s,o){if(n.length===0)return s;var u=n[0];if(n.length>1){var c=!isNil$1(o)&&_has(u,o)?o[u]:_isInteger(n[1])?[]:{};s=r(Array.prototype.slice.call(n,1),s,c)}return _assoc(u,s,o)});const assocPath$1=assocPath;var assoc=_curry3(function(n,s,o){return assocPath$1([n],s,o)});const assoc$1=assoc;function _isFunction(r){var n=Object.prototype.toString.call(r);return n==="[object Function]"||n==="[object AsyncFunction]"||n==="[object GeneratorFunction]"||n==="[object AsyncGeneratorFunction]"}var clamp=_curry3(function(n,s,o){if(n>s)throw new Error("min must not be greater than max in clamp(min, max, value)");return o<n?n:o>s?s:o});const clamp$1=clamp;function _cloneRegExp(r){return new RegExp(r.source,(r.global?"g":"")+(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.sticky?"y":"")+(r.unicode?"u":""))}var type=_curry1(function(n){return n===null?"Null":n===void 0?"Undefined":Object.prototype.toString.call(n).slice(8,-1)});const type$1=type;function _clone(r,n,s,o){var u=function(b){for(var O=n.length,B=0;B<O;){if(r===n[B])return s[B];B+=1}n[B]=r,s[B]=b;for(var M in r)r.hasOwnProperty(M)&&(b[M]=o?_clone(r[M],n,s,!0):r[M]);return b};switch(type$1(r)){case"Object":return u(Object.create(Object.getPrototypeOf(r)));case"Array":return u([]);case"Date":return new Date(r.valueOf());case"RegExp":return _cloneRegExp(r);case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":return r.slice();default:return r}}var not=_curry1(function(n){return!n});const not$1=not;function _pipe(r,n){return function(){return n.call(this,r.apply(this,arguments))}}function _checkForMethod(r,n){return function(){var s=arguments.length;if(s===0)return n();var o=arguments[s-1];return _isArray(o)||typeof o[r]!="function"?n.apply(this,arguments):o[r].apply(o,Array.prototype.slice.call(arguments,0,s-1))}}var slice=_curry3(_checkForMethod("slice",function(n,s,o){return Array.prototype.slice.call(o,n,s)}));const slice$1=slice;var tail=_curry1(_checkForMethod("tail",slice$1(1,1/0)));const tail$1=tail;function pipe(){if(arguments.length===0)throw new Error("pipe requires at least one argument");return _arity(arguments[0].length,reduce$1(_pipe,arguments[0],tail$1(arguments)))}function _identity(r){return r}var identity=_curry1(_identity);const identity$1=identity;function _arrayFromIterator(r){for(var n=[],s;!(s=r.next()).done;)n.push(s.value);return n}function _includesWith(r,n,s){for(var o=0,u=s.length;o<u;){if(r(n,s[o]))return!0;o+=1}return!1}function _functionName(r){var n=String(r).match(/^function (\w*)/);return n==null?"":n[1]}function _objectIs(r,n){return r===n?r!==0||1/r===1/n:r!==r&&n!==n}const _objectIs$1=typeof Object.is=="function"?Object.is:_objectIs;function _uniqContentEquals(r,n,s,o){var u=_arrayFromIterator(r),c=_arrayFromIterator(n);function b(O,B){return _equals(O,B,s.slice(),o.slice())}return!_includesWith(function(O,B){return!_includesWith(b,B,O)},c,u)}function _equals(r,n,s,o){if(_objectIs$1(r,n))return!0;var u=type$1(r);if(u!==type$1(n))return!1;if(typeof r["fantasy-land/equals"]=="function"||typeof n["fantasy-land/equals"]=="function")return typeof r["fantasy-land/equals"]=="function"&&r["fantasy-land/equals"](n)&&typeof n["fantasy-land/equals"]=="function"&&n["fantasy-land/equals"](r);if(typeof r.equals=="function"||typeof n.equals=="function")return typeof r.equals=="function"&&r.equals(n)&&typeof n.equals=="function"&&n.equals(r);switch(u){case"Arguments":case"Array":case"Object":if(typeof r.constructor=="function"&&_functionName(r.constructor)==="Promise")return r===n;break;case"Boolean":case"Number":case"String":if(!(typeof r==typeof n&&_objectIs$1(r.valueOf(),n.valueOf())))return!1;break;case"Date":if(!_objectIs$1(r.valueOf(),n.valueOf()))return!1;break;case"Error":return r.name===n.name&&r.message===n.message;case"RegExp":if(!(r.source===n.source&&r.global===n.global&&r.ignoreCase===n.ignoreCase&&r.multiline===n.multiline&&r.sticky===n.sticky&&r.unicode===n.unicode))return!1;break}for(var c=s.length-1;c>=0;){if(s[c]===r)return o[c]===n;c-=1}switch(u){case"Map":return r.size!==n.size?!1:_uniqContentEquals(r.entries(),n.entries(),s.concat([r]),o.concat([n]));case"Set":return r.size!==n.size?!1:_uniqContentEquals(r.values(),n.values(),s.concat([r]),o.concat([n]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var b=keys$1(r);if(b.length!==keys$1(n).length)return!1;var O=s.concat([r]),B=o.concat([n]);for(c=b.length-1;c>=0;){var M=b[c];if(!(_has(M,n)&&_equals(n[M],r[M],O,B)))return!1;c-=1}return!0}var equals=_curry2(function(n,s){return _equals(n,s,[],[])});const equals$1=equals;function _indexOf(r,n,s){var o,u;if(typeof r.indexOf=="function")switch(typeof n){case"number":if(n===0){for(o=1/n;s<r.length;){if(u=r[s],u===0&&1/u===o)return s;s+=1}return-1}else if(n!==n){for(;s<r.length;){if(u=r[s],typeof u=="number"&&u!==u)return s;s+=1}return-1}return r.indexOf(n,s);case"string":case"boolean":case"function":case"undefined":return r.indexOf(n,s);case"object":if(n===null)return r.indexOf(n,s)}for(;s<r.length;){if(equals$1(r[s],n))return s;s+=1}return-1}function _includes(r,n){return _indexOf(n,r,0)>=0}function _quote(r){var n=r.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0");return'"'+n.replace(/"/g,'\\"')+'"'}var pad=function(n){return(n<10?"0":"")+n},_toISOString=typeof Date.prototype.toISOString=="function"?function(n){return n.toISOString()}:function(n){return n.getUTCFullYear()+"-"+pad(n.getUTCMonth()+1)+"-"+pad(n.getUTCDate())+"T"+pad(n.getUTCHours())+":"+pad(n.getUTCMinutes())+":"+pad(n.getUTCSeconds())+"."+(n.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"};const _toISOString$1=_toISOString;function _complement(r){return function(){return!r.apply(this,arguments)}}function _filter(r,n){for(var s=0,o=n.length,u=[];s<o;)r(n[s])&&(u[u.length]=n[s]),s+=1;return u}function _isObject(r){return Object.prototype.toString.call(r)==="[object Object]"}var XFilter=function(){function r(n,s){this.xf=s,this.f=n}return r.prototype["@@transducer/init"]=_xfBase.init,r.prototype["@@transducer/result"]=_xfBase.result,r.prototype["@@transducer/step"]=function(n,s){return this.f(s)?this.xf["@@transducer/step"](n,s):n},r}(),_xfilter=_curry2(function(n,s){return new XFilter(n,s)});const _xfilter$1=_xfilter;var filter$1=_curry2(_dispatchable(["fantasy-land/filter","filter"],_xfilter$1,function(r,n){return _isObject(n)?_reduce(function(s,o){return r(n[o])&&(s[o]=n[o]),s},{},keys$1(n)):_filter(r,n)}));const filter$2=filter$1;var reject=_curry2(function(n,s){return filter$2(_complement(n),s)});const reject$1=reject;function _toString(r,n){var s=function(b){var O=n.concat([r]);return _includes(b,O)?"<Circular>":_toString(b,O)},o=function(c,b){return _map(function(O){return _quote(O)+": "+s(c[O])},b.slice().sort())};switch(Object.prototype.toString.call(r)){case"[object Arguments]":return"(function() { return arguments; }("+_map(s,r).join(", ")+"))";case"[object Array]":return"["+_map(s,r).concat(o(r,reject$1(function(c){return/^\d+$/.test(c)},keys$1(r)))).join(", ")+"]";case"[object Boolean]":return typeof r=="object"?"new Boolean("+s(r.valueOf())+")":r.toString();case"[object Date]":return"new Date("+(isNaN(r.valueOf())?s(NaN):_quote(_toISOString$1(r)))+")";case"[object Null]":return"null";case"[object Number]":return typeof r=="object"?"new Number("+s(r.valueOf())+")":1/r===-1/0?"-0":r.toString(10);case"[object String]":return typeof r=="object"?"new String("+s(r.valueOf())+")":_quote(r);case"[object Undefined]":return"undefined";default:if(typeof r.toString=="function"){var u=r.toString();if(u!=="[object Object]")return u}return"{"+o(r,keys$1(r)).join(", ")+"}"}}var toString=_curry1(function(n){return _toString(n,[])});const toString$1=toString;var cond=_curry1(function(n){var s=reduce$1(max$1,0,map$3(function(o){return o[0].length},n));return _arity(s,function(){for(var o=0;o<n.length;){if(n[o][0].apply(this,arguments))return n[o][1].apply(this,arguments);o+=1}})});const cond$1=cond;var curry=_curry1(function(n){return curryN$1(n.length,n)});const curry$1=curry;var XReduceBy=function(){function r(n,s,o,u){this.valueFn=n,this.valueAcc=s,this.keyFn=o,this.xf=u,this.inputs={}}return r.prototype["@@transducer/init"]=_xfBase.init,r.prototype["@@transducer/result"]=function(n){var s;for(s in this.inputs)if(_has(s,this.inputs)&&(n=this.xf["@@transducer/step"](n,this.inputs[s]),n["@@transducer/reduced"])){n=n["@@transducer/value"];break}return this.inputs=null,this.xf["@@transducer/result"](n)},r.prototype["@@transducer/step"]=function(n,s){var o=this.keyFn(s);return this.inputs[o]=this.inputs[o]||[o,this.valueAcc],this.inputs[o][1]=this.valueFn(this.inputs[o][1],s),n},r}(),_xreduceBy=_curryN(4,[],function(n,s,o,u){return new XReduceBy(n,s,o,u)});const _xreduceBy$1=_xreduceBy;var reduceBy=_curryN(4,[],_dispatchable([],_xreduceBy$1,function(n,s,o,u){return _reduce(function(c,b){var O=o(b),B=n(_has(O,c)?c[O]:_clone(s,[],[],!1),b);return B&&B["@@transducer/reduced"]?_reduced(c):(c[O]=B,c)},{},u)}));const reduceBy$1=reduceBy;var remove$1=_curry3(function(n,s,o){var u=Array.prototype.slice.call(o,0);return u.splice(n,s),u});const remove$2=remove$1;var or=_curry2(function(n,s){return n||s});const or$1=or;function _isTypedArray(r){var n=Object.prototype.toString.call(r);return n==="[object Uint8ClampedArray]"||n==="[object Int8Array]"||n==="[object Uint8Array]"||n==="[object Int16Array]"||n==="[object Uint16Array]"||n==="[object Int32Array]"||n==="[object Uint32Array]"||n==="[object Float32Array]"||n==="[object Float64Array]"||n==="[object BigInt64Array]"||n==="[object BigUint64Array]"}var empty=_curry1(function(n){return n!=null&&typeof n["fantasy-land/empty"]=="function"?n["fantasy-land/empty"]():n!=null&&n.constructor!=null&&typeof n.constructor["fantasy-land/empty"]=="function"?n.constructor["fantasy-land/empty"]():n!=null&&typeof n.empty=="function"?n.empty():n!=null&&n.constructor!=null&&typeof n.constructor.empty=="function"?n.constructor.empty():_isArray(n)?[]:_isString(n)?"":_isObject(n)?{}:_isArguments$1(n)?function(){return arguments}():_isTypedArray(n)?n.constructor.from(""):void 0});const empty$1=empty;var evolve$1=_curry2(function r(n,s){if(!_isObject(s)&&!_isArray(s))return s;var o=s instanceof Array?[]:{},u,c,b;for(c in s)u=n[c],b=typeof u,o[c]=b==="function"?u(s[c]):u&&b==="object"?r(u,s[c]):s[c];return o});const evolve$2=evolve$1;var XFindIndex=function(){function r(n,s){this.xf=s,this.f=n,this.idx=-1,this.found=!1}return r.prototype["@@transducer/init"]=_xfBase.init,r.prototype["@@transducer/result"]=function(n){return this.found||(n=this.xf["@@transducer/step"](n,-1)),this.xf["@@transducer/result"](n)},r.prototype["@@transducer/step"]=function(n,s){return this.idx+=1,this.f(s)&&(this.found=!0,n=_reduced(this.xf["@@transducer/step"](n,this.idx))),n},r}(),_xfindIndex=_curry2(function(n,s){return new XFindIndex(n,s)});const _xfindIndex$1=_xfindIndex;var findIndex=_curry2(_dispatchable([],_xfindIndex$1,function(n,s){for(var o=0,u=s.length;o<u;){if(n(s[o]))return o;o+=1}return-1}));const findIndex$1=findIndex;var fromPairs=_curry1(function(n){for(var s={},o=0;o<n.length;)s[n[o][0]]=n[o][1],o+=1;return s});const fromPairs$1=fromPairs;var groupBy=_curry2(_checkForMethod("groupBy",reduceBy$1(function(r,n){return r.push(n),r},[])));const groupBy$1=groupBy;var insert=_curry3(function(n,s,o){n=n<o.length&&n>=0?n:o.length;var u=Array.prototype.slice.call(o,0);return u.splice(n,0,s),u});const insert$1=insert;function _objectAssign(r){if(r==null)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(r),s=1,o=arguments.length;s<o;){var u=arguments[s];if(u!=null)for(var c in u)_has(c,u)&&(n[c]=u[c]);s+=1}return n}const _objectAssign$1=typeof Object.assign=="function"?Object.assign:_objectAssign;var objOf=_curry2(function(n,s){var o={};return o[n]=s,o});const objOf$1=objOf;var invoker=_curry2(function(n,s){return curryN$1(n+1,function(){var o=arguments[n];if(o!=null&&_isFunction(o[s]))return o[s].apply(o,Array.prototype.slice.call(arguments,0,n));throw new TypeError(toString$1(o)+' does not have a method named "'+s+'"')})});const invoker$1=invoker;var is=_curry2(function(n,s){return s instanceof n||s!=null&&(s.constructor===n||n.name==="Object"&&typeof s=="object")});const is$1=is;var isEmpty=_curry1(function(n){return n!=null&&equals$1(n,empty$1(n))});const isEmpty$1=isEmpty;var lens=_curry2(function(n,s){return function(o){return function(u){return map$3(function(c){return s(c,u)},o(n(u)))}}});const lens$1=lens;var paths=_curry2(function(n,s){return n.map(function(o){for(var u=s,c=0,b;c<o.length;){if(u==null)return;b=o[c],u=_isInteger(b)?nth$1(b,u):u[b],c+=1}return u})});const paths$1=paths;var path=_curry2(function(n,s){return paths$1([n],s)[0]});const path$1=path;var mapObjIndexed=_curry2(function(n,s){return _reduce(function(o,u){return o[u]=n(s[u],u,s),o},{},keys$1(s))});const mapObjIndexed$1=mapObjIndexed;var mergeWithKey=_curry3(function(n,s,o){var u={},c;for(c in s)_has(c,s)&&(u[c]=_has(c,o)?n(c,s[c],o[c]):s[c]);for(c in o)_has(c,o)&&!_has(c,u)&&(u[c]=o[c]);return u});const mergeWithKey$1=mergeWithKey;var mergeLeft=_curry2(function(n,s){return _objectAssign$1({},s,n)});const mergeLeft$1=mergeLeft;var mergeRight=_curry2(function(n,s){return _objectAssign$1({},n,s)});const mergeRight$1=mergeRight;var mergeWith=_curry3(function(n,s,o){return mergeWithKey$1(function(u,c,b){return n(c,b)},s,o)});const mergeWith$1=mergeWith;function _modify(r,n,s){if(_isInteger(r)&&_isArray(s)){var o=[].concat(s);return o[r]=n(o[r]),o}var u={};for(var c in s)u[c]=s[c];return u[r]=n(u[r]),u}var modifyPath=_curry3(function r(n,s,o){if(!_isObject(o)&&!_isArray(o)||n.length===0)return o;var u=n[0];if(!_has(u,o))return o;if(n.length===1)return _modify(u,s,o);var c=r(Array.prototype.slice.call(n,1),s,o[u]);return c===o[u]?o:_assoc(u,c,o)});const modifyPath$1=modifyPath;var modify=_curry3(function(n,s,o){return modifyPath$1([n],s,o)});const modify$1=modify;var multiply=_curry2(function(n,s){return n*s});const multiply$1=multiply;var Identity=function(r){return{value:r,map:function(n){return Identity(n(r))}}},over=_curry3(function(n,s,o){return n(function(u){return Identity(s(u))})(o).value});const over$1=over;var pick=_curry2(function(n,s){for(var o={},u=0;u<n.length;)n[u]in s&&(o[n[u]]=s[n[u]]),u+=1;return o});const pick$1=pick;var pickBy=_curry2(function(n,s){var o={};for(var u in s)n(s[u],u,s)&&(o[u]=s[u]);return o});const pickBy$1=pickBy;var propEq=_curry3(function(n,s,o){return equals$1(s,prop$1(n,o))});const propEq$1=propEq;var props=_curry2(function(n,s){return n.map(function(o){return path$1([o],s)})});const props$1=props;var set=_curry3(function(n,s,o){return over$1(n,always$1(s),o)});const set$1=set;var sort=_curry2(function(n,s){return Array.prototype.slice.call(s,0).sort(n)});const sort$1=sort;var split=invoker$1(1,"split");const split$1=split;var toPairs=_curry1(function(n){var s=[];for(var o in n)_has(o,n)&&(s[s.length]=[o,n[o]]);return s});const toPairs$1=toPairs;var Const=function(r){return{value:r,"fantasy-land/map":function(){return this}}},view=_curry2(function(n,s){return n(Const)(s).value});const view$1=view;var zipObj=_curry2(function(n,s){for(var o=0,u=Math.min(n.length,s.length),c={};o<u;)c[n[o]]=s[o],o+=1;return c});const zipObj$1=zipObj,HilbertForward=(r,n,s)=>wasm_functions.forward(r.toString(),n,s),HilbertInverse=(r,n)=>BigInt(wasm_functions.inverse(r,n));function prod(r,n,s){if(typeof r==typeof n)return r*n;{let[o,u]=typeof r=="bigint"?[n,r]:[r,n];return BigInt(Math.round(o*10**s))*u/BigInt(10**s)}}sort$1((r,n)=>r-n);const scale$1=(r,n,s,o,u,c=9)=>prod((u-r)/(n-r),o-s,c),lerp=curry$1((r,n,s,o,u,c=identity$1)=>scale$1(r,n,s,o,c(u))+s),deepMap=curry$1((r,n)=>mapObjIndexed$1((s,o)=>or$1(is$1(Array,s),is$1(Object,s))?deepMap(r,s):r(s),n)),deepAlways=deepMap(always$1),deepObjOf=(r,n)=>assocPath$1(r,n,{}),mergePartialWith=curry$1((r,n,s)=>mergeWith$1(r,n,pick$1(keys$1(n),s)));function lerpView(r,n,s){return function(o){return lerp(...n(o),...s,o[r])}}function lerpSet(r,n,s){return function(o,u){return assoc$1(r,lerp(...s,...n(u),o),u)}}function lerpLens(r,n,s){return lens$1(lerpView(r,n,s),lerpSet(r,n,s))}function stringToPath(r){return isEmpty$1(split$1(" ",r))?[]:map$3(n=>isNaN(n)?n:Number(n),split$1(" ",r))}const pipeEvolver=(r,n)=>mergeWith$1((s,o)=>pipe(s,o),r,n);function evolve(r,n){const s={};for(const[o,u]of Object.entries(n))o in r?s[o]=r[o](u):s[o]=u;return s}const constrainEvolver=(r,n,s,o)=>cond$1([[s,always$1(n)],[T$1,always$1(pipeEvolver(n,o))]])(r),solve=curry$1((r,n,s)=>{const o=mapObjIndexed$1((u,c)=>n[c]==null?identity$1:n[c],s);//! assumes that "constraints" have been sorted in propagation order
return r.reduce((u,{predicate:c,g:b})=>constrainEvolver(s,u,c,b(u,s)),o)}),liftSolve=curry$1((r,n,s)=>evolve$2(mergePartialWith(r,n,s),s));let e=1e-6;const constraintsPreset=[{predicate:r=>r.c1-r.c0>=e,g:(r,n)=>({c0:s=>r.c1(s-e/2)-e/2,c1:s=>r.c0(s+e/2)+e/2})},{predicate:r=>r.z>=r.c1-r.c0&&r.z<=e,g:(r,n)=>({z:s=>clamp$1(e,r.c1(n.c1)-r.c0(n.c0),r.z(s))})},{predicate:r=>r.b<=r.c0+r.z/2&&r.b>=r.c1-r.z/2,g:(r,n)=>({b:s=>clamp$1(r.c0(n.c0)+r.z(n.z)/2,r.c1(n.c1)-r.z(n.z)/2,r.b(s))})},{predicate:r=>r.a<=r.b-r.z/2&&r.a>=r.b+r.z/2,g:(r,n)=>({a:s=>clamp$1(r.b(n.b)-r.z(n.z)/2,r.b(n.b)+r.z(n.z)/2,r.a(s))})}],scale=curry$1((r,n)=>evolve({x:s=>s*r,y:s=>s*r},n));curry$1((r,n,s)=>evolve({x:o=>o*r+s.x,y:o=>o*r+s.y},n));const dot=(r,n)=>r.x*n.x+r.y*n.y,norm=r=>Math.sqrt(dot(r,r)),setNorm=(r,n)=>scale(r,unit(n)),add=(r,n)=>evolve({x:s=>s+r.x,y:s=>s+r.y},n),sub=(r,n)=>evolve({x:s=>s-r.x,y:s=>s-r.y},n),unit=r=>scale(1/norm(r),r);curry$1((r,n)=>scale(dot(n,r)/norm(r),r));const projectXAB=(r,n,s)=>add(n,scale(dot(sub(n,r),sub(n,s))/norm(sub(n,s)),unit(sub(n,s))));curry$1((r,n)=>({x:2*r.x-n.x,y:2*r.y-n.y}));curry$1((r,n,s)=>({x:(r.x*(1+n)-s.x)/n,y:(r.y*(1+n)-s.y)/n}));const EventStore=writable({x:0,y:0,movementX:0,movementY:0,mouseDown:!0,mouseDiff:!0}),UIOptions=writable({noscroll:!1});EventStore.subscribe(r=>r);function liftedConstraintStore(r,n=.01){function s(M){let xe=M;return xe.z??(xe.z=M.c1-M.c0),xe.b??(xe.b=(M.c1-M.c0)/2),xe.a??(xe.a=lerp(0,1,xe.b-xe.z/2,xe.b+xe.z/2,Math.random())),xe.locked??(xe.locked=!1),xe}let o=map$3(s,fromPairs$1(r)),u=deepAlways(fromPairs$1(r));const c=writable(liftSolve(solve(constraintsPreset),u,o)),b=writable(map$3(M=>M[0],r));function O(M){c.update(liftSolve(solve(constraintsPreset),M))}function B(M){O(deepAlways(M))}return[{subscribe:c.subscribe,set:B,update:c.update,evolve:O},{subscribe:b.subscribe,set:b.set,update:b.update}]}function MuesliStore(r){const[n,s]=liftedConstraintStore(r.inputSpace),o=writable(32),u=derived([s,n],([We,nt])=>reject$1(gt=>prop$1("locked",nt[gt]),We)),c=derived([u,o],([We,nt])=>BigInt(2**(We.length*nt)-1));let b,O,B,M,xe,Ce;o.subscribe(We=>{O=We}),n.subscribe(We=>{b=We}),u.subscribe(We=>{B=We}),c.subscribe(We=>{Ce=We}),r.h_local??(r.h_local=prod(.5,Ce,9)),r.h_global??(r.h_global=prod(.5,Ce,9));const[ge,we]=[writable(r.h_local),writable(r.h_global)];we.subscribe(We=>{M=We}),ge.subscribe(We=>{xe=We});let Re=lerpLens("a",({b:We,z:nt})=>[We-nt/2,We+nt/2],[0,2**O-1]),ft=lerpLens("b",({c0:We,c1:nt,z:gt})=>[We+gt/2,nt-gt/2],[0,2**O-1]);function yt(We){Oe(always$1(clamp$1(0n,Ce,We)))}function Qe(We){Ge(always$1(clamp$1(0n,Ce,We)))}function Oe(We){ge.update(gt=>clamp$1(0n,Ce,We(gt)));let nt=zipObj$1(B,HilbertForward(xe,O,B.length));n.set(mergeWith$1(set$1(Re),nt,b))}function Ge(We){we.update(pipe(We,clamp$1(0n,Ce)));let nt=zipObj$1(B,HilbertForward(M,O,B.length));n.set(mergeWith$1(set$1(ft),nt,b))}function tt(We){ze(liftSolve(solve(constraintsPreset),pick$1(B,We)))}function ze(We){n.update(We);let[nt,gt]=[mapObjIndexed$1(view$1(ft),b),mapObjIndexed$1(view$1(Re),b)];ge.set(HilbertInverse(Uint32Array.from(props$1(B,gt)),O)),we.set(HilbertInverse(Uint32Array.from(props$1(B,nt)),O))}return[{subscribe:we.subscribe,set:Qe,update:Ge},{subscribe:ge.subscribe,set:yt,update:Oe},{subscribe:n.subscribe,set:n.set,update:ze,evolve:tt},o,u,derived(n,pluck$1("a")),c]}function AlignmentStore(r,n,s){const[o,u,c]=[writable(r),writable(n),writable(s)],b=writable(n),[O,B]=[writable(!1),writable(!1)],[M,xe,Ce]=[derived([o,u],([qe,pt])=>sub(qe,pt)),derived([o,c],([qe,pt])=>sub(qe,pt)),derived([u,c],([qe,pt])=>sub(qe,pt))],ge=writable(void 0),we=derived([o,c],([qe,pt])=>({z:qe.movementX/(qe.y-pt.y)}));let Re,ft,yt,Qe,Oe,Ge,tt,ze,We,nt;O.subscribe(qe=>{Re=qe}),B.subscribe(qe=>{ft=qe}),o.subscribe(qe=>{yt=qe}),u.subscribe(qe=>{Qe=qe}),c.subscribe(qe=>{Oe=qe}),M.subscribe(qe=>{Ge=qe}),xe.subscribe(qe=>{tt=qe}),Ce.subscribe(qe=>{ze=qe}),ge.subscribe(qe=>{}),b.subscribe(qe=>{We=qe}),we.subscribe(qe=>{nt=qe});function gt(qe){let pt=document.elementsFromPoint(Qe.x,Qe.y).filter(ct=>ct.classList.contains("thumb")||ct.classList.contains("range")),bt=pt.length>0?pt[0]:void 0;qe?ge.set(bt):ge.set(void 0),B.set(qe),b.set(Qe)}function lt(qe){wt(mergeLeft$1(qe))}function wt(qe){if(ft)if(Re){let pt=projectXAB(qe(yt),yt,Oe),bt=norm(sub(pt,Oe))<=norm(ze)+1e-5?add(Qe,setNorm(1e-5,sub(Qe,Oe))):pt;o.set(bt)}else{o.update(qe);let pt=(N,ne)=>({movementX:ne.z*(N.y-Oe.y),movementY:-ne.z*(Oe.x-N.x)}),bt=tt.y/tt.x,ct=Oe.y-Oe.x*tt.y/tt.x,R={x:(We.y-ct)/bt,y:We.y},g=pt(R,nt),H=Math.abs(tt.y)-.01>Math.abs(Oe.y-We.y)?{x:R.x+Qe.movementX,y:R.y+Qe.movementY,mXPrev:Qe.movementX,movementX:g.movementX,movementY:0}:add(yt,scale(.01,tt));u.update(mergeLeft$1(H))}else if(Re){let pt=tt;o.update(qe);let bt=norm(Ge)>=norm(pt)+.01?add(Qe,setNorm(.01,Ge)):add(yt,setNorm(norm(pt),Ge));c.set(bt)}else{let[pt,bt]=[Ge,tt];o.update(qe),u.set(add(yt,pt)),c.set(add(yt,bt))}}return[{subscribe:o.subscribe,set:lt,update:wt},{subscribe:u.subscribe,set:gt},{subscribe:c.subscribe,set:O.set},{subscribe:ge.subscribe}]}const examples=[{name:"ojack1",preset:0,inputSpace:[["oscillator_frequency",{c0:1e-4,c1:100,a:1,locked:!1}],["oscillator_offset",{c0:1e-4,c1:1,a:1,locked:!1}],["kaleidoscope_shape",{c0:1,c1:20,a:2,locked:!1}],["red",{c0:0,c1:1,a:1,locked:!1}],["green",{c0:0,c1:1,a:1,locked:!1}],["blue",{c0:0,c1:1,a:1,locked:!1}],["rotation_1",{c0:0,c1:1,a:1,locked:!1}],["rotation_2",{c0:0,c1:1,a:1,locked:!1}],["scale_factor",{c0:1e-4,c1:1,a:1,locked:!1}],["modulation_amount",{c0:1e-4,c1:1,a:1,locked:!1}]],synth:r=>n=>n.osc(r.oscillator_frequency,1/r.oscillator_frequency,r.oscillator_offset).kaleid(r.kaleidoscope_shape).color(r.red,r.green,r.blue).rotate(r.rotation_1,r.rotation_2).modulate(n.o0,r.modulation_amount).scale(r.scale_factor).out(n.o0),h_global:prod(BigInt(2**(32*10)),.1,6),h_local:prod(BigInt(2**(32*10)),.5,6)},{name:"puertas3",preset:0,inputSpace:[["oscillator_1_frequency",{c0:1e-4,c1:100,a:1,locked:!1}],["oscillator_1_offset",{c0:1e-4,c1:1,a:1,locked:!1}],["oscillator_2_frequency",{c0:1e-4,c1:100,a:1,locked:!1}],["oscillator_2_offset",{c0:1e-4,c1:1,a:1,locked:!1}],["kaleidoscope_shape",{c0:1,c1:20,a:1,locked:!1}],["repeatX",{c0:0,c1:20,a:1,locked:!1}],["repeatY",{c0:0,c1:20,a:1,locked:!1}],["modulation_amount",{c0:1e-4,c1:1,a:1,locked:!1}],["shape_modulation_sides",{c0:0,c1:20,a:1,locked:!1}],["shape_modulation_scale",{c0:1e-4,c1:10,a:1,locked:!1}],["shape_modulation_fade",{c0:0,c1:1,a:1,locked:!1}]],synth:r=>n=>n.osc(r.oscillator_1_frequency,1/r.oscillator_1_frequency,r.oscillator_1_offset).modulateScale(n.osc(r.oscillator_2_frequency,1/r.oscillator_2_frequency,r.oscillator_2_offset).kaleid(r.kaleidoscope_shape)).repeat(r.repeatX,r.repeatY).modulate(n.o0,r.modulation_amount).modulateKaleid(n.shape(r.shape_modulation_sides,r.shape_modulation_scale,r.shape_modulation_fade)).out(n.o0),h_global:prod(BigInt(2**(32*10)),.1,6),h_local:prod(BigInt(2**(32*10)),.5,6)},{name:"ojack2",preset:0,inputSpace:[["oscillator_1_frequency",{c0:1e-4,c1:100,a:1,locked:!1}],["oscillator_1_offset",{c0:1e-4,c1:1,a:1,locked:!1}],["oscillator_2_frequency",{c0:1e-4,c1:100,a:1,locked:!1}],["oscillator_2_offset",{c0:1e-4,c1:1,a:1,locked:!1}],["oscillator_2_threshold",{c0:0,c1:1,a:1,locked:!1}],["oscillator_2_rotation",{c0:0,c1:1,a:1,locked:!1}],["oscillator_3_frequency",{c0:1e-4,c1:100,a:1,locked:!1}],["oscillator_3_offset",{c0:1e-4,c1:1,a:1,locked:!1}],["oscillator_3_threshold",{c0:0,c1:1,a:1,locked:!1}],["oscillator_3_threshold_tolerance",{c0:0,c1:1,a:1,locked:!1}],["oscillator_3_modulation_amount",{c0:0,c1:1,a:1,locked:!1}],["red",{c0:0,c1:1,a:1,locked:!1}],["green",{c0:0,c1:1,a:1,locked:!1}],["blue",{c0:0,c1:1,a:1,locked:!1}],["rotation",{c0:0,c1:1,a:1,locked:!1}],["scale_factor",{c0:1e-4,c1:1,a:1,locked:!1}],["feedback_rotation",{c0:0,c1:1,a:1,locked:!1}],["feedback_modulation_amount",{c0:0,c1:1,a:1,locked:!1}]],synth:r=>n=>n.osc(r.oscillator_1_frequency,1/r.oscillator_1_frequency,r.oscillator_1_offset).modulate(n.src(n.o0).rotate(r.feedback_rotation),r.feedback_modulation_amount).color(r.red,r.green,r.blue).rotate(r.rotation,0).pixelate(.576,12.888).mult(n.osc(r.oscillator_2_frequency,1/r.oscillator_2_frequency,r.oscillator_2_offset).thresh(r.oscillator_2_threshold).rotate(r.oscillator_2_rotation,0)).modulateRotate(n.osc(r.oscillator_3_frequency,1/r.oscillator_3_frequency,r.oscillator_3_offset).thresh(r.oscillator_3_threshold,r.oscillator_3_threshold_tolerance),r.oscillator_3_modulation_amount).out(n.o0),h_global:prod(BigInt(2**(32*10)),.1,6),h_local:prod(BigInt(2**(32*10)),.5,6)},{name:"dualNoiseBW",preset:"0",inputSpace:[["frequency",{c0:1e-4,c1:100,a:1,locked:!1}],["offset",{c0:1e-4,c1:1,a:1,locked:!1}],["noise_scale",{c0:.1,c1:10,a:1,locked:!1}],["noise_scale_1",{c0:.1,c1:10,a:1,locked:!1}],["modulation_amount_1",{c0:1e-4,c1:1,a:1,locked:!1}],["modulation_amount_2",{c0:0,c1:1,a:1,locked:!1}]],synth:r=>n=>n.noise(r.noise_scale_1,1/r.noise_scale_1).modulate(n.src(n.o0).modulate(n.osc(r.frequency,1/r.frequency,r.offset),r.modulation_amount_1),r.modulation_amount_2).posterize().out(n.o0),h_global:prod(BigInt(2**(32*10)),.1,6),h_local:prod(BigInt(2**(32*10)),.5,6)},{author:"Asdr\xFAbal Gomez",name:"",preset:"",inputSpace:[["frequency",{c0:1e-4,c1:100,a:1,locked:!1}],["offset",{c0:1e-4,c1:1,a:1,locked:!1}],["noise_scale",{c0:1,c1:10,a:1,locked:!1}],["noise_scale_1",{c0:-10,c1:10,a:0,locked:!1}],["modulation_amount_1",{c0:1e-4,c1:1,a:1,locked:!1}],["modulation_amount_2",{c0:1e-4,c1:1,a:1,locked:!1}]],synth:r=>n=>n.noise(3,.1,6.157).rotate(1,-1.941,-2).mask(n.shape(20)).colorama(.959).modulateScale(n.o0).modulateScale(n.o0,.291).blend(n.o0).blend(n.o0).blend(n.o0).blend(n.o0).out(n.o0)}];/*! Kefir.js v3.8.8
 *  https://github.com/kefirjs/kefir
 */function createObj(r){var n=function(){};return n.prototype=r,new n}function extend(r){var n=arguments.length,s=void 0,o=void 0;for(s=1;s<n;s++)for(o in arguments[s])r[o]=arguments[s][o];return r}function inherit(r,n){var s=arguments.length,o=void 0;for(r.prototype=createObj(n.prototype),r.prototype.constructor=r,o=2;o<s;o++)extend(r.prototype,arguments[o]);return r}var NOTHING=["<nothing>"],END="end",VALUE="value",ERROR="error",ANY="any";function concat(r,n){var s=void 0,o=void 0,u=void 0,c=void 0;if(r.length===0)return n;if(n.length===0)return r;for(c=0,s=new Array(r.length+n.length),o=r.length,u=0;u<o;u++,c++)s[c]=r[u];for(o=n.length,u=0;u<o;u++,c++)s[c]=n[u];return s}function find(r,n){var s=r.length,o=void 0;for(o=0;o<s;o++)if(r[o]===n)return o;return-1}function findByPred(r,n){var s=r.length,o=void 0;for(o=0;o<s;o++)if(n(r[o]))return o;return-1}function cloneArray(r){var n=r.length,s=new Array(n),o=void 0;for(o=0;o<n;o++)s[o]=r[o];return s}function remove(r,n){var s=r.length,o=void 0,u=void 0,c=void 0;if(n>=0&&n<s){if(s===1)return[];for(o=new Array(s-1),u=0,c=0;u<s;u++)u!==n&&(o[c]=r[u],c++);return o}else return r}function map$1(r,n){var s=r.length,o=new Array(s),u=void 0;for(u=0;u<s;u++)o[u]=n(r[u]);return o}function forEach(r,n){var s=r.length,o=void 0;for(o=0;o<s;o++)n(r[o])}function fillArray(r,n){var s=r.length,o=void 0;for(o=0;o<s;o++)r[o]=n}function contains$1(r,n){return find(r,n)!==-1}function slide(r,n,s){var o=Math.min(s,r.length+1),u=r.length-o+1,c=new Array(o),b=void 0;for(b=u;b<o;b++)c[b-u]=r[b];return c[o-1]=n,c}function callSubscriber(r,n,s){r===ANY?n(s):r===s.type&&(r===VALUE||r===ERROR?n(s.value):n())}function Dispatcher(){this._items=[],this._spies=[],this._inLoop=0,this._removedItems=null}extend(Dispatcher.prototype,{add:function(r,n){return this._items=concat(this._items,[{type:r,fn:n}]),this._items.length},remove:function(r,n){var s=findByPred(this._items,function(o){return o.type===r&&o.fn===n});return this._inLoop!==0&&s!==-1&&(this._removedItems===null&&(this._removedItems=[]),this._removedItems.push(this._items[s])),this._items=remove(this._items,s),this._items.length},addSpy:function(r){return this._spies=concat(this._spies,[r]),this._spies.length},removeSpy:function(r){return this._spies=remove(this._spies,this._spies.indexOf(r)),this._spies.length},dispatch:function(r){this._inLoop++;for(var n=0,s=this._spies;this._spies!==null&&n<s.length;n++)s[n](r);for(var o=0,u=this._items;o<u.length&&this._items!==null;o++)this._removedItems!==null&&contains$1(this._removedItems,u[o])||callSubscriber(u[o].type,u[o].fn,r);this._inLoop--,this._inLoop===0&&(this._removedItems=null)},cleanup:function(){this._items=null,this._spies=null}});function Observable(){this._dispatcher=new Dispatcher,this._active=!1,this._alive=!0,this._activating=!1,this._logHandlers=null,this._spyHandlers=null}extend(Observable.prototype,{_name:"observable",_onActivation:function(){},_onDeactivation:function(){},_setActive:function(r){this._active!==r&&(this._active=r,r?(this._activating=!0,this._onActivation(),this._activating=!1):this._onDeactivation())},_clear:function(){this._setActive(!1),this._dispatcher.cleanup(),this._dispatcher=null,this._logHandlers=null},_emit:function(r,n){switch(r){case VALUE:return this._emitValue(n);case ERROR:return this._emitError(n);case END:return this._emitEnd()}},_emitValue:function(r){this._alive&&this._dispatcher.dispatch({type:VALUE,value:r})},_emitError:function(r){this._alive&&this._dispatcher.dispatch({type:ERROR,value:r})},_emitEnd:function(){this._alive&&(this._alive=!1,this._dispatcher.dispatch({type:END}),this._clear())},_on:function(r,n){return this._alive?(this._dispatcher.add(r,n),this._setActive(!0)):callSubscriber(r,n,{type:END}),this},_off:function(r,n){if(this._alive){var s=this._dispatcher.remove(r,n);s===0&&this._setActive(!1)}return this},onValue:function(r){return this._on(VALUE,r)},onError:function(r){return this._on(ERROR,r)},onEnd:function(r){return this._on(END,r)},onAny:function(r){return this._on(ANY,r)},offValue:function(r){return this._off(VALUE,r)},offError:function(r){return this._off(ERROR,r)},offEnd:function(r){return this._off(END,r)},offAny:function(r){return this._off(ANY,r)},observe:function(r,n,s){var o=this,u=!1,c=!r||typeof r=="function"?{value:r,error:n,end:s}:r,b=function(O){O.type===END&&(u=!0),O.type===VALUE&&c.value?c.value(O.value):O.type===ERROR&&c.error?c.error(O.value):O.type===END&&c.end&&c.end(O.value)};return this.onAny(b),{unsubscribe:function(){u||(o.offAny(b),u=!0)},get closed(){return u}}},_ofSameType:function(r,n){return r.prototype.getType()===this.getType()?r:n},setName:function(r,n){return this._name=n?r._name+"."+n:r,this},log:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.toString(),n=void 0,s=function(o){var u="<"+o.type+(n?":current":"")+">";o.type===END?console.log(r,u):console.log(r,u,o.value)};return this._alive&&(this._logHandlers||(this._logHandlers=[]),this._logHandlers.push({name:r,handler:s})),n=!0,this.onAny(s),n=!1,this},offLog:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.toString();if(this._logHandlers){var n=findByPred(this._logHandlers,function(s){return s.name===r});n!==-1&&(this.offAny(this._logHandlers[n].handler),this._logHandlers.splice(n,1))}return this},spy:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.toString(),n=function(s){var o="<"+s.type+">";s.type===END?console.log(r,o):console.log(r,o,s.value)};return this._alive&&(this._spyHandlers||(this._spyHandlers=[]),this._spyHandlers.push({name:r,handler:n}),this._dispatcher.addSpy(n)),this},offSpy:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.toString();if(this._spyHandlers){var n=findByPred(this._spyHandlers,function(s){return s.name===r});n!==-1&&(this._dispatcher.removeSpy(this._spyHandlers[n].handler),this._spyHandlers.splice(n,1))}return this}});Observable.prototype.toString=function(){return"["+this._name+"]"};function Stream(){Observable.call(this)}inherit(Stream,Observable,{_name:"stream",getType:function(){return"stream"}});function Property(){Observable.call(this),this._currentEvent=null}inherit(Property,Observable,{_name:"property",_emitValue:function(r){this._alive&&(this._currentEvent={type:VALUE,value:r},this._activating||this._dispatcher.dispatch({type:VALUE,value:r}))},_emitError:function(r){this._alive&&(this._currentEvent={type:ERROR,value:r},this._activating||this._dispatcher.dispatch({type:ERROR,value:r}))},_emitEnd:function(){this._alive&&(this._alive=!1,this._activating||this._dispatcher.dispatch({type:END}),this._clear())},_on:function(r,n){return this._alive&&(this._dispatcher.add(r,n),this._setActive(!0)),this._currentEvent!==null&&callSubscriber(r,n,this._currentEvent),this._alive||callSubscriber(r,n,{type:END}),this},getType:function(){return"property"}});var neverS=new Stream;neverS._emitEnd();neverS._name="never";function never(){return neverS}function timeBased(r){function n(s,o){var u=this;Stream.call(this),this._wait=s,this._intervalId=null,this._$onTick=function(){return u._onTick()},this._init(o)}return inherit(n,Stream,{_init:function(){},_free:function(){},_onTick:function(){},_onActivation:function(){this._intervalId=setInterval(this._$onTick,this._wait)},_onDeactivation:function(){this._intervalId!==null&&(clearInterval(this._intervalId),this._intervalId=null)},_clear:function(){Stream.prototype._clear.call(this),this._$onTick=null,this._free()}},r),n}var S=timeBased({_name:"later",_init:function(r){var n=r.x;this._x=n},_free:function(){this._x=null},_onTick:function(){this._emitValue(this._x),this._emitEnd()}});function later(r,n){return new S(r,{x:n})}var S$1=timeBased({_name:"interval",_init:function(r){var n=r.x;this._x=n},_free:function(){this._x=null},_onTick:function(){this._emitValue(this._x)}});function interval(r,n){return new S$1(r,{x:n})}var S$2=timeBased({_name:"sequentially",_init:function(r){var n=r.xs;this._xs=cloneArray(n)},_free:function(){this._xs=null},_onTick:function(){this._xs.length===1?(this._emitValue(this._xs[0]),this._emitEnd()):this._emitValue(this._xs.shift())}});function sequentially(r,n){return n.length===0?never():new S$2(r,{xs:n})}var S$3=timeBased({_name:"fromPoll",_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_onTick:function(){var r=this._fn;this._emitValue(r())}});function fromPoll(r,n){return new S$3(r,{fn:n})}function emitter(r){function n(c){return r._emitValue(c),r._active}function s(c){return r._emitError(c),r._active}function o(){return r._emitEnd(),r._active}function u(c){return r._emit(c.type,c.value),r._active}return{value:n,error:s,end:o,event:u,emit:n,emitEvent:u}}var S$4=timeBased({_name:"withInterval",_init:function(r){var n=r.fn;this._fn=n,this._emitter=emitter(this)},_free:function(){this._fn=null,this._emitter=null},_onTick:function(){var r=this._fn;r(this._emitter)}});function withInterval(r,n){return new S$4(r,{fn:n})}function S$5(r){Stream.call(this),this._fn=r,this._unsubscribe=null}inherit(S$5,Stream,{_name:"stream",_onActivation:function(){var r=this._fn,n=r(emitter(this));this._unsubscribe=typeof n=="function"?n:null,this._active||this._callUnsubscribe()},_callUnsubscribe:function(){this._unsubscribe!==null&&(this._unsubscribe(),this._unsubscribe=null)},_onDeactivation:function(){this._callUnsubscribe()},_clear:function(){Stream.prototype._clear.call(this),this._fn=null}});function stream(r){return new S$5(r)}function fromCallback(r){var n=!1;return stream(function(s){n||(r(function(o){s.emit(o),s.end()}),n=!0)}).setName("fromCallback")}function fromNodeCallback(r){var n=!1;return stream(function(s){n||(r(function(o,u){o?s.error(o):s.emit(u),s.end()}),n=!0)}).setName("fromNodeCallback")}function spread(r,n){switch(n){case 0:return function(){return r()};case 1:return function(s){return r(s[0])};case 2:return function(s){return r(s[0],s[1])};case 3:return function(s){return r(s[0],s[1],s[2])};case 4:return function(s){return r(s[0],s[1],s[2],s[3])};default:return function(s){return r.apply(null,s)}}}function apply(r,n,s){var o=s?s.length:0;if(n==null)switch(o){case 0:return r();case 1:return r(s[0]);case 2:return r(s[0],s[1]);case 3:return r(s[0],s[1],s[2]);case 4:return r(s[0],s[1],s[2],s[3]);default:return r.apply(null,s)}else switch(o){case 0:return r.call(n);default:return r.apply(n,s)}}function fromSubUnsub(r,n,s){return stream(function(o){var u=s?function(){o.emit(apply(s,this,arguments))}:function(c){o.emit(c)};return r(u),function(){return n(u)}}).setName("fromSubUnsub")}var pairs=[["addEventListener","removeEventListener"],["addListener","removeListener"],["on","off"]];function fromEvents(r,n,s){for(var o=void 0,u=void 0,c=0;c<pairs.length;c++)if(typeof r[pairs[c][0]]=="function"&&typeof r[pairs[c][1]]=="function"){o=pairs[c][0],u=pairs[c][1];break}if(o===void 0)throw new Error("target don't support any of addEventListener/removeEventListener, addListener/removeListener, on/off method pair");return fromSubUnsub(function(b){return r[o](n,b)},function(b){return r[u](n,b)},s).setName("fromEvents")}function P(r){this._currentEvent={type:"value",value:r,current:!0}}inherit(P,Property,{_name:"constant",_active:!1,_activating:!1,_alive:!1,_dispatcher:null,_logHandlers:null});function constant(r){return new P(r)}function P$1(r){this._currentEvent={type:"error",value:r,current:!0}}inherit(P$1,Property,{_name:"constantError",_active:!1,_activating:!1,_alive:!1,_dispatcher:null,_logHandlers:null});function constantError(r){return new P$1(r)}function createConstructor(r,n){return function(o,u){var c=this;r.call(this),this._source=o,this._name=o._name+"."+n,this._init(u),this._$handleAny=function(b){return c._handleAny(b)}}}function createClassMethods(r){return{_init:function(){},_free:function(){},_handleValue:function(n){this._emitValue(n)},_handleError:function(n){this._emitError(n)},_handleEnd:function(){this._emitEnd()},_handleAny:function(n){switch(n.type){case VALUE:return this._handleValue(n.value);case ERROR:return this._handleError(n.value);case END:return this._handleEnd()}},_onActivation:function(){this._source.onAny(this._$handleAny)},_onDeactivation:function(){this._source.offAny(this._$handleAny)},_clear:function(){r.prototype._clear.call(this),this._source=null,this._$handleAny=null,this._free()}}}function createStream(r,n){var s=createConstructor(Stream,r);return inherit(s,Stream,createClassMethods(Stream),n),s}function createProperty(r,n){var s=createConstructor(Property,r);return inherit(s,Property,createClassMethods(Property),n),s}var P$2=createProperty("toProperty",{_init:function(r){var n=r.fn;this._getInitialCurrent=n},_onActivation:function(){if(this._getInitialCurrent!==null){var r=this._getInitialCurrent;this._emitValue(r())}this._source.onAny(this._$handleAny)}});function toProperty(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(n!==null&&typeof n!="function")throw new Error("You should call toProperty() with a function or no arguments.");return new P$2(r,{fn:n})}var S$6=createStream("changes",{_handleValue:function(r){this._activating||this._emitValue(r)},_handleError:function(r){this._activating||this._emitError(r)}});function changes(r){return new S$6(r)}function fromPromise(r){var n=!1,s=stream(function(o){if(!n){var u=function(O){o.emit(O),o.end()},c=function(O){o.error(O),o.end()},b=r.then(u,c);b&&typeof b.done=="function"&&b.done(),n=!0}});return toProperty(s,null).setName("fromPromise")}function getGlodalPromise(){if(typeof Promise=="function")return Promise;throw new Error("There isn't default Promise, use shim or parameter")}var toPromise=function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:getGlodalPromise(),s=null;return new n(function(o,u){r.onAny(function(c){c.type===END&&s!==null?((s.type===VALUE?o:u)(s.value),s=null):s=c})})};function symbolObservablePonyfill(r){var n,s=r.Symbol;return typeof s=="function"?s.observable?n=s.observable:(n=s("observable"),s.observable=n):n="@@observable",n}var root$1;typeof self<"u"?root$1=self:typeof window<"u"?root$1=window:typeof global<"u"?root$1=global:typeof module<"u"?root$1=module:root$1=Function("return this")();var result=symbolObservablePonyfill(root$1),$$observable=result.default?result.default:result;function fromESObservable(r){var n=r[$$observable]?r[$$observable]():r;return stream(function(s){var o=n.subscribe({error:function(u){s.error(u),s.end()},next:function(u){s.emit(u)},complete:function(){s.end()}});return o.unsubscribe?function(){o.unsubscribe()}:o}).setName("fromESObservable")}function ESObservable(r){this._observable=r.takeErrors(1)}extend(ESObservable.prototype,{subscribe:function(r,n,s){var o=this,u=typeof r=="function"?{next:r,error:n,complete:s}:r,c=function(B){B.type===END&&(b=!0),B.type===VALUE&&u.next?u.next(B.value):B.type===ERROR&&u.error?u.error(B.value):B.type===END&&u.complete&&u.complete(B.value)};this._observable.onAny(c);var b=!1,O={unsubscribe:function(){b=!0,o._observable.offAny(c)},get closed(){return b}};return O}});ESObservable.prototype[$$observable]=function(){return this};function toESObservable(){return new ESObservable(this)}function collect(r,n,s){for(var o in r)r.hasOwnProperty(o)&&(n.push(o),s.push(r[o]))}function defaultErrorsCombinator(r){for(var n=void 0,s=0;s<r.length;s++)r[s]!==void 0&&(n===void 0||n.index<r[s].index)&&(n=r[s]);return n.error}function Combine(r,n,s){var o=this;Stream.call(this),this._activeCount=r.length,this._sources=concat(r,n),this._combinator=s,this._aliveCount=0,this._latestValues=new Array(this._sources.length),this._latestErrors=new Array(this._sources.length),fillArray(this._latestValues,NOTHING),this._emitAfterActivation=!1,this._endAfterActivation=!1,this._latestErrorIndex=0,this._$handlers=[];for(var u=function(b){o._$handlers.push(function(O){return o._handleAny(b,O)})},c=0;c<this._sources.length;c++)u(c)}inherit(Combine,Stream,{_name:"combine",_onActivation:function(){this._aliveCount=this._activeCount;for(var r=this._activeCount;r<this._sources.length;r++)this._sources[r].onAny(this._$handlers[r]);for(var n=0;n<this._activeCount;n++)this._sources[n].onAny(this._$handlers[n]);this._emitAfterActivation&&(this._emitAfterActivation=!1,this._emitIfFull()),this._endAfterActivation&&this._emitEnd()},_onDeactivation:function(){var r=this._sources.length,n=void 0;for(n=0;n<r;n++)this._sources[n].offAny(this._$handlers[n])},_emitIfFull:function(){for(var r=!0,n=!1,s=this._latestValues.length,o=new Array(s),u=new Array(s),c=0;c<s;c++)o[c]=this._latestValues[c],u[c]=this._latestErrors[c],o[c]===NOTHING&&(r=!1),u[c]!==void 0&&(n=!0);if(r){var b=this._combinator;this._emitValue(b(o))}n&&this._emitError(defaultErrorsCombinator(u))},_handleAny:function(r,n){n.type===VALUE||n.type===ERROR?(n.type===VALUE&&(this._latestValues[r]=n.value,this._latestErrors[r]=void 0),n.type===ERROR&&(this._latestValues[r]=NOTHING,this._latestErrors[r]={index:this._latestErrorIndex++,error:n.value}),r<this._activeCount&&(this._activating?this._emitAfterActivation=!0:this._emitIfFull())):r<this._activeCount&&(this._aliveCount--,this._aliveCount===0&&(this._activating?this._endAfterActivation=!0:this._emitEnd()))},_clear:function(){Stream.prototype._clear.call(this),this._sources=null,this._latestValues=null,this._latestErrors=null,this._combinator=null,this._$handlers=null}});function combineAsArray(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],s=arguments[2];if(!Array.isArray(n))throw new Error("Combine can only combine active and passive collections of the same type.");return s=s?spread(s,r.length+n.length):function(o){return o},r.length===0?never():new Combine(r,n,s)}function combineAsObject(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments[2];if(typeof n!="object"||Array.isArray(n))throw new Error("Combine can only combine active and passive collections of the same type.");var o=[],u=[],c=[];collect(r,o,u),collect(n,o,c);var b=function(O){for(var B={},M=O.length-1;0<=M;M--)B[o[M]]=O[M];return s?s(B):B};return u.length===0?never():new Combine(u,c,b)}function combine(r,n,s){return typeof n=="function"&&(s=n,n=void 0),Array.isArray(r)?combineAsArray(r,n,s):combineAsObject(r,n,s)}var Observable$2={empty:function(){return never()},concat:function(r,n){return r.merge(n)},of:function(r){return constant(r)},map:function(r,n){return n.map(r)},bimap:function(r,n,s){return s.mapErrors(r).map(n)},ap:function(r,n){return combine([r,n],function(s,o){return s(o)})},chain:function(r,n){return n.flatMap(r)}},staticLand=Object.freeze({Observable:Observable$2}),mixin={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleValue:function(r){var n=this._fn;this._emitValue(n(r))}},S$7=createStream("map",mixin),P$3=createProperty("map",mixin),id$1=function(r){return r};function map$1$1(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:id$1;return new(r._ofSameType(S$7,P$3))(r,{fn:n})}var mixin$1={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleValue:function(r){var n=this._fn;n(r)&&this._emitValue(r)}},S$8=createStream("filter",mixin$1),P$4=createProperty("filter",mixin$1),id$1$1=function(r){return r};function filter(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:id$1$1;return new(r._ofSameType(S$8,P$4))(r,{fn:n})}var mixin$2={_init:function(r){var n=r.n;this._n=n,n<=0&&this._emitEnd()},_handleValue:function(r){this._n!==0&&(this._n--,this._emitValue(r),this._n===0&&this._emitEnd())}},S$9=createStream("take",mixin$2),P$5=createProperty("take",mixin$2);function take(r,n){return new(r._ofSameType(S$9,P$5))(r,{n})}var mixin$3={_init:function(r){var n=r.n;this._n=n,n<=0&&this._emitEnd()},_handleError:function(r){this._n!==0&&(this._n--,this._emitError(r),this._n===0&&this._emitEnd())}},S$10=createStream("takeErrors",mixin$3),P$6=createProperty("takeErrors",mixin$3);function takeErrors(r,n){return new(r._ofSameType(S$10,P$6))(r,{n})}var mixin$4={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleValue:function(r){var n=this._fn;n(r)?this._emitValue(r):this._emitEnd()}},S$11=createStream("takeWhile",mixin$4),P$7=createProperty("takeWhile",mixin$4),id$2=function(r){return r};function takeWhile(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:id$2;return new(r._ofSameType(S$11,P$7))(r,{fn:n})}var mixin$5={_init:function(){this._lastValue=NOTHING},_free:function(){this._lastValue=null},_handleValue:function(r){this._lastValue=r},_handleEnd:function(){this._lastValue!==NOTHING&&this._emitValue(this._lastValue),this._emitEnd()}},S$12=createStream("last",mixin$5),P$8=createProperty("last",mixin$5);function last$1(r){return new(r._ofSameType(S$12,P$8))(r)}var mixin$6={_init:function(r){var n=r.n;this._n=Math.max(0,n)},_handleValue:function(r){this._n===0?this._emitValue(r):this._n--}},S$13=createStream("skip",mixin$6),P$9=createProperty("skip",mixin$6);function skip(r,n){return new(r._ofSameType(S$13,P$9))(r,{n})}var mixin$7={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleValue:function(r){var n=this._fn;this._fn!==null&&!n(r)&&(this._fn=null),this._fn===null&&this._emitValue(r)}},S$14=createStream("skipWhile",mixin$7),P$10=createProperty("skipWhile",mixin$7),id$3=function(r){return r};function skipWhile(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:id$3;return new(r._ofSameType(S$14,P$10))(r,{fn:n})}var mixin$8={_init:function(r){var n=r.fn;this._fn=n,this._prev=NOTHING},_free:function(){this._fn=null,this._prev=null},_handleValue:function(r){var n=this._fn;(this._prev===NOTHING||!n(this._prev,r))&&(this._prev=r,this._emitValue(r))}},S$15=createStream("skipDuplicates",mixin$8),P$11=createProperty("skipDuplicates",mixin$8),eq=function(r,n){return r===n};function skipDuplicates(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:eq;return new(r._ofSameType(S$15,P$11))(r,{fn:n})}var mixin$9={_init:function(r){var n=r.fn,s=r.seed;this._fn=n,this._prev=s},_free:function(){this._prev=null,this._fn=null},_handleValue:function(r){if(this._prev!==NOTHING){var n=this._fn;this._emitValue(n(this._prev,r))}this._prev=r}},S$16=createStream("diff",mixin$9),P$12=createProperty("diff",mixin$9);function defaultFn(r,n){return[r,n]}function diff(r,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:NOTHING;return new(r._ofSameType(S$16,P$12))(r,{fn:n||defaultFn,seed:s})}var P$13=createProperty("scan",{_init:function(r){var n=r.fn,s=r.seed;this._fn=n,this._seed=s,s!==NOTHING&&this._emitValue(s)},_free:function(){this._fn=null,this._seed=null},_handleValue:function(r){var n=this._fn;this._currentEvent===null||this._currentEvent.type===ERROR?this._emitValue(this._seed===NOTHING?r:n(this._seed,r)):this._emitValue(n(this._currentEvent.value,r))}});function scan(r,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:NOTHING;return new P$13(r,{fn:n,seed:s})}var mixin$10={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleValue:function(r){for(var n=this._fn,s=n(r),o=0;o<s.length;o++)this._emitValue(s[o])}},S$17=createStream("flatten",mixin$10),id$4=function(r){return r};function flatten(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:id$4;return new S$17(r,{fn:n})}var END_MARKER={},mixin$11={_init:function(r){var n=this,s=r.wait;this._wait=Math.max(0,s),this._buff=[],this._$shiftBuff=function(){var o=n._buff.shift();o===END_MARKER?n._emitEnd():n._emitValue(o)}},_free:function(){this._buff=null,this._$shiftBuff=null},_handleValue:function(r){this._activating?this._emitValue(r):(this._buff.push(r),setTimeout(this._$shiftBuff,this._wait))},_handleEnd:function(){this._activating?this._emitEnd():(this._buff.push(END_MARKER),setTimeout(this._$shiftBuff,this._wait))}},S$18=createStream("delay",mixin$11),P$14=createProperty("delay",mixin$11);function delay(r,n){return new(r._ofSameType(S$18,P$14))(r,{wait:n})}var now$2=Date.now?function(){return Date.now()}:function(){return new Date().getTime()},mixin$12={_init:function(r){var n=this,s=r.wait,o=r.leading,u=r.trailing;this._wait=Math.max(0,s),this._leading=o,this._trailing=u,this._trailingValue=null,this._timeoutId=null,this._endLater=!1,this._lastCallTime=0,this._$trailingCall=function(){return n._trailingCall()}},_free:function(){this._trailingValue=null,this._$trailingCall=null},_handleValue:function(r){if(this._activating)this._emitValue(r);else{var n=now$2();this._lastCallTime===0&&!this._leading&&(this._lastCallTime=n);var s=this._wait-(n-this._lastCallTime);s<=0?(this._cancelTrailing(),this._lastCallTime=n,this._emitValue(r)):this._trailing&&(this._cancelTrailing(),this._trailingValue=r,this._timeoutId=setTimeout(this._$trailingCall,s))}},_handleEnd:function(){this._activating?this._emitEnd():this._timeoutId?this._endLater=!0:this._emitEnd()},_cancelTrailing:function(){this._timeoutId!==null&&(clearTimeout(this._timeoutId),this._timeoutId=null)},_trailingCall:function(){this._emitValue(this._trailingValue),this._timeoutId=null,this._trailingValue=null,this._lastCallTime=this._leading?now$2():0,this._endLater&&this._emitEnd()}},S$19=createStream("throttle",mixin$12),P$15=createProperty("throttle",mixin$12);function throttle(r,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.leading,u=o===void 0?!0:o,c=s.trailing,b=c===void 0?!0:c;return new(r._ofSameType(S$19,P$15))(r,{wait:n,leading:u,trailing:b})}var mixin$13={_init:function(r){var n=this,s=r.wait,o=r.immediate;this._wait=Math.max(0,s),this._immediate=o,this._lastAttempt=0,this._timeoutId=null,this._laterValue=null,this._endLater=!1,this._$later=function(){return n._later()}},_free:function(){this._laterValue=null,this._$later=null},_handleValue:function(r){this._activating?this._emitValue(r):(this._lastAttempt=now$2(),this._immediate&&!this._timeoutId&&this._emitValue(r),this._timeoutId||(this._timeoutId=setTimeout(this._$later,this._wait)),this._immediate||(this._laterValue=r))},_handleEnd:function(){this._activating?this._emitEnd():this._timeoutId&&!this._immediate?this._endLater=!0:this._emitEnd()},_later:function(){var r=now$2()-this._lastAttempt;if(r<this._wait&&r>=0)this._timeoutId=setTimeout(this._$later,this._wait-r);else{if(this._timeoutId=null,!this._immediate){var n=this._laterValue;this._laterValue=null,this._emitValue(n)}this._endLater&&this._emitEnd()}}},S$20=createStream("debounce",mixin$13),P$16=createProperty("debounce",mixin$13);function debounce(r,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.immediate,u=o===void 0?!1:o;return new(r._ofSameType(S$20,P$16))(r,{wait:n,immediate:u})}var mixin$14={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleError:function(r){var n=this._fn;this._emitError(n(r))}},S$21=createStream("mapErrors",mixin$14),P$17=createProperty("mapErrors",mixin$14),id$5=function(r){return r};function mapErrors(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:id$5;return new(r._ofSameType(S$21,P$17))(r,{fn:n})}var mixin$15={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleError:function(r){var n=this._fn;n(r)&&this._emitError(r)}},S$22=createStream("filterErrors",mixin$15),P$18=createProperty("filterErrors",mixin$15),id$6=function(r){return r};function filterErrors(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:id$6;return new(r._ofSameType(S$22,P$18))(r,{fn:n})}var mixin$16={_handleValue:function(){}},S$23=createStream("ignoreValues",mixin$16),P$19=createProperty("ignoreValues",mixin$16);function ignoreValues(r){return new(r._ofSameType(S$23,P$19))(r)}var mixin$17={_handleError:function(){}},S$24=createStream("ignoreErrors",mixin$17),P$20=createProperty("ignoreErrors",mixin$17);function ignoreErrors(r){return new(r._ofSameType(S$24,P$20))(r)}var mixin$18={_handleEnd:function(){}},S$25=createStream("ignoreEnd",mixin$18),P$21=createProperty("ignoreEnd",mixin$18);function ignoreEnd(r){return new(r._ofSameType(S$25,P$21))(r)}var mixin$19={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleEnd:function(){var r=this._fn;this._emitValue(r()),this._emitEnd()}},S$26=createStream("beforeEnd",mixin$19),P$22=createProperty("beforeEnd",mixin$19);function beforeEnd(r,n){return new(r._ofSameType(S$26,P$22))(r,{fn:n})}var mixin$20={_init:function(r){var n=r.min,s=r.max;this._max=s,this._min=n,this._buff=[]},_free:function(){this._buff=null},_handleValue:function(r){this._buff=slide(this._buff,r,this._max),this._buff.length>=this._min&&this._emitValue(this._buff)}},S$27=createStream("slidingWindow",mixin$20),P$23=createProperty("slidingWindow",mixin$20);function slidingWindow(r,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return new(r._ofSameType(S$27,P$23))(r,{min:s,max:n})}var mixin$21={_init:function(r){var n=r.fn,s=r.flushOnEnd;this._fn=n,this._flushOnEnd=s,this._buff=[]},_free:function(){this._buff=null},_flush:function(){this._buff!==null&&this._buff.length!==0&&(this._emitValue(this._buff),this._buff=[])},_handleValue:function(r){this._buff.push(r);var n=this._fn;n(r)||this._flush()},_handleEnd:function(){this._flushOnEnd&&this._flush(),this._emitEnd()}},S$28=createStream("bufferWhile",mixin$21),P$24=createProperty("bufferWhile",mixin$21),id$7=function(r){return r};function bufferWhile(r,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.flushOnEnd,u=o===void 0?!0:o;return new(r._ofSameType(S$28,P$24))(r,{fn:n||id$7,flushOnEnd:u})}var mixin$22={_init:function(r){var n=r.count,s=r.flushOnEnd;this._count=n,this._flushOnEnd=s,this._buff=[]},_free:function(){this._buff=null},_flush:function(){this._buff!==null&&this._buff.length!==0&&(this._emitValue(this._buff),this._buff=[])},_handleValue:function(r){this._buff.push(r),this._buff.length>=this._count&&this._flush()},_handleEnd:function(){this._flushOnEnd&&this._flush(),this._emitEnd()}},S$29=createStream("bufferWithCount",mixin$22),P$25=createProperty("bufferWithCount",mixin$22);function bufferWhile$1(r,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.flushOnEnd,u=o===void 0?!0:o;return new(r._ofSameType(S$29,P$25))(r,{count:n,flushOnEnd:u})}var mixin$23={_init:function(r){var n=this,s=r.wait,o=r.count,u=r.flushOnEnd;this._wait=s,this._count=o,this._flushOnEnd=u,this._intervalId=null,this._$onTick=function(){return n._flush()},this._buff=[]},_free:function(){this._$onTick=null,this._buff=null},_flush:function(){this._buff!==null&&(this._emitValue(this._buff),this._buff=[])},_handleValue:function(r){this._buff.push(r),this._buff.length>=this._count&&(clearInterval(this._intervalId),this._flush(),this._intervalId=setInterval(this._$onTick,this._wait))},_handleEnd:function(){this._flushOnEnd&&this._buff.length!==0&&this._flush(),this._emitEnd()},_onActivation:function(){this._intervalId=setInterval(this._$onTick,this._wait),this._source.onAny(this._$handleAny)},_onDeactivation:function(){this._intervalId!==null&&(clearInterval(this._intervalId),this._intervalId=null),this._source.offAny(this._$handleAny)}},S$30=createStream("bufferWithTimeOrCount",mixin$23),P$26=createProperty("bufferWithTimeOrCount",mixin$23);function bufferWithTimeOrCount(r,n,s){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},u=o.flushOnEnd,c=u===void 0?!0:u;return new(r._ofSameType(S$30,P$26))(r,{wait:n,count:s,flushOnEnd:c})}function xformForObs(r){return{"@@transducer/step":function(n,s){return r._emitValue(s),null},"@@transducer/result":function(){return r._emitEnd(),null}}}var mixin$24={_init:function(r){var n=r.transducer;this._xform=n(xformForObs(this))},_free:function(){this._xform=null},_handleValue:function(r){this._xform["@@transducer/step"](null,r)!==null&&this._xform["@@transducer/result"](null)},_handleEnd:function(){this._xform["@@transducer/result"](null)}},S$31=createStream("transduce",mixin$24),P$27=createProperty("transduce",mixin$24);function transduce(r,n){return new(r._ofSameType(S$31,P$27))(r,{transducer:n})}var mixin$25={_init:function(r){var n=r.fn;this._handler=n,this._emitter=emitter(this)},_free:function(){this._handler=null,this._emitter=null},_handleAny:function(r){this._handler(this._emitter,r)}},S$32=createStream("withHandler",mixin$25),P$28=createProperty("withHandler",mixin$25);function withHandler(r,n){return new(r._ofSameType(S$32,P$28))(r,{fn:n})}var isArray=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};function Zip(r,n){var s=this;Stream.call(this),this._buffers=map$1(r,function(c){return isArray(c)?cloneArray(c):[]}),this._sources=map$1(r,function(c){return isArray(c)?never():c}),this._combinator=n?spread(n,this._sources.length):function(c){return c},this._aliveCount=0,this._$handlers=[];for(var o=function(c){s._$handlers.push(function(b){return s._handleAny(c,b)})},u=0;u<this._sources.length;u++)o(u)}inherit(Zip,Stream,{_name:"zip",_onActivation:function(){for(;this._isFull();)this._emit();var r=this._sources.length;this._aliveCount=r;for(var n=0;n<r&&this._active;n++)this._sources[n].onAny(this._$handlers[n])},_onDeactivation:function(){for(var r=0;r<this._sources.length;r++)this._sources[r].offAny(this._$handlers[r])},_emit:function(){for(var r=new Array(this._buffers.length),n=0;n<this._buffers.length;n++)r[n]=this._buffers[n].shift();var s=this._combinator;this._emitValue(s(r))},_isFull:function(){for(var r=0;r<this._buffers.length;r++)if(this._buffers[r].length===0)return!1;return!0},_handleAny:function(r,n){n.type===VALUE&&(this._buffers[r].push(n.value),this._isFull()&&this._emit()),n.type===ERROR&&this._emitError(n.value),n.type===END&&(this._aliveCount--,this._aliveCount===0&&this._emitEnd())},_clear:function(){Stream.prototype._clear.call(this),this._sources=null,this._buffers=null,this._combinator=null,this._$handlers=null}});function zip(r,n){return r.length===0?never():new Zip(r,n)}var id$8=function(r){return r};function AbstractPool(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=n.queueLim,o=s===void 0?0:s,u=n.concurLim,c=u===void 0?-1:u,b=n.drop,O=b===void 0?"new":b;Stream.call(this),this._queueLim=o<0?-1:o,this._concurLim=c<0?-1:c,this._drop=O,this._queue=[],this._curSources=[],this._$handleSubAny=function(B){return r._handleSubAny(B)},this._$endHandlers=[],this._currentlyAdding=null,this._concurLim===0&&this._emitEnd()}inherit(AbstractPool,Stream,{_name:"abstractPool",_add:function(r,n){n=n||id$8,this._concurLim===-1||this._curSources.length<this._concurLim?this._addToCur(n(r)):this._queueLim===-1||this._queue.length<this._queueLim?this._addToQueue(n(r)):this._drop==="old"&&(this._removeOldest(),this._add(r,n))},_addAll:function(r){var n=this;forEach(r,function(s){return n._add(s)})},_remove:function(r){this._removeCur(r)===-1&&this._removeQueue(r)},_addToQueue:function(r){this._queue=concat(this._queue,[r])},_addToCur:function(r){if(this._active){if(!r._alive){r._currentEvent&&this._emit(r._currentEvent.type,r._currentEvent.value),this._active&&(this._queue.length!==0?this._pullQueue():this._curSources.length===0&&this._onEmpty());return}this._currentlyAdding=r,r.onAny(this._$handleSubAny),this._currentlyAdding=null,r._alive?(this._curSources=concat(this._curSources,[r]),this._active&&this._subToEnd(r)):this._queue.length!==0?this._pullQueue():this._curSources.length===0&&this._onEmpty()}else this._curSources=concat(this._curSources,[r])},_subToEnd:function(r){var n=this,s=function(){return n._removeCur(r)};this._$endHandlers.push({obs:r,handler:s}),r.onEnd(s)},_subscribe:function(r){r.onAny(this._$handleSubAny),this._active&&this._subToEnd(r)},_unsubscribe:function(r){r.offAny(this._$handleSubAny);var n=findByPred(this._$endHandlers,function(s){return s.obs===r});n!==-1&&(r.offEnd(this._$endHandlers[n].handler),this._$endHandlers.splice(n,1))},_handleSubAny:function(r){r.type===VALUE?this._emitValue(r.value):r.type===ERROR&&this._emitError(r.value)},_removeQueue:function(r){var n=find(this._queue,r);return this._queue=remove(this._queue,n),n},_removeCur:function(r){this._active&&this._unsubscribe(r);var n=find(this._curSources,r);return this._curSources=remove(this._curSources,n),n!==-1&&(this._queue.length!==0?this._pullQueue():this._curSources.length===0&&this._onEmpty()),n},_removeOldest:function(){this._removeCur(this._curSources[0])},_pullQueue:function(){this._queue.length!==0&&(this._queue=cloneArray(this._queue),this._addToCur(this._queue.shift()))},_onActivation:function(){for(var r=0,n=this._curSources;r<n.length&&this._active;r++)this._subscribe(n[r])},_onDeactivation:function(){for(var r=0,n=this._curSources;r<n.length;r++)this._unsubscribe(n[r]);this._currentlyAdding!==null&&this._unsubscribe(this._currentlyAdding)},_isEmpty:function(){return this._curSources.length===0},_onEmpty:function(){},_clear:function(){Stream.prototype._clear.call(this),this._queue=null,this._curSources=null,this._$handleSubAny=null,this._$endHandlers=null}});function Merge(r){AbstractPool.call(this),this._addAll(r),this._initialised=!0}inherit(Merge,AbstractPool,{_name:"merge",_onEmpty:function(){this._initialised&&this._emitEnd()}});function merge(r){return r.length===0?never():new Merge(r)}function S$33(r){var n=this;Stream.call(this),this._generator=r,this._source=null,this._inLoop=!1,this._iteration=0,this._$handleAny=function(s){return n._handleAny(s)}}inherit(S$33,Stream,{_name:"repeat",_handleAny:function(r){r.type===END?(this._source=null,this._getSource()):this._emit(r.type,r.value)},_getSource:function(){if(!this._inLoop){this._inLoop=!0;for(var r=this._generator;this._source===null&&this._alive&&this._active;)this._source=r(this._iteration++),this._source?this._source.onAny(this._$handleAny):this._emitEnd();this._inLoop=!1}},_onActivation:function(){this._source?this._source.onAny(this._$handleAny):this._getSource()},_onDeactivation:function(){this._source&&this._source.offAny(this._$handleAny)},_clear:function(){Stream.prototype._clear.call(this),this._generator=null,this._source=null,this._$handleAny=null}});var repeat=function(r){return new S$33(r)};function concat$1(r){return repeat(function(n){return r.length>n?r[n]:!1}).setName("concat")}function Pool(){AbstractPool.call(this)}inherit(Pool,AbstractPool,{_name:"pool",plug:function(r){return this._add(r),this},unplug:function(r){return this._remove(r),this}});function FlatMap(r,n,s){var o=this;AbstractPool.call(this,s),this._source=r,this._fn=n,this._mainEnded=!1,this._lastCurrent=null,this._$handleMain=function(u){return o._handleMain(u)}}inherit(FlatMap,AbstractPool,{_onActivation:function(){AbstractPool.prototype._onActivation.call(this),this._active&&this._source.onAny(this._$handleMain)},_onDeactivation:function(){AbstractPool.prototype._onDeactivation.call(this),this._source.offAny(this._$handleMain),this._hadNoEvSinceDeact=!0},_handleMain:function(r){if(r.type===VALUE){var n=this._activating&&this._hadNoEvSinceDeact&&this._lastCurrent===r.value;n||this._add(r.value,this._fn),this._lastCurrent=r.value,this._hadNoEvSinceDeact=!1}r.type===ERROR&&this._emitError(r.value),r.type===END&&(this._isEmpty()?this._emitEnd():this._mainEnded=!0)},_onEmpty:function(){this._mainEnded&&this._emitEnd()},_clear:function(){AbstractPool.prototype._clear.call(this),this._source=null,this._lastCurrent=null,this._$handleMain=null}});function FlatMapErrors(r,n){FlatMap.call(this,r,n)}inherit(FlatMapErrors,FlatMap,{_handleMain:function(r){if(r.type===ERROR){var n=this._activating&&this._hadNoEvSinceDeact&&this._lastCurrent===r.value;n||this._add(r.value,this._fn),this._lastCurrent=r.value,this._hadNoEvSinceDeact=!1}r.type===VALUE&&this._emitValue(r.value),r.type===END&&(this._isEmpty()?this._emitEnd():this._mainEnded=!0)}});function createConstructor$1(r,n){return function(o,u,c){var b=this;r.call(this),this._primary=o,this._secondary=u,this._name=o._name+"."+n,this._lastSecondary=NOTHING,this._$handleSecondaryAny=function(O){return b._handleSecondaryAny(O)},this._$handlePrimaryAny=function(O){return b._handlePrimaryAny(O)},this._init(c)}}function createClassMethods$1(r){return{_init:function(){},_free:function(){},_handlePrimaryValue:function(n){this._emitValue(n)},_handlePrimaryError:function(n){this._emitError(n)},_handlePrimaryEnd:function(){this._emitEnd()},_handleSecondaryValue:function(n){this._lastSecondary=n},_handleSecondaryError:function(n){this._emitError(n)},_handleSecondaryEnd:function(){},_handlePrimaryAny:function(n){switch(n.type){case VALUE:return this._handlePrimaryValue(n.value);case ERROR:return this._handlePrimaryError(n.value);case END:return this._handlePrimaryEnd(n.value)}},_handleSecondaryAny:function(n){switch(n.type){case VALUE:return this._handleSecondaryValue(n.value);case ERROR:return this._handleSecondaryError(n.value);case END:this._handleSecondaryEnd(n.value),this._removeSecondary()}},_removeSecondary:function(){this._secondary!==null&&(this._secondary.offAny(this._$handleSecondaryAny),this._$handleSecondaryAny=null,this._secondary=null)},_onActivation:function(){this._secondary!==null&&this._secondary.onAny(this._$handleSecondaryAny),this._active&&this._primary.onAny(this._$handlePrimaryAny)},_onDeactivation:function(){this._secondary!==null&&this._secondary.offAny(this._$handleSecondaryAny),this._primary.offAny(this._$handlePrimaryAny)},_clear:function(){r.prototype._clear.call(this),this._primary=null,this._secondary=null,this._lastSecondary=null,this._$handleSecondaryAny=null,this._$handlePrimaryAny=null,this._free()}}}function createStream$1(r,n){var s=createConstructor$1(Stream,r);return inherit(s,Stream,createClassMethods$1(Stream),n),s}function createProperty$1(r,n){var s=createConstructor$1(Property,r);return inherit(s,Property,createClassMethods$1(Property),n),s}var mixin$26={_handlePrimaryValue:function(r){this._lastSecondary!==NOTHING&&this._lastSecondary&&this._emitValue(r)},_handleSecondaryEnd:function(){(this._lastSecondary===NOTHING||!this._lastSecondary)&&this._emitEnd()}},S$34=createStream$1("filterBy",mixin$26),P$29=createProperty$1("filterBy",mixin$26);function filterBy(r,n){return new(r._ofSameType(S$34,P$29))(r,n)}var id2=function(r,n){return n};function sampledBy(r,n,s){var o=s?function(u,c){return s(c,u)}:id2;return combine([n],[r],o).setName(r,"sampledBy")}var mixin$27={_handlePrimaryValue:function(r){this._lastSecondary!==NOTHING&&this._emitValue(r)},_handleSecondaryEnd:function(){this._lastSecondary===NOTHING&&this._emitEnd()}},S$35=createStream$1("skipUntilBy",mixin$27),P$30=createProperty$1("skipUntilBy",mixin$27);function skipUntilBy(r,n){return new(r._ofSameType(S$35,P$30))(r,n)}var mixin$28={_handleSecondaryValue:function(){this._emitEnd()}},S$36=createStream$1("takeUntilBy",mixin$28),P$31=createProperty$1("takeUntilBy",mixin$28);function takeUntilBy(r,n){return new(r._ofSameType(S$36,P$31))(r,n)}var mixin$29={_init:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=r.flushOnEnd,s=n===void 0?!0:n;this._buff=[],this._flushOnEnd=s},_free:function(){this._buff=null},_flush:function(){this._buff!==null&&(this._emitValue(this._buff),this._buff=[])},_handlePrimaryEnd:function(){this._flushOnEnd&&this._flush(),this._emitEnd()},_onActivation:function(){this._primary.onAny(this._$handlePrimaryAny),this._alive&&this._secondary!==null&&this._secondary.onAny(this._$handleSecondaryAny)},_handlePrimaryValue:function(r){this._buff.push(r)},_handleSecondaryValue:function(){this._flush()},_handleSecondaryEnd:function(){this._flushOnEnd||this._emitEnd()}},S$37=createStream$1("bufferBy",mixin$29),P$32=createProperty$1("bufferBy",mixin$29);function bufferBy(r,n,s){return new(r._ofSameType(S$37,P$32))(r,n,s)}var mixin$30={_init:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=r.flushOnEnd,s=n===void 0?!0:n,o=r.flushOnChange,u=o===void 0?!1:o;this._buff=[],this._flushOnEnd=s,this._flushOnChange=u},_free:function(){this._buff=null},_flush:function(){this._buff!==null&&(this._emitValue(this._buff),this._buff=[])},_handlePrimaryEnd:function(){this._flushOnEnd&&this._flush(),this._emitEnd()},_handlePrimaryValue:function(r){this._buff.push(r),this._lastSecondary!==NOTHING&&!this._lastSecondary&&this._flush()},_handleSecondaryEnd:function(){!this._flushOnEnd&&(this._lastSecondary===NOTHING||this._lastSecondary)&&this._emitEnd()},_handleSecondaryValue:function(r){this._flushOnChange&&!r&&this._flush(),this._lastSecondary=r}},S$38=createStream$1("bufferWhileBy",mixin$30),P$33=createProperty$1("bufferWhileBy",mixin$30);function bufferWhileBy(r,n,s){return new(r._ofSameType(S$38,P$33))(r,n,s)}var f=function(){return!1},t=function(){return!0};function awaiting(r,n){var s=merge([map$1$1(r,t),map$1$1(n,f)]);return s=skipDuplicates(s),s=toProperty(s,f),s.setName(r,"awaiting")}var mixin$31={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleValue:function(r){var n=this._fn,s=n(r);s.convert?this._emitError(s.error):this._emitValue(r)}},S$39=createStream("valuesToErrors",mixin$31),P$34=createProperty("valuesToErrors",mixin$31),defFn=function(r){return{convert:!0,error:r}};function valuesToErrors(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:defFn;return new(r._ofSameType(S$39,P$34))(r,{fn:n})}var mixin$32={_init:function(r){var n=r.fn;this._fn=n},_free:function(){this._fn=null},_handleError:function(r){var n=this._fn,s=n(r);s.convert?this._emitValue(s.value):this._emitError(r)}},S$40=createStream("errorsToValues",mixin$32),P$35=createProperty("errorsToValues",mixin$32),defFn$1=function(r){return{convert:!0,value:r}};function errorsToValues(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:defFn$1;return new(r._ofSameType(S$40,P$35))(r,{fn:n})}var mixin$33={_handleError:function(r){this._emitError(r),this._emitEnd()}},S$41=createStream("endOnError",mixin$33),P$36=createProperty("endOnError",mixin$33);function endOnError(r){return new(r._ofSameType(S$41,P$36))(r)}Observable.prototype.toProperty=function(r){return toProperty(this,r)};Observable.prototype.changes=function(){return changes(this)};Observable.prototype.toPromise=function(r){return toPromise(this,r)};Observable.prototype.toESObservable=toESObservable;Observable.prototype[$$observable]=toESObservable;Observable.prototype.map=function(r){return map$1$1(this,r)};Observable.prototype.filter=function(r){return filter(this,r)};Observable.prototype.take=function(r){return take(this,r)};Observable.prototype.takeErrors=function(r){return takeErrors(this,r)};Observable.prototype.takeWhile=function(r){return takeWhile(this,r)};Observable.prototype.last=function(){return last$1(this)};Observable.prototype.skip=function(r){return skip(this,r)};Observable.prototype.skipWhile=function(r){return skipWhile(this,r)};Observable.prototype.skipDuplicates=function(r){return skipDuplicates(this,r)};Observable.prototype.diff=function(r,n){return diff(this,r,n)};Observable.prototype.scan=function(r,n){return scan(this,r,n)};Observable.prototype.flatten=function(r){return flatten(this,r)};Observable.prototype.delay=function(r){return delay(this,r)};Observable.prototype.throttle=function(r,n){return throttle(this,r,n)};Observable.prototype.debounce=function(r,n){return debounce(this,r,n)};Observable.prototype.mapErrors=function(r){return mapErrors(this,r)};Observable.prototype.filterErrors=function(r){return filterErrors(this,r)};Observable.prototype.ignoreValues=function(){return ignoreValues(this)};Observable.prototype.ignoreErrors=function(){return ignoreErrors(this)};Observable.prototype.ignoreEnd=function(){return ignoreEnd(this)};Observable.prototype.beforeEnd=function(r){return beforeEnd(this,r)};Observable.prototype.slidingWindow=function(r,n){return slidingWindow(this,r,n)};Observable.prototype.bufferWhile=function(r,n){return bufferWhile(this,r,n)};Observable.prototype.bufferWithCount=function(r,n){return bufferWhile$1(this,r,n)};Observable.prototype.bufferWithTimeOrCount=function(r,n,s){return bufferWithTimeOrCount(this,r,n,s)};Observable.prototype.transduce=function(r){return transduce(this,r)};Observable.prototype.withHandler=function(r){return withHandler(this,r)};Observable.prototype.thru=function(r){return r(this)};Observable.prototype.combine=function(r,n){return combine([this,r],n)};Observable.prototype.zip=function(r,n){return zip([this,r],n)};Observable.prototype.merge=function(r){return merge([this,r])};Observable.prototype.concat=function(r){return concat$1([this,r])};var pool=function(){return new Pool};Observable.prototype.flatMap=function(r){return new FlatMap(this,r).setName(this,"flatMap")};Observable.prototype.flatMapLatest=function(r){return new FlatMap(this,r,{concurLim:1,drop:"old"}).setName(this,"flatMapLatest")};Observable.prototype.flatMapFirst=function(r){return new FlatMap(this,r,{concurLim:1}).setName(this,"flatMapFirst")};Observable.prototype.flatMapConcat=function(r){return new FlatMap(this,r,{queueLim:-1,concurLim:1}).setName(this,"flatMapConcat")};Observable.prototype.flatMapConcurLimit=function(r,n){return new FlatMap(this,r,{queueLim:-1,concurLim:n}).setName(this,"flatMapConcurLimit")};Observable.prototype.flatMapErrors=function(r){return new FlatMapErrors(this,r).setName(this,"flatMapErrors")};Observable.prototype.filterBy=function(r){return filterBy(this,r)};Observable.prototype.sampledBy=function(r,n){return sampledBy(this,r,n)};Observable.prototype.skipUntilBy=function(r){return skipUntilBy(this,r)};Observable.prototype.takeUntilBy=function(r){return takeUntilBy(this,r)};Observable.prototype.bufferBy=function(r,n){return bufferBy(this,r,n)};Observable.prototype.bufferWhileBy=function(r,n){return bufferWhileBy(this,r,n)};function warn(r){if(console&&typeof console.warn=="function"){var n=`
Here is an Error object for you containing the call stack:`;console.warn(r,n,new Error)}}Observable.prototype.awaiting=function(r){return warn("You are using deprecated .awaiting() method, see https://github.com/kefirjs/kefir/issues/145"),awaiting(this,r)};Observable.prototype.valuesToErrors=function(r){return warn("You are using deprecated .valuesToErrors() method, see https://github.com/kefirjs/kefir/issues/149"),valuesToErrors(this,r)};Observable.prototype.errorsToValues=function(r){return warn("You are using deprecated .errorsToValues() method, see https://github.com/kefirjs/kefir/issues/149"),errorsToValues(this,r)};Observable.prototype.endOnError=function(){return warn("You are using deprecated .endOnError() method, see https://github.com/kefirjs/kefir/issues/150"),endOnError(this)};var Kefir={Observable,Stream,Property,never,later,interval,sequentially,fromPoll,withInterval,fromCallback,fromNodeCallback,fromEvents,stream,constant,constantError,fromPromise,fromESObservable,combine,zip,merge,concat:concat$1,Pool,pool,repeat,staticLand};Kefir.Kefir=Kefir;const mousedown_=Kefir.fromEvents(window,"mousedown"),mouseup_=Kefir.fromEvents(window,"mouseup"),shiftdown_=Kefir.fromEvents(window,"keydown").filter(r=>r.shiftKey),shiftup_=Kefir.fromEvents(window,"keyup"),mousemove_=Kefir.fromEvents(window,"mousemove"),mousewheel_=Kefir.fromEvents(window,"wheel"),capture=(r,n)=>n.map(s=>assoc$1("capture",r,s)).flatMap(s=>Kefir.constant(s)),asr=(r,n,s)=>r.flatMap(o=>Kefir.constant(o).sampledBy(n,(u,c)=>assoc$1("atk",u,c)).takeUntilBy(s));asr(mousedown_,Kefir.interval(10,{movementX:"test"}),mouseup_);const obs=r=>n=>n.onValue(s=>r(s)),drag_=asr(mousedown_,mousemove_,mouseup_);var Output=function({regl:r,precision:n,label:s="",width:o,height:u}){this.regl=r,this.precision=n,this.label=s,this.positionBuffer=this.regl.buffer([[-2,0],[0,-2],[2,2]]),this.draw=()=>{},this.init(),this.pingPongIndex=0,this.fbos=Array(2).fill().map(()=>this.regl.framebuffer({color:this.regl.texture({mag:"nearest",width:o,height:u,format:"rgba"}),depthStencil:!1}))};Output.prototype.resize=function(r,n){this.fbos.forEach(s=>{s.resize(r,n)})};Output.prototype.getCurrent=function(){return this.fbos[this.pingPongIndex]};Output.prototype.getTexture=function(){var r=this.pingPongIndex?0:1;return this.fbos[r]};Output.prototype.init=function(){return this.transformIndex=0,this.fragHeader=`
  precision ${this.precision} float;

  uniform float time;
  varying vec2 uv;
  `,this.fragBody="",this.vert=`
  precision ${this.precision} float;
  attribute vec2 position;
  varying vec2 uv;

  void main () {
    uv = position;
    gl_Position = vec4(2.0 * position - 1.0, 0, 1);
  }`,this.attributes={position:this.positionBuffer},this.uniforms={time:this.regl.prop("time"),resolution:this.regl.prop("resolution")},this.frag=`
       ${this.fragHeader}

      void main () {
        vec4 c = vec4(0, 0, 0, 0);
        vec2 st = uv;
        ${this.fragBody}
        gl_FragColor = c;
      }
  `,this};Output.prototype.render=function(r){let n=r[0];var s=this,o=Object.assign(n.uniforms,{prevBuffer:()=>s.fbos[s.pingPongIndex]});s.draw=s.regl({frag:n.frag,vert:s.vert,attributes:s.attributes,uniforms:o,count:3,framebuffer:()=>(s.pingPongIndex=s.pingPongIndex?0:1,s.fbos[s.pingPongIndex])})};Output.prototype.tick=function(r){this.draw(r)};var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var inherits_browser={exports:{}};typeof Object.create=="function"?inherits_browser.exports=function(n,s){s&&(n.super_=s,n.prototype=Object.create(s.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(n,s){if(s){n.super_=s;var o=function(){};o.prototype=s.prototype,n.prototype=new o,n.prototype.constructor=n}};function EventEmitter$1(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var events=EventEmitter$1;EventEmitter$1.EventEmitter=EventEmitter$1;EventEmitter$1.prototype._events=void 0;EventEmitter$1.prototype._maxListeners=void 0;EventEmitter$1.defaultMaxListeners=10;EventEmitter$1.prototype.setMaxListeners=function(r){if(!isNumber(r)||r<0||isNaN(r))throw TypeError("n must be a positive number");return this._maxListeners=r,this};EventEmitter$1.prototype.emit=function(r){var n,s,o,u,c,b;if(this._events||(this._events={}),r==="error"&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(n=arguments[1],n instanceof Error)throw n;var O=new Error('Uncaught, unspecified "error" event. ('+n+")");throw O.context=n,O}if(s=this._events[r],isUndefined(s))return!1;if(isFunction(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),s.apply(this,u)}else if(isObject(s))for(u=Array.prototype.slice.call(arguments,1),b=s.slice(),o=b.length,c=0;c<o;c++)b[c].apply(this,u);return!0};EventEmitter$1.prototype.addListener=function(r,n){var s;if(!isFunction(n))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",r,isFunction(n.listener)?n.listener:n),this._events[r]?isObject(this._events[r])?this._events[r].push(n):this._events[r]=[this._events[r],n]:this._events[r]=n,isObject(this._events[r])&&!this._events[r].warned&&(isUndefined(this._maxListeners)?s=EventEmitter$1.defaultMaxListeners:s=this._maxListeners,s&&s>0&&this._events[r].length>s&&(this._events[r].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[r].length),typeof console.trace=="function"&&console.trace())),this};EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener;EventEmitter$1.prototype.once=function(r,n){if(!isFunction(n))throw TypeError("listener must be a function");var s=!1;function o(){this.removeListener(r,o),s||(s=!0,n.apply(this,arguments))}return o.listener=n,this.on(r,o),this};EventEmitter$1.prototype.removeListener=function(r,n){var s,o,u,c;if(!isFunction(n))throw TypeError("listener must be a function");if(!this._events||!this._events[r])return this;if(s=this._events[r],u=s.length,o=-1,s===n||isFunction(s.listener)&&s.listener===n)delete this._events[r],this._events.removeListener&&this.emit("removeListener",r,n);else if(isObject(s)){for(c=u;c-- >0;)if(s[c]===n||s[c].listener&&s[c].listener===n){o=c;break}if(o<0)return this;s.length===1?(s.length=0,delete this._events[r]):s.splice(o,1),this._events.removeListener&&this.emit("removeListener",r,n)}return this};EventEmitter$1.prototype.removeAllListeners=function(r){var n,s;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[r]&&delete this._events[r],this;if(arguments.length===0){for(n in this._events)n!=="removeListener"&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events={},this}if(s=this._events[r],isFunction(s))this.removeListener(r,s);else if(s)for(;s.length;)this.removeListener(r,s[s.length-1]);return delete this._events[r],this};EventEmitter$1.prototype.listeners=function(r){var n;return!this._events||!this._events[r]?n=[]:isFunction(this._events[r])?n=[this._events[r]]:n=this._events[r].slice(),n};EventEmitter$1.prototype.listenerCount=function(r){if(this._events){var n=this._events[r];if(isFunction(n))return 1;if(n)return n.length}return 0};EventEmitter$1.listenerCount=function(r,n){return r.listenerCount(n)};function isFunction(r){return typeof r=="function"}function isNumber(r){return typeof r=="number"}function isObject(r){return typeof r=="object"&&r!==null}function isUndefined(r){return r===void 0}var browser=performance&&performance.now?function(){return performance.now()}:Date.now||function(){return+new Date},raf$2={exports:{}},performanceNow={exports:{}};(function(){var r,n,s,o,u,c;typeof performance<"u"&&performance!==null&&performance.now?performanceNow.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(performanceNow.exports=function(){return(r()-u)/1e6},n=process.hrtime,r=function(){var b;return b=n(),b[0]*1e9+b[1]},o=r(),c=process.uptime()*1e9,u=o-c):Date.now?(performanceNow.exports=function(){return Date.now()-s},s=Date.now()):(performanceNow.exports=function(){return new Date().getTime()-s},s=new Date().getTime())}).call(commonjsGlobal);var now$1=performanceNow.exports,root=typeof window>"u"?commonjsGlobal:window,vendors=["moz","webkit"],suffix="AnimationFrame",raf$1=root["request"+suffix],caf=root["cancel"+suffix]||root["cancelRequest"+suffix];for(var i=0;!raf$1&&i<vendors.length;i++)raf$1=root[vendors[i]+"Request"+suffix],caf=root[vendors[i]+"Cancel"+suffix]||root[vendors[i]+"CancelRequest"+suffix];if(!raf$1||!caf){var last=0,id=0,queue=[],frameDuration=1e3/60;raf$1=function(r){if(queue.length===0){var n=now$1(),s=Math.max(0,frameDuration-(n-last));last=s+n,setTimeout(function(){var o=queue.slice(0);queue.length=0;for(var u=0;u<o.length;u++)if(!o[u].cancelled)try{o[u].callback(last)}catch(c){setTimeout(function(){throw c},0)}},Math.round(s))}return queue.push({handle:++id,callback:r,cancelled:!1}),id},caf=function(r){for(var n=0;n<queue.length;n++)queue[n].handle===r&&(queue[n].cancelled=!0)}}raf$2.exports=function(r){return raf$1.call(root,r)};raf$2.exports.cancel=function(){caf.apply(root,arguments)};raf$2.exports.polyfill=function(r){r||(r=root),r.requestAnimationFrame=raf$1,r.cancelAnimationFrame=caf};var inherits=inherits_browser.exports,EventEmitter=events.EventEmitter,now=browser,raf=raf$2.exports,rafLoop=Engine;function Engine(r){if(!(this instanceof Engine))return new Engine(r);this.running=!1,this.last=now(),this._frame=0,this._tick=this.tick.bind(this),r&&this.on("tick",r)}inherits(Engine,EventEmitter);Engine.prototype.start=function(){if(!this.running)return this.running=!0,this.last=now(),this._frame=raf(this._tick),this};Engine.prototype.stop=function(){return this.running=!1,this._frame!==0&&raf.cancel(this._frame),this._frame=0,this};Engine.prototype.tick=function(){this._frame=raf(this._tick);var r=now(),n=r-this.last;this.emit("tick",n),this.last=r};function Webcam(r){return navigator.mediaDevices.enumerateDevices().then(n=>n.filter(s=>s.kind==="videoinput")).then(n=>{let s={audio:!1,video:!0};return n[r]&&(s.video={deviceId:{exact:n[r].deviceId}}),window.navigator.mediaDevices.getUserMedia(s)}).then(n=>{const s=document.createElement("video");return s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.setAttribute("playsinline",""),s.srcObject=n,new Promise((o,u)=>{s.addEventListener("loadedmetadata",()=>{s.play().then(()=>o({video:s}))})})}).catch(console.log.bind(console))}function Screen(r){return new Promise(function(n,s){navigator.mediaDevices.getDisplayMedia(r).then(o=>{const u=document.createElement("video");u.srcObject=o,u.addEventListener("loadedmetadata",()=>{u.play(),n({video:u})})}).catch(o=>s(o))})}class HydraSource{constructor({regl:n,width:s,height:o,pb:u,label:c=""}){this.label=c,this.regl=n,this.src=null,this.dynamic=!0,this.width=s,this.height=o,this.tex=this.regl.texture({shape:[1,1]}),this.pb=u}init(n,s){"src"in n&&(this.src=n.src,this.tex=this.regl.texture({data:this.src,...s})),"dynamic"in n&&(this.dynamic=n.dynamic)}initCam(n,s){const o=this;Webcam(n).then(u=>{o.src=u.video,o.dynamic=!0,o.tex=o.regl.texture({data:o.src,...s})}).catch(u=>console.log("could not get camera",u))}initVideo(n="",s){const o=document.createElement("video");o.crossOrigin="anonymous",o.autoplay=!0,o.loop=!0,o.muted=!0,o.addEventListener("loadeddata",()=>{this.src=o,o.play(),this.tex=this.regl.texture({data:this.src,...s}),this.dynamic=!0}),o.src=n}initImage(n="",s){const o=document.createElement("img");o.crossOrigin="anonymous",o.src=n,o.onload=()=>{this.src=o,this.dynamic=!1,this.tex=this.regl.texture({data:this.src,...s})}}initStream(n,s){let o=this;n&&this.pb&&(this.pb.initSource(n),this.pb.on("got video",function(u,c){u===n&&(o.src=c,o.dynamic=!0,o.tex=o.regl.texture({data:o.src,...s}))}))}initScreen(n=0,s){const o=this;Screen().then(function(u){o.src=u.video,o.tex=o.regl.texture({data:o.src,...s}),o.dynamic=!0}).catch(u=>console.log("could not get screen",u))}resize(n,s){this.width=n,this.height=s}clear(){this.src&&this.src.srcObject&&this.src.srcObject.getTracks&&this.src.srcObject.getTracks().forEach(n=>n.stop()),this.src=null,this.tex=this.regl.texture({shape:[1,1]})}tick(n){this.src!==null&&this.dynamic===!0&&(this.src.videoWidth&&this.src.videoWidth!==this.tex.width&&(console.log(this.src.videoWidth,this.src.videoHeight,this.tex.width,this.tex.height),this.tex.resize(this.src.videoWidth,this.src.videoHeight)),this.src.width&&this.src.width!==this.tex.width&&this.tex.resize(this.src.width,this.src.height),this.tex.subimage(this.src))}getTexture(){return this.tex}}const mouse={};function mouseButtons(r){if(typeof r=="object"){if("buttons"in r)return r.buttons;if("which"in r){var n=r.which;if(n===2)return 4;if(n===3)return 2;if(n>0)return 1<<n-1}else if("button"in r){var n=r.button;if(n===1)return 4;if(n===2)return 2;if(n>=0)return 1<<n}}return 0}mouse.buttons=mouseButtons;function mouseElement(r){return r.target||r.srcElement||window}mouse.element=mouseElement;function mouseRelativeX(r){return typeof r=="object"&&"pageX"in r?r.pageX:0}mouse.x=mouseRelativeX;function mouseRelativeY(r){return typeof r=="object"&&"pageY"in r?r.pageY:0}mouse.y=mouseRelativeY;function mouseListen(r,n){n||(n=r,r=window);var s=0,o=0,u=0,c={shift:!1,alt:!1,control:!1,meta:!1},b=!1;function O(Oe){var Ge=!1;return"altKey"in Oe&&(Ge=Ge||Oe.altKey!==c.alt,c.alt=!!Oe.altKey),"shiftKey"in Oe&&(Ge=Ge||Oe.shiftKey!==c.shift,c.shift=!!Oe.shiftKey),"ctrlKey"in Oe&&(Ge=Ge||Oe.ctrlKey!==c.control,c.control=!!Oe.ctrlKey),"metaKey"in Oe&&(Ge=Ge||Oe.metaKey!==c.meta,c.meta=!!Oe.metaKey),Ge}function B(Oe,Ge){var tt=mouse.x(Ge),ze=mouse.y(Ge);"buttons"in Ge&&(Oe=Ge.buttons|0),(Oe!==s||tt!==o||ze!==u||O(Ge))&&(s=Oe|0,o=tt||0,u=ze||0,n&&n(s,o,u,c))}function M(Oe){B(0,Oe)}function xe(){(s||o||u||c.shift||c.alt||c.meta||c.control)&&(o=u=0,s=0,c.shift=c.alt=c.control=c.meta=!1,n&&n(0,0,0,c))}function Ce(Oe){O(Oe)&&n&&n(s,o,u,c)}function ge(Oe){mouse.buttons(Oe)===0?B(0,Oe):B(s,Oe)}function we(Oe){B(s|mouse.buttons(Oe),Oe)}function Re(Oe){B(s&~mouse.buttons(Oe),Oe)}function ft(){b||(b=!0,r.addEventListener("mousemove",ge),r.addEventListener("mousedown",we),r.addEventListener("mouseup",Re),r.addEventListener("mouseleave",M),r.addEventListener("mouseenter",M),r.addEventListener("mouseout",M),r.addEventListener("mouseover",M),r.addEventListener("blur",xe),r.addEventListener("keyup",Ce),r.addEventListener("keydown",Ce),r.addEventListener("keypress",Ce),r!==window&&(window.addEventListener("blur",xe),window.addEventListener("keyup",Ce),window.addEventListener("keydown",Ce),window.addEventListener("keypress",Ce)))}function yt(){!b||(b=!1,r.removeEventListener("mousemove",ge),r.removeEventListener("mousedown",we),r.removeEventListener("mouseup",Re),r.removeEventListener("mouseleave",M),r.removeEventListener("mouseenter",M),r.removeEventListener("mouseout",M),r.removeEventListener("mouseover",M),r.removeEventListener("blur",xe),r.removeEventListener("keyup",Ce),r.removeEventListener("keydown",Ce),r.removeEventListener("keypress",Ce),r!==window&&(window.removeEventListener("blur",xe),window.removeEventListener("keyup",Ce),window.removeEventListener("keydown",Ce),window.removeEventListener("keypress",Ce)))}ft();var Qe={element:r};return Object.defineProperties(Qe,{enabled:{get:function(){return b},set:function(Oe){Oe?ft():yt()},enumerable:!0},buttons:{get:function(){return s},enumerable:!0},x:{get:function(){return o},enumerable:!0},y:{get:function(){return u},enumerable:!0},mods:{get:function(){return c},enumerable:!0}}),Qe}var meyda_min={exports:{}};(function(r,n){(function(s,o){r.exports=o()})(commonjsGlobal,function(){function s(R,g,H){if(H||arguments.length===2)for(var N,ne=0,be=g.length;ne<be;ne++)!N&&ne in g||(N||(N=Array.prototype.slice.call(g,0,ne)),N[ne]=g[ne]);return R.concat(N||Array.prototype.slice.call(g))}var o=Object.freeze({__proto__:null,blackman:function(R){for(var g=new Float32Array(R),H=2*Math.PI/(R-1),N=2*H,ne=0;ne<R/2;ne++)g[ne]=.42-.5*Math.cos(ne*H)+.08*Math.cos(ne*N);for(ne=Math.ceil(R/2);ne>0;ne--)g[R-ne]=g[ne-1];return g},sine:function(R){for(var g=Math.PI/(R-1),H=new Float32Array(R),N=0;N<R;N++)H[N]=Math.sin(g*N);return H},hanning:function(R){for(var g=new Float32Array(R),H=0;H<R;H++)g[H]=.5-.5*Math.cos(2*Math.PI*H/(R-1));return g},hamming:function(R){for(var g=new Float32Array(R),H=0;H<R;H++)g[H]=.54-.46*Math.cos(2*Math.PI*(H/R-1));return g}}),u={};function c(R){for(;R%2==0&&R>1;)R/=2;return R===1}function b(R,g){if(g!=="rect"){if(g!==""&&g||(g="hanning"),u[g]||(u[g]={}),!u[g][R.length])try{u[g][R.length]=o[g](R.length)}catch{throw new Error("Invalid windowing function")}R=function(H,N){for(var ne=[],be=0;be<Math.min(H.length,N.length);be++)ne[be]=H[be]*N[be];return ne}(R,u[g][R.length])}return R}function O(R,g,H){for(var N=new Float32Array(R),ne=0;ne<N.length;ne++)N[ne]=ne*g/H,N[ne]=13*Math.atan(N[ne]/1315.8)+3.5*Math.atan(Math.pow(N[ne]/7518,2));return N}function B(R){return Float32Array.from(R)}function M(R){return 1125*Math.log(1+R/700)}function xe(R,g,H){for(var N,ne=new Float32Array(R+2),be=new Float32Array(R+2),Fe=g/2,Pe=M(0),He=(M(Fe)-Pe)/(R+1),Ve=new Array(R+2),Ne=0;Ne<ne.length;Ne++)ne[Ne]=Ne*He,be[Ne]=(N=ne[Ne],700*(Math.exp(N/1125)-1)),Ve[Ne]=Math.floor((H+1)*be[Ne]/g);for(var he=new Array(R),Te=0;Te<he.length;Te++){for(he[Te]=new Array(H/2+1).fill(0),Ne=Ve[Te];Ne<Ve[Te+1];Ne++)he[Te][Ne]=(Ne-Ve[Te])/(Ve[Te+1]-Ve[Te]);for(Ne=Ve[Te+1];Ne<Ve[Te+2];Ne++)he[Te][Ne]=(Ve[Te+2]-Ne)/(Ve[Te+2]-Ve[Te+1])}return he}function Ce(R,g,H,N,ne,be,Fe){N===void 0&&(N=5),ne===void 0&&(ne=2),be===void 0&&(be=!0),Fe===void 0&&(Fe=440);var Pe=Math.floor(H/2)+1,He=new Array(H).fill(0).map(function(St,$t){return R*function(xt,jt){return Math.log2(16*xt/jt)}(g*$t/H,Fe)});He[0]=He[1]-1.5*R;var Ve,Ne,he,Te=He.slice(1).map(function(St,$t){return Math.max(St-He[$t])},1).concat([1]),ut=Math.round(R/2),Se=new Array(R).fill(0).map(function(St,$t){return He.map(function(xt){return(10*R+ut+xt-$t)%R-ut})}),_t=Se.map(function(St,$t){return St.map(function(xt,jt){return Math.exp(-.5*Math.pow(2*Se[$t][jt]/Te[jt],2))})});if(Ne=(Ve=_t)[0].map(function(){return 0}),he=Ve.reduce(function(St,$t){return $t.forEach(function(xt,jt){St[jt]+=Math.pow(xt,2)}),St},Ne).map(Math.sqrt),_t=Ve.map(function(St,$t){return St.map(function(xt,jt){return xt/(he[jt]||1)})}),ne){var Jt=He.map(function(St){return Math.exp(-.5*Math.pow((St/R-N)/ne,2))});_t=_t.map(function(St){return St.map(function($t,xt){return $t*Jt[xt]})})}return be&&(_t=s(s([],_t.slice(3),!0),_t.slice(0,3),!0)),_t.map(function(St){return St.slice(0,Pe)})}function ge(R,g){for(var H=0,N=0,ne=0;ne<g.length;ne++)H+=Math.pow(ne,R)*Math.abs(g[ne]),N+=g[ne];return H/N}function we(R){var g=R.ampSpectrum,H=R.barkScale,N=R.numberOfBarkBands,ne=N===void 0?24:N;if(typeof g!="object"||typeof H!="object")throw new TypeError;var be=ne,Fe=new Float32Array(be),Pe=0,He=g,Ve=new Int32Array(be+1);Ve[0]=0;for(var Ne=H[He.length-1]/be,he=1,Te=0;Te<He.length;Te++)for(;H[Te]>Ne;)Ve[he++]=Te,Ne=he*H[He.length-1]/be;for(Ve[be]=He.length-1,Te=0;Te<be;Te++){for(var ut=0,Se=Ve[Te];Se<Ve[Te+1];Se++)ut+=He[Se];Fe[Te]=Math.pow(ut,.23)}for(Te=0;Te<Fe.length;Te++)Pe+=Fe[Te];return{specific:Fe,total:Pe}}function Re(R){var g=R.ampSpectrum;if(typeof g!="object")throw new TypeError;for(var H=new Float32Array(g.length),N=0;N<H.length;N++)H[N]=Math.pow(g[N],2);return H}function ft(R){var g=R.ampSpectrum,H=R.melFilterBank,N=R.bufferSize;if(typeof g!="object")throw new TypeError("Valid ampSpectrum is required to generate melBands");if(typeof H!="object")throw new TypeError("Valid melFilterBank is required to generate melBands");for(var ne=Re({ampSpectrum:g}),be=H.length,Fe=Array(be),Pe=new Float32Array(be),He=0;He<Pe.length;He++){Fe[He]=new Float32Array(N/2),Pe[He]=0;for(var Ve=0;Ve<N/2;Ve++)Fe[He][Ve]=H[He][Ve]*ne[Ve],Pe[He]+=Fe[He][Ve];Pe[He]=Math.log(Pe[He]+1)}return Array.prototype.slice.call(Pe)}function yt(R){return R&&R.__esModule&&Object.prototype.hasOwnProperty.call(R,"default")?R.default:R}var Qe={exports:{}},Oe=null,Ge=function(R,g){var H=R.length;return g=g||2,Oe&&Oe[H]||function(N){(Oe=Oe||{})[N]=new Array(N*N);for(var ne=Math.PI/N,be=0;be<N;be++)for(var Fe=0;Fe<N;Fe++)Oe[N][Fe+be*N]=Math.cos(ne*(Fe+.5)*be)}(H),R.map(function(){return 0}).map(function(N,ne){return g*R.reduce(function(be,Fe,Pe,He){return be+Fe*Oe[H][Pe+ne*H]},0)})};(function(R){R.exports=Ge})(Qe);var tt=yt(Qe.exports),ze=Object.freeze({__proto__:null,buffer:function(R){return R.signal},rms:function(R){var g=R.signal;if(typeof g!="object")throw new TypeError;for(var H=0,N=0;N<g.length;N++)H+=Math.pow(g[N],2);return H/=g.length,H=Math.sqrt(H)},energy:function(R){var g=R.signal;if(typeof g!="object")throw new TypeError;for(var H=0,N=0;N<g.length;N++)H+=Math.pow(Math.abs(g[N]),2);return H},complexSpectrum:function(R){return R.complexSpectrum},spectralSlope:function(R){var g=R.ampSpectrum,H=R.sampleRate,N=R.bufferSize;if(typeof g!="object")throw new TypeError;for(var ne=0,be=0,Fe=new Float32Array(g.length),Pe=0,He=0,Ve=0;Ve<g.length;Ve++){ne+=g[Ve];var Ne=Ve*H/N;Fe[Ve]=Ne,Pe+=Ne*Ne,be+=Ne,He+=Ne*g[Ve]}return(g.length*He-be*ne)/(ne*(Pe-Math.pow(be,2)))},spectralCentroid:function(R){var g=R.ampSpectrum;if(typeof g!="object")throw new TypeError;return ge(1,g)},spectralRolloff:function(R){var g=R.ampSpectrum,H=R.sampleRate;if(typeof g!="object")throw new TypeError;for(var N=g,ne=H/(2*(N.length-1)),be=0,Fe=0;Fe<N.length;Fe++)be+=N[Fe];for(var Pe=.99*be,He=N.length-1;be>Pe&&He>=0;)be-=N[He],--He;return(He+1)*ne},spectralFlatness:function(R){var g=R.ampSpectrum;if(typeof g!="object")throw new TypeError;for(var H=0,N=0,ne=0;ne<g.length;ne++)H+=Math.log(g[ne]),N+=g[ne];return Math.exp(H/g.length)*g.length/N},spectralSpread:function(R){var g=R.ampSpectrum;if(typeof g!="object")throw new TypeError;return Math.sqrt(ge(2,g)-Math.pow(ge(1,g),2))},spectralSkewness:function(R){var g=R.ampSpectrum;if(typeof g!="object")throw new TypeError;var H=ge(1,g),N=ge(2,g),ne=ge(3,g);return(2*Math.pow(H,3)-3*H*N+ne)/Math.pow(Math.sqrt(N-Math.pow(H,2)),3)},spectralKurtosis:function(R){var g=R.ampSpectrum;if(typeof g!="object")throw new TypeError;var H=g,N=ge(1,H),ne=ge(2,H),be=ge(3,H),Fe=ge(4,H);return(-3*Math.pow(N,4)+6*N*ne-4*N*be+Fe)/Math.pow(Math.sqrt(ne-Math.pow(N,2)),4)},amplitudeSpectrum:function(R){return R.ampSpectrum},zcr:function(R){var g=R.signal;if(typeof g!="object")throw new TypeError;for(var H=0,N=1;N<g.length;N++)(g[N-1]>=0&&g[N]<0||g[N-1]<0&&g[N]>=0)&&H++;return H},loudness:we,perceptualSpread:function(R){for(var g=we({ampSpectrum:R.ampSpectrum,barkScale:R.barkScale}),H=0,N=0;N<g.specific.length;N++)g.specific[N]>H&&(H=g.specific[N]);return Math.pow((g.total-H)/g.total,2)},perceptualSharpness:function(R){for(var g=we({ampSpectrum:R.ampSpectrum,barkScale:R.barkScale}),H=g.specific,N=0,ne=0;ne<H.length;ne++)N+=ne<15?(ne+1)*H[ne+1]:.066*Math.exp(.171*(ne+1));return N*=.11/g.total},powerSpectrum:Re,mfcc:function(R){var g=R.ampSpectrum,H=R.melFilterBank,N=R.numberOfMFCCCoefficients,ne=R.bufferSize,be=Math.min(40,Math.max(1,N||13));if(H.length<be)throw new Error("Insufficient filter bank for requested number of coefficients");var Fe=ft({ampSpectrum:g,melFilterBank:H,bufferSize:ne});return tt(Fe).slice(0,be)},chroma:function(R){var g=R.ampSpectrum,H=R.chromaFilterBank;if(typeof g!="object")throw new TypeError("Valid ampSpectrum is required to generate chroma");if(typeof H!="object")throw new TypeError("Valid chromaFilterBank is required to generate chroma");var N=H.map(function(be,Fe){return g.reduce(function(Pe,He,Ve){return Pe+He*be[Ve]},0)}),ne=Math.max.apply(Math,N);return ne?N.map(function(be){return be/ne}):N},spectralFlux:function(R){var g=R.signal,H=R.previousSignal,N=R.bufferSize;if(typeof g!="object"||typeof H!="object")throw new TypeError;for(var ne=0,be=-N/2;be<g.length/2-1;be++)x=Math.abs(g[be])-Math.abs(H[be]),ne+=(x+Math.abs(x))/2;return ne},spectralCrest:function(R){var g=R.ampSpectrum;if(typeof g!="object")throw new TypeError;var H=0,N=-1/0;return g.forEach(function(ne){H+=Math.pow(ne,2),N=ne>N?ne:N}),H/=g.length,H=Math.sqrt(H),N/H},melBands:ft});function We(R){if(Array.isArray(R)){for(var g=0,H=Array(R.length);g<R.length;g++)H[g]=R[g];return H}return Array.from(R)}var nt={},gt={},lt={bitReverseArray:function(R){if(nt[R]===void 0){for(var g=(R-1).toString(2).length,H="0".repeat(g),N={},ne=0;ne<R;ne++){var be=ne.toString(2);be=H.substr(be.length)+be,be=[].concat(We(be)).reverse().join(""),N[ne]=parseInt(be,2)}nt[R]=N}return nt[R]},multiply:function(R,g){return{real:R.real*g.real-R.imag*g.imag,imag:R.real*g.imag+R.imag*g.real}},add:function(R,g){return{real:R.real+g.real,imag:R.imag+g.imag}},subtract:function(R,g){return{real:R.real-g.real,imag:R.imag-g.imag}},euler:function(R,g){var H=-2*Math.PI*R/g;return{real:Math.cos(H),imag:Math.sin(H)}},conj:function(R){return R.imag*=-1,R},constructComplexArray:function(R){var g={};g.real=R.real===void 0?R.slice():R.real.slice();var H=g.real.length;return gt[H]===void 0&&(gt[H]=Array.apply(null,Array(H)).map(Number.prototype.valueOf,0)),g.imag=gt[H].slice(),g}},wt=function(R){var g={};R.real===void 0||R.imag===void 0?g=lt.constructComplexArray(R):(g.real=R.real.slice(),g.imag=R.imag.slice());var H=g.real.length,N=Math.log2(H);if(Math.round(N)!=N)throw new Error("Input size must be a power of 2.");if(g.real.length!=g.imag.length)throw new Error("Real and imaginary components must have the same length.");for(var ne=lt.bitReverseArray(H),be={real:[],imag:[]},Fe=0;Fe<H;Fe++)be.real[ne[Fe]]=g.real[Fe],be.imag[ne[Fe]]=g.imag[Fe];for(var Pe=0;Pe<H;Pe++)g.real[Pe]=be.real[Pe],g.imag[Pe]=be.imag[Pe];for(var He=1;He<=N;He++)for(var Ve=Math.pow(2,He),Ne=0;Ne<Ve/2;Ne++)for(var he=lt.euler(Ne,Ve),Te=0;Te<H/Ve;Te++){var ut=Ve*Te+Ne,Se=Ve*Te+Ne+Ve/2,_t={real:g.real[ut],imag:g.imag[ut]},Jt={real:g.real[Se],imag:g.imag[Se]},St=lt.multiply(he,Jt),$t=lt.subtract(_t,St);g.real[Se]=$t.real,g.imag[Se]=$t.imag;var xt=lt.add(St,_t);g.real[ut]=xt.real,g.imag[ut]=xt.imag}return g},qe=wt,pt=function(){function R(g,H){var N=this;if(this._m=H,!g.audioContext)throw this._m.errors.noAC;if(g.bufferSize&&!c(g.bufferSize))throw this._m._errors.notPow2;if(!g.source)throw this._m._errors.noSource;this._m.audioContext=g.audioContext,this._m.bufferSize=g.bufferSize||this._m.bufferSize||256,this._m.hopSize=g.hopSize||this._m.hopSize||this._m.bufferSize,this._m.sampleRate=g.sampleRate||this._m.audioContext.sampleRate||44100,this._m.callback=g.callback,this._m.windowingFunction=g.windowingFunction||"hanning",this._m.featureExtractors=ze,this._m.EXTRACTION_STARTED=g.startImmediately||!1,this._m.channel=typeof g.channel=="number"?g.channel:0,this._m.inputs=g.inputs||1,this._m.outputs=g.outputs||1,this._m.numberOfMFCCCoefficients=g.numberOfMFCCCoefficients||this._m.numberOfMFCCCoefficients||13,this._m.numberOfBarkBands=g.numberOfBarkBands||this._m.numberOfBarkBands||24,this._m.spn=this._m.audioContext.createScriptProcessor(this._m.bufferSize,this._m.inputs,this._m.outputs),this._m.spn.connect(this._m.audioContext.destination),this._m._featuresToExtract=g.featureExtractors||[],this._m.barkScale=O(this._m.bufferSize,this._m.sampleRate,this._m.bufferSize),this._m.melFilterBank=xe(Math.max(this._m.melBands,this._m.numberOfMFCCCoefficients),this._m.sampleRate,this._m.bufferSize),this._m.inputData=null,this._m.previousInputData=null,this._m.frame=null,this._m.previousFrame=null,this.setSource(g.source),this._m.spn.onaudioprocess=function(ne){var be;N._m.inputData!==null&&(N._m.previousInputData=N._m.inputData),N._m.inputData=ne.inputBuffer.getChannelData(N._m.channel),N._m.previousInputData?((be=new Float32Array(N._m.previousInputData.length+N._m.inputData.length-N._m.hopSize)).set(N._m.previousInputData.slice(N._m.hopSize)),be.set(N._m.inputData,N._m.previousInputData.length-N._m.hopSize)):be=N._m.inputData,function(Fe,Pe,He){if(Fe.length<Pe)throw new Error("Buffer is too short for frame length");if(He<1)throw new Error("Hop length cannot be less that 1");if(Pe<1)throw new Error("Frame length cannot be less that 1");var Ve=1+Math.floor((Fe.length-Pe)/He);return new Array(Ve).fill(0).map(function(Ne,he){return Fe.slice(he*He,he*He+Pe)})}(be,N._m.bufferSize,N._m.hopSize).forEach(function(Fe){N._m.frame=Fe;var Pe=N._m.extract(N._m._featuresToExtract,N._m.frame,N._m.previousFrame);typeof N._m.callback=="function"&&N._m.EXTRACTION_STARTED&&N._m.callback(Pe),N._m.previousFrame=N._m.frame})}}return R.prototype.start=function(g){this._m._featuresToExtract=g||this._m._featuresToExtract,this._m.EXTRACTION_STARTED=!0},R.prototype.stop=function(){this._m.EXTRACTION_STARTED=!1},R.prototype.setSource=function(g){this._m.source&&this._m.source.disconnect(this._m.spn),this._m.source=g,this._m.source.connect(this._m.spn)},R.prototype.setChannel=function(g){g<=this._m.inputs?this._m.channel=g:console.error("Channel ".concat(g," does not exist. Make sure you've provided a value for 'inputs' that is greater than ").concat(g," when instantiating the MeydaAnalyzer"))},R.prototype.get=function(g){return this._m.inputData?this._m.extract(g||this._m._featuresToExtract,this._m.inputData,this._m.previousInputData):null},R}(),bt={audioContext:null,spn:null,bufferSize:512,sampleRate:44100,melBands:26,chromaBands:12,callback:null,windowingFunction:"hanning",featureExtractors:ze,EXTRACTION_STARTED:!1,numberOfMFCCCoefficients:13,numberOfBarkBands:24,_featuresToExtract:[],windowing:b,_errors:{notPow2:new Error("Meyda: Buffer size must be a power of 2, e.g. 64 or 512"),featureUndef:new Error("Meyda: No features defined."),invalidFeatureFmt:new Error("Meyda: Invalid feature format"),invalidInput:new Error("Meyda: Invalid input."),noAC:new Error("Meyda: No AudioContext specified."),noSource:new Error("Meyda: No source node specified.")},createMeydaAnalyzer:function(R){return new pt(R,Object.assign({},bt))},listAvailableFeatureExtractors:function(){return Object.keys(this.featureExtractors)},extract:function(R,g,H){var N=this;if(!g)throw this._errors.invalidInput;if(typeof g!="object")throw this._errors.invalidInput;if(!R)throw this._errors.featureUndef;if(!c(g.length))throw this._errors.notPow2;this.barkScale!==void 0&&this.barkScale.length==this.bufferSize||(this.barkScale=O(this.bufferSize,this.sampleRate,this.bufferSize)),this.melFilterBank!==void 0&&this.barkScale.length==this.bufferSize&&this.melFilterBank.length==this.melBands||(this.melFilterBank=xe(Math.max(this.melBands,this.numberOfMFCCCoefficients),this.sampleRate,this.bufferSize)),this.chromaFilterBank!==void 0&&this.chromaFilterBank.length==this.chromaBands||(this.chromaFilterBank=Ce(this.chromaBands,this.sampleRate,this.bufferSize)),"buffer"in g&&g.buffer===void 0?this.signal=B(g):this.signal=g;var ne=ct(g,this.windowingFunction,this.bufferSize);if(this.signal=ne.windowedSignal,this.complexSpectrum=ne.complexSpectrum,this.ampSpectrum=ne.ampSpectrum,H){var be=ct(H,this.windowingFunction,this.bufferSize);this.previousSignal=be.windowedSignal,this.previousComplexSpectrum=be.complexSpectrum,this.previousAmpSpectrum=be.ampSpectrum}var Fe=function(Pe){return N.featureExtractors[Pe]({ampSpectrum:N.ampSpectrum,chromaFilterBank:N.chromaFilterBank,complexSpectrum:N.complexSpectrum,signal:N.signal,bufferSize:N.bufferSize,sampleRate:N.sampleRate,barkScale:N.barkScale,melFilterBank:N.melFilterBank,previousSignal:N.previousSignal,previousAmpSpectrum:N.previousAmpSpectrum,previousComplexSpectrum:N.previousComplexSpectrum,numberOfMFCCCoefficients:N.numberOfMFCCCoefficients,numberOfBarkBands:N.numberOfBarkBands})};if(typeof R=="object")return R.reduce(function(Pe,He){var Ve;return Object.assign({},Pe,((Ve={})[He]=Fe(He),Ve))},{});if(typeof R=="string")return Fe(R);throw this._errors.invalidFeatureFmt}},ct=function(R,g,H){var N={};R.buffer===void 0?N.signal=B(R):N.signal=R,N.windowedSignal=b(N.signal,g),N.complexSpectrum=qe(N.windowedSignal),N.ampSpectrum=new Float32Array(H/2);for(var ne=0;ne<H/2;ne++)N.ampSpectrum[ne]=Math.sqrt(Math.pow(N.complexSpectrum.real[ne],2)+Math.pow(N.complexSpectrum.imag[ne],2));return N};return typeof window<"u"&&(window.Meyda=bt),bt})})(meyda_min);const Meyda=getDefaultExportFromCjs(meyda_min.exports);class Audio{constructor({numBins:n=4,cutoff:s=2,smooth:o=.4,max:u=15,scale:c=10,isDrawing:b=!1,parentEl:O=document.body}){this.vol=0,this.scale=c,this.max=u,this.cutoff=s,this.smooth=o,this.setBins(n),this.beat={holdFrames:20,threshold:40,_cutoff:0,decay:.98,_framesSinceBeat:0},this.onBeat=()=>{},this.canvas=document.createElement("canvas"),this.canvas.width=100,this.canvas.height=80,this.canvas.style.width="100px",this.canvas.style.height="80px",this.canvas.style.position="absolute",this.canvas.style.right="0px",this.canvas.style.bottom="0px",O.appendChild(this.canvas),this.isDrawing=b,this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#DFFFFF",this.ctx.strokeStyle="#0ff",this.ctx.lineWidth=.5,window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then(B=>{this.stream=B,this.context=new AudioContext;let M=this.context.createMediaStreamSource(B);this.meyda=Meyda.createMeydaAnalyzer({audioContext:this.context,source:M,featureExtractors:["loudness"]})}).catch(B=>console.log("ERROR",B))}detectBeat(n){n>this.beat._cutoff&&n>this.beat.threshold?(this.onBeat(),this.beat._cutoff=n*1.2,this.beat._framesSinceBeat=0):this.beat._framesSinceBeat<=this.beat.holdFrames?this.beat._framesSinceBeat++:(this.beat._cutoff*=this.beat.decay,this.beat._cutoff=Math.max(this.beat._cutoff,this.beat.threshold))}tick(){if(this.meyda){var n=this.meyda.get();if(n&&n!==null){this.vol=n.loudness.total,this.detectBeat(this.vol);const s=(u,c)=>u+c;let o=Math.floor(n.loudness.specific.length/this.bins.length);this.prevBins=this.bins.slice(0),this.bins=this.bins.map((u,c)=>n.loudness.specific.slice(c*o,(c+1)*o).reduce(s)).map((u,c)=>u*(1-this.settings[c].smooth)+this.prevBins[c]*this.settings[c].smooth),this.fft=this.bins.map((u,c)=>Math.max(0,(u-this.settings[c].cutoff)/this.settings[c].scale)),this.isDrawing&&this.draw()}}}setCutoff(n){this.cutoff=n,this.settings=this.settings.map(s=>(s.cutoff=n,s))}setSmooth(n){this.smooth=n,this.settings=this.settings.map(s=>(s.smooth=n,s))}setBins(n){this.bins=Array(n).fill(0),this.prevBins=Array(n).fill(0),this.fft=Array(n).fill(0),this.settings=Array(n).fill(0).map(()=>({cutoff:this.cutoff,scale:this.scale,smooth:this.smooth})),this.bins.forEach((s,o)=>{window["a"+o]=(u=1,c=0)=>()=>a.fft[o]*u+c})}setScale(n){this.scale=n,this.settings=this.settings.map(s=>(s.scale=n,s))}setMax(n){this.max=n,console.log("set max is deprecated")}hide(){this.isDrawing=!1,this.canvas.style.display="none"}show(){this.isDrawing=!0,this.canvas.style.display="block"}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var n=this.canvas.width/this.bins.length,s=this.canvas.height/(this.max*2);this.bins.forEach((o,u)=>{var c=o*s;this.ctx.fillRect(u*n,this.canvas.height-c,n,c);var b=this.canvas.height-s*this.settings[u].cutoff;this.ctx.beginPath(),this.ctx.moveTo(u*n,b),this.ctx.lineTo((u+1)*n,b),this.ctx.stroke();var O=this.canvas.height-s*(this.settings[u].scale+this.settings[u].cutoff);this.ctx.beginPath(),this.ctx.moveTo(u*n,O),this.ctx.lineTo((u+1)*n,O),this.ctx.stroke()})}}class VideoRecorder{constructor(n){this.mediaSource=new MediaSource,this.stream=n,this.output=document.createElement("video"),this.output.autoplay=!0,this.output.loop=!0;let s=this;this.mediaSource.addEventListener("sourceopen",()=>{console.log("MediaSource opened"),s.sourceBuffer=s.mediaSource.addSourceBuffer('video/webm; codecs="vp8"'),console.log("Source buffer: ",sourceBuffer)})}start(){let n={mimeType:"video/webm;codecs=vp9"};this.recordedBlobs=[];try{this.mediaRecorder=new MediaRecorder(this.stream,n)}catch(s){console.log("Unable to create MediaRecorder with options Object: ",s);try{n={mimeType:"video/webm,codecs=vp9"},this.mediaRecorder=new MediaRecorder(this.stream,n)}catch(o){console.log("Unable to create MediaRecorder with options Object: ",o);try{n="video/vp8",this.mediaRecorder=new MediaRecorder(this.stream,n)}catch(u){alert(`MediaRecorder is not supported by this browser.

Try Firefox 29 or later, or Chrome 47 or later, with Enable experimental Web Platform features enabled from chrome://flags.`),console.error("Exception while creating MediaRecorder:",u);return}}}console.log("Created MediaRecorder",this.mediaRecorder,"with options",n),this.mediaRecorder.onstop=this._handleStop.bind(this),this.mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this.mediaRecorder.start(100),console.log("MediaRecorder started",this.mediaRecorder)}stop(){this.mediaRecorder.stop()}_handleStop(){const n=new Blob(this.recordedBlobs,{type:this.mediaRecorder.mimeType}),s=window.URL.createObjectURL(n);this.output.src=s;const o=document.createElement("a");o.style.display="none",o.href=s;let u=new Date;o.download=`hydra-${u.getFullYear()}-${u.getMonth()+1}-${u.getDate()}-${u.getHours()}.${u.getMinutes()}.${u.getSeconds()}.webm`,document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),window.URL.revokeObjectURL(s)},300)}_handleDataAvailable(n){n.data&&n.data.size>0&&this.recordedBlobs.push(n.data)}}const easing={linear:function(r){return r},easeInQuad:function(r){return r*r},easeOutQuad:function(r){return r*(2-r)},easeInOutQuad:function(r){return r<.5?2*r*r:-1+(4-2*r)*r},easeInCubic:function(r){return r*r*r},easeOutCubic:function(r){return--r*r*r+1},easeInOutCubic:function(r){return r<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1},easeInQuart:function(r){return r*r*r*r},easeOutQuart:function(r){return 1- --r*r*r*r},easeInOutQuart:function(r){return r<.5?8*r*r*r*r:1-8*--r*r*r*r},easeInQuint:function(r){return r*r*r*r*r},easeOutQuint:function(r){return 1+--r*r*r*r*r},easeInOutQuint:function(r){return r<.5?16*r*r*r*r*r:1+16*--r*r*r*r*r},sin:function(r){return(1+Math.sin(Math.PI*r-Math.PI/2))/2}};var map=(r,n,s,o,u)=>(r-n)*(u-o)/(s-n)+o;const ArrayUtils={init:()=>{Array.prototype.fast=function(r=1){return this._speed=r,this},Array.prototype.smooth=function(r=1){return this._smooth=r,this},Array.prototype.ease=function(r="linear"){return typeof r=="function"?(this._smooth=1,this._ease=r):easing[r]&&(this._smooth=1,this._ease=easing[r]),this},Array.prototype.offset=function(r=.5){return this._offset=r%1,this},Array.prototype.fit=function(r=0,n=1){let s=Math.min(...this),o=Math.max(...this);var u=this.map(c=>map(c,s,o,r,n));return u._speed=this._speed,u._smooth=this._smooth,u._ease=this._ease,u}},getValue:(r=[])=>({time:n,bpm:s})=>{let o=r._speed?r._speed:1,u=r._smooth?r._smooth:0,c=n*o*(s/60)+(r._offset||0);if(u!==0){let b=r._ease?r._ease:easing.linear,O=c-u/2,B=r[Math.floor(O%r.length)],M=r[Math.floor((O+1)%r.length)],xe=Math.min(O%1/u,1);return b(xe)*(M-B)+B}else return r[Math.floor(c%r.length)],r[Math.floor(c%r.length)]}},Sandbox=parent=>{var initialCode="",sandbox=createSandbox(initialCode),addToContext=(r,n)=>{initialCode+=`
      var ${r} = ${n}
    `,sandbox=createSandbox(initialCode)};return{addToContext,eval:r=>sandbox.eval(r)};function createSandbox(initial){eval(initial);var localEval=function(code){eval(code)};return{eval:localEval}}};class EvalSandbox{constructor(n,s,o=[]){this.makeGlobal=s,this.sandbox=Sandbox(),this.parent=n;var u=Object.keys(n);u.forEach(c=>this.add(c)),this.userProps=o}add(n){this.makeGlobal&&(window[n]=this.parent[n]),this.sandbox.addToContext(n,`parent.${n}`)}set(n,s){this.makeGlobal&&(window[n]=s),this.parent[n]=s}tick(){this.makeGlobal&&this.userProps.forEach(n=>{this.parent[n]=window[n]})}eval(n){this.sandbox.eval(n)}}const DEFAULT_CONVERSIONS={float:{vec4:{name:"sum",args:[[1,1,1,1]]},vec2:{name:"sum",args:[[1,1]]}}},ensure_decimal_dot=r=>(r=r.toString(),r.indexOf(".")<0&&(r+="."),r);function formatArguments(r,n,s){const o=r.transform.inputs,u=r.userArgs,{generators:c}=r.synth,{src:b}=c;return o.map((O,B)=>{const M={value:O.default,type:O.type,isUniform:!1,name:O.name,vecLen:0};if(M.type==="float"&&(M.value=ensure_decimal_dot(O.default)),O.type.startsWith("vec"))try{M.vecLen=Number.parseInt(O.type.substr(3))}catch{console.log(`Error determining length of vector input type ${O.type} (${O.name})`)}if(u.length>B&&(M.value=u[B],typeof u[B]=="function"?(M.value=(ge,we,Re)=>{try{const ft=u[B](we);return typeof ft=="number"?ft:(console.warn("function does not return a number",u[B]),O.default)}catch(ft){return console.warn("ERROR",ft),O.default}},M.isUniform=!0):u[B].constructor===Array&&(M.value=(ge,we,Re)=>ArrayUtils.getValue(u[B])(we),M.isUniform=!0)),!(n<0)){if(M.value&&M.value.transforms){const ge=M.value.transforms[M.value.transforms.length-1];if(ge.transform.glsl_return_type!==O.type){const we=DEFAULT_CONVERSIONS[O.type];if(typeof we<"u"){const Re=we[ge.transform.glsl_return_type];if(typeof Re<"u"){const{name:ft,args:yt}=Re;M.value=M.value[ft](...yt)}}}M.isUniform=!1}else if(M.type==="float"&&typeof M.value=="number")M.value=ensure_decimal_dot(M.value);else if(M.type.startsWith("vec")&&typeof M.value=="object"&&Array.isArray(M.value))M.isUniform=!1,M.value=`${M.type}(${M.value.map(ensure_decimal_dot).join(", ")})`;else if(O.type==="sampler2D"){var xe=M.value;M.value=()=>xe.getTexture(),M.isUniform=!0}else if(M.value.getTexture&&O.type==="vec4"){var Ce=M.value;M.value=b(Ce),M.isUniform=!1}M.isUniform&&(M.name+=n)}return M})}function generateGlsl(r){var n={uniforms:[],glslFunctions:[],fragColor:""},s=generateGlsl$1(r,n)("st");n.fragColor=s;let o={};return n.uniforms.forEach(u=>o[u.name]=u),n.uniforms=Object.values(o),n}function generateGlsl$1(r,n){var s=()=>"";return r.forEach(o=>{var u=formatArguments(o,n.uniforms.length);u.forEach(O=>{O.isUniform&&n.uniforms.push(O)}),contains(o,n.glslFunctions)||n.glslFunctions.push(o);var c=s;if(o.transform.type==="src")s=O=>`${shaderString(O,o.name,u,n)}`;else if(o.transform.type==="coord")s=O=>`${c(`${shaderString(O,o.name,u,n)}`)}`;else if(o.transform.type==="color")s=O=>`${shaderString(`${c(O)}`,o.name,u,n)}`;else if(o.transform.type==="combine"){var b=u[0].value&&u[0].value.transforms?O=>`${generateGlsl$1(u[0].value.transforms,n)(O)}`:u[0].isUniform?()=>u[0].name:()=>u[0].value;s=O=>`${shaderString(`${c(O)}, ${b(O)}`,o.name,u.slice(1),n)}`}else if(o.transform.type==="combineCoord"){var b=u[0].value&&u[0].value.transforms?B=>`${generateGlsl$1(u[0].value.transforms,n)(B)}`:u[0].isUniform?()=>u[0].name:()=>u[0].value;s=B=>`${c(`${shaderString(`${B}, ${b(B)}`,o.name,u.slice(1),n)}`)}`}}),s}function shaderString(r,n,s,o){const u=s.map(c=>c.isUniform?c.name:c.value&&c.value.transforms?`${generateGlsl$1(c.value.transforms,o)("st")}`:c.value).reduce((c,b)=>`${c}, ${b}`,"");return`${n}(${r}${u})`}function contains(r,n){for(var s=0;s<n.length;s++)if(r.name==n[s].name)return!0;return!1}const utilityGlsl={_luminance:{type:"util",glsl:`float _luminance(vec3 rgb){
      const vec3 W = vec3(0.2125, 0.7154, 0.0721);
      return dot(rgb, W);
    }`},_noise:{type:"util",glsl:`
    //	Simplex 3D Noise
    //	by Ian McEwan, Ashima Arts
    vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
  vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}

  float _noise(vec3 v){
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);

  // First corner
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;

  // Other corners
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );

    //  x0 = x0 - 0. + 0.0 * C
    vec3 x1 = x0 - i1 + 1.0 * C.xxx;
    vec3 x2 = x0 - i2 + 2.0 * C.xxx;
    vec3 x3 = x0 - 1. + 3.0 * C.xxx;

  // Permutations
    i = mod(i, 289.0 );
    vec4 p = permute( permute( permute(
               i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
             + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
             + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));

  // Gradients
  // ( N*N points uniformly over a square, mapped onto an octahedron.)
    float n_ = 1.0/7.0; // N=7
    vec3  ns = n_ * D.wyz - D.xzx;

    vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)

    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)

    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);

    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );

    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));

    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;

    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);

  //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;

  // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
  }
    `},_rgbToHsv:{type:"util",glsl:`vec3 _rgbToHsv(vec3 c){
            vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
            vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
            vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

            float d = q.x - min(q.w, q.y);
            float e = 1.0e-10;
            return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
        }`},_hsvToRgb:{type:"util",glsl:`vec3 _hsvToRgb(vec3 c){
        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
    }`}};var GlslSource=function(r){return this.transforms=[],this.transforms.push(r),this.defaultOutput=r.defaultOutput,this.synth=r.synth,this.type="GlslSource",this.defaultUniforms=r.defaultUniforms,this};GlslSource.prototype.addTransform=function(r){this.transforms.push(r)};GlslSource.prototype.out=function(r){var n=r||this.defaultOutput,s=this.glsl(n);if(this.synth.currentFunctions=[],n)try{n.render(s)}catch(o){console.log("shader could not compile",o)}};GlslSource.prototype.glsl=function(){var r=[],n=[];return this.transforms.forEach(s=>{s.transform.type==="renderpass"?console.warn("no support for renderpass"):n.push(s)}),n.length>0&&r.push(this.compile(n)),r};GlslSource.prototype.compile=function(r){var n=generateGlsl(r,this.synth),s={};n.uniforms.forEach(u=>{s[u.name]=u.value});var o=`
  precision ${this.defaultOutput.precision} float;
  ${Object.values(n.uniforms).map(u=>{let c=u.type;switch(u.type){case"texture":c="sampler2D";break}return`
      uniform ${c} ${u.name};`}).join("")}
  uniform float time;
  uniform vec2 resolution;
  varying vec2 uv;
  uniform sampler2D prevBuffer;

  ${Object.values(utilityGlsl).map(u=>`
            ${u.glsl}
          `).join("")}

  ${n.glslFunctions.map(u=>`
            ${u.transform.glsl}
          `).join("")}

  void main () {
    vec4 c = vec4(1, 0, 0, 1);
    vec2 st = gl_FragCoord.xy/resolution.xy;
    gl_FragColor = ${n.fragColor};
  }
  `;return{frag:o,uniforms:Object.assign({},this.defaultUniforms,s)}};const glslFunctions=()=>[{name:"noise",type:"src",inputs:[{type:"float",name:"scale",default:10},{type:"float",name:"offset",default:.1}],glsl:"   return vec4(vec3(_noise(vec3(_st*scale, offset*time))), 1.0);"},{name:"voronoi",type:"src",inputs:[{type:"float",name:"scale",default:5},{type:"float",name:"speed",default:.3},{type:"float",name:"blending",default:.3}],glsl:`   vec3 color = vec3(.0);
   // Scale
   _st *= scale;
   // Tile the space
   vec2 i_st = floor(_st);
   vec2 f_st = fract(_st);
   float m_dist = 10.;  // minimun distance
   vec2 m_point;        // minimum point
   for (int j=-1; j<=1; j++ ) {
   for (int i=-1; i<=1; i++ ) {
   vec2 neighbor = vec2(float(i),float(j));
   vec2 p = i_st + neighbor;
   vec2 point = fract(sin(vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3))))*43758.5453);
   point = 0.5 + 0.5*sin(time*speed + 6.2831*point);
   vec2 diff = neighbor + point - f_st;
   float dist = length(diff);
   if( dist < m_dist ) {
   m_dist = dist;
   m_point = point;
   }
   }
   }
   // Assign a color using the closest point position
   color += dot(m_point,vec2(.3,.6));
   color *= 1.0 - blending*m_dist;
   return vec4(color, 1.0);`},{name:"osc",type:"src",inputs:[{type:"float",name:"frequency",default:60},{type:"float",name:"sync",default:.1},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st;
   float r = sin((st.x-offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   float g = sin((st.x+time*sync)*frequency)*0.5 + 0.5;
   float b = sin((st.x+offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   return vec4(r, g, b, 1.0);`},{name:"shape",type:"src",inputs:[{type:"float",name:"sides",default:3},{type:"float",name:"radius",default:.3},{type:"float",name:"smoothing",default:.01}],glsl:`   vec2 st = _st * 2. - 1.;
   // Angle and radius from the current pixel
   float a = atan(st.x,st.y)+3.1416;
   float r = (2.*3.1416)/sides;
   float d = cos(floor(.5+a/r)*r-a)*length(st);
   return vec4(vec3(1.0-smoothstep(radius,radius + smoothing + 0.0000001,d)), 1.0);`},{name:"gradient",type:"src",inputs:[{type:"float",name:"speed",default:0}],glsl:"   return vec4(_st, sin(time*speed), 1.0);"},{name:"src",type:"src",inputs:[{type:"sampler2D",name:"tex",default:NaN}],glsl:`   //  vec2 uv = gl_FragCoord.xy/vec2(1280., 720.);
   return texture2D(tex, fract(_st));`},{name:"solid",type:"src",inputs:[{type:"float",name:"r",default:0},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:1}],glsl:"   return vec4(r, g, b, a);"},{name:"rotate",type:"coord",inputs:[{type:"float",name:"angle",default:10},{type:"float",name:"speed",default:0}],glsl:`   vec2 xy = _st - vec2(0.5);
   float ang = angle + speed *time;
   xy = mat2(cos(ang),-sin(ang), sin(ang),cos(ang))*xy;
   xy += 0.5;
   return xy;`},{name:"scale",type:"coord",inputs:[{type:"float",name:"amount",default:1.5},{type:"float",name:"xMult",default:1},{type:"float",name:"yMult",default:1},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:`   vec2 xy = _st - vec2(offsetX, offsetY);
   xy*=(1.0/vec2(amount*xMult, amount*yMult));
   xy+=vec2(offsetX, offsetY);
   return xy;
   `},{name:"pixelate",type:"coord",inputs:[{type:"float",name:"pixelX",default:20},{type:"float",name:"pixelY",default:20}],glsl:`   vec2 xy = vec2(pixelX, pixelY);
   return (floor(_st * xy) + 0.5)/xy;`},{name:"posterize",type:"color",inputs:[{type:"float",name:"bins",default:3},{type:"float",name:"gamma",default:.6}],glsl:`   vec4 c2 = pow(_c0, vec4(gamma));
   c2 *= vec4(bins);
   c2 = floor(c2);
   c2/= vec4(bins);
   c2 = pow(c2, vec4(1.0/gamma));
   return vec4(c2.xyz, _c0.a);`},{name:"shift",type:"color",inputs:[{type:"float",name:"r",default:.5},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:0}],glsl:`   vec4 c2 = vec4(_c0);
   c2.r = fract(c2.r + r);
   c2.g = fract(c2.g + g);
   c2.b = fract(c2.b + b);
   c2.a = fract(c2.a + a);
   return vec4(c2.rgba);`},{name:"repeat",type:"coord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:0},{type:"float",name:"offsetY",default:0}],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) * offsetX;
   st.y += step(1., mod(st.x,2.0)) * offsetY;
   return fract(st);`},{name:"modulateRepeat",type:"combineCoord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offsetX;
   st.y += step(1., mod(st.x,2.0)) + _c0.g * offsetY;
   return fract(st);`},{name:"repeatX",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0))* offset;
   return fract(st);`},{name:"modulateRepeatX",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0)) + _c0.r * offset;
   return fract(st);`},{name:"repeatY",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st * vec2(1.0, reps);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0))* offset;
   return fract(st);`},{name:"modulateRepeatY",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offset;
   return fract(st);`},{name:"kaleid",type:"coord",inputs:[{type:"float",name:"nSides",default:4}],glsl:`   vec2 st = _st;
   st -= 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return r*vec2(cos(a), sin(a));`},{name:"modulateKaleid",type:"combineCoord",inputs:[{type:"float",name:"nSides",default:4}],glsl:`   vec2 st = _st - 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return (_c0.r+r)*vec2(cos(a), sin(a));`},{name:"scroll",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"scrollY",default:.5},{type:"float",name:"speedX",default:0},{type:"float",name:"speedY",default:0}],glsl:`
   _st.x += scrollX + time*speedX;
   _st.y += scrollY + time*speedY;
   return fract(_st);`},{name:"scrollX",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.x += scrollX + time*speed;
   return fract(_st);`},{name:"modulateScrollX",type:"combineCoord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.x += _c0.r*scrollX + time*speed;
   return fract(_st);`},{name:"scrollY",type:"coord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.y += scrollY + time*speed;
   return fract(_st);`},{name:"modulateScrollY",type:"combineCoord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.y += _c0.r*scrollY + time*speed;
   return fract(_st);`},{name:"add",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0+_c1)*amount + _c0*(1.0-amount);"},{name:"sub",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0-_c1)*amount + _c0*(1.0-amount);"},{name:"layer",type:"combine",inputs:[],glsl:"   return vec4(mix(_c0.rgb, _c1.rgb, _c1.a), clamp(_c0.a + _c1.a, 0.0, 1.0));"},{name:"blend",type:"combine",inputs:[{type:"float",name:"amount",default:.5}],glsl:"   return _c0*(1.0-amount)+_c1*amount;"},{name:"mult",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _c0*(1.0-amount)+(_c0*_c1)*amount;"},{name:"diff",type:"combine",inputs:[],glsl:"   return vec4(abs(_c0.rgb-_c1.rgb), max(_c0.a, _c1.a));"},{name:"modulate",type:"combineCoord",inputs:[{type:"float",name:"amount",default:.1}],glsl:`   //  return fract(st+(_c0.xy-0.5)*amount);
   return _st + _c0.xy*amount;`},{name:"modulateScale",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:1}],glsl:`   vec2 xy = _st - vec2(0.5);
   xy*=(1.0/vec2(offset + multiple*_c0.r, offset + multiple*_c0.g));
   xy+=vec2(0.5);
   return xy;`},{name:"modulatePixelate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:10},{type:"float",name:"offset",default:3}],glsl:`   vec2 xy = vec2(offset + _c0.x*multiple, offset + _c0.y*multiple);
   return (floor(_st * xy) + 0.5)/xy;`},{name:"modulateRotate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:0}],glsl:`   vec2 xy = _st - vec2(0.5);
   float angle = offset + _c0.x * multiple;
   xy = mat2(cos(angle),-sin(angle), sin(angle),cos(angle))*xy;
   xy += 0.5;
   return xy;`},{name:"modulateHue",type:"combineCoord",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _st + (vec2(_c0.g - _c0.r, _c0.b - _c0.g) * amount * 1.0/resolution);"},{name:"invert",type:"color",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return vec4((1.0-_c0.rgb)*amount + _c0.rgb*(1.0-amount), _c0.a);"},{name:"contrast",type:"color",inputs:[{type:"float",name:"amount",default:1.6}],glsl:`   vec4 c = (_c0-vec4(0.5))*vec4(amount) + vec4(0.5);
   return vec4(c.rgb, _c0.a);`},{name:"brightness",type:"color",inputs:[{type:"float",name:"amount",default:.4}],glsl:"   return vec4(_c0.rgb + vec3(amount), _c0.a);"},{name:"mask",type:"combine",inputs:[],glsl:`   float a = _luminance(_c1.rgb);
  return vec4(_c0.rgb*a, a*_c0.a);`},{name:"luma",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.1}],glsl:`   float a = smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb));
   return vec4(_c0.rgb*a, a);`},{name:"thresh",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.04}],glsl:"   return vec4(vec3(smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb))), _c0.a);"},{name:"color",type:"color",inputs:[{type:"float",name:"r",default:1},{type:"float",name:"g",default:1},{type:"float",name:"b",default:1},{type:"float",name:"a",default:1}],glsl:`   vec4 c = vec4(r, g, b, a);
   vec4 pos = step(0.0, c); // detect whether negative
   // if > 0, return r * _c0
   // if < 0 return (1.0-r) * _c0
   return vec4(mix((1.0-_c0)*abs(c), c*_c0, pos));`},{name:"saturate",type:"color",inputs:[{type:"float",name:"amount",default:2}],glsl:`   const vec3 W = vec3(0.2125, 0.7154, 0.0721);
   vec3 intensity = vec3(dot(_c0.rgb, W));
   return vec4(mix(intensity, _c0.rgb, amount), _c0.a);`},{name:"hue",type:"color",inputs:[{type:"float",name:"hue",default:.4}],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c.r += hue;
   //  c.r = fract(c.r);
   return vec4(_hsvToRgb(c), _c0.a);`},{name:"colorama",type:"color",inputs:[{type:"float",name:"amount",default:.005}],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c += vec3(amount);
   c = _hsvToRgb(c);
   c = fract(c);
   return vec4(c, _c0.a);`},{name:"prev",type:"src",inputs:[],glsl:"   return texture2D(prevBuffer, fract(_st));"},{name:"sum",type:"color",inputs:[{type:"vec4",name:"scale",default:1}],glsl:`   vec4 v = _c0 * s;
   return v.r + v.g + v.b + v.a;
   }
   float sum(vec2 _st, vec4 s) { // vec4 is not a typo, because argument type is not overloaded
   vec2 v = _st.xy * s.xy;
   return v.x + v.y;`},{name:"r",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.r * scale + offset);"},{name:"g",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.g * scale + offset);"},{name:"b",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.b * scale + offset);"},{name:"a",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.a * scale + offset);"}];class GeneratorFactory{constructor({defaultUniforms:n,defaultOutput:s,extendTransforms:o=[],changeListener:u=()=>{}}={}){this.defaultOutput=s,this.defaultUniforms=n,this.changeListener=u,this.extendTransforms=o,this.generators={},this.init()}init(){const n=glslFunctions();return this.glslTransforms={},this.generators=Object.entries(this.generators).reduce((s,[o,u])=>(this.changeListener({type:"remove",synth:this,method:o}),s),{}),this.sourceClass=(()=>class extends GlslSource{})(),Array.isArray(this.extendTransforms)?n.concat(this.extendTransforms):typeof this.extendTransforms=="object"&&this.extendTransforms.type&&n.push(this.extendTransforms),n.map(s=>this.setFunction(s))}_addMethod(n,s){const o=this;if(this.glslTransforms[n]=s,s.type==="src"){const u=(...c)=>new this.sourceClass({name:n,transform:s,userArgs:c,defaultOutput:this.defaultOutput,defaultUniforms:this.defaultUniforms,synth:o});return this.generators[n]=u,this.changeListener({type:"add",synth:this,method:n}),u}else this.sourceClass.prototype[n]=function(...u){return this.transforms.push({name:n,transform:s,userArgs:u,synth:o}),this}}setFunction(n){var s=processGlsl(n);s&&this._addMethod(n.name,s)}}const typeLookup={src:{returnType:"vec4",args:["vec2 _st"]},coord:{returnType:"vec2",args:["vec2 _st"]},color:{returnType:"vec4",args:["vec4 _c0"]},combine:{returnType:"vec4",args:["vec4 _c0","vec4 _c1"]},combineCoord:{returnType:"vec2",args:["vec2 _st","vec4 _c0"]}};function processGlsl(r){let n=typeLookup[r.type];if(n){let s=n.args.map(b=>b).join(", "),o=r.inputs.map(b=>`${b.type} ${b.name}`).join(", "),u=`${s}${o.length>0?", "+o:""}`,c=`
  ${n.returnType} ${r.name}(${u}) {
      ${r.glsl}
  }
`;return(r.type==="combine"||r.type==="combineCoord")&&r.inputs.unshift({name:"color",type:"vec4"}),Object.assign({},r,{glsl:c})}else console.warn(`type ${r.type} not recognized`,r)}var regl$1={exports:{}};(function(r,n){(function(s,o){r.exports=o()})(commonjsGlobal,function(){var s=function(l){return l instanceof Uint8Array||l instanceof Uint16Array||l instanceof Uint32Array||l instanceof Int8Array||l instanceof Int16Array||l instanceof Int32Array||l instanceof Float32Array||l instanceof Float64Array||l instanceof Uint8ClampedArray},o=function(l,d){for(var E=Object.keys(d),j=0;j<E.length;++j)l[E[j]]=d[E[j]];return l},u=`
`;function c(l){return typeof atob<"u"?atob(l):"base64:"+l}function b(l){var d=new Error("(regl) "+l);throw console.error(d),d}function O(l,d){l||b(d)}function B(l){return l?": "+l:""}function M(l,d,E){l in d||b("unknown parameter ("+l+")"+B(E)+". possible values: "+Object.keys(d).join())}function xe(l,d){s(l)||b("invalid parameter type"+B(d)+". must be a typed array")}function Ce(l,d){switch(d){case"number":return typeof l=="number";case"object":return typeof l=="object";case"string":return typeof l=="string";case"boolean":return typeof l=="boolean";case"function":return typeof l=="function";case"undefined":return typeof l>"u";case"symbol":return typeof l=="symbol"}}function ge(l,d,E){Ce(l,d)||b("invalid parameter type"+B(E)+". expected "+d+", got "+typeof l)}function we(l,d){l>=0&&(l|0)===l||b("invalid parameter type, ("+l+")"+B(d)+". must be a nonnegative integer")}function Re(l,d,E){d.indexOf(l)<0&&b("invalid value"+B(E)+". must be one of: "+d)}var ft=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function yt(l){Object.keys(l).forEach(function(d){ft.indexOf(d)<0&&b('invalid regl constructor argument "'+d+'". must be one of '+ft)})}function Qe(l,d){for(l=l+"";l.length<d;)l=" "+l;return l}function Oe(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Ge(l,d){this.number=l,this.line=d,this.errors=[]}function tt(l,d,E){this.file=l,this.line=d,this.message=E}function ze(){var l=new Error,d=(l.stack||l).toString(),E=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(d);if(E)return E[1];var j=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(d);return j?j[1]:"unknown"}function We(){var l=new Error,d=(l.stack||l).toString(),E=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(d);if(E)return E[1];var j=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(d);return j?j[1]:"unknown"}function nt(l,d){var E=l.split(`
`),j=1,Q=0,z={unknown:new Oe,0:new Oe};z.unknown.name=z[0].name=d||ze(),z.unknown.lines.push(new Ge(0,""));for(var W=0;W<E.length;++W){var ie=E[W],se=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(ie);if(se)switch(se[1]){case"line":var le=/(\d+)(\s+\d+)?/.exec(se[2]);le&&(j=le[1]|0,le[2]&&(Q=le[2]|0,Q in z||(z[Q]=new Oe)));break;case"define":var oe=/SHADER_NAME(_B64)?\s+(.*)$/.exec(se[2]);oe&&(z[Q].name=oe[1]?c(oe[2]):oe[2]);break}z[Q].lines.push(new Ge(j++,ie))}return Object.keys(z).forEach(function(de){var ve=z[de];ve.lines.forEach(function(ae){ve.index[ae.number]=ae})}),z}function gt(l){var d=[];return l.split(`
`).forEach(function(E){if(!(E.length<5)){var j=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(E);j?d.push(new tt(j[1]|0,j[2]|0,j[3].trim())):E.length>0&&d.push(new tt("unknown",0,E))}}),d}function lt(l,d){d.forEach(function(E){var j=l[E.file];if(j){var Q=j.index[E.line];if(Q){Q.errors.push(E),j.hasErrors=!0;return}}l.unknown.hasErrors=!0,l.unknown.lines[0].errors.push(E)})}function wt(l,d,E,j,Q){if(!l.getShaderParameter(d,l.COMPILE_STATUS)){var z=l.getShaderInfoLog(d),W=j===l.FRAGMENT_SHADER?"fragment":"vertex";H(E,"string",W+" shader source must be a string",Q);var ie=nt(E,Q),se=gt(z);lt(ie,se),Object.keys(ie).forEach(function(le){var oe=ie[le];if(!oe.hasErrors)return;var de=[""],ve=[""];function ae(me,D){de.push(me),ve.push(D||"")}ae("file number "+le+": "+oe.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),oe.lines.forEach(function(me){if(me.errors.length>0){ae(Qe(me.number,4)+"|  ","background-color:yellow; font-weight:bold"),ae(me.line+u,"color:red; background-color:yellow; font-weight:bold");var D=0;me.errors.forEach(function(X){var fe=X.message,Ee=/^\s*'(.*)'\s*:\s*(.*)$/.exec(fe);if(Ee){var ee=Ee[1];switch(fe=Ee[2],ee){case"assign":ee="=";break}D=Math.max(me.line.indexOf(ee,D),0)}else D=0;ae(Qe("| ",6)),ae(Qe("^^^",D+3)+u,"font-weight:bold"),ae(Qe("| ",6)),ae(fe+u,"font-weight:bold")}),ae(Qe("| ",6)+u)}else ae(Qe(me.number,4)+"|  "),ae(me.line+u,"color:red")}),typeof document<"u"&&!window.chrome?(ve[0]=de.join("%c"),console.log.apply(console,ve)):console.log(de.join(""))}),O.raise("Error compiling "+W+" shader, "+ie[0].name)}}function qe(l,d,E,j,Q){if(!l.getProgramParameter(d,l.LINK_STATUS)){var z=l.getProgramInfoLog(d),W=nt(E,Q),ie=nt(j,Q),se='Error linking program with vertex shader, "'+ie[0].name+'", and fragment shader "'+W[0].name+'"';typeof document<"u"?console.log("%c"+se+u+"%c"+z,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(se+u+z),O.raise(se)}}function pt(l){l._commandRef=ze()}function bt(l,d,E,j){pt(l);function Q(se){return se?j.id(se):0}l._fragId=Q(l.static.frag),l._vertId=Q(l.static.vert);function z(se,le){Object.keys(le).forEach(function(oe){se[j.id(oe)]=!0})}var W=l._uniformSet={};z(W,d.static),z(W,d.dynamic);var ie=l._attributeSet={};z(ie,E.static),z(ie,E.dynamic),l._hasCount="count"in l.static||"count"in l.dynamic||"elements"in l.static||"elements"in l.dynamic}function ct(l,d){var E=We();b(l+" in command "+(d||ze())+(E==="unknown"?"":" called from "+E))}function R(l,d,E){l||ct(d,E||ze())}function g(l,d,E,j){l in d||ct("unknown parameter ("+l+")"+B(E)+". possible values: "+Object.keys(d).join(),j||ze())}function H(l,d,E,j){Ce(l,d)||ct("invalid parameter type"+B(E)+". expected "+d+", got "+typeof l,j||ze())}function N(l){l()}function ne(l,d,E){l.texture?Re(l.texture._texture.internalformat,d,"unsupported texture format for attachment"):Re(l.renderbuffer._renderbuffer.format,E,"unsupported renderbuffer format for attachment")}var be=33071,Fe=9728,Pe=9984,He=9985,Ve=9986,Ne=9987,he=5120,Te=5121,ut=5122,Se=5123,_t=5124,Jt=5125,St=5126,$t=32819,xt=32820,jt=33635,pn=34042,Yn=36193,qt={};qt[he]=qt[Te]=1,qt[ut]=qt[Se]=qt[Yn]=qt[jt]=qt[$t]=qt[xt]=2,qt[_t]=qt[Jt]=qt[St]=qt[pn]=4;function Wr(l,d){return l===xt||l===$t||l===jt?2:l===pn?4:qt[l]*d}function vr(l){return!(l&l-1)&&!!l}function Kn(l,d,E){var j,Q=d.width,z=d.height,W=d.channels;O(Q>0&&Q<=E.maxTextureSize&&z>0&&z<=E.maxTextureSize,"invalid texture shape"),(l.wrapS!==be||l.wrapT!==be)&&O(vr(Q)&&vr(z),"incompatible wrap mode for texture, both width and height must be power of 2"),d.mipmask===1?Q!==1&&z!==1&&O(l.minFilter!==Pe&&l.minFilter!==Ve&&l.minFilter!==He&&l.minFilter!==Ne,"min filter requires mipmap"):(O(vr(Q)&&vr(z),"texture must be a square power of 2 to support mipmapping"),O(d.mipmask===(Q<<1)-1,"missing or incomplete mipmap data")),d.type===St&&(E.extensions.indexOf("oes_texture_float_linear")<0&&O(l.minFilter===Fe&&l.magFilter===Fe,"filter not supported, must enable oes_texture_float_linear"),O(!l.genMipmaps,"mipmap generation not supported with float textures"));var ie=d.images;for(j=0;j<16;++j)if(ie[j]){var se=Q>>j,le=z>>j;O(d.mipmask&1<<j,"missing mipmap data");var oe=ie[j];if(O(oe.width===se&&oe.height===le,"invalid shape for mip images"),O(oe.format===d.format&&oe.internalformat===d.internalformat&&oe.type===d.type,"incompatible type for mip image"),!oe.compressed)if(oe.data){var de=Math.ceil(Wr(oe.type,W)*se/oe.unpackAlignment)*oe.unpackAlignment;O(oe.data.byteLength===de*le,"invalid data for image, buffer size is inconsistent with image format")}else oe.element||oe.copy}else l.genMipmaps||O((d.mipmask&1<<j)===0,"extra mipmap data");d.compressed&&O(!l.genMipmaps,"mipmap generation for compressed images not supported")}function yr(l,d,E,j){var Q=l.width,z=l.height,W=l.channels;O(Q>0&&Q<=j.maxTextureSize&&z>0&&z<=j.maxTextureSize,"invalid texture shape"),O(Q===z,"cube map must be square"),O(d.wrapS===be&&d.wrapT===be,"wrap mode not supported by cube map");for(var ie=0;ie<E.length;++ie){var se=E[ie];O(se.width===Q&&se.height===z,"inconsistent cube map face shape"),d.genMipmaps&&(O(!se.compressed,"can not generate mipmap for compressed textures"),O(se.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var le=se.images,oe=0;oe<16;++oe){var de=le[oe];if(de){var ve=Q>>oe,ae=z>>oe;O(se.mipmask&1<<oe,"missing mipmap data"),O(de.width===ve&&de.height===ae,"invalid shape for mip images"),O(de.format===l.format&&de.internalformat===l.internalformat&&de.type===l.type,"incompatible type for mip image"),de.compressed||(de.data?O(de.data.byteLength===ve*ae*Math.max(Wr(de.type,W),de.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):de.element||de.copy)}}}}var p=o(O,{optional:N,raise:b,commandRaise:ct,command:R,parameter:M,commandParameter:g,constructor:yt,type:ge,commandType:H,isTypedArray:xe,nni:we,oneOf:Re,shaderError:wt,linkError:qe,callSite:We,saveCommandRef:pt,saveDrawInfo:bt,framebufferFormat:ne,guessCommand:ze,texture2D:Kn,textureCube:yr}),Qn=0,Zn=0,Jn=5,ei=6;function ur(l,d){this.id=Qn++,this.type=l,this.data=d}function _n(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function br(l){if(l.length===0)return[];var d=l.charAt(0),E=l.charAt(l.length-1);if(l.length>1&&d===E&&(d==='"'||d==="'"))return['"'+_n(l.substr(1,l.length-2))+'"'];var j=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(l);if(j)return br(l.substr(0,j.index)).concat(br(j[1])).concat(br(l.substr(j.index+j[0].length)));var Q=l.split(".");if(Q.length===1)return['"'+_n(l)+'"'];for(var z=[],W=0;W<Q.length;++W)z=z.concat(br(Q[W]));return z}function vn(l){return"["+br(l).join("][")+"]"}function ti(l,d){return new ur(l,vn(d+""))}function ri(l){return typeof l=="function"&&!l._reglType||l instanceof ur}function yn(l,d){if(typeof l=="function")return new ur(Zn,l);if(typeof l=="number"||typeof l=="boolean")return new ur(Jn,l);if(Array.isArray(l))return new ur(ei,l.map((E,j)=>yn(E,d+"["+j+"]")));if(l instanceof ur)return l;p(!1,"invalid option type in uniform "+d)}var Ht={DynamicVariable:ur,define:ti,isDynamic:ri,unbox:yn,accessor:vn},Xr={next:typeof requestAnimationFrame=="function"?function(l){return requestAnimationFrame(l)}:function(l){return setTimeout(l,16)},cancel:typeof cancelAnimationFrame=="function"?function(l){return cancelAnimationFrame(l)}:clearTimeout},bn=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ni(){var l={"":0},d=[""];return{id:function(E){var j=l[E];return j||(j=l[E]=d.length,d.push(E),j)},str:function(E){return d[E]}}}function ii(l,d,E){var j=document.createElement("canvas");o(j.style,{border:0,margin:0,padding:0,top:0,left:0}),l.appendChild(j),l===document.body&&(j.style.position="absolute",o(l.style,{margin:0,padding:0}));function Q(){var ie=window.innerWidth,se=window.innerHeight;if(l!==document.body){var le=l.getBoundingClientRect();ie=le.right-le.left,se=le.bottom-le.top}j.width=E*ie,j.height=E*se,o(j.style,{width:ie+"px",height:se+"px"})}var z;l!==document.body&&typeof ResizeObserver=="function"?(z=new ResizeObserver(function(){setTimeout(Q)}),z.observe(l)):window.addEventListener("resize",Q,!1);function W(){z?z.disconnect():window.removeEventListener("resize",Q),l.removeChild(j)}return Q(),{canvas:j,onDestroy:W}}function ai(l,d){function E(j){try{return l.getContext(j,d)}catch{return null}}return E("webgl")||E("experimental-webgl")||E("webgl-experimental")}function si(l){return typeof l.nodeName=="string"&&typeof l.appendChild=="function"&&typeof l.getBoundingClientRect=="function"}function oi(l){return typeof l.drawArrays=="function"||typeof l.drawElements=="function"}function Be(l){return typeof l=="string"?l.split():(p(Array.isArray(l),"invalid extension array"),l)}function At(l){return typeof l=="string"?(p(typeof document<"u","not supported outside of DOM"),document.querySelector(l)):l}function nr(l){var d=l||{},E,j,Q,z,W={},ie=[],se=[],le=typeof window>"u"?1:window.devicePixelRatio,oe=!1,de=function(me){me&&p.raise(me)},ve=function(){};if(typeof d=="string"?(p(typeof document<"u","selector queries only supported in DOM enviroments"),E=document.querySelector(d),p(E,"invalid query string for element")):typeof d=="object"?si(d)?E=d:oi(d)?(z=d,Q=z.canvas):(p.constructor(d),"gl"in d?z=d.gl:"canvas"in d?Q=At(d.canvas):"container"in d&&(j=At(d.container)),"attributes"in d&&(W=d.attributes,p.type(W,"object","invalid context attributes")),"extensions"in d&&(ie=Be(d.extensions)),"optionalExtensions"in d&&(se=Be(d.optionalExtensions)),"onDone"in d&&(p.type(d.onDone,"function","invalid or missing onDone callback"),de=d.onDone),"profile"in d&&(oe=!!d.profile),"pixelRatio"in d&&(le=+d.pixelRatio,p(le>0,"invalid pixel ratio"))):p.raise("invalid arguments to regl"),E&&(E.nodeName.toLowerCase()==="canvas"?Q=E:j=E),!z){if(!Q){p(typeof document<"u","must manually specify webgl context outside of DOM environments");var ae=ii(j||document.body,de,le);if(!ae)return null;Q=ae.canvas,ve=ae.onDestroy}W.premultipliedAlpha===void 0&&(W.premultipliedAlpha=!0),z=ai(Q,W)}return z?{gl:z,canvas:Q,container:j,extensions:ie,optionalExtensions:se,pixelRatio:le,profile:oe,onDone:de,onDestroy:ve}:(ve(),de("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function cr(l,d){var E={};function j(W){p.type(W,"string","extension name must be string");var ie=W.toLowerCase(),se;try{se=E[ie]=l.getExtension(ie)}catch{}return!!se}for(var Q=0;Q<d.extensions.length;++Q){var z=d.extensions[Q];if(!j(z))return d.onDestroy(),d.onDone('"'+z+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return d.optionalExtensions.forEach(j),{extensions:E,restore:function(){Object.keys(E).forEach(function(W){if(E[W]&&!j(W))throw new Error("(regl): error restoring extension "+W)})}}}function Dt(l,d){for(var E=Array(l),j=0;j<l;++j)E[j]=d(j);return E}var Yr=5120,Kr=5121,ui=5122,Qs=5123,Zs=5124,Js=5125,eo=5126;function to(l){for(var d=16;d<=1<<28;d*=16)if(l<=d)return d;return 0}function ia(l){var d,E;return d=(l>65535)<<4,l>>>=d,E=(l>255)<<3,l>>>=E,d|=E,E=(l>15)<<2,l>>>=E,d|=E,E=(l>3)<<1,l>>>=E,d|=E,d|l>>1}function aa(){var l=Dt(8,function(){return[]});function d(z){var W=to(z),ie=l[ia(W)>>2];return ie.length>0?ie.pop():new ArrayBuffer(W)}function E(z){l[ia(z.byteLength)>>2].push(z)}function j(z,W){var ie=null;switch(z){case Yr:ie=new Int8Array(d(W),0,W);break;case Kr:ie=new Uint8Array(d(W),0,W);break;case ui:ie=new Int16Array(d(2*W),0,W);break;case Qs:ie=new Uint16Array(d(2*W),0,W);break;case Zs:ie=new Int32Array(d(4*W),0,W);break;case Js:ie=new Uint32Array(d(4*W),0,W);break;case eo:ie=new Float32Array(d(4*W),0,W);break;default:return null}return ie.length!==W?ie.subarray(0,W):ie}function Q(z){E(z.buffer)}return{alloc:d,free:E,allocType:j,freeType:Q}}var Ct=aa();Ct.zero=aa();var ro=3408,no=3410,io=3411,ao=3412,so=3413,oo=3414,uo=3415,fo=33901,lo=33902,co=3379,ho=3386,mo=34921,po=36347,_o=36348,vo=35661,yo=35660,bo=34930,go=36349,Eo=34076,wo=34024,So=7936,xo=7937,Ao=7938,To=35724,$o=34047,Oo=36063,Lo=34852,gn=3553,sa=34067,ko=34069,Co=33984,Qr=6408,fi=5126,oa=5121,li=36160,Ro=36053,Po=36064,Io=16384,Fo=function(l,d){var E=1;d.ext_texture_filter_anisotropic&&(E=l.getParameter($o));var j=1,Q=1;d.webgl_draw_buffers&&(j=l.getParameter(Lo),Q=l.getParameter(Oo));var z=!!d.oes_texture_float;if(z){var W=l.createTexture();l.bindTexture(gn,W),l.texImage2D(gn,0,Qr,1,1,0,Qr,fi,null);var ie=l.createFramebuffer();if(l.bindFramebuffer(li,ie),l.framebufferTexture2D(li,Po,gn,W,0),l.bindTexture(gn,null),l.checkFramebufferStatus(li)!==Ro)z=!1;else{l.viewport(0,0,1,1),l.clearColor(1,0,0,1),l.clear(Io);var se=Ct.allocType(fi,4);l.readPixels(0,0,1,1,Qr,fi,se),l.getError()?z=!1:(l.deleteFramebuffer(ie),l.deleteTexture(W),z=se[0]===1),Ct.freeType(se)}}var le=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),oe=!0;if(!le){var de=l.createTexture(),ve=Ct.allocType(oa,36);l.activeTexture(Co),l.bindTexture(sa,de),l.texImage2D(ko,0,Qr,3,3,0,Qr,oa,ve),Ct.freeType(ve),l.bindTexture(sa,null),l.deleteTexture(de),oe=!l.getError()}return{colorBits:[l.getParameter(no),l.getParameter(io),l.getParameter(ao),l.getParameter(so)],depthBits:l.getParameter(oo),stencilBits:l.getParameter(uo),subpixelBits:l.getParameter(ro),extensions:Object.keys(d).filter(function(ae){return!!d[ae]}),maxAnisotropic:E,maxDrawbuffers:j,maxColorAttachments:Q,pointSizeDims:l.getParameter(fo),lineWidthDims:l.getParameter(lo),maxViewportDims:l.getParameter(ho),maxCombinedTextureUnits:l.getParameter(vo),maxCubeMapSize:l.getParameter(Eo),maxRenderbufferSize:l.getParameter(wo),maxTextureUnits:l.getParameter(bo),maxTextureSize:l.getParameter(co),maxAttributes:l.getParameter(mo),maxVertexUniforms:l.getParameter(po),maxVertexTextureUnits:l.getParameter(yo),maxVaryingVectors:l.getParameter(_o),maxFragmentUniforms:l.getParameter(go),glsl:l.getParameter(To),renderer:l.getParameter(xo),vendor:l.getParameter(So),version:l.getParameter(Ao),readFloat:z,npotTextureCube:oe}};function er(l){return!!l&&typeof l=="object"&&Array.isArray(l.shape)&&Array.isArray(l.stride)&&typeof l.offset=="number"&&l.shape.length===l.stride.length&&(Array.isArray(l.data)||s(l.data))}var Kt=function(l){return Object.keys(l).map(function(d){return l[d]})},En={shape:Do,flatten:Bo};function Mo(l,d,E){for(var j=0;j<d;++j)E[j]=l[j]}function No(l,d,E,j){for(var Q=0,z=0;z<d;++z)for(var W=l[z],ie=0;ie<E;++ie)j[Q++]=W[ie]}function ua(l,d,E,j,Q,z){for(var W=z,ie=0;ie<d;++ie)for(var se=l[ie],le=0;le<E;++le)for(var oe=se[le],de=0;de<j;++de)Q[W++]=oe[de]}function fa(l,d,E,j,Q){for(var z=1,W=E+1;W<d.length;++W)z*=d[W];var ie=d[E];if(d.length-E===4){var se=d[E+1],le=d[E+2],oe=d[E+3];for(W=0;W<ie;++W)ua(l[W],se,le,oe,j,Q),Q+=z}else for(W=0;W<ie;++W)fa(l[W],d,E+1,j,Q),Q+=z}function Bo(l,d,E,j){var Q=1;if(d.length)for(var z=0;z<d.length;++z)Q*=d[z];else Q=0;var W=j||Ct.allocType(E,Q);switch(d.length){case 0:break;case 1:Mo(l,d[0],W);break;case 2:No(l,d[0],d[1],W);break;case 3:ua(l,d[0],d[1],d[2],W,0);break;default:fa(l,d,0,W,0)}return W}function Do(l){for(var d=[],E=l;E.length;E=E[0])d.push(E.length);return d}var ci={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Go=5120,Uo=5122,Vo=5124,zo=5121,jo=5123,qo=5125,Ho=5126,Wo=5126,gr={int8:Go,int16:Uo,int32:Vo,uint8:zo,uint16:jo,uint32:qo,float:Ho,float32:Wo},Xo=35048,Yo=35040,wn={dynamic:Xo,stream:Yo,static:35044},hi=En.flatten,la=En.shape,ca=35044,Ko=35040,di=5121,mi=5126,hr=[];hr[5120]=1,hr[5122]=2,hr[5124]=4,hr[5121]=1,hr[5123]=2,hr[5125]=4,hr[5126]=4;function Sn(l){return ci[Object.prototype.toString.call(l)]|0}function ha(l,d){for(var E=0;E<d.length;++E)l[E]=d[E]}function da(l,d,E,j,Q,z,W){for(var ie=0,se=0;se<E;++se)for(var le=0;le<j;++le)l[ie++]=d[Q*se+z*le+W]}function Qo(l,d,E,j){var Q=0,z={};function W(D){this.id=Q++,this.buffer=l.createBuffer(),this.type=D,this.usage=ca,this.byteLength=0,this.dimension=1,this.dtype=di,this.persistentData=null,E.profile&&(this.stats={size:0})}W.prototype.bind=function(){l.bindBuffer(this.type,this.buffer)},W.prototype.destroy=function(){ve(this)};var ie=[];function se(D,X){var fe=ie.pop();return fe||(fe=new W(D)),fe.bind(),de(fe,X,Ko,0,1,!1),fe}function le(D){ie.push(D)}function oe(D,X,fe){D.byteLength=X.byteLength,l.bufferData(D.type,X,fe)}function de(D,X,fe,Ee,ee,Ae){var re;if(D.usage=fe,Array.isArray(X)){if(D.dtype=Ee||mi,X.length>0){var pe;if(Array.isArray(X[0])){re=la(X);for(var te=1,_e=1;_e<re.length;++_e)te*=re[_e];D.dimension=te,pe=hi(X,re,D.dtype),oe(D,pe,fe),Ae?D.persistentData=pe:Ct.freeType(pe)}else if(typeof X[0]=="number"){D.dimension=ee;var Me=Ct.allocType(D.dtype,X.length);ha(Me,X),oe(D,Me,fe),Ae?D.persistentData=Me:Ct.freeType(Me)}else s(X[0])?(D.dimension=X[0].length,D.dtype=Ee||Sn(X[0])||mi,pe=hi(X,[X.length,X[0].length],D.dtype),oe(D,pe,fe),Ae?D.persistentData=pe:Ct.freeType(pe)):p.raise("invalid buffer data")}}else if(s(X))D.dtype=Ee||Sn(X),D.dimension=ee,oe(D,X,fe),Ae&&(D.persistentData=new Uint8Array(new Uint8Array(X.buffer)));else if(er(X)){re=X.shape;var Xe=X.stride,ye=X.offset,ce=0,J=0,je=0,Ze=0;re.length===1?(ce=re[0],J=1,je=Xe[0],Ze=0):re.length===2?(ce=re[0],J=re[1],je=Xe[0],Ze=Xe[1]):p.raise("invalid shape"),D.dtype=Ee||Sn(X.data)||mi,D.dimension=J;var Le=Ct.allocType(D.dtype,ce*J);da(Le,X.data,ce,J,je,Ze,ye),oe(D,Le,fe),Ae?D.persistentData=Le:Ct.freeType(Le)}else X instanceof ArrayBuffer?(D.dtype=di,D.dimension=ee,oe(D,X,fe),Ae&&(D.persistentData=new Uint8Array(new Uint8Array(X)))):p.raise("invalid buffer data")}function ve(D){d.bufferCount--,j(D);var X=D.buffer;p(X,"buffer must not be deleted already"),l.deleteBuffer(X),D.buffer=null,delete z[D.id]}function ae(D,X,fe,Ee){d.bufferCount++;var ee=new W(X);z[ee.id]=ee;function Ae(te){var _e=ca,Me=null,Xe=0,ye=0,ce=1;return Array.isArray(te)||s(te)||er(te)||te instanceof ArrayBuffer?Me=te:typeof te=="number"?Xe=te|0:te&&(p.type(te,"object","buffer arguments must be an object, a number or an array"),"data"in te&&(p(Me===null||Array.isArray(Me)||s(Me)||er(Me),"invalid data for buffer"),Me=te.data),"usage"in te&&(p.parameter(te.usage,wn,"invalid buffer usage"),_e=wn[te.usage]),"type"in te&&(p.parameter(te.type,gr,"invalid buffer type"),ye=gr[te.type]),"dimension"in te&&(p.type(te.dimension,"number","invalid dimension"),ce=te.dimension|0),"length"in te&&(p.nni(Xe,"buffer length must be a nonnegative integer"),Xe=te.length|0)),ee.bind(),Me?de(ee,Me,_e,ye,ce,Ee):(Xe&&l.bufferData(ee.type,Xe,_e),ee.dtype=ye||di,ee.usage=_e,ee.dimension=ce,ee.byteLength=Xe),E.profile&&(ee.stats.size=ee.byteLength*hr[ee.dtype]),Ae}function re(te,_e){p(_e+te.byteLength<=ee.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+te.byteLength+" starting from offset "+_e+" to a buffer of size "+ee.byteLength),l.bufferSubData(ee.type,_e,te)}function pe(te,_e){var Me=(_e||0)|0,Xe;if(ee.bind(),s(te)||te instanceof ArrayBuffer)re(te,Me);else if(Array.isArray(te)){if(te.length>0)if(typeof te[0]=="number"){var ye=Ct.allocType(ee.dtype,te.length);ha(ye,te),re(ye,Me),Ct.freeType(ye)}else if(Array.isArray(te[0])||s(te[0])){Xe=la(te);var ce=hi(te,Xe,ee.dtype);re(ce,Me),Ct.freeType(ce)}else p.raise("invalid buffer data")}else if(er(te)){Xe=te.shape;var J=te.stride,je=0,Ze=0,Le=0,it=0;Xe.length===1?(je=Xe[0],Ze=1,Le=J[0],it=0):Xe.length===2?(je=Xe[0],Ze=Xe[1],Le=J[0],it=J[1]):p.raise("invalid shape");var Ye=Array.isArray(te.data)?ee.dtype:Sn(te.data),rt=Ct.allocType(Ye,je*Ze);da(rt,te.data,je,Ze,Le,it,te.offset),re(rt,Me),Ct.freeType(rt)}else p.raise("invalid data for buffer subdata");return Ae}return fe||Ae(D),Ae._reglType="buffer",Ae._buffer=ee,Ae.subdata=pe,E.profile&&(Ae.stats=ee.stats),Ae.destroy=function(){ve(ee)},Ae}function me(){Kt(z).forEach(function(D){D.buffer=l.createBuffer(),l.bindBuffer(D.type,D.buffer),l.bufferData(D.type,D.persistentData||D.byteLength,D.usage)})}return E.profile&&(d.getTotalBufferSize=function(){var D=0;return Object.keys(z).forEach(function(X){D+=z[X].stats.size}),D}),{create:ae,createStream:se,destroyStream:le,clear:function(){Kt(z).forEach(ve),ie.forEach(ve)},getBuffer:function(D){return D&&D._buffer instanceof W?D._buffer:null},restore:me,_initBuffer:de}}var Zo=0,Jo=0,eu=1,tu=1,ru=4,nu=4,Cr={points:Zo,point:Jo,lines:eu,line:tu,triangles:ru,triangle:nu,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},iu=0,au=1,Zr=4,su=5120,Rr=5121,ma=5122,Pr=5123,pa=5124,Er=5125,pi=34963,ou=35040,uu=35044;function fu(l,d,E,j){var Q={},z=0,W={uint8:Rr,uint16:Pr};d.oes_element_index_uint&&(W.uint32=Er);function ie(me){this.id=z++,Q[this.id]=this,this.buffer=me,this.primType=Zr,this.vertCount=0,this.type=0}ie.prototype.bind=function(){this.buffer.bind()};var se=[];function le(me){var D=se.pop();return D||(D=new ie(E.create(null,pi,!0,!1)._buffer)),de(D,me,ou,-1,-1,0,0),D}function oe(me){se.push(me)}function de(me,D,X,fe,Ee,ee,Ae){me.buffer.bind();var re;if(D){var pe=Ae;!Ae&&(!s(D)||er(D)&&!s(D.data))&&(pe=d.oes_element_index_uint?Er:Pr),E._initBuffer(me.buffer,D,X,pe,3)}else l.bufferData(pi,ee,X),me.buffer.dtype=re||Rr,me.buffer.usage=X,me.buffer.dimension=3,me.buffer.byteLength=ee;if(re=Ae,!Ae){switch(me.buffer.dtype){case Rr:case su:re=Rr;break;case Pr:case ma:re=Pr;break;case Er:case pa:re=Er;break;default:p.raise("unsupported type for element array")}me.buffer.dtype=re}me.type=re,p(re!==Er||!!d.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var te=Ee;te<0&&(te=me.buffer.byteLength,re===Pr?te>>=1:re===Er&&(te>>=2)),me.vertCount=te;var _e=fe;if(fe<0){_e=Zr;var Me=me.buffer.dimension;Me===1&&(_e=iu),Me===2&&(_e=au),Me===3&&(_e=Zr)}me.primType=_e}function ve(me){j.elementsCount--,p(me.buffer!==null,"must not double destroy elements"),delete Q[me.id],me.buffer.destroy(),me.buffer=null}function ae(me,D){var X=E.create(null,pi,!0),fe=new ie(X._buffer);j.elementsCount++;function Ee(ee){if(!ee)X(),fe.primType=Zr,fe.vertCount=0,fe.type=Rr;else if(typeof ee=="number")X(ee),fe.primType=Zr,fe.vertCount=ee|0,fe.type=Rr;else{var Ae=null,re=uu,pe=-1,te=-1,_e=0,Me=0;Array.isArray(ee)||s(ee)||er(ee)?Ae=ee:(p.type(ee,"object","invalid arguments for elements"),"data"in ee&&(Ae=ee.data,p(Array.isArray(Ae)||s(Ae)||er(Ae),"invalid data for element buffer")),"usage"in ee&&(p.parameter(ee.usage,wn,"invalid element buffer usage"),re=wn[ee.usage]),"primitive"in ee&&(p.parameter(ee.primitive,Cr,"invalid element buffer primitive"),pe=Cr[ee.primitive]),"count"in ee&&(p(typeof ee.count=="number"&&ee.count>=0,"invalid vertex count for elements"),te=ee.count|0),"type"in ee&&(p.parameter(ee.type,W,"invalid buffer type"),Me=W[ee.type]),"length"in ee?_e=ee.length|0:(_e=te,Me===Pr||Me===ma?_e*=2:(Me===Er||Me===pa)&&(_e*=4))),de(fe,Ae,re,pe,te,_e,Me)}return Ee}return Ee(me),Ee._reglType="elements",Ee._elements=fe,Ee.subdata=function(ee,Ae){return X.subdata(ee,Ae),Ee},Ee.destroy=function(){ve(fe)},Ee}return{create:ae,createStream:le,destroyStream:oe,getElements:function(me){return typeof me=="function"&&me._elements instanceof ie?me._elements:null},clear:function(){Kt(Q).forEach(ve)}}}var _a=new Float32Array(1),lu=new Uint32Array(_a.buffer),cu=5123;function va(l){for(var d=Ct.allocType(cu,l.length),E=0;E<l.length;++E)if(isNaN(l[E]))d[E]=65535;else if(l[E]===1/0)d[E]=31744;else if(l[E]===-1/0)d[E]=64512;else{_a[0]=l[E];var j=lu[0],Q=j>>>31<<15,z=(j<<1>>>24)-127,W=j>>13&(1<<10)-1;if(z<-24)d[E]=Q;else if(z<-14){var ie=-14-z;d[E]=Q+(W+(1<<10)>>ie)}else z>15?d[E]=Q+31744:d[E]=Q+(z+15<<10)+W}return d}function Ot(l){return Array.isArray(l)||s(l)}var ya=function(l){return!(l&l-1)&&!!l},hu=34467,ir=3553,_i=34067,xn=34069,wr=6408,vi=6406,An=6407,Jr=6409,Tn=6410,ba=32854,yi=32855,ga=36194,du=32819,mu=32820,pu=33635,_u=34042,bi=6402,$n=34041,gi=35904,Ei=35906,Ir=36193,wi=33776,Si=33777,xi=33778,Ai=33779,Ea=35986,wa=35987,Sa=34798,xa=35840,Aa=35841,Ta=35842,$a=35843,Oa=36196,Fr=5121,Ti=5123,$i=5125,en=5126,vu=10242,yu=10243,bu=10497,Oi=33071,gu=33648,Eu=10240,wu=10241,Li=9728,Su=9729,ki=9984,La=9985,ka=9986,Ci=9987,xu=33170,On=4352,Au=4353,Tu=4354,$u=34046,Ou=3317,Lu=37440,ku=37441,Cu=37443,Ca=37444,tn=33984,Ru=[ki,ka,La,Ci],Ln=[0,Jr,Tn,An,wr],Qt={};Qt[Jr]=Qt[vi]=Qt[bi]=1,Qt[$n]=Qt[Tn]=2,Qt[An]=Qt[gi]=3,Qt[wr]=Qt[Ei]=4;function Mr(l){return"[object "+l+"]"}var Ra=Mr("HTMLCanvasElement"),Pa=Mr("OffscreenCanvas"),Ia=Mr("CanvasRenderingContext2D"),Fa=Mr("ImageBitmap"),Ma=Mr("HTMLImageElement"),Na=Mr("HTMLVideoElement"),Pu=Object.keys(ci).concat([Ra,Pa,Ia,Fa,Ma,Na]),Nr=[];Nr[Fr]=1,Nr[en]=4,Nr[Ir]=2,Nr[Ti]=2,Nr[$i]=4;var Ut=[];Ut[ba]=2,Ut[yi]=2,Ut[ga]=2,Ut[$n]=4,Ut[wi]=.5,Ut[Si]=.5,Ut[xi]=1,Ut[Ai]=1,Ut[Ea]=.5,Ut[wa]=1,Ut[Sa]=1,Ut[xa]=.5,Ut[Aa]=.25,Ut[Ta]=.5,Ut[$a]=.25,Ut[Oa]=.5;function Ba(l){return Array.isArray(l)&&(l.length===0||typeof l[0]=="number")}function Da(l){if(!Array.isArray(l))return!1;var d=l.length;return!(d===0||!Ot(l[0]))}function Sr(l){return Object.prototype.toString.call(l)}function Ga(l){return Sr(l)===Ra}function Ua(l){return Sr(l)===Pa}function Iu(l){return Sr(l)===Ia}function Fu(l){return Sr(l)===Fa}function Mu(l){return Sr(l)===Ma}function Nu(l){return Sr(l)===Na}function Ri(l){if(!l)return!1;var d=Sr(l);return Pu.indexOf(d)>=0?!0:Ba(l)||Da(l)||er(l)}function Va(l){return ci[Object.prototype.toString.call(l)]|0}function Bu(l,d){var E=d.length;switch(l.type){case Fr:case Ti:case $i:case en:var j=Ct.allocType(l.type,E);j.set(d),l.data=j;break;case Ir:l.data=va(d);break;default:p.raise("unsupported texture type, must specify a typed array")}}function za(l,d){return Ct.allocType(l.type===Ir?en:l.type,d)}function ja(l,d){l.type===Ir?(l.data=va(d),Ct.freeType(d)):l.data=d}function Du(l,d,E,j,Q,z){for(var W=l.width,ie=l.height,se=l.channels,le=W*ie*se,oe=za(l,le),de=0,ve=0;ve<ie;++ve)for(var ae=0;ae<W;++ae)for(var me=0;me<se;++me)oe[de++]=d[E*ae+j*ve+Q*me+z];ja(l,oe)}function kn(l,d,E,j,Q,z){var W;if(typeof Ut[l]<"u"?W=Ut[l]:W=Qt[l]*Nr[d],z&&(W*=6),Q){for(var ie=0,se=E;se>=1;)ie+=W*se*se,se/=2;return ie}else return W*E*j}function Gu(l,d,E,j,Q,z,W){var ie={"don't care":On,"dont care":On,nice:Tu,fast:Au},se={repeat:bu,clamp:Oi,mirror:gu},le={nearest:Li,linear:Su},oe=o({mipmap:Ci,"nearest mipmap nearest":ki,"linear mipmap nearest":La,"nearest mipmap linear":ka,"linear mipmap linear":Ci},le),de={none:0,browser:Ca},ve={uint8:Fr,rgba4:du,rgb565:pu,"rgb5 a1":mu},ae={alpha:vi,luminance:Jr,"luminance alpha":Tn,rgb:An,rgba:wr,rgba4:ba,"rgb5 a1":yi,rgb565:ga},me={};d.ext_srgb&&(ae.srgb=gi,ae.srgba=Ei),d.oes_texture_float&&(ve.float32=ve.float=en),d.oes_texture_half_float&&(ve.float16=ve["half float"]=Ir),d.webgl_depth_texture&&(o(ae,{depth:bi,"depth stencil":$n}),o(ve,{uint16:Ti,uint32:$i,"depth stencil":_u})),d.webgl_compressed_texture_s3tc&&o(me,{"rgb s3tc dxt1":wi,"rgba s3tc dxt1":Si,"rgba s3tc dxt3":xi,"rgba s3tc dxt5":Ai}),d.webgl_compressed_texture_atc&&o(me,{"rgb atc":Ea,"rgba atc explicit alpha":wa,"rgba atc interpolated alpha":Sa}),d.webgl_compressed_texture_pvrtc&&o(me,{"rgb pvrtc 4bppv1":xa,"rgb pvrtc 2bppv1":Aa,"rgba pvrtc 4bppv1":Ta,"rgba pvrtc 2bppv1":$a}),d.webgl_compressed_texture_etc1&&(me["rgb etc1"]=Oa);var D=Array.prototype.slice.call(l.getParameter(hu));Object.keys(me).forEach(function(y){var q=me[y];D.indexOf(q)>=0&&(ae[y]=q)});var X=Object.keys(ae);E.textureFormats=X;var fe=[];Object.keys(ae).forEach(function(y){var q=ae[y];fe[q]=y});var Ee=[];Object.keys(ve).forEach(function(y){var q=ve[y];Ee[q]=y});var ee=[];Object.keys(le).forEach(function(y){var q=le[y];ee[q]=y});var Ae=[];Object.keys(oe).forEach(function(y){var q=oe[y];Ae[q]=y});var re=[];Object.keys(se).forEach(function(y){var q=se[y];re[q]=y});var pe=X.reduce(function(y,q){var V=ae[q];return V===Jr||V===vi||V===Jr||V===Tn||V===bi||V===$n||d.ext_srgb&&(V===gi||V===Ei)?y[V]=V:V===yi||q.indexOf("rgba")>=0?y[V]=wr:y[V]=An,y},{});function te(){this.internalformat=wr,this.format=wr,this.type=Fr,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Ca,this.width=0,this.height=0,this.channels=0}function _e(y,q){y.internalformat=q.internalformat,y.format=q.format,y.type=q.type,y.compressed=q.compressed,y.premultiplyAlpha=q.premultiplyAlpha,y.flipY=q.flipY,y.unpackAlignment=q.unpackAlignment,y.colorSpace=q.colorSpace,y.width=q.width,y.height=q.height,y.channels=q.channels}function Me(y,q){if(!(typeof q!="object"||!q)){if("premultiplyAlpha"in q&&(p.type(q.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),y.premultiplyAlpha=q.premultiplyAlpha),"flipY"in q&&(p.type(q.flipY,"boolean","invalid texture flip"),y.flipY=q.flipY),"alignment"in q&&(p.oneOf(q.alignment,[1,2,4,8],"invalid texture unpack alignment"),y.unpackAlignment=q.alignment),"colorSpace"in q&&(p.parameter(q.colorSpace,de,"invalid colorSpace"),y.colorSpace=de[q.colorSpace]),"type"in q){var V=q.type;p(d.oes_texture_float||!(V==="float"||V==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),p(d.oes_texture_half_float||!(V==="half float"||V==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),p(d.webgl_depth_texture||!(V==="uint16"||V==="uint32"||V==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),p.parameter(V,ve,"invalid texture type"),y.type=ve[V]}var $e=y.width,at=y.height,_=y.channels,h=!1;"shape"in q?(p(Array.isArray(q.shape)&&q.shape.length>=2,"shape must be an array"),$e=q.shape[0],at=q.shape[1],q.shape.length===3&&(_=q.shape[2],p(_>0&&_<=4,"invalid number of channels"),h=!0),p($e>=0&&$e<=E.maxTextureSize,"invalid width"),p(at>=0&&at<=E.maxTextureSize,"invalid height")):("radius"in q&&($e=at=q.radius,p($e>=0&&$e<=E.maxTextureSize,"invalid radius")),"width"in q&&($e=q.width,p($e>=0&&$e<=E.maxTextureSize,"invalid width")),"height"in q&&(at=q.height,p(at>=0&&at<=E.maxTextureSize,"invalid height")),"channels"in q&&(_=q.channels,p(_>0&&_<=4,"invalid number of channels"),h=!0)),y.width=$e|0,y.height=at|0,y.channels=_|0;var A=!1;if("format"in q){var I=q.format;p(d.webgl_depth_texture||!(I==="depth"||I==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),p.parameter(I,ae,"invalid texture format");var G=y.internalformat=ae[I];y.format=pe[G],I in ve&&("type"in q||(y.type=ve[I])),I in me&&(y.compressed=!0),A=!0}!h&&A?y.channels=Qt[y.format]:h&&!A?y.channels!==Ln[y.format]&&(y.format=y.internalformat=Ln[y.channels]):A&&h&&p(y.channels===Qt[y.format],"number of channels inconsistent with specified format")}}function Xe(y){l.pixelStorei(Lu,y.flipY),l.pixelStorei(ku,y.premultiplyAlpha),l.pixelStorei(Cu,y.colorSpace),l.pixelStorei(Ou,y.unpackAlignment)}function ye(){te.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function ce(y,q){var V=null;if(Ri(q)?V=q:q&&(p.type(q,"object","invalid pixel data type"),Me(y,q),"x"in q&&(y.xOffset=q.x|0),"y"in q&&(y.yOffset=q.y|0),Ri(q.data)&&(V=q.data)),p(!y.compressed||V instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),q.copy){p(!V,"can not specify copy and data field for the same texture");var $e=Q.viewportWidth,at=Q.viewportHeight;y.width=y.width||$e-y.xOffset,y.height=y.height||at-y.yOffset,y.needsCopy=!0,p(y.xOffset>=0&&y.xOffset<$e&&y.yOffset>=0&&y.yOffset<at&&y.width>0&&y.width<=$e&&y.height>0&&y.height<=at,"copy texture read out of bounds")}else if(!V)y.width=y.width||1,y.height=y.height||1,y.channels=y.channels||4;else if(s(V))y.channels=y.channels||4,y.data=V,!("type"in q)&&y.type===Fr&&(y.type=Va(V));else if(Ba(V))y.channels=y.channels||4,Bu(y,V),y.alignment=1,y.needsFree=!0;else if(er(V)){var _=V.data;!Array.isArray(_)&&y.type===Fr&&(y.type=Va(_));var h=V.shape,A=V.stride,I,G,L,$,k,v;h.length===3?(L=h[2],v=A[2]):(p(h.length===2,"invalid ndarray pixel data, must be 2 or 3D"),L=1,v=1),I=h[0],G=h[1],$=A[0],k=A[1],y.alignment=1,y.width=I,y.height=G,y.channels=L,y.format=y.internalformat=Ln[L],y.needsFree=!0,Du(y,_,$,k,v,V.offset)}else if(Ga(V)||Ua(V)||Iu(V))Ga(V)||Ua(V)?y.element=V:y.element=V.canvas,y.width=y.element.width,y.height=y.element.height,y.channels=4;else if(Fu(V))y.element=V,y.width=V.width,y.height=V.height,y.channels=4;else if(Mu(V))y.element=V,y.width=V.naturalWidth,y.height=V.naturalHeight,y.channels=4;else if(Nu(V))y.element=V,y.width=V.videoWidth,y.height=V.videoHeight,y.channels=4;else if(Da(V)){var w=y.width||V[0].length,m=y.height||V.length,C=y.channels;Ot(V[0][0])?C=C||V[0][0].length:C=C||1;for(var U=En.shape(V),K=1,Z=0;Z<U.length;++Z)K*=U[Z];var Y=za(y,K);En.flatten(V,U,"",Y),ja(y,Y),y.alignment=1,y.width=w,y.height=m,y.channels=C,y.format=y.internalformat=Ln[C],y.needsFree=!0}y.type===en?p(E.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):y.type===Ir&&p(E.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function J(y,q,V){var $e=y.element,at=y.data,_=y.internalformat,h=y.format,A=y.type,I=y.width,G=y.height;Xe(y),$e?l.texImage2D(q,V,h,h,A,$e):y.compressed?l.compressedTexImage2D(q,V,_,I,G,0,at):y.needsCopy?(j(),l.copyTexImage2D(q,V,h,y.xOffset,y.yOffset,I,G,0)):l.texImage2D(q,V,h,I,G,0,h,A,at||null)}function je(y,q,V,$e,at){var _=y.element,h=y.data,A=y.internalformat,I=y.format,G=y.type,L=y.width,$=y.height;Xe(y),_?l.texSubImage2D(q,at,V,$e,I,G,_):y.compressed?l.compressedTexSubImage2D(q,at,V,$e,A,L,$,h):y.needsCopy?(j(),l.copyTexSubImage2D(q,at,V,$e,y.xOffset,y.yOffset,L,$)):l.texSubImage2D(q,at,V,$e,L,$,I,G,h)}var Ze=[];function Le(){return Ze.pop()||new ye}function it(y){y.needsFree&&Ct.freeType(y.data),ye.call(y),Ze.push(y)}function Ye(){te.call(this),this.genMipmaps=!1,this.mipmapHint=On,this.mipmask=0,this.images=Array(16)}function rt(y,q,V){var $e=y.images[0]=Le();y.mipmask=1,$e.width=y.width=q,$e.height=y.height=V,$e.channels=y.channels=4}function dt(y,q){var V=null;if(Ri(q))V=y.images[0]=Le(),_e(V,y),ce(V,q),y.mipmask=1;else if(Me(y,q),Array.isArray(q.mipmap))for(var $e=q.mipmap,at=0;at<$e.length;++at)V=y.images[at]=Le(),_e(V,y),V.width>>=at,V.height>>=at,ce(V,$e[at]),y.mipmask|=1<<at;else V=y.images[0]=Le(),_e(V,y),ce(V,q),y.mipmask=1;_e(y,y.images[0]),y.compressed&&(y.internalformat===wi||y.internalformat===Si||y.internalformat===xi||y.internalformat===Ai)&&p(y.width%4===0&&y.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Pt(y,q){for(var V=y.images,$e=0;$e<V.length;++$e){if(!V[$e])return;J(V[$e],q,$e)}}var Bt=[];function ot(){var y=Bt.pop()||new Ye;te.call(y),y.mipmask=0;for(var q=0;q<16;++q)y.images[q]=null;return y}function Ft(y){for(var q=y.images,V=0;V<q.length;++V)q[V]&&it(q[V]),q[V]=null;Bt.push(y)}function Et(){this.minFilter=Li,this.magFilter=Li,this.wrapS=Oi,this.wrapT=Oi,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=On}function It(y,q){if("min"in q){var V=q.min;p.parameter(V,oe),y.minFilter=oe[V],Ru.indexOf(y.minFilter)>=0&&!("faces"in q)&&(y.genMipmaps=!0)}if("mag"in q){var $e=q.mag;p.parameter($e,le),y.magFilter=le[$e]}var at=y.wrapS,_=y.wrapT;if("wrap"in q){var h=q.wrap;typeof h=="string"?(p.parameter(h,se),at=_=se[h]):Array.isArray(h)&&(p.parameter(h[0],se),p.parameter(h[1],se),at=se[h[0]],_=se[h[1]])}else{if("wrapS"in q){var A=q.wrapS;p.parameter(A,se),at=se[A]}if("wrapT"in q){var I=q.wrapT;p.parameter(I,se),_=se[I]}}if(y.wrapS=at,y.wrapT=_,"anisotropic"in q){var G=q.anisotropic;p(typeof G=="number"&&G>=1&&G<=E.maxAnisotropic,"aniso samples must be between 1 and "),y.anisotropic=q.anisotropic}if("mipmap"in q){var L=!1;switch(typeof q.mipmap){case"string":p.parameter(q.mipmap,ie,"invalid mipmap hint"),y.mipmapHint=ie[q.mipmap],y.genMipmaps=!0,L=!0;break;case"boolean":L=y.genMipmaps=q.mipmap;break;case"object":p(Array.isArray(q.mipmap),"invalid mipmap type"),y.genMipmaps=!1,L=!0;break;default:p.raise("invalid mipmap type")}L&&!("min"in q)&&(y.minFilter=ki)}}function Mt(y,q){l.texParameteri(q,wu,y.minFilter),l.texParameteri(q,Eu,y.magFilter),l.texParameteri(q,vu,y.wrapS),l.texParameteri(q,yu,y.wrapT),d.ext_texture_filter_anisotropic&&l.texParameteri(q,$u,y.anisotropic),y.genMipmaps&&(l.hint(xu,y.mipmapHint),l.generateMipmap(q))}var Nt=0,Gt={},Vt=E.maxTextureUnits,Lt=Array(Vt).map(function(){return null});function Je(y){te.call(this),this.mipmask=0,this.internalformat=wr,this.id=Nt++,this.refCount=1,this.target=y,this.texture=l.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Et,W.profile&&(this.stats={size:0})}function zt(y){l.activeTexture(tn),l.bindTexture(y.target,y.texture)}function vt(){var y=Lt[0];y?l.bindTexture(y.target,y.texture):l.bindTexture(ir,null)}function De(y){var q=y.texture;p(q,"must not double destroy texture");var V=y.unit,$e=y.target;V>=0&&(l.activeTexture(tn+V),l.bindTexture($e,null),Lt[V]=null),l.deleteTexture(q),y.texture=null,y.params=null,y.pixels=null,y.refCount=0,delete Gt[y.id],z.textureCount--}o(Je.prototype,{bind:function(){var y=this;y.bindCount+=1;var q=y.unit;if(q<0){for(var V=0;V<Vt;++V){var $e=Lt[V];if($e){if($e.bindCount>0)continue;$e.unit=-1}Lt[V]=y,q=V;break}q>=Vt&&p.raise("insufficient number of texture units"),W.profile&&z.maxTextureUnits<q+1&&(z.maxTextureUnits=q+1),y.unit=q,l.activeTexture(tn+q),l.bindTexture(y.target,y.texture)}return q},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&De(this)}});function st(y,q){var V=new Je(ir);Gt[V.id]=V,z.textureCount++;function $e(h,A){var I=V.texInfo;Et.call(I);var G=ot();return typeof h=="number"?typeof A=="number"?rt(G,h|0,A|0):rt(G,h|0,h|0):h?(p.type(h,"object","invalid arguments to regl.texture"),It(I,h),dt(G,h)):rt(G,1,1),I.genMipmaps&&(G.mipmask=(G.width<<1)-1),V.mipmask=G.mipmask,_e(V,G),p.texture2D(I,G,E),V.internalformat=G.internalformat,$e.width=G.width,$e.height=G.height,zt(V),Pt(G,ir),Mt(I,ir),vt(),Ft(G),W.profile&&(V.stats.size=kn(V.internalformat,V.type,G.width,G.height,I.genMipmaps,!1)),$e.format=fe[V.internalformat],$e.type=Ee[V.type],$e.mag=ee[I.magFilter],$e.min=Ae[I.minFilter],$e.wrapS=re[I.wrapS],$e.wrapT=re[I.wrapT],$e}function at(h,A,I,G){p(!!h,"must specify image data");var L=A|0,$=I|0,k=G|0,v=Le();return _e(v,V),v.width=0,v.height=0,ce(v,h),v.width=v.width||(V.width>>k)-L,v.height=v.height||(V.height>>k)-$,p(V.type===v.type&&V.format===v.format&&V.internalformat===v.internalformat,"incompatible format for texture.subimage"),p(L>=0&&$>=0&&L+v.width<=V.width&&$+v.height<=V.height,"texture.subimage write out of bounds"),p(V.mipmask&1<<k,"missing mipmap data"),p(v.data||v.element||v.needsCopy,"missing image data"),zt(V),je(v,ir,L,$,k),vt(),it(v),$e}function _(h,A){var I=h|0,G=A|0||I;if(I===V.width&&G===V.height)return $e;$e.width=V.width=I,$e.height=V.height=G,zt(V);for(var L=0;V.mipmask>>L;++L){var $=I>>L,k=G>>L;if(!$||!k)break;l.texImage2D(ir,L,V.format,$,k,0,V.format,V.type,null)}return vt(),W.profile&&(V.stats.size=kn(V.internalformat,V.type,I,G,!1,!1)),$e}return $e(y,q),$e.subimage=at,$e.resize=_,$e._reglType="texture2d",$e._texture=V,W.profile&&($e.stats=V.stats),$e.destroy=function(){V.decRef()},$e}function ht(y,q,V,$e,at,_){var h=new Je(_i);Gt[h.id]=h,z.cubeCount++;var A=new Array(6);function I($,k,v,w,m,C){var U,K=h.texInfo;for(Et.call(K),U=0;U<6;++U)A[U]=ot();if(typeof $=="number"||!$){var Z=$|0||1;for(U=0;U<6;++U)rt(A[U],Z,Z)}else if(typeof $=="object")if(k)dt(A[0],$),dt(A[1],k),dt(A[2],v),dt(A[3],w),dt(A[4],m),dt(A[5],C);else if(It(K,$),Me(h,$),"faces"in $){var Y=$.faces;for(p(Array.isArray(Y)&&Y.length===6,"cube faces must be a length 6 array"),U=0;U<6;++U)p(typeof Y[U]=="object"&&!!Y[U],"invalid input for cube map face"),_e(A[U],h),dt(A[U],Y[U])}else for(U=0;U<6;++U)dt(A[U],$);else p.raise("invalid arguments to cube map");for(_e(h,A[0]),E.npotTextureCube||p(ya(h.width)&&ya(h.height),"your browser does not support non power or two texture dimensions"),K.genMipmaps?h.mipmask=(A[0].width<<1)-1:h.mipmask=A[0].mipmask,p.textureCube(h,K,A,E),h.internalformat=A[0].internalformat,I.width=A[0].width,I.height=A[0].height,zt(h),U=0;U<6;++U)Pt(A[U],xn+U);for(Mt(K,_i),vt(),W.profile&&(h.stats.size=kn(h.internalformat,h.type,I.width,I.height,K.genMipmaps,!0)),I.format=fe[h.internalformat],I.type=Ee[h.type],I.mag=ee[K.magFilter],I.min=Ae[K.minFilter],I.wrapS=re[K.wrapS],I.wrapT=re[K.wrapT],U=0;U<6;++U)Ft(A[U]);return I}function G($,k,v,w,m){p(!!k,"must specify image data"),p(typeof $=="number"&&$===($|0)&&$>=0&&$<6,"invalid face");var C=v|0,U=w|0,K=m|0,Z=Le();return _e(Z,h),Z.width=0,Z.height=0,ce(Z,k),Z.width=Z.width||(h.width>>K)-C,Z.height=Z.height||(h.height>>K)-U,p(h.type===Z.type&&h.format===Z.format&&h.internalformat===Z.internalformat,"incompatible format for texture.subimage"),p(C>=0&&U>=0&&C+Z.width<=h.width&&U+Z.height<=h.height,"texture.subimage write out of bounds"),p(h.mipmask&1<<K,"missing mipmap data"),p(Z.data||Z.element||Z.needsCopy,"missing image data"),zt(h),je(Z,xn+$,C,U,K),vt(),it(Z),I}function L($){var k=$|0;if(k!==h.width){I.width=h.width=k,I.height=h.height=k,zt(h);for(var v=0;v<6;++v)for(var w=0;h.mipmask>>w;++w)l.texImage2D(xn+v,w,h.format,k>>w,k>>w,0,h.format,h.type,null);return vt(),W.profile&&(h.stats.size=kn(h.internalformat,h.type,I.width,I.height,!1,!0)),I}}return I(y,q,V,$e,at,_),I.subimage=G,I.resize=L,I._reglType="textureCube",I._texture=h,W.profile&&(I.stats=h.stats),I.destroy=function(){h.decRef()},I}function kt(){for(var y=0;y<Vt;++y)l.activeTexture(tn+y),l.bindTexture(ir,null),Lt[y]=null;Kt(Gt).forEach(De),z.cubeCount=0,z.textureCount=0}W.profile&&(z.getTotalTextureSize=function(){var y=0;return Object.keys(Gt).forEach(function(q){y+=Gt[q].stats.size}),y});function sr(){for(var y=0;y<Vt;++y){var q=Lt[y];q&&(q.bindCount=0,q.unit=-1,Lt[y]=null)}Kt(Gt).forEach(function(V){V.texture=l.createTexture(),l.bindTexture(V.target,V.texture);for(var $e=0;$e<32;++$e)if((V.mipmask&1<<$e)!==0)if(V.target===ir)l.texImage2D(ir,$e,V.internalformat,V.width>>$e,V.height>>$e,0,V.internalformat,V.type,null);else for(var at=0;at<6;++at)l.texImage2D(xn+at,$e,V.internalformat,V.width>>$e,V.height>>$e,0,V.internalformat,V.type,null);Mt(V.texInfo,V.target)})}function kr(){for(var y=0;y<Vt;++y){var q=Lt[y];q&&(q.bindCount=0,q.unit=-1,Lt[y]=null),l.activeTexture(tn+y),l.bindTexture(ir,null),l.bindTexture(_i,null)}}return{create2D:st,createCube:ht,clear:kt,getTexture:function(y){return null},restore:sr,refresh:kr}}var dr=36161,Cn=32854,qa=32855,Ha=36194,Wa=33189,Xa=36168,Ya=34041,Ka=35907,Qa=34836,Za=34842,Ja=34843,tr=[];tr[Cn]=2,tr[qa]=2,tr[Ha]=2,tr[Wa]=2,tr[Xa]=1,tr[Ya]=4,tr[Ka]=4,tr[Qa]=16,tr[Za]=8,tr[Ja]=6;function es(l,d,E){return tr[l]*d*E}var Uu=function(l,d,E,j,Q){var z={rgba4:Cn,rgb565:Ha,"rgb5 a1":qa,depth:Wa,stencil:Xa,"depth stencil":Ya};d.ext_srgb&&(z.srgba=Ka),d.ext_color_buffer_half_float&&(z.rgba16f=Za,z.rgb16f=Ja),d.webgl_color_buffer_float&&(z.rgba32f=Qa);var W=[];Object.keys(z).forEach(function(ae){var me=z[ae];W[me]=ae});var ie=0,se={};function le(ae){this.id=ie++,this.refCount=1,this.renderbuffer=ae,this.format=Cn,this.width=0,this.height=0,Q.profile&&(this.stats={size:0})}le.prototype.decRef=function(){--this.refCount<=0&&oe(this)};function oe(ae){var me=ae.renderbuffer;p(me,"must not double destroy renderbuffer"),l.bindRenderbuffer(dr,null),l.deleteRenderbuffer(me),ae.renderbuffer=null,ae.refCount=0,delete se[ae.id],j.renderbufferCount--}function de(ae,me){var D=new le(l.createRenderbuffer());se[D.id]=D,j.renderbufferCount++;function X(Ee,ee){var Ae=0,re=0,pe=Cn;if(typeof Ee=="object"&&Ee){var te=Ee;if("shape"in te){var _e=te.shape;p(Array.isArray(_e)&&_e.length>=2,"invalid renderbuffer shape"),Ae=_e[0]|0,re=_e[1]|0}else"radius"in te&&(Ae=re=te.radius|0),"width"in te&&(Ae=te.width|0),"height"in te&&(re=te.height|0);"format"in te&&(p.parameter(te.format,z,"invalid renderbuffer format"),pe=z[te.format])}else typeof Ee=="number"?(Ae=Ee|0,typeof ee=="number"?re=ee|0:re=Ae):Ee?p.raise("invalid arguments to renderbuffer constructor"):Ae=re=1;if(p(Ae>0&&re>0&&Ae<=E.maxRenderbufferSize&&re<=E.maxRenderbufferSize,"invalid renderbuffer size"),!(Ae===D.width&&re===D.height&&pe===D.format))return X.width=D.width=Ae,X.height=D.height=re,D.format=pe,l.bindRenderbuffer(dr,D.renderbuffer),l.renderbufferStorage(dr,pe,Ae,re),p(l.getError()===0,"invalid render buffer format"),Q.profile&&(D.stats.size=es(D.format,D.width,D.height)),X.format=W[D.format],X}function fe(Ee,ee){var Ae=Ee|0,re=ee|0||Ae;return Ae===D.width&&re===D.height||(p(Ae>0&&re>0&&Ae<=E.maxRenderbufferSize&&re<=E.maxRenderbufferSize,"invalid renderbuffer size"),X.width=D.width=Ae,X.height=D.height=re,l.bindRenderbuffer(dr,D.renderbuffer),l.renderbufferStorage(dr,D.format,Ae,re),p(l.getError()===0,"invalid render buffer format"),Q.profile&&(D.stats.size=es(D.format,D.width,D.height))),X}return X(ae,me),X.resize=fe,X._reglType="renderbuffer",X._renderbuffer=D,Q.profile&&(X.stats=D.stats),X.destroy=function(){D.decRef()},X}Q.profile&&(j.getTotalRenderbufferSize=function(){var ae=0;return Object.keys(se).forEach(function(me){ae+=se[me].stats.size}),ae});function ve(){Kt(se).forEach(function(ae){ae.renderbuffer=l.createRenderbuffer(),l.bindRenderbuffer(dr,ae.renderbuffer),l.renderbufferStorage(dr,ae.format,ae.width,ae.height)}),l.bindRenderbuffer(dr,null)}return{create:de,clear:function(){Kt(se).forEach(oe)},restore:ve}},fr=36160,Pi=36161,xr=3553,Rn=34069,ts=36064,rs=36096,ns=36128,as=33306,ss=36053,Vu=36054,zu=36055,ju=36057,qu=36061,Hu=36193,Wu=5121,Xu=5126,os=6407,us=6408,Yu=6402,Ku=[os,us],Ii=[];Ii[us]=4,Ii[os]=3;var Pn=[];Pn[Wu]=1,Pn[Xu]=4,Pn[Hu]=2;var Qu=32854,Zu=32855,Ju=36194,ef=33189,tf=36168,fs=34041,rf=35907,nf=34836,af=34842,sf=34843,of=[Qu,Zu,Ju,rf,af,sf,nf],Br={};Br[ss]="complete",Br[Vu]="incomplete attachment",Br[ju]="incomplete dimensions",Br[zu]="incomplete, missing attachment",Br[qu]="unsupported";function uf(l,d,E,j,Q,z){var W={cur:null,next:null,dirty:!1,setFBO:null},ie=["rgba"],se=["rgba4","rgb565","rgb5 a1"];d.ext_srgb&&se.push("srgba"),d.ext_color_buffer_half_float&&se.push("rgba16f","rgb16f"),d.webgl_color_buffer_float&&se.push("rgba32f");var le=["uint8"];d.oes_texture_half_float&&le.push("half float","float16"),d.oes_texture_float&&le.push("float","float32");function oe(ye,ce,J){this.target=ye,this.texture=ce,this.renderbuffer=J;var je=0,Ze=0;ce?(je=ce.width,Ze=ce.height):J&&(je=J.width,Ze=J.height),this.width=je,this.height=Ze}function de(ye){ye&&(ye.texture&&ye.texture._texture.decRef(),ye.renderbuffer&&ye.renderbuffer._renderbuffer.decRef())}function ve(ye,ce,J){if(!!ye)if(ye.texture){var je=ye.texture._texture,Ze=Math.max(1,je.width),Le=Math.max(1,je.height);p(Ze===ce&&Le===J,"inconsistent width/height for supplied texture"),je.refCount+=1}else{var it=ye.renderbuffer._renderbuffer;p(it.width===ce&&it.height===J,"inconsistent width/height for renderbuffer"),it.refCount+=1}}function ae(ye,ce){ce&&(ce.texture?l.framebufferTexture2D(fr,ye,ce.target,ce.texture._texture.texture,0):l.framebufferRenderbuffer(fr,ye,Pi,ce.renderbuffer._renderbuffer.renderbuffer))}function me(ye){var ce=xr,J=null,je=null,Ze=ye;typeof ye=="object"&&(Ze=ye.data,"target"in ye&&(ce=ye.target|0)),p.type(Ze,"function","invalid attachment data");var Le=Ze._reglType;return Le==="texture2d"?(J=Ze,p(ce===xr)):Le==="textureCube"?(J=Ze,p(ce>=Rn&&ce<Rn+6,"invalid cube map target")):Le==="renderbuffer"?(je=Ze,ce=Pi):p.raise("invalid regl object for attachment"),new oe(ce,J,je)}function D(ye,ce,J,je,Ze){if(J){var Le=j.create2D({width:ye,height:ce,format:je,type:Ze});return Le._texture.refCount=0,new oe(xr,Le,null)}else{var it=Q.create({width:ye,height:ce,format:je});return it._renderbuffer.refCount=0,new oe(Pi,null,it)}}function X(ye){return ye&&(ye.texture||ye.renderbuffer)}function fe(ye,ce,J){ye&&(ye.texture?ye.texture.resize(ce,J):ye.renderbuffer&&ye.renderbuffer.resize(ce,J),ye.width=ce,ye.height=J)}var Ee=0,ee={};function Ae(){this.id=Ee++,ee[this.id]=this,this.framebuffer=l.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function re(ye){ye.colorAttachments.forEach(de),de(ye.depthAttachment),de(ye.stencilAttachment),de(ye.depthStencilAttachment)}function pe(ye){var ce=ye.framebuffer;p(ce,"must not double destroy framebuffer"),l.deleteFramebuffer(ce),ye.framebuffer=null,z.framebufferCount--,delete ee[ye.id]}function te(ye){var ce;l.bindFramebuffer(fr,ye.framebuffer);var J=ye.colorAttachments;for(ce=0;ce<J.length;++ce)ae(ts+ce,J[ce]);for(ce=J.length;ce<E.maxColorAttachments;++ce)l.framebufferTexture2D(fr,ts+ce,xr,null,0);l.framebufferTexture2D(fr,as,xr,null,0),l.framebufferTexture2D(fr,rs,xr,null,0),l.framebufferTexture2D(fr,ns,xr,null,0),ae(rs,ye.depthAttachment),ae(ns,ye.stencilAttachment),ae(as,ye.depthStencilAttachment);var je=l.checkFramebufferStatus(fr);!l.isContextLost()&&je!==ss&&p.raise("framebuffer configuration not supported, status = "+Br[je]),l.bindFramebuffer(fr,W.next?W.next.framebuffer:null),W.cur=W.next,l.getError()}function _e(ye,ce){var J=new Ae;z.framebufferCount++;function je(Le,it){var Ye;p(W.next!==J,"can not update framebuffer which is currently in use");var rt=0,dt=0,Pt=!0,Bt=!0,ot=null,Ft=!0,Et="rgba",It="uint8",Mt=1,Nt=null,Gt=null,Vt=null,Lt=!1;if(typeof Le=="number")rt=Le|0,dt=it|0||rt;else if(!Le)rt=dt=1;else{p.type(Le,"object","invalid arguments for framebuffer");var Je=Le;if("shape"in Je){var zt=Je.shape;p(Array.isArray(zt)&&zt.length>=2,"invalid shape for framebuffer"),rt=zt[0],dt=zt[1]}else"radius"in Je&&(rt=dt=Je.radius),"width"in Je&&(rt=Je.width),"height"in Je&&(dt=Je.height);("color"in Je||"colors"in Je)&&(ot=Je.color||Je.colors,Array.isArray(ot)&&p(ot.length===1||d.webgl_draw_buffers,"multiple render targets not supported")),ot||("colorCount"in Je&&(Mt=Je.colorCount|0,p(Mt>0,"invalid color buffer count")),"colorTexture"in Je&&(Ft=!!Je.colorTexture,Et="rgba4"),"colorType"in Je&&(It=Je.colorType,Ft?(p(d.oes_texture_float||!(It==="float"||It==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),p(d.oes_texture_half_float||!(It==="half float"||It==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):It==="half float"||It==="float16"?(p(d.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Et="rgba16f"):(It==="float"||It==="float32")&&(p(d.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Et="rgba32f"),p.oneOf(It,le,"invalid color type")),"colorFormat"in Je&&(Et=Je.colorFormat,ie.indexOf(Et)>=0?Ft=!0:se.indexOf(Et)>=0?Ft=!1:Ft?p.oneOf(Je.colorFormat,ie,"invalid color format for texture"):p.oneOf(Je.colorFormat,se,"invalid color format for renderbuffer"))),("depthTexture"in Je||"depthStencilTexture"in Je)&&(Lt=!!(Je.depthTexture||Je.depthStencilTexture),p(!Lt||d.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Je&&(typeof Je.depth=="boolean"?Pt=Je.depth:(Nt=Je.depth,Bt=!1)),"stencil"in Je&&(typeof Je.stencil=="boolean"?Bt=Je.stencil:(Gt=Je.stencil,Pt=!1)),"depthStencil"in Je&&(typeof Je.depthStencil=="boolean"?Pt=Bt=Je.depthStencil:(Vt=Je.depthStencil,Pt=!1,Bt=!1))}var vt=null,De=null,st=null,ht=null;if(Array.isArray(ot))vt=ot.map(me);else if(ot)vt=[me(ot)];else for(vt=new Array(Mt),Ye=0;Ye<Mt;++Ye)vt[Ye]=D(rt,dt,Ft,Et,It);p(d.webgl_draw_buffers||vt.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),p(vt.length<=E.maxColorAttachments,"too many color attachments, not supported"),rt=rt||vt[0].width,dt=dt||vt[0].height,Nt?De=me(Nt):Pt&&!Bt&&(De=D(rt,dt,Lt,"depth","uint32")),Gt?st=me(Gt):Bt&&!Pt&&(st=D(rt,dt,!1,"stencil","uint8")),Vt?ht=me(Vt):!Nt&&!Gt&&Bt&&Pt&&(ht=D(rt,dt,Lt,"depth stencil","depth stencil")),p(!!Nt+!!Gt+!!Vt<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var kt=null;for(Ye=0;Ye<vt.length;++Ye)if(ve(vt[Ye],rt,dt),p(!vt[Ye]||vt[Ye].texture&&Ku.indexOf(vt[Ye].texture._texture.format)>=0||vt[Ye].renderbuffer&&of.indexOf(vt[Ye].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ye+" is invalid"),vt[Ye]&&vt[Ye].texture){var sr=Ii[vt[Ye].texture._texture.format]*Pn[vt[Ye].texture._texture.type];kt===null?kt=sr:p(kt===sr,"all color attachments much have the same number of bits per pixel.")}return ve(De,rt,dt),p(!De||De.texture&&De.texture._texture.format===Yu||De.renderbuffer&&De.renderbuffer._renderbuffer.format===ef,"invalid depth attachment for framebuffer object"),ve(st,rt,dt),p(!st||st.renderbuffer&&st.renderbuffer._renderbuffer.format===tf,"invalid stencil attachment for framebuffer object"),ve(ht,rt,dt),p(!ht||ht.texture&&ht.texture._texture.format===fs||ht.renderbuffer&&ht.renderbuffer._renderbuffer.format===fs,"invalid depth-stencil attachment for framebuffer object"),re(J),J.width=rt,J.height=dt,J.colorAttachments=vt,J.depthAttachment=De,J.stencilAttachment=st,J.depthStencilAttachment=ht,je.color=vt.map(X),je.depth=X(De),je.stencil=X(st),je.depthStencil=X(ht),je.width=J.width,je.height=J.height,te(J),je}function Ze(Le,it){p(W.next!==J,"can not resize a framebuffer which is currently in use");var Ye=Math.max(Le|0,1),rt=Math.max(it|0||Ye,1);if(Ye===J.width&&rt===J.height)return je;for(var dt=J.colorAttachments,Pt=0;Pt<dt.length;++Pt)fe(dt[Pt],Ye,rt);return fe(J.depthAttachment,Ye,rt),fe(J.stencilAttachment,Ye,rt),fe(J.depthStencilAttachment,Ye,rt),J.width=je.width=Ye,J.height=je.height=rt,te(J),je}return je(ye,ce),o(je,{resize:Ze,_reglType:"framebuffer",_framebuffer:J,destroy:function(){pe(J),re(J)},use:function(Le){W.setFBO({framebuffer:je},Le)}})}function Me(ye){var ce=Array(6);function J(Ze){var Le;p(ce.indexOf(W.next)<0,"can not update framebuffer which is currently in use");var it={color:null},Ye=0,rt=null,dt="rgba",Pt="uint8",Bt=1;if(typeof Ze=="number")Ye=Ze|0;else if(!Ze)Ye=1;else{p.type(Ze,"object","invalid arguments for framebuffer");var ot=Ze;if("shape"in ot){var Ft=ot.shape;p(Array.isArray(Ft)&&Ft.length>=2,"invalid shape for framebuffer"),p(Ft[0]===Ft[1],"cube framebuffer must be square"),Ye=Ft[0]}else"radius"in ot&&(Ye=ot.radius|0),"width"in ot?(Ye=ot.width|0,"height"in ot&&p(ot.height===Ye,"must be square")):"height"in ot&&(Ye=ot.height|0);("color"in ot||"colors"in ot)&&(rt=ot.color||ot.colors,Array.isArray(rt)&&p(rt.length===1||d.webgl_draw_buffers,"multiple render targets not supported")),rt||("colorCount"in ot&&(Bt=ot.colorCount|0,p(Bt>0,"invalid color buffer count")),"colorType"in ot&&(p.oneOf(ot.colorType,le,"invalid color type"),Pt=ot.colorType),"colorFormat"in ot&&(dt=ot.colorFormat,p.oneOf(ot.colorFormat,ie,"invalid color format for texture"))),"depth"in ot&&(it.depth=ot.depth),"stencil"in ot&&(it.stencil=ot.stencil),"depthStencil"in ot&&(it.depthStencil=ot.depthStencil)}var Et;if(rt)if(Array.isArray(rt))for(Et=[],Le=0;Le<rt.length;++Le)Et[Le]=rt[Le];else Et=[rt];else{Et=Array(Bt);var It={radius:Ye,format:dt,type:Pt};for(Le=0;Le<Bt;++Le)Et[Le]=j.createCube(It)}for(it.color=Array(Et.length),Le=0;Le<Et.length;++Le){var Mt=Et[Le];p(typeof Mt=="function"&&Mt._reglType==="textureCube","invalid cube map"),Ye=Ye||Mt.width,p(Mt.width===Ye&&Mt.height===Ye,"invalid cube map shape"),it.color[Le]={target:Rn,data:Et[Le]}}for(Le=0;Le<6;++Le){for(var Nt=0;Nt<Et.length;++Nt)it.color[Nt].target=Rn+Le;Le>0&&(it.depth=ce[0].depth,it.stencil=ce[0].stencil,it.depthStencil=ce[0].depthStencil),ce[Le]?ce[Le](it):ce[Le]=_e(it)}return o(J,{width:Ye,height:Ye,color:Et})}function je(Ze){var Le,it=Ze|0;if(p(it>0&&it<=E.maxCubeMapSize,"invalid radius for cube fbo"),it===J.width)return J;var Ye=J.color;for(Le=0;Le<Ye.length;++Le)Ye[Le].resize(it);for(Le=0;Le<6;++Le)ce[Le].resize(it);return J.width=J.height=it,J}return J(ye),o(J,{faces:ce,resize:je,_reglType:"framebufferCube",destroy:function(){ce.forEach(function(Ze){Ze.destroy()})}})}function Xe(){W.cur=null,W.next=null,W.dirty=!0,Kt(ee).forEach(function(ye){ye.framebuffer=l.createFramebuffer(),te(ye)})}return o(W,{getFramebuffer:function(ye){if(typeof ye=="function"&&ye._reglType==="framebuffer"){var ce=ye._framebuffer;if(ce instanceof Ae)return ce}return null},create:_e,createCube:Me,clear:function(){Kt(ee).forEach(pe)},restore:Xe})}var ff=5126,ls=34962;function Fi(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=ff,this.offset=0,this.stride=0,this.divisor=0}function lf(l,d,E,j,Q){for(var z=E.maxAttributes,W=new Array(z),ie=0;ie<z;++ie)W[ie]=new Fi;var se=0,le={},oe={Record:Fi,scope:{},state:W,currentVAO:null,targetVAO:null,restore:ve()?ee:function(){},createVAO:Ae,getVAO:me,destroyBuffer:de,setVAO:ve()?D:X,clear:ve()?fe:function(){}};function de(re){for(var pe=0;pe<W.length;++pe){var te=W[pe];te.buffer===re&&(l.disableVertexAttribArray(pe),te.buffer=null)}}function ve(){return d.oes_vertex_array_object}function ae(){return d.angle_instanced_arrays}function me(re){return typeof re=="function"&&re._vao?re._vao:null}function D(re){if(re!==oe.currentVAO){var pe=ve();re?pe.bindVertexArrayOES(re.vao):pe.bindVertexArrayOES(null),oe.currentVAO=re}}function X(re){if(re!==oe.currentVAO){if(re)re.bindAttrs();else for(var pe=ae(),te=0;te<W.length;++te){var _e=W[te];_e.buffer?(l.enableVertexAttribArray(te),l.vertexAttribPointer(te,_e.size,_e.type,_e.normalized,_e.stride,_e.offfset),pe&&_e.divisor&&pe.vertexAttribDivisorANGLE(te,_e.divisor)):(l.disableVertexAttribArray(te),l.vertexAttrib4f(te,_e.x,_e.y,_e.z,_e.w))}oe.currentVAO=re}}function fe(){Kt(le).forEach(function(re){re.destroy()})}function Ee(){this.id=++se,this.attributes=[];var re=ve();re?this.vao=re.createVertexArrayOES():this.vao=null,le[this.id]=this,this.buffers=[]}Ee.prototype.bindAttrs=function(){for(var re=ae(),pe=this.attributes,te=0;te<pe.length;++te){var _e=pe[te];_e.buffer?(l.enableVertexAttribArray(te),l.bindBuffer(ls,_e.buffer.buffer),l.vertexAttribPointer(te,_e.size,_e.type,_e.normalized,_e.stride,_e.offset),re&&_e.divisor&&re.vertexAttribDivisorANGLE(te,_e.divisor)):(l.disableVertexAttribArray(te),l.vertexAttrib4f(te,_e.x,_e.y,_e.z,_e.w))}for(var Me=pe.length;Me<z;++Me)l.disableVertexAttribArray(Me)},Ee.prototype.refresh=function(){var re=ve();re&&(re.bindVertexArrayOES(this.vao),this.bindAttrs(),oe.currentVAO=this)},Ee.prototype.destroy=function(){if(this.vao){var re=ve();this===oe.currentVAO&&(oe.currentVAO=null,re.bindVertexArrayOES(null)),re.deleteVertexArrayOES(this.vao),this.vao=null}le[this.id]&&(delete le[this.id],j.vaoCount-=1)};function ee(){var re=ve();re&&Kt(le).forEach(function(pe){pe.refresh()})}function Ae(re){var pe=new Ee;j.vaoCount+=1;function te(_e){p(Array.isArray(_e),"arguments to vertex array constructor must be an array"),p(_e.length<z,"too many attributes"),p(_e.length>0,"must specify at least one attribute");var Me={},Xe=pe.attributes;Xe.length=_e.length;for(var ye=0;ye<_e.length;++ye){var ce=_e[ye],J=Xe[ye]=new Fi,je=ce.data||ce;if(Array.isArray(je)||s(je)||er(je)){var Ze;pe.buffers[ye]&&(Ze=pe.buffers[ye],s(je)&&Ze._buffer.byteLength>=je.byteLength?Ze.subdata(je):(Ze.destroy(),pe.buffers[ye]=null)),pe.buffers[ye]||(Ze=pe.buffers[ye]=Q.create(ce,ls,!1,!0)),J.buffer=Q.getBuffer(Ze),J.size=J.buffer.dimension|0,J.normalized=!1,J.type=J.buffer.dtype,J.offset=0,J.stride=0,J.divisor=0,J.state=1,Me[ye]=1}else Q.getBuffer(ce)?(J.buffer=Q.getBuffer(ce),J.size=J.buffer.dimension|0,J.normalized=!1,J.type=J.buffer.dtype,J.offset=0,J.stride=0,J.divisor=0,J.state=1):Q.getBuffer(ce.buffer)?(J.buffer=Q.getBuffer(ce.buffer),J.size=(+ce.size||J.buffer.dimension)|0,J.normalized=!!ce.normalized||!1,"type"in ce?(p.parameter(ce.type,gr,"invalid buffer type"),J.type=gr[ce.type]):J.type=J.buffer.dtype,J.offset=(ce.offset||0)|0,J.stride=(ce.stride||0)|0,J.divisor=(ce.divisor||0)|0,J.state=1,p(J.size>=1&&J.size<=4,"size must be between 1 and 4"),p(J.offset>=0,"invalid offset"),p(J.stride>=0&&J.stride<=255,"stride must be between 0 and 255"),p(J.divisor>=0,"divisor must be positive"),p(!J.divisor||!!d.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in ce?(p(ye>0,"first attribute must not be a constant"),J.x=+ce.x||0,J.y=+ce.y||0,J.z=+ce.z||0,J.w=+ce.w||0,J.state=2):p(!1,"invalid attribute spec for location "+ye)}for(var Le=0;Le<pe.buffers.length;++Le)!Me[Le]&&pe.buffers[Le]&&(pe.buffers[Le].destroy(),pe.buffers[Le]=null);return pe.refresh(),te}return te.destroy=function(){for(var _e=0;_e<pe.buffers.length;++_e)pe.buffers[_e]&&pe.buffers[_e].destroy();pe.buffers.length=0,pe.destroy()},te._vao=pe,te._reglType="vao",te(re)}return oe}var cs=35632,cf=35633,hf=35718,df=35721;function mf(l,d,E,j){var Q={},z={};function W(D,X,fe,Ee){this.name=D,this.id=X,this.location=fe,this.info=Ee}function ie(D,X){for(var fe=0;fe<D.length;++fe)if(D[fe].id===X.id){D[fe].location=X.location;return}D.push(X)}function se(D,X,fe){var Ee=D===cs?Q:z,ee=Ee[X];if(!ee){var Ae=d.str(X);ee=l.createShader(D),l.shaderSource(ee,Ae),l.compileShader(ee),p.shaderError(l,ee,Ae,D,fe),Ee[X]=ee}return ee}var le={},oe=[],de=0;function ve(D,X){this.id=de++,this.fragId=D,this.vertId=X,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,j.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function ae(D,X,fe){var Ee,ee,Ae=se(cs,D.fragId),re=se(cf,D.vertId),pe=D.program=l.createProgram();if(l.attachShader(pe,Ae),l.attachShader(pe,re),fe)for(Ee=0;Ee<fe.length;++Ee){var te=fe[Ee];l.bindAttribLocation(pe,te[0],te[1])}l.linkProgram(pe),p.linkError(l,pe,d.str(D.fragId),d.str(D.vertId),X);var _e=l.getProgramParameter(pe,hf);j.profile&&(D.stats.uniformsCount=_e);var Me=D.uniforms;for(Ee=0;Ee<_e;++Ee)if(ee=l.getActiveUniform(pe,Ee),ee)if(ee.size>1)for(var Xe=0;Xe<ee.size;++Xe){var ye=ee.name.replace("[0]","["+Xe+"]");ie(Me,new W(ye,d.id(ye),l.getUniformLocation(pe,ye),ee))}else ie(Me,new W(ee.name,d.id(ee.name),l.getUniformLocation(pe,ee.name),ee));var ce=l.getProgramParameter(pe,df);j.profile&&(D.stats.attributesCount=ce);var J=D.attributes;for(Ee=0;Ee<ce;++Ee)ee=l.getActiveAttrib(pe,Ee),ee&&ie(J,new W(ee.name,d.id(ee.name),l.getAttribLocation(pe,ee.name),ee))}j.profile&&(E.getMaxUniformsCount=function(){var D=0;return oe.forEach(function(X){X.stats.uniformsCount>D&&(D=X.stats.uniformsCount)}),D},E.getMaxAttributesCount=function(){var D=0;return oe.forEach(function(X){X.stats.attributesCount>D&&(D=X.stats.attributesCount)}),D});function me(){Q={},z={};for(var D=0;D<oe.length;++D)ae(oe[D],null,oe[D].attributes.map(function(X){return[X.location,X.name]}))}return{clear:function(){var D=l.deleteShader.bind(l);Kt(Q).forEach(D),Q={},Kt(z).forEach(D),z={},oe.forEach(function(X){l.deleteProgram(X.program)}),oe.length=0,le={},E.shaderCount=0},program:function(D,X,fe,Ee){p.command(D>=0,"missing vertex shader",fe),p.command(X>=0,"missing fragment shader",fe);var ee=le[X];ee||(ee=le[X]={});var Ae=ee[D];if(Ae&&(Ae.refCount++,!Ee))return Ae;var re=new ve(X,D);return E.shaderCount++,ae(re,fe,Ee),Ae||(ee[D]=re),oe.push(re),o(re,{destroy:function(){if(re.refCount--,re.refCount<=0){l.deleteProgram(re.program);var pe=oe.indexOf(re);oe.splice(pe,1),E.shaderCount--}ee[re.vertId].refCount<=0&&(l.deleteShader(z[re.vertId]),delete z[re.vertId],delete le[re.fragId][re.vertId]),Object.keys(le[re.fragId]).length||(l.deleteShader(Q[re.fragId]),delete Q[re.fragId],delete le[re.fragId])}})},restore:me,shader:se,frag:-1,vert:-1}}var pf=6408,rn=5121,_f=3333,In=5126;function vf(l,d,E,j,Q,z,W){function ie(oe){var de;d.next===null?(p(Q.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),de=rn):(p(d.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),de=d.next.colorAttachments[0].texture._texture.type,z.oes_texture_float?(p(de===rn||de===In,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),de===In&&p(W.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):p(de===rn,"Reading from a framebuffer is only allowed for the type 'uint8'"));var ve=0,ae=0,me=j.framebufferWidth,D=j.framebufferHeight,X=null;s(oe)?X=oe:oe&&(p.type(oe,"object","invalid arguments to regl.read()"),ve=oe.x|0,ae=oe.y|0,p(ve>=0&&ve<j.framebufferWidth,"invalid x offset for regl.read"),p(ae>=0&&ae<j.framebufferHeight,"invalid y offset for regl.read"),me=(oe.width||j.framebufferWidth-ve)|0,D=(oe.height||j.framebufferHeight-ae)|0,X=oe.data||null),X&&(de===rn?p(X instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):de===In&&p(X instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),p(me>0&&me+ve<=j.framebufferWidth,"invalid width for read pixels"),p(D>0&&D+ae<=j.framebufferHeight,"invalid height for read pixels"),E();var fe=me*D*4;return X||(de===rn?X=new Uint8Array(fe):de===In&&(X=X||new Float32Array(fe))),p.isTypedArray(X,"data buffer for regl.read() must be a typedarray"),p(X.byteLength>=fe,"data buffer for regl.read() too small"),l.pixelStorei(_f,4),l.readPixels(ve,ae,me,D,pf,de,X),X}function se(oe){var de;return d.setFBO({framebuffer:oe.framebuffer},function(){de=ie(oe)}),de}function le(oe){return!oe||!("framebuffer"in oe)?ie(oe):se(oe)}return le}function Dr(l){return Array.prototype.slice.call(l)}function Gr(l){return Dr(l).join("")}function yf(){var l=0,d=[],E=[];function j(de){for(var ve=0;ve<E.length;++ve)if(E[ve]===de)return d[ve];var ae="g"+l++;return d.push(ae),E.push(de),ae}function Q(){var de=[];function ve(){de.push.apply(de,Dr(arguments))}var ae=[];function me(){var D="v"+l++;return ae.push(D),arguments.length>0&&(de.push(D,"="),de.push.apply(de,Dr(arguments)),de.push(";")),D}return o(ve,{def:me,toString:function(){return Gr([ae.length>0?"var "+ae.join(",")+";":"",Gr(de)])}})}function z(){var de=Q(),ve=Q(),ae=de.toString,me=ve.toString;function D(X,fe){ve(X,fe,"=",de.def(X,fe),";")}return o(function(){de.apply(de,Dr(arguments))},{def:de.def,entry:de,exit:ve,save:D,set:function(X,fe,Ee){D(X,fe),de(X,fe,"=",Ee,";")},toString:function(){return ae()+me()}})}function W(){var de=Gr(arguments),ve=z(),ae=z(),me=ve.toString,D=ae.toString;return o(ve,{then:function(){return ve.apply(ve,Dr(arguments)),this},else:function(){return ae.apply(ae,Dr(arguments)),this},toString:function(){var X=D();return X&&(X="else{"+X+"}"),Gr(["if(",de,"){",me(),"}",X])}})}var ie=Q(),se={};function le(de,ve){var ae=[];function me(){var ee="a"+ae.length;return ae.push(ee),ee}ve=ve||0;for(var D=0;D<ve;++D)me();var X=z(),fe=X.toString,Ee=se[de]=o(X,{arg:me,toString:function(){return Gr(["function(",ae.join(),"){",fe(),"}"])}});return Ee}function oe(){var de=['"use strict";',ie,"return {"];Object.keys(se).forEach(function(me){de.push('"',me,'":',se[me].toString(),",")}),de.push("}");var ve=Gr(de).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),ae=Function.apply(null,d.concat(ve));return ae.apply(null,E)}return{global:ie,link:j,block:Q,proc:le,scope:z,cond:W,compile:oe}}var Ur="xyzw".split(""),hs=5121,Vr=1,Mi=2,Ni=0,Bi=1,Di=2,Gi=3,Fn=4,ds=5,ms=6,ps="dither",_s="blend.enable",vs="blend.color",Ui="blend.equation",Vi="blend.func",ys="depth.enable",bs="depth.func",gs="depth.range",Es="depth.mask",zi="colorMask",ws="cull.enable",Ss="cull.face",ji="frontFace",qi="lineWidth",xs="polygonOffset.enable",Hi="polygonOffset.offset",As="sample.alpha",Ts="sample.enable",Wi="sample.coverage",$s="stencil.enable",Os="stencil.mask",Xi="stencil.func",Yi="stencil.opFront",nn="stencil.opBack",Ls="scissor.enable",Mn="scissor.box",lr="viewport",an="profile",Ar="framebuffer",sn="vert",on="frag",Tr="elements",$r="primitive",Or="count",Nn="offset",Bn="instances",un="vao",Ki="Width",Qi="Height",zr=Ar+Ki,jr=Ar+Qi,bf=lr+Ki,gf=lr+Qi,ks="drawingBuffer",Cs=ks+Ki,Rs=ks+Qi,Ef=[Vi,Ui,Xi,Yi,nn,Wi,lr,Mn,Hi],qr=34962,wf=34963,Sf=35632,xf=35633,Ps=3553,Af=34067,Tf=2884,$f=3042,Of=3024,Lf=2960,kf=2929,Cf=3089,Rf=32823,Pf=32926,If=32928,Zi=5126,Dn=35664,Gn=35665,Un=35666,Ji=5124,Vn=35667,zn=35668,jn=35669,ea=35670,qn=35671,Hn=35672,Wn=35673,fn=35674,ln=35675,cn=35676,hn=35678,dn=35680,Is=4,mn=1028,Lr=1029,Fs=2304,ta=2305,Ff=32775,Mf=32776,Nf=519,mr=7680,Ms=0,Ns=1,Bs=32774,Bf=513,Ds=36160,Df=36064,ar={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Gs=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Hr={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},pr={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Us={frag:Sf,vert:xf},ra={cw:Fs,ccw:ta};function Xn(l){return Array.isArray(l)||s(l)||er(l)}function Vs(l){return l.sort(function(d,E){return d===lr?-1:E===lr?1:d<E?-1:1})}function Wt(l,d,E,j){this.thisDep=l,this.contextDep=d,this.propDep=E,this.append=j}function _r(l){return l&&!(l.thisDep||l.contextDep||l.propDep)}function Rt(l){return new Wt(!1,!1,!1,l)}function Yt(l,d){var E=l.type;if(E===Ni){var j=l.data.length;return new Wt(!0,j>=1,j>=2,d)}else if(E===Fn){var Q=l.data;return new Wt(Q.thisDep,Q.contextDep,Q.propDep,d)}else{if(E===ds)return new Wt(!1,!1,!1,d);if(E===ms){for(var z=!1,W=!1,ie=!1,se=0;se<l.data.length;++se){var le=l.data[se];if(le.type===Bi)ie=!0;else if(le.type===Di)W=!0;else if(le.type===Gi)z=!0;else if(le.type===Ni){z=!0;var oe=le.data;oe>=1&&(W=!0),oe>=2&&(ie=!0)}else le.type===Fn&&(z=z||le.data.thisDep,W=W||le.data.contextDep,ie=ie||le.data.propDep)}return new Wt(z,W,ie,d)}else return new Wt(E===Gi,E===Di,E===Bi,d)}}var zs=new Wt(!1,!1,!1,function(){});function Gf(l,d,E,j,Q,z,W,ie,se,le,oe,de,ve,ae,me){var D=le.Record,X={add:32774,subtract:32778,"reverse subtract":32779};E.ext_blend_minmax&&(X.min=Ff,X.max=Mf);var fe=E.angle_instanced_arrays,Ee=E.webgl_draw_buffers,ee={dirty:!0,profile:me.profile},Ae={},re=[],pe={},te={};function _e(_){return _.replace(".","_")}function Me(_,h,A){var I=_e(_);re.push(_),Ae[I]=ee[I]=!!A,pe[I]=h}function Xe(_,h,A){var I=_e(_);re.push(_),Array.isArray(A)?(ee[I]=A.slice(),Ae[I]=A.slice()):ee[I]=Ae[I]=A,te[I]=h}Me(ps,Of),Me(_s,$f),Xe(vs,"blendColor",[0,0,0,0]),Xe(Ui,"blendEquationSeparate",[Bs,Bs]),Xe(Vi,"blendFuncSeparate",[Ns,Ms,Ns,Ms]),Me(ys,kf,!0),Xe(bs,"depthFunc",Bf),Xe(gs,"depthRange",[0,1]),Xe(Es,"depthMask",!0),Xe(zi,zi,[!0,!0,!0,!0]),Me(ws,Tf),Xe(Ss,"cullFace",Lr),Xe(ji,ji,ta),Xe(qi,qi,1),Me(xs,Rf),Xe(Hi,"polygonOffset",[0,0]),Me(As,Pf),Me(Ts,If),Xe(Wi,"sampleCoverage",[1,!1]),Me($s,Lf),Xe(Os,"stencilMask",-1),Xe(Xi,"stencilFunc",[Nf,0,-1]),Xe(Yi,"stencilOpSeparate",[mn,mr,mr,mr]),Xe(nn,"stencilOpSeparate",[Lr,mr,mr,mr]),Me(Ls,Cf),Xe(Mn,"scissor",[0,0,l.drawingBufferWidth,l.drawingBufferHeight]),Xe(lr,lr,[0,0,l.drawingBufferWidth,l.drawingBufferHeight]);var ye={gl:l,context:ve,strings:d,next:Ae,current:ee,draw:de,elements:z,buffer:Q,shader:oe,attributes:le.state,vao:le,uniforms:se,framebuffer:ie,extensions:E,timer:ae,isBufferArgs:Xn},ce={primTypes:Cr,compareFuncs:Hr,blendFuncs:ar,blendEquations:X,stencilOps:pr,glTypes:gr,orientationType:ra};p.optional(function(){ye.isArrayLike=Ot}),Ee&&(ce.backBuffer=[Lr],ce.drawBuffer=Dt(j.maxDrawbuffers,function(_){return _===0?[0]:Dt(_,function(h){return Df+h})}));var J=0;function je(){var _=yf(),h=_.link,A=_.global;_.id=J++,_.batchId="0";var I=h(ye),G=_.shared={props:"a0"};Object.keys(ye).forEach(function(w){G[w]=A.def(I,".",w)}),p.optional(function(){_.CHECK=h(p),_.commandStr=p.guessCommand(),_.command=h(_.commandStr),_.assert=function(w,m,C){w("if(!(",m,"))",this.CHECK,".commandRaise(",h(C),",",this.command,");")},ce.invalidBlendCombinations=Gs});var L=_.next={},$=_.current={};Object.keys(te).forEach(function(w){Array.isArray(ee[w])&&(L[w]=A.def(G.next,".",w),$[w]=A.def(G.current,".",w))});var k=_.constants={};Object.keys(ce).forEach(function(w){k[w]=A.def(JSON.stringify(ce[w]))}),_.invoke=function(w,m){switch(m.type){case Ni:var C=["this",G.context,G.props,_.batchId];return w.def(h(m.data),".call(",C.slice(0,Math.max(m.data.length+1,4)),")");case Bi:return w.def(G.props,m.data);case Di:return w.def(G.context,m.data);case Gi:return w.def("this",m.data);case Fn:return m.data.append(_,w),m.data.ref;case ds:return m.data.toString();case ms:return m.data.map(function(U){return _.invoke(w,U)})}},_.attribCache={};var v={};return _.scopeAttrib=function(w){var m=d.id(w);if(m in v)return v[m];var C=le.scope[m];C||(C=le.scope[m]=new D);var U=v[m]=h(C);return U},_}function Ze(_){var h=_.static,A=_.dynamic,I;if(an in h){var G=!!h[an];I=Rt(function($,k){return G}),I.enable=G}else if(an in A){var L=A[an];I=Yt(L,function($,k){return $.invoke(k,L)})}return I}function Le(_,h){var A=_.static,I=_.dynamic;if(Ar in A){var G=A[Ar];return G?(G=ie.getFramebuffer(G),p.command(G,"invalid framebuffer object"),Rt(function($,k){var v=$.link(G),w=$.shared;k.set(w.framebuffer,".next",v);var m=w.context;return k.set(m,"."+zr,v+".width"),k.set(m,"."+jr,v+".height"),v})):Rt(function($,k){var v=$.shared;k.set(v.framebuffer,".next","null");var w=v.context;return k.set(w,"."+zr,w+"."+Cs),k.set(w,"."+jr,w+"."+Rs),"null"})}else if(Ar in I){var L=I[Ar];return Yt(L,function($,k){var v=$.invoke(k,L),w=$.shared,m=w.framebuffer,C=k.def(m,".getFramebuffer(",v,")");p.optional(function(){$.assert(k,"!"+v+"||"+C,"invalid framebuffer object")}),k.set(m,".next",C);var U=w.context;return k.set(U,"."+zr,C+"?"+C+".width:"+U+"."+Cs),k.set(U,"."+jr,C+"?"+C+".height:"+U+"."+Rs),C})}else return null}function it(_,h,A){var I=_.static,G=_.dynamic;function L(v){if(v in I){var w=I[v];p.commandType(w,"object","invalid "+v,A.commandStr);var m=!0,C=w.x|0,U=w.y|0,K,Z;return"width"in w?(K=w.width|0,p.command(K>=0,"invalid "+v,A.commandStr)):m=!1,"height"in w?(Z=w.height|0,p.command(Z>=0,"invalid "+v,A.commandStr)):m=!1,new Wt(!m&&h&&h.thisDep,!m&&h&&h.contextDep,!m&&h&&h.propDep,function(Ie,et){var ke=Ie.shared.context,Ue=K;"width"in w||(Ue=et.def(ke,".",zr,"-",C));var Ke=Z;return"height"in w||(Ke=et.def(ke,".",jr,"-",U)),[C,U,Ue,Ke]})}else if(v in G){var Y=G[v],ue=Yt(Y,function(Ie,et){var ke=Ie.invoke(et,Y);p.optional(function(){Ie.assert(et,ke+"&&typeof "+ke+'==="object"',"invalid "+v)});var Ue=Ie.shared.context,Ke=et.def(ke,".x|0"),mt=et.def(ke,".y|0"),Tt=et.def('"width" in ',ke,"?",ke,".width|0:","(",Ue,".",zr,"-",Ke,")"),Xt=et.def('"height" in ',ke,"?",ke,".height|0:","(",Ue,".",jr,"-",mt,")");return p.optional(function(){Ie.assert(et,Tt+">=0&&"+Xt+">=0","invalid "+v)}),[Ke,mt,Tt,Xt]});return h&&(ue.thisDep=ue.thisDep||h.thisDep,ue.contextDep=ue.contextDep||h.contextDep,ue.propDep=ue.propDep||h.propDep),ue}else return h?new Wt(h.thisDep,h.contextDep,h.propDep,function(Ie,et){var ke=Ie.shared.context;return[0,0,et.def(ke,".",zr),et.def(ke,".",jr)]}):null}var $=L(lr);if($){var k=$;$=new Wt($.thisDep,$.contextDep,$.propDep,function(v,w){var m=k.append(v,w),C=v.shared.context;return w.set(C,"."+bf,m[2]),w.set(C,"."+gf,m[3]),m})}return{viewport:$,scissor_box:L(Mn)}}function Ye(_,h){var A=_.static,I=typeof A[on]=="string"&&typeof A[sn]=="string";if(I){if(Object.keys(h.dynamic).length>0)return null;var G=h.static,L=Object.keys(G);if(L.length>0&&typeof G[L[0]]=="number"){for(var $=[],k=0;k<L.length;++k)p(typeof G[L[k]]=="number","must specify all vertex attribute locations when using vaos"),$.push([G[L[k]]|0,L[k]]);return $}}return null}function rt(_,h,A){var I=_.static,G=_.dynamic;function L(m){if(m in I){var C=d.id(I[m]);p.optional(function(){oe.shader(Us[m],C,p.guessCommand())});var U=Rt(function(){return C});return U.id=C,U}else if(m in G){var K=G[m];return Yt(K,function(Z,Y){var ue=Z.invoke(Y,K),Ie=Y.def(Z.shared.strings,".id(",ue,")");return p.optional(function(){Y(Z.shared.shader,".shader(",Us[m],",",Ie,",",Z.command,");")}),Ie})}return null}var $=L(on),k=L(sn),v=null,w;return _r($)&&_r(k)?(v=oe.program(k.id,$.id,null,A),w=Rt(function(m,C){return m.link(v)})):w=new Wt($&&$.thisDep||k&&k.thisDep,$&&$.contextDep||k&&k.contextDep,$&&$.propDep||k&&k.propDep,function(m,C){var U=m.shared.shader,K;$?K=$.append(m,C):K=C.def(U,".",on);var Z;k?Z=k.append(m,C):Z=C.def(U,".",sn);var Y=U+".program("+Z+","+K;return p.optional(function(){Y+=","+m.command}),C.def(Y+")")}),{frag:$,vert:k,progVar:w,program:v}}function dt(_,h){var A=_.static,I=_.dynamic;function G(){if(Tr in A){var m=A[Tr];Xn(m)?m=z.getElements(z.create(m,!0)):m&&(m=z.getElements(m),p.command(m,"invalid elements",h.commandStr));var C=Rt(function(K,Z){if(m){var Y=K.link(m);return K.ELEMENTS=Y,Y}return K.ELEMENTS=null,null});return C.value=m,C}else if(Tr in I){var U=I[Tr];return Yt(U,function(K,Z){var Y=K.shared,ue=Y.isBufferArgs,Ie=Y.elements,et=K.invoke(Z,U),ke=Z.def("null"),Ue=Z.def(ue,"(",et,")"),Ke=K.cond(Ue).then(ke,"=",Ie,".createStream(",et,");").else(ke,"=",Ie,".getElements(",et,");");return p.optional(function(){K.assert(Ke.else,"!"+et+"||"+ke,"invalid elements")}),Z.entry(Ke),Z.exit(K.cond(Ue).then(Ie,".destroyStream(",ke,");")),K.ELEMENTS=ke,ke})}return null}var L=G();function $(){if($r in A){var m=A[$r];return p.commandParameter(m,Cr,"invalid primitve",h.commandStr),Rt(function(U,K){return Cr[m]})}else if($r in I){var C=I[$r];return Yt(C,function(U,K){var Z=U.constants.primTypes,Y=U.invoke(K,C);return p.optional(function(){U.assert(K,Y+" in "+Z,"invalid primitive, must be one of "+Object.keys(Cr))}),K.def(Z,"[",Y,"]")})}else if(L)return _r(L)?L.value?Rt(function(U,K){return K.def(U.ELEMENTS,".primType")}):Rt(function(){return Is}):new Wt(L.thisDep,L.contextDep,L.propDep,function(U,K){var Z=U.ELEMENTS;return K.def(Z,"?",Z,".primType:",Is)});return null}function k(m,C){if(m in A){var U=A[m]|0;return p.command(!C||U>=0,"invalid "+m,h.commandStr),Rt(function(Z,Y){return C&&(Z.OFFSET=U),U})}else if(m in I){var K=I[m];return Yt(K,function(Z,Y){var ue=Z.invoke(Y,K);return C&&(Z.OFFSET=ue,p.optional(function(){Z.assert(Y,ue+">=0","invalid "+m)})),ue})}else if(C&&L)return Rt(function(Z,Y){return Z.OFFSET="0",0});return null}var v=k(Nn,!0);function w(){if(Or in A){var m=A[Or]|0;return p.command(typeof m=="number"&&m>=0,"invalid vertex count",h.commandStr),Rt(function(){return m})}else if(Or in I){var C=I[Or];return Yt(C,function(Z,Y){var ue=Z.invoke(Y,C);return p.optional(function(){Z.assert(Y,"typeof "+ue+'==="number"&&'+ue+">=0&&"+ue+"===("+ue+"|0)","invalid vertex count")}),ue})}else if(L)if(_r(L)){if(L)return v?new Wt(v.thisDep,v.contextDep,v.propDep,function(Z,Y){var ue=Y.def(Z.ELEMENTS,".vertCount-",Z.OFFSET);return p.optional(function(){Z.assert(Y,ue+">=0","invalid vertex offset/element buffer too small")}),ue}):Rt(function(Z,Y){return Y.def(Z.ELEMENTS,".vertCount")});var U=Rt(function(){return-1});return p.optional(function(){U.MISSING=!0}),U}else{var K=new Wt(L.thisDep||v.thisDep,L.contextDep||v.contextDep,L.propDep||v.propDep,function(Z,Y){var ue=Z.ELEMENTS;return Z.OFFSET?Y.def(ue,"?",ue,".vertCount-",Z.OFFSET,":-1"):Y.def(ue,"?",ue,".vertCount:-1")});return p.optional(function(){K.DYNAMIC=!0}),K}return null}return{elements:L,primitive:$(),count:w(),instances:k(Bn,!1),offset:v}}function Pt(_,h){var A=_.static,I=_.dynamic,G={};return re.forEach(function(L){var $=_e(L);function k(v,w){if(L in A){var m=v(A[L]);G[$]=Rt(function(){return m})}else if(L in I){var C=I[L];G[$]=Yt(C,function(U,K){return w(U,K,U.invoke(K,C))})}}switch(L){case ws:case _s:case ps:case $s:case ys:case Ls:case xs:case As:case Ts:case Es:return k(function(v){return p.commandType(v,"boolean",L,h.commandStr),v},function(v,w,m){return p.optional(function(){v.assert(w,"typeof "+m+'==="boolean"',"invalid flag "+L,v.commandStr)}),m});case bs:return k(function(v){return p.commandParameter(v,Hr,"invalid "+L,h.commandStr),Hr[v]},function(v,w,m){var C=v.constants.compareFuncs;return p.optional(function(){v.assert(w,m+" in "+C,"invalid "+L+", must be one of "+Object.keys(Hr))}),w.def(C,"[",m,"]")});case gs:return k(function(v){return p.command(Ot(v)&&v.length===2&&typeof v[0]=="number"&&typeof v[1]=="number"&&v[0]<=v[1],"depth range is 2d array",h.commandStr),v},function(v,w,m){p.optional(function(){v.assert(w,v.shared.isArrayLike+"("+m+")&&"+m+".length===2&&typeof "+m+'[0]==="number"&&typeof '+m+'[1]==="number"&&'+m+"[0]<="+m+"[1]","depth range must be a 2d array")});var C=w.def("+",m,"[0]"),U=w.def("+",m,"[1]");return[C,U]});case Vi:return k(function(v){p.commandType(v,"object","blend.func",h.commandStr);var w="srcRGB"in v?v.srcRGB:v.src,m="srcAlpha"in v?v.srcAlpha:v.src,C="dstRGB"in v?v.dstRGB:v.dst,U="dstAlpha"in v?v.dstAlpha:v.dst;return p.commandParameter(w,ar,$+".srcRGB",h.commandStr),p.commandParameter(m,ar,$+".srcAlpha",h.commandStr),p.commandParameter(C,ar,$+".dstRGB",h.commandStr),p.commandParameter(U,ar,$+".dstAlpha",h.commandStr),p.command(Gs.indexOf(w+", "+C)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+w+", "+C+")",h.commandStr),[ar[w],ar[C],ar[m],ar[U]]},function(v,w,m){var C=v.constants.blendFuncs;p.optional(function(){v.assert(w,m+"&&typeof "+m+'==="object"',"invalid blend func, must be an object")});function U(ke,Ue){var Ke=w.def('"',ke,Ue,'" in ',m,"?",m,".",ke,Ue,":",m,".",ke);return p.optional(function(){v.assert(w,Ke+" in "+C,"invalid "+L+"."+ke+Ue+", must be one of "+Object.keys(ar))}),Ke}var K=U("src","RGB"),Z=U("dst","RGB");p.optional(function(){var ke=v.constants.invalidBlendCombinations;v.assert(w,ke+".indexOf("+K+'+", "+'+Z+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Y=w.def(C,"[",K,"]"),ue=w.def(C,"[",U("src","Alpha"),"]"),Ie=w.def(C,"[",Z,"]"),et=w.def(C,"[",U("dst","Alpha"),"]");return[Y,Ie,ue,et]});case Ui:return k(function(v){if(typeof v=="string")return p.commandParameter(v,X,"invalid "+L,h.commandStr),[X[v],X[v]];if(typeof v=="object")return p.commandParameter(v.rgb,X,L+".rgb",h.commandStr),p.commandParameter(v.alpha,X,L+".alpha",h.commandStr),[X[v.rgb],X[v.alpha]];p.commandRaise("invalid blend.equation",h.commandStr)},function(v,w,m){var C=v.constants.blendEquations,U=w.def(),K=w.def(),Z=v.cond("typeof ",m,'==="string"');return p.optional(function(){function Y(ue,Ie,et){v.assert(ue,et+" in "+C,"invalid "+Ie+", must be one of "+Object.keys(X))}Y(Z.then,L,m),v.assert(Z.else,m+"&&typeof "+m+'==="object"',"invalid "+L),Y(Z.else,L+".rgb",m+".rgb"),Y(Z.else,L+".alpha",m+".alpha")}),Z.then(U,"=",K,"=",C,"[",m,"];"),Z.else(U,"=",C,"[",m,".rgb];",K,"=",C,"[",m,".alpha];"),w(Z),[U,K]});case vs:return k(function(v){return p.command(Ot(v)&&v.length===4,"blend.color must be a 4d array",h.commandStr),Dt(4,function(w){return+v[w]})},function(v,w,m){return p.optional(function(){v.assert(w,v.shared.isArrayLike+"("+m+")&&"+m+".length===4","blend.color must be a 4d array")}),Dt(4,function(C){return w.def("+",m,"[",C,"]")})});case Os:return k(function(v){return p.commandType(v,"number",$,h.commandStr),v|0},function(v,w,m){return p.optional(function(){v.assert(w,"typeof "+m+'==="number"',"invalid stencil.mask")}),w.def(m,"|0")});case Xi:return k(function(v){p.commandType(v,"object",$,h.commandStr);var w=v.cmp||"keep",m=v.ref||0,C="mask"in v?v.mask:-1;return p.commandParameter(w,Hr,L+".cmp",h.commandStr),p.commandType(m,"number",L+".ref",h.commandStr),p.commandType(C,"number",L+".mask",h.commandStr),[Hr[w],m,C]},function(v,w,m){var C=v.constants.compareFuncs;p.optional(function(){function Y(){v.assert(w,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Y(m+"&&typeof ",m,'==="object"'),Y('!("cmp" in ',m,")||(",m,".cmp in ",C,")")});var U=w.def('"cmp" in ',m,"?",C,"[",m,".cmp]",":",mr),K=w.def(m,".ref|0"),Z=w.def('"mask" in ',m,"?",m,".mask|0:-1");return[U,K,Z]});case Yi:case nn:return k(function(v){p.commandType(v,"object",$,h.commandStr);var w=v.fail||"keep",m=v.zfail||"keep",C=v.zpass||"keep";return p.commandParameter(w,pr,L+".fail",h.commandStr),p.commandParameter(m,pr,L+".zfail",h.commandStr),p.commandParameter(C,pr,L+".zpass",h.commandStr),[L===nn?Lr:mn,pr[w],pr[m],pr[C]]},function(v,w,m){var C=v.constants.stencilOps;p.optional(function(){v.assert(w,m+"&&typeof "+m+'==="object"',"invalid "+L)});function U(K){return p.optional(function(){v.assert(w,'!("'+K+'" in '+m+")||("+m+"."+K+" in "+C+")","invalid "+L+"."+K+", must be one of "+Object.keys(pr))}),w.def('"',K,'" in ',m,"?",C,"[",m,".",K,"]:",mr)}return[L===nn?Lr:mn,U("fail"),U("zfail"),U("zpass")]});case Hi:return k(function(v){p.commandType(v,"object",$,h.commandStr);var w=v.factor|0,m=v.units|0;return p.commandType(w,"number",$+".factor",h.commandStr),p.commandType(m,"number",$+".units",h.commandStr),[w,m]},function(v,w,m){p.optional(function(){v.assert(w,m+"&&typeof "+m+'==="object"',"invalid "+L)});var C=w.def(m,".factor|0"),U=w.def(m,".units|0");return[C,U]});case Ss:return k(function(v){var w=0;return v==="front"?w=mn:v==="back"&&(w=Lr),p.command(!!w,$,h.commandStr),w},function(v,w,m){return p.optional(function(){v.assert(w,m+'==="front"||'+m+'==="back"',"invalid cull.face")}),w.def(m,'==="front"?',mn,":",Lr)});case qi:return k(function(v){return p.command(typeof v=="number"&&v>=j.lineWidthDims[0]&&v<=j.lineWidthDims[1],"invalid line width, must be a positive number between "+j.lineWidthDims[0]+" and "+j.lineWidthDims[1],h.commandStr),v},function(v,w,m){return p.optional(function(){v.assert(w,"typeof "+m+'==="number"&&'+m+">="+j.lineWidthDims[0]+"&&"+m+"<="+j.lineWidthDims[1],"invalid line width")}),m});case ji:return k(function(v){return p.commandParameter(v,ra,$,h.commandStr),ra[v]},function(v,w,m){return p.optional(function(){v.assert(w,m+'==="cw"||'+m+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),w.def(m+'==="cw"?'+Fs+":"+ta)});case zi:return k(function(v){return p.command(Ot(v)&&v.length===4,"color.mask must be length 4 array",h.commandStr),v.map(function(w){return!!w})},function(v,w,m){return p.optional(function(){v.assert(w,v.shared.isArrayLike+"("+m+")&&"+m+".length===4","invalid color.mask")}),Dt(4,function(C){return"!!"+m+"["+C+"]"})});case Wi:return k(function(v){p.command(typeof v=="object"&&v,$,h.commandStr);var w="value"in v?v.value:1,m=!!v.invert;return p.command(typeof w=="number"&&w>=0&&w<=1,"sample.coverage.value must be a number between 0 and 1",h.commandStr),[w,m]},function(v,w,m){p.optional(function(){v.assert(w,m+"&&typeof "+m+'==="object"',"invalid sample.coverage")});var C=w.def('"value" in ',m,"?+",m,".value:1"),U=w.def("!!",m,".invert");return[C,U]})}}),G}function Bt(_,h){var A=_.static,I=_.dynamic,G={};return Object.keys(A).forEach(function(L){var $=A[L],k;if(typeof $=="number"||typeof $=="boolean")k=Rt(function(){return $});else if(typeof $=="function"){var v=$._reglType;v==="texture2d"||v==="textureCube"?k=Rt(function(w){return w.link($)}):v==="framebuffer"||v==="framebufferCube"?(p.command($.color.length>0,'missing color attachment for framebuffer sent to uniform "'+L+'"',h.commandStr),k=Rt(function(w){return w.link($.color[0])})):p.commandRaise('invalid data for uniform "'+L+'"',h.commandStr)}else Ot($)?k=Rt(function(w){var m=w.global.def("[",Dt($.length,function(C){return p.command(typeof $[C]=="number"||typeof $[C]=="boolean","invalid uniform "+L,w.commandStr),$[C]}),"]");return m}):p.commandRaise('invalid or missing data for uniform "'+L+'"',h.commandStr);k.value=$,G[L]=k}),Object.keys(I).forEach(function(L){var $=I[L];G[L]=Yt($,function(k,v){return k.invoke(v,$)})}),G}function ot(_,h){var A=_.static,I=_.dynamic,G={};return Object.keys(A).forEach(function(L){var $=A[L],k=d.id(L),v=new D;if(Xn($))v.state=Vr,v.buffer=Q.getBuffer(Q.create($,qr,!1,!0)),v.type=0;else{var w=Q.getBuffer($);if(w)v.state=Vr,v.buffer=w,v.type=0;else if(p.command(typeof $=="object"&&$,"invalid data for attribute "+L,h.commandStr),"constant"in $){var m=$.constant;v.buffer="null",v.state=Mi,typeof m=="number"?v.x=m:(p.command(Ot(m)&&m.length>0&&m.length<=4,"invalid constant for attribute "+L,h.commandStr),Ur.forEach(function(Ie,et){et<m.length&&(v[Ie]=m[et])}))}else{Xn($.buffer)?w=Q.getBuffer(Q.create($.buffer,qr,!1,!0)):w=Q.getBuffer($.buffer),p.command(!!w,'missing buffer for attribute "'+L+'"',h.commandStr);var C=$.offset|0;p.command(C>=0,'invalid offset for attribute "'+L+'"',h.commandStr);var U=$.stride|0;p.command(U>=0&&U<256,'invalid stride for attribute "'+L+'", must be integer betweeen [0, 255]',h.commandStr);var K=$.size|0;p.command(!("size"in $)||K>0&&K<=4,'invalid size for attribute "'+L+'", must be 1,2,3,4',h.commandStr);var Z=!!$.normalized,Y=0;"type"in $&&(p.commandParameter($.type,gr,"invalid type for attribute "+L,h.commandStr),Y=gr[$.type]);var ue=$.divisor|0;"divisor"in $&&(p.command(ue===0||fe,'cannot specify divisor for attribute "'+L+'", instancing not supported',h.commandStr),p.command(ue>=0,'invalid divisor for attribute "'+L+'"',h.commandStr)),p.optional(function(){var Ie=h.commandStr,et=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys($).forEach(function(ke){p.command(et.indexOf(ke)>=0,'unknown parameter "'+ke+'" for attribute pointer "'+L+'" (valid parameters are '+et+")",Ie)})}),v.buffer=w,v.state=Vr,v.size=K,v.normalized=Z,v.type=Y||w.dtype,v.offset=C,v.stride=U,v.divisor=ue}}G[L]=Rt(function(Ie,et){var ke=Ie.attribCache;if(k in ke)return ke[k];var Ue={isStream:!1};return Object.keys(v).forEach(function(Ke){Ue[Ke]=v[Ke]}),v.buffer&&(Ue.buffer=Ie.link(v.buffer),Ue.type=Ue.type||Ue.buffer+".dtype"),ke[k]=Ue,Ue})}),Object.keys(I).forEach(function(L){var $=I[L];function k(v,w){var m=v.invoke(w,$),C=v.shared,U=v.constants,K=C.isBufferArgs,Z=C.buffer;p.optional(function(){v.assert(w,m+"&&(typeof "+m+'==="object"||typeof '+m+'==="function")&&('+K+"("+m+")||"+Z+".getBuffer("+m+")||"+Z+".getBuffer("+m+".buffer)||"+K+"("+m+'.buffer)||("constant" in '+m+"&&(typeof "+m+'.constant==="number"||'+C.isArrayLike+"("+m+".constant))))",'invalid dynamic attribute "'+L+'"')});var Y={isStream:w.def(!1)},ue=new D;ue.state=Vr,Object.keys(ue).forEach(function(Ue){Y[Ue]=w.def(""+ue[Ue])});var Ie=Y.buffer,et=Y.type;w("if(",K,"(",m,")){",Y.isStream,"=true;",Ie,"=",Z,".createStream(",qr,",",m,");",et,"=",Ie,".dtype;","}else{",Ie,"=",Z,".getBuffer(",m,");","if(",Ie,"){",et,"=",Ie,".dtype;",'}else if("constant" in ',m,"){",Y.state,"=",Mi,";","if(typeof "+m+'.constant === "number"){',Y[Ur[0]],"=",m,".constant;",Ur.slice(1).map(function(Ue){return Y[Ue]}).join("="),"=0;","}else{",Ur.map(function(Ue,Ke){return Y[Ue]+"="+m+".constant.length>"+Ke+"?"+m+".constant["+Ke+"]:0;"}).join(""),"}}else{","if(",K,"(",m,".buffer)){",Ie,"=",Z,".createStream(",qr,",",m,".buffer);","}else{",Ie,"=",Z,".getBuffer(",m,".buffer);","}",et,'="type" in ',m,"?",U.glTypes,"[",m,".type]:",Ie,".dtype;",Y.normalized,"=!!",m,".normalized;");function ke(Ue){w(Y[Ue],"=",m,".",Ue,"|0;")}return ke("size"),ke("offset"),ke("stride"),ke("divisor"),w("}}"),w.exit("if(",Y.isStream,"){",Z,".destroyStream(",Ie,");","}"),Y}G[L]=Yt($,k)}),G}function Ft(_,h){var A=_.static,I=_.dynamic;if(un in A){var G=A[un];return G!==null&&le.getVAO(G)===null&&(G=le.createVAO(G)),Rt(function($){return $.link(le.getVAO(G))})}else if(un in I){var L=I[un];return Yt(L,function($,k){var v=$.invoke(k,L);return k.def($.shared.vao+".getVAO("+v+")")})}return null}function Et(_){var h=_.static,A=_.dynamic,I={};return Object.keys(h).forEach(function(G){var L=h[G];I[G]=Rt(function($,k){return typeof L=="number"||typeof L=="boolean"?""+L:$.link(L)})}),Object.keys(A).forEach(function(G){var L=A[G];I[G]=Yt(L,function($,k){return $.invoke(k,L)})}),I}function It(_,h,A,I,G){var L=_.static,$=_.dynamic;p.optional(function(){var ke=[Ar,sn,on,Tr,$r,Nn,Or,Bn,an,un].concat(re);function Ue(Ke){Object.keys(Ke).forEach(function(mt){p.command(ke.indexOf(mt)>=0,'unknown parameter "'+mt+'"',G.commandStr)})}Ue(L),Ue($)});var k=Ye(_,h),v=Le(_),w=it(_,v,G),m=dt(_,G),C=Pt(_,G),U=rt(_,G,k);function K(ke){var Ue=w[ke];Ue&&(C[ke]=Ue)}K(lr),K(_e(Mn));var Z=Object.keys(C).length>0,Y={framebuffer:v,draw:m,shader:U,state:C,dirty:Z,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Y.profile=Ze(_),Y.uniforms=Bt(A,G),Y.drawVAO=Y.scopeVAO=Ft(_),!Y.drawVAO&&U.program&&!k&&E.angle_instanced_arrays){var ue=!0,Ie=U.program.attributes.map(function(ke){var Ue=h.static[ke];return ue=ue&&!!Ue,Ue});if(ue&&Ie.length>0){var et=le.getVAO(le.createVAO(Ie));Y.drawVAO=new Wt(null,null,null,function(ke,Ue){return ke.link(et)}),Y.useVAO=!0}}return k?Y.useVAO=!0:Y.attributes=ot(h,G),Y.context=Et(I),Y}function Mt(_,h,A){var I=_.shared,G=I.context,L=_.scope();Object.keys(A).forEach(function($){h.save(G,"."+$);var k=A[$],v=k.append(_,h);Array.isArray(v)?L(G,".",$,"=[",v.join(),"];"):L(G,".",$,"=",v,";")}),h(L)}function Nt(_,h,A,I){var G=_.shared,L=G.gl,$=G.framebuffer,k;Ee&&(k=h.def(G.extensions,".webgl_draw_buffers"));var v=_.constants,w=v.drawBuffer,m=v.backBuffer,C;A?C=A.append(_,h):C=h.def($,".next"),I||h("if(",C,"!==",$,".cur){"),h("if(",C,"){",L,".bindFramebuffer(",Ds,",",C,".framebuffer);"),Ee&&h(k,".drawBuffersWEBGL(",w,"[",C,".colorAttachments.length]);"),h("}else{",L,".bindFramebuffer(",Ds,",null);"),Ee&&h(k,".drawBuffersWEBGL(",m,");"),h("}",$,".cur=",C,";"),I||h("}")}function Gt(_,h,A){var I=_.shared,G=I.gl,L=_.current,$=_.next,k=I.current,v=I.next,w=_.cond(k,".dirty");re.forEach(function(m){var C=_e(m);if(!(C in A.state)){var U,K;if(C in $){U=$[C],K=L[C];var Z=Dt(ee[C].length,function(ue){return w.def(U,"[",ue,"]")});w(_.cond(Z.map(function(ue,Ie){return ue+"!=="+K+"["+Ie+"]"}).join("||")).then(G,".",te[C],"(",Z,");",Z.map(function(ue,Ie){return K+"["+Ie+"]="+ue}).join(";"),";"))}else{U=w.def(v,".",C);var Y=_.cond(U,"!==",k,".",C);w(Y),C in pe?Y(_.cond(U).then(G,".enable(",pe[C],");").else(G,".disable(",pe[C],");"),k,".",C,"=",U,";"):Y(G,".",te[C],"(",U,");",k,".",C,"=",U,";")}}}),Object.keys(A.state).length===0&&w(k,".dirty=false;"),h(w)}function Vt(_,h,A,I){var G=_.shared,L=_.current,$=G.current,k=G.gl;Vs(Object.keys(A)).forEach(function(v){var w=A[v];if(!(I&&!I(w))){var m=w.append(_,h);if(pe[v]){var C=pe[v];_r(w)?m?h(k,".enable(",C,");"):h(k,".disable(",C,");"):h(_.cond(m).then(k,".enable(",C,");").else(k,".disable(",C,");")),h($,".",v,"=",m,";")}else if(Ot(m)){var U=L[v];h(k,".",te[v],"(",m,");",m.map(function(K,Z){return U+"["+Z+"]="+K}).join(";"),";")}else h(k,".",te[v],"(",m,");",$,".",v,"=",m,";")}})}function Lt(_,h){fe&&(_.instancing=h.def(_.shared.extensions,".angle_instanced_arrays"))}function Je(_,h,A,I,G){var L=_.shared,$=_.stats,k=L.current,v=L.timer,w=A.profile;function m(){return typeof performance>"u"?"Date.now()":"performance.now()"}var C,U;function K(ke){C=h.def(),ke(C,"=",m(),";"),typeof G=="string"?ke($,".count+=",G,";"):ke($,".count++;"),ae&&(I?(U=h.def(),ke(U,"=",v,".getNumPendingQueries();")):ke(v,".beginQuery(",$,");"))}function Z(ke){ke($,".cpuTime+=",m(),"-",C,";"),ae&&(I?ke(v,".pushScopeStats(",U,",",v,".getNumPendingQueries(),",$,");"):ke(v,".endQuery();"))}function Y(ke){var Ue=h.def(k,".profile");h(k,".profile=",ke,";"),h.exit(k,".profile=",Ue,";")}var ue;if(w){if(_r(w)){w.enable?(K(h),Z(h.exit),Y("true")):Y("false");return}ue=w.append(_,h),Y(ue)}else ue=h.def(k,".profile");var Ie=_.block();K(Ie),h("if(",ue,"){",Ie,"}");var et=_.block();Z(et),h.exit("if(",ue,"){",et,"}")}function zt(_,h,A,I,G){var L=_.shared;function $(v){switch(v){case Dn:case Vn:case qn:return 2;case Gn:case zn:case Hn:return 3;case Un:case jn:case Wn:return 4;default:return 1}}function k(v,w,m){var C=L.gl,U=h.def(v,".location"),K=h.def(L.attributes,"[",U,"]"),Z=m.state,Y=m.buffer,ue=[m.x,m.y,m.z,m.w],Ie=["buffer","normalized","offset","stride"];function et(){h("if(!",K,".buffer){",C,".enableVertexAttribArray(",U,");}");var Ue=m.type,Ke;if(m.size?Ke=h.def(m.size,"||",w):Ke=w,h("if(",K,".type!==",Ue,"||",K,".size!==",Ke,"||",Ie.map(function(Tt){return K+"."+Tt+"!=="+m[Tt]}).join("||"),"){",C,".bindBuffer(",qr,",",Y,".buffer);",C,".vertexAttribPointer(",[U,Ke,Ue,m.normalized,m.stride,m.offset],");",K,".type=",Ue,";",K,".size=",Ke,";",Ie.map(function(Tt){return K+"."+Tt+"="+m[Tt]+";"}).join(""),"}"),fe){var mt=m.divisor;h("if(",K,".divisor!==",mt,"){",_.instancing,".vertexAttribDivisorANGLE(",[U,mt],");",K,".divisor=",mt,";}")}}function ke(){h("if(",K,".buffer){",C,".disableVertexAttribArray(",U,");",K,".buffer=null;","}if(",Ur.map(function(Ue,Ke){return K+"."+Ue+"!=="+ue[Ke]}).join("||"),"){",C,".vertexAttrib4f(",U,",",ue,");",Ur.map(function(Ue,Ke){return K+"."+Ue+"="+ue[Ke]+";"}).join(""),"}")}Z===Vr?et():Z===Mi?ke():(h("if(",Z,"===",Vr,"){"),et(),h("}else{"),ke(),h("}"))}I.forEach(function(v){var w=v.name,m=A.attributes[w],C;if(m){if(!G(m))return;C=m.append(_,h)}else{if(!G(zs))return;var U=_.scopeAttrib(w);p.optional(function(){_.assert(h,U+".state","missing attribute "+w)}),C={},Object.keys(new D).forEach(function(K){C[K]=h.def(U,".",K)})}k(_.link(v),$(v.info.type),C)})}function vt(_,h,A,I,G){for(var L=_.shared,$=L.gl,k,v=0;v<I.length;++v){var w=I[v],m=w.name,C=w.info.type,U=A.uniforms[m],K=_.link(w),Z=K+".location",Y;if(U){if(!G(U))continue;if(_r(U)){var ue=U.value;if(p.command(ue!==null&&typeof ue<"u",'missing uniform "'+m+'"',_.commandStr),C===hn||C===dn){p.command(typeof ue=="function"&&(C===hn&&(ue._reglType==="texture2d"||ue._reglType==="framebuffer")||C===dn&&(ue._reglType==="textureCube"||ue._reglType==="framebufferCube")),"invalid texture for uniform "+m,_.commandStr);var Ie=_.link(ue._texture||ue.color[0]._texture);h($,".uniform1i(",Z,",",Ie+".bind());"),h.exit(Ie,".unbind();")}else if(C===fn||C===ln||C===cn){p.optional(function(){p.command(Ot(ue),"invalid matrix for uniform "+m,_.commandStr),p.command(C===fn&&ue.length===4||C===ln&&ue.length===9||C===cn&&ue.length===16,"invalid length for matrix uniform "+m,_.commandStr)});var et=_.global.def("new Float32Array(["+Array.prototype.slice.call(ue)+"])"),ke=2;C===ln?ke=3:C===cn&&(ke=4),h($,".uniformMatrix",ke,"fv(",Z,",false,",et,");")}else{switch(C){case Zi:p.commandType(ue,"number","uniform "+m,_.commandStr),k="1f";break;case Dn:p.command(Ot(ue)&&ue.length===2,"uniform "+m,_.commandStr),k="2f";break;case Gn:p.command(Ot(ue)&&ue.length===3,"uniform "+m,_.commandStr),k="3f";break;case Un:p.command(Ot(ue)&&ue.length===4,"uniform "+m,_.commandStr),k="4f";break;case ea:p.commandType(ue,"boolean","uniform "+m,_.commandStr),k="1i";break;case Ji:p.commandType(ue,"number","uniform "+m,_.commandStr),k="1i";break;case qn:p.command(Ot(ue)&&ue.length===2,"uniform "+m,_.commandStr),k="2i";break;case Vn:p.command(Ot(ue)&&ue.length===2,"uniform "+m,_.commandStr),k="2i";break;case Hn:p.command(Ot(ue)&&ue.length===3,"uniform "+m,_.commandStr),k="3i";break;case zn:p.command(Ot(ue)&&ue.length===3,"uniform "+m,_.commandStr),k="3i";break;case Wn:p.command(Ot(ue)&&ue.length===4,"uniform "+m,_.commandStr),k="4i";break;case jn:p.command(Ot(ue)&&ue.length===4,"uniform "+m,_.commandStr),k="4i";break}h($,".uniform",k,"(",Z,",",Ot(ue)?Array.prototype.slice.call(ue):ue,");")}continue}else Y=U.append(_,h)}else{if(!G(zs))continue;Y=h.def(L.uniforms,"[",d.id(m),"]")}C===hn?(p(!Array.isArray(Y),"must specify a scalar prop for textures"),h("if(",Y,"&&",Y,'._reglType==="framebuffer"){',Y,"=",Y,".color[0];","}")):C===dn&&(p(!Array.isArray(Y),"must specify a scalar prop for cube maps"),h("if(",Y,"&&",Y,'._reglType==="framebufferCube"){',Y,"=",Y,".color[0];","}")),p.optional(function(){function Xt(rr,Ks){_.assert(h,rr,'bad data or missing for uniform "'+m+'".  '+Ks)}function na(rr){p(!Array.isArray(Y),"must not specify an array type for uniform"),Xt("typeof "+Y+'==="'+rr+'"',"invalid type, expected "+rr)}function Zt(rr,Ks){Array.isArray(Y)?p(Y.length===rr,"must have length "+rr):Xt(L.isArrayLike+"("+Y+")&&"+Y+".length==="+rr,"invalid vector, should have length "+rr,_.commandStr)}function Ys(rr){p(!Array.isArray(Y),"must not specify a value type"),Xt("typeof "+Y+'==="function"&&'+Y+'._reglType==="texture'+(rr===Ps?"2d":"Cube")+'"',"invalid texture type",_.commandStr)}switch(C){case Ji:na("number");break;case Vn:Zt(2);break;case zn:Zt(3);break;case jn:Zt(4);break;case Zi:na("number");break;case Dn:Zt(2);break;case Gn:Zt(3);break;case Un:Zt(4);break;case ea:na("boolean");break;case qn:Zt(2);break;case Hn:Zt(3);break;case Wn:Zt(4);break;case fn:Zt(4);break;case ln:Zt(9);break;case cn:Zt(16);break;case hn:Ys(Ps);break;case dn:Ys(Af);break}});var Ue=1;switch(C){case hn:case dn:var Ke=h.def(Y,"._texture");h($,".uniform1i(",Z,",",Ke,".bind());"),h.exit(Ke,".unbind();");continue;case Ji:case ea:k="1i";break;case Vn:case qn:k="2i",Ue=2;break;case zn:case Hn:k="3i",Ue=3;break;case jn:case Wn:k="4i",Ue=4;break;case Zi:k="1f";break;case Dn:k="2f",Ue=2;break;case Gn:k="3f",Ue=3;break;case Un:k="4f",Ue=4;break;case fn:k="Matrix2fv";break;case ln:k="Matrix3fv";break;case cn:k="Matrix4fv";break}if(h($,".uniform",k,"(",Z,","),k.charAt(0)==="M"){var mt=Math.pow(C-fn+2,2),Tt=_.global.def("new Float32Array(",mt,")");Array.isArray(Y)?h("false,(",Dt(mt,function(Xt){return Tt+"["+Xt+"]="+Y[Xt]}),",",Tt,")"):h("false,(Array.isArray(",Y,")||",Y," instanceof Float32Array)?",Y,":(",Dt(mt,function(Xt){return Tt+"["+Xt+"]="+Y+"["+Xt+"]"}),",",Tt,")")}else Ue>1?h(Dt(Ue,function(Xt){return Array.isArray(Y)?Y[Xt]:Y+"["+Xt+"]"})):(p(!Array.isArray(Y),"uniform value must not be an array"),h(Y));h(");")}}function De(_,h,A,I){var G=_.shared,L=G.gl,$=G.draw,k=I.draw;function v(){var Ke=k.elements,mt,Tt=h;return Ke?((Ke.contextDep&&I.contextDynamic||Ke.propDep)&&(Tt=A),mt=Ke.append(_,Tt)):mt=Tt.def($,".",Tr),mt&&Tt("if("+mt+")"+L+".bindBuffer("+wf+","+mt+".buffer.buffer);"),mt}function w(){var Ke=k.count,mt,Tt=h;return Ke?((Ke.contextDep&&I.contextDynamic||Ke.propDep)&&(Tt=A),mt=Ke.append(_,Tt),p.optional(function(){Ke.MISSING&&_.assert(h,"false","missing vertex count"),Ke.DYNAMIC&&_.assert(Tt,mt+">=0","missing vertex count")})):(mt=Tt.def($,".",Or),p.optional(function(){_.assert(Tt,mt+">=0","missing vertex count")})),mt}var m=v();function C(Ke){var mt=k[Ke];return mt?mt.contextDep&&I.contextDynamic||mt.propDep?mt.append(_,A):mt.append(_,h):h.def($,".",Ke)}var U=C($r),K=C(Nn),Z=w();if(typeof Z=="number"){if(Z===0)return}else A("if(",Z,"){"),A.exit("}");var Y,ue;fe&&(Y=C(Bn),ue=_.instancing);var Ie=m+".type",et=k.elements&&_r(k.elements);function ke(){function Ke(){A(ue,".drawElementsInstancedANGLE(",[U,Z,Ie,K+"<<(("+Ie+"-"+hs+")>>1)",Y],");")}function mt(){A(ue,".drawArraysInstancedANGLE(",[U,K,Z,Y],");")}m?et?Ke():(A("if(",m,"){"),Ke(),A("}else{"),mt(),A("}")):mt()}function Ue(){function Ke(){A(L+".drawElements("+[U,Z,Ie,K+"<<(("+Ie+"-"+hs+")>>1)"]+");")}function mt(){A(L+".drawArrays("+[U,K,Z]+");")}m?et?Ke():(A("if(",m,"){"),Ke(),A("}else{"),mt(),A("}")):mt()}fe&&(typeof Y!="number"||Y>=0)?typeof Y=="string"?(A("if(",Y,">0){"),ke(),A("}else if(",Y,"<0){"),Ue(),A("}")):ke():Ue()}function st(_,h,A,I,G){var L=je(),$=L.proc("body",G);return p.optional(function(){L.commandStr=h.commandStr,L.command=L.link(h.commandStr)}),fe&&(L.instancing=$.def(L.shared.extensions,".angle_instanced_arrays")),_(L,$,A,I),L.compile().body}function ht(_,h,A,I){Lt(_,h),A.useVAO?A.drawVAO?h(_.shared.vao,".setVAO(",A.drawVAO.append(_,h),");"):h(_.shared.vao,".setVAO(",_.shared.vao,".targetVAO);"):(h(_.shared.vao,".setVAO(null);"),zt(_,h,A,I.attributes,function(){return!0})),vt(_,h,A,I.uniforms,function(){return!0}),De(_,h,h,A)}function kt(_,h){var A=_.proc("draw",1);Lt(_,A),Mt(_,A,h.context),Nt(_,A,h.framebuffer),Gt(_,A,h),Vt(_,A,h.state),Je(_,A,h,!1,!0);var I=h.shader.progVar.append(_,A);if(A(_.shared.gl,".useProgram(",I,".program);"),h.shader.program)ht(_,A,h,h.shader.program);else{A(_.shared.vao,".setVAO(null);");var G=_.global.def("{}"),L=A.def(I,".id"),$=A.def(G,"[",L,"]");A(_.cond($).then($,".call(this,a0);").else($,"=",G,"[",L,"]=",_.link(function(k){return st(ht,_,h,k,1)}),"(",I,");",$,".call(this,a0);"))}Object.keys(h.state).length>0&&A(_.shared.current,".dirty=true;")}function sr(_,h,A,I){_.batchId="a1",Lt(_,h);function G(){return!0}zt(_,h,A,I.attributes,G),vt(_,h,A,I.uniforms,G),De(_,h,h,A)}function kr(_,h,A,I){Lt(_,h);var G=A.contextDep,L=h.def(),$="a0",k="a1",v=h.def();_.shared.props=v,_.batchId=L;var w=_.scope(),m=_.scope();h(w.entry,"for(",L,"=0;",L,"<",k,";++",L,"){",v,"=",$,"[",L,"];",m,"}",w.exit);function C(Ie){return Ie.contextDep&&G||Ie.propDep}function U(Ie){return!C(Ie)}if(A.needsContext&&Mt(_,m,A.context),A.needsFramebuffer&&Nt(_,m,A.framebuffer),Vt(_,m,A.state,C),A.profile&&C(A.profile)&&Je(_,m,A,!1,!0),I)A.useVAO?A.drawVAO?C(A.drawVAO)?m(_.shared.vao,".setVAO(",A.drawVAO.append(_,m),");"):w(_.shared.vao,".setVAO(",A.drawVAO.append(_,w),");"):w(_.shared.vao,".setVAO(",_.shared.vao,".targetVAO);"):(w(_.shared.vao,".setVAO(null);"),zt(_,w,A,I.attributes,U),zt(_,m,A,I.attributes,C)),vt(_,w,A,I.uniforms,U),vt(_,m,A,I.uniforms,C),De(_,w,m,A);else{var K=_.global.def("{}"),Z=A.shader.progVar.append(_,m),Y=m.def(Z,".id"),ue=m.def(K,"[",Y,"]");m(_.shared.gl,".useProgram(",Z,".program);","if(!",ue,"){",ue,"=",K,"[",Y,"]=",_.link(function(Ie){return st(sr,_,A,Ie,2)}),"(",Z,");}",ue,".call(this,a0[",L,"],",L,");")}}function y(_,h){var A=_.proc("batch",2);_.batchId="0",Lt(_,A);var I=!1,G=!0;Object.keys(h.context).forEach(function(K){I=I||h.context[K].propDep}),I||(Mt(_,A,h.context),G=!1);var L=h.framebuffer,$=!1;L?(L.propDep?I=$=!0:L.contextDep&&I&&($=!0),$||Nt(_,A,L)):Nt(_,A,null),h.state.viewport&&h.state.viewport.propDep&&(I=!0);function k(K){return K.contextDep&&I||K.propDep}Gt(_,A,h),Vt(_,A,h.state,function(K){return!k(K)}),(!h.profile||!k(h.profile))&&Je(_,A,h,!1,"a1"),h.contextDep=I,h.needsContext=G,h.needsFramebuffer=$;var v=h.shader.progVar;if(v.contextDep&&I||v.propDep)kr(_,A,h,null);else{var w=v.append(_,A);if(A(_.shared.gl,".useProgram(",w,".program);"),h.shader.program)kr(_,A,h,h.shader.program);else{A(_.shared.vao,".setVAO(null);");var m=_.global.def("{}"),C=A.def(w,".id"),U=A.def(m,"[",C,"]");A(_.cond(U).then(U,".call(this,a0,a1);").else(U,"=",m,"[",C,"]=",_.link(function(K){return st(kr,_,h,K,2)}),"(",w,");",U,".call(this,a0,a1);"))}}Object.keys(h.state).length>0&&A(_.shared.current,".dirty=true;")}function q(_,h){var A=_.proc("scope",3);_.batchId="a2";var I=_.shared,G=I.current;Mt(_,A,h.context),h.framebuffer&&h.framebuffer.append(_,A),Vs(Object.keys(h.state)).forEach(function($){var k=h.state[$],v=k.append(_,A);Ot(v)?v.forEach(function(w,m){A.set(_.next[$],"["+m+"]",w)}):A.set(I.next,"."+$,v)}),Je(_,A,h,!0,!0),[Tr,Nn,Or,Bn,$r].forEach(function($){var k=h.draw[$];!k||A.set(I.draw,"."+$,""+k.append(_,A))}),Object.keys(h.uniforms).forEach(function($){var k=h.uniforms[$].append(_,A);Array.isArray(k)&&(k="["+k.join()+"]"),A.set(I.uniforms,"["+d.id($)+"]",k)}),Object.keys(h.attributes).forEach(function($){var k=h.attributes[$].append(_,A),v=_.scopeAttrib($);Object.keys(new D).forEach(function(w){A.set(v,"."+w,k[w])})}),h.scopeVAO&&A.set(I.vao,".targetVAO",h.scopeVAO.append(_,A));function L($){var k=h.shader[$];k&&A.set(I.shader,"."+$,k.append(_,A))}L(sn),L(on),Object.keys(h.state).length>0&&(A(G,".dirty=true;"),A.exit(G,".dirty=true;")),A("a1(",_.shared.context,",a0,",_.batchId,");")}function V(_){if(!(typeof _!="object"||Ot(_))){for(var h=Object.keys(_),A=0;A<h.length;++A)if(Ht.isDynamic(_[h[A]]))return!0;return!1}}function $e(_,h,A){var I=h.static[A];if(!I||!V(I))return;var G=_.global,L=Object.keys(I),$=!1,k=!1,v=!1,w=_.global.def("{}");L.forEach(function(C){var U=I[C];if(Ht.isDynamic(U)){typeof U=="function"&&(U=I[C]=Ht.unbox(U));var K=Yt(U,null);$=$||K.thisDep,v=v||K.propDep,k=k||K.contextDep}else{switch(G(w,".",C,"="),typeof U){case"number":G(U);break;case"string":G('"',U,'"');break;case"object":Array.isArray(U)&&G("[",U.join(),"]");break;default:G(_.link(U));break}G(";")}});function m(C,U){L.forEach(function(K){var Z=I[K];if(!!Ht.isDynamic(Z)){var Y=C.invoke(U,Z);U(w,".",K,"=",Y,";")}})}h.dynamic[A]=new Ht.DynamicVariable(Fn,{thisDep:$,contextDep:k,propDep:v,ref:w,append:m}),delete h.static[A]}function at(_,h,A,I,G){var L=je();L.stats=L.link(G),Object.keys(h.static).forEach(function(k){$e(L,h,k)}),Ef.forEach(function(k){$e(L,_,k)});var $=It(_,h,A,I,L);return kt(L,$),q(L,$),y(L,$),o(L.compile(),{destroy:function(){$.shader.program.destroy()}})}return{next:Ae,current:ee,procs:function(){var _=je(),h=_.proc("poll"),A=_.proc("refresh"),I=_.block();h(I),A(I);var G=_.shared,L=G.gl,$=G.next,k=G.current;I(k,".dirty=false;"),Nt(_,h),Nt(_,A,null,!0);var v;fe&&(v=_.link(fe)),E.oes_vertex_array_object&&A(_.link(E.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var w=0;w<j.maxAttributes;++w){var m=A.def(G.attributes,"[",w,"]"),C=_.cond(m,".buffer");C.then(L,".enableVertexAttribArray(",w,");",L,".bindBuffer(",qr,",",m,".buffer.buffer);",L,".vertexAttribPointer(",w,",",m,".size,",m,".type,",m,".normalized,",m,".stride,",m,".offset);").else(L,".disableVertexAttribArray(",w,");",L,".vertexAttrib4f(",w,",",m,".x,",m,".y,",m,".z,",m,".w);",m,".buffer=null;"),A(C),fe&&A(v,".vertexAttribDivisorANGLE(",w,",",m,".divisor);")}return A(_.shared.vao,".currentVAO=null;",_.shared.vao,".setVAO(",_.shared.vao,".targetVAO);"),Object.keys(pe).forEach(function(U){var K=pe[U],Z=I.def($,".",U),Y=_.block();Y("if(",Z,"){",L,".enable(",K,")}else{",L,".disable(",K,")}",k,".",U,"=",Z,";"),A(Y),h("if(",Z,"!==",k,".",U,"){",Y,"}")}),Object.keys(te).forEach(function(U){var K=te[U],Z=ee[U],Y,ue,Ie=_.block();if(Ie(L,".",K,"("),Ot(Z)){var et=Z.length;Y=_.global.def($,".",U),ue=_.global.def(k,".",U),Ie(Dt(et,function(ke){return Y+"["+ke+"]"}),");",Dt(et,function(ke){return ue+"["+ke+"]="+Y+"["+ke+"];"}).join("")),h("if(",Dt(et,function(ke){return Y+"["+ke+"]!=="+ue+"["+ke+"]"}).join("||"),"){",Ie,"}")}else Y=I.def($,".",U),ue=I.def(k,".",U),Ie(Y,");",k,".",U,"=",Y,";"),h("if(",Y,"!==",ue,"){",Ie,"}");A(Ie)}),_.compile()}(),compile:at}}function Uf(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Vf=34918,zf=34919,js=35007,jf=function(l,d){if(!d.ext_disjoint_timer_query)return null;var E=[];function j(){return E.pop()||d.ext_disjoint_timer_query.createQueryEXT()}function Q(fe){E.push(fe)}var z=[];function W(fe){var Ee=j();d.ext_disjoint_timer_query.beginQueryEXT(js,Ee),z.push(Ee),ae(z.length-1,z.length,fe)}function ie(){d.ext_disjoint_timer_query.endQueryEXT(js)}function se(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var le=[];function oe(){return le.pop()||new se}function de(fe){le.push(fe)}var ve=[];function ae(fe,Ee,ee){var Ae=oe();Ae.startQueryIndex=fe,Ae.endQueryIndex=Ee,Ae.sum=0,Ae.stats=ee,ve.push(Ae)}var me=[],D=[];function X(){var fe,Ee,ee=z.length;if(ee!==0){D.length=Math.max(D.length,ee+1),me.length=Math.max(me.length,ee+1),me[0]=0,D[0]=0;var Ae=0;for(fe=0,Ee=0;Ee<z.length;++Ee){var re=z[Ee];d.ext_disjoint_timer_query.getQueryObjectEXT(re,zf)?(Ae+=d.ext_disjoint_timer_query.getQueryObjectEXT(re,Vf),Q(re)):z[fe++]=re,me[Ee+1]=Ae,D[Ee+1]=fe}for(z.length=fe,fe=0,Ee=0;Ee<ve.length;++Ee){var pe=ve[Ee],te=pe.startQueryIndex,_e=pe.endQueryIndex;pe.sum+=me[_e]-me[te];var Me=D[te],Xe=D[_e];Xe===Me?(pe.stats.gpuTime+=pe.sum/1e6,de(pe)):(pe.startQueryIndex=Me,pe.endQueryIndex=Xe,ve[fe++]=pe)}ve.length=fe}}return{beginQuery:W,endQuery:ie,pushScopeStats:ae,update:X,getNumPendingQueries:function(){return z.length},clear:function(){E.push.apply(E,z);for(var fe=0;fe<E.length;fe++)d.ext_disjoint_timer_query.deleteQueryEXT(E[fe]);z.length=0,E.length=0},restore:function(){z.length=0,E.length=0}}},qf=16384,Hf=256,Wf=1024,Xf=34962,qs="webglcontextlost",Hs="webglcontextrestored",Ws=1,Yf=2,Kf=3;function Xs(l,d){for(var E=0;E<l.length;++E)if(l[E]===d)return E;return-1}function Qf(l){var d=nr(l);if(!d)return null;var E=d.gl,j=E.getContextAttributes(),Q=E.isContextLost(),z=cr(E,d);if(!z)return null;var W=ni(),ie=Uf(),se=z.extensions,le=jf(E,se),oe=bn(),de=E.drawingBufferWidth,ve=E.drawingBufferHeight,ae={tick:0,time:0,viewportWidth:de,viewportHeight:ve,framebufferWidth:de,framebufferHeight:ve,drawingBufferWidth:de,drawingBufferHeight:ve,pixelRatio:d.pixelRatio},me={},D={elements:null,primitive:4,count:-1,offset:0,instances:-1},X=Fo(E,se),fe=Qo(E,ie,d,ee),Ee=lf(E,se,X,ie,fe);function ee(De){return Ee.destroyBuffer(De)}var Ae=fu(E,se,fe,ie),re=mf(E,W,ie,d),pe=Gu(E,se,X,function(){Me.procs.poll()},ae,ie,d),te=Uu(E,se,X,ie,d),_e=uf(E,se,X,pe,te,ie),Me=Gf(E,W,se,X,fe,Ae,pe,_e,me,Ee,re,D,ae,le,d),Xe=vf(E,_e,Me.procs.poll,ae,j,se,X),ye=Me.next,ce=E.canvas,J=[],je=[],Ze=[],Le=[d.onDestroy],it=null;function Ye(){if(J.length===0){le&&le.update(),it=null;return}it=Xr.next(Ye),Vt();for(var De=J.length-1;De>=0;--De){var st=J[De];st&&st(ae,null,0)}E.flush(),le&&le.update()}function rt(){!it&&J.length>0&&(it=Xr.next(Ye))}function dt(){it&&(Xr.cancel(Ye),it=null)}function Pt(De){De.preventDefault(),Q=!0,dt(),je.forEach(function(st){st()})}function Bt(De){E.getError(),Q=!1,z.restore(),re.restore(),fe.restore(),pe.restore(),te.restore(),_e.restore(),Ee.restore(),le&&le.restore(),Me.procs.refresh(),rt(),Ze.forEach(function(st){st()})}ce&&(ce.addEventListener(qs,Pt,!1),ce.addEventListener(Hs,Bt,!1));function ot(){J.length=0,dt(),ce&&(ce.removeEventListener(qs,Pt),ce.removeEventListener(Hs,Bt)),re.clear(),_e.clear(),te.clear(),pe.clear(),Ae.clear(),fe.clear(),Ee.clear(),le&&le.clear(),Le.forEach(function(De){De()})}function Ft(De){p(!!De,"invalid args to regl({...})"),p.type(De,"object","invalid args to regl({...})");function st(G){var L=o({},G);delete L.uniforms,delete L.attributes,delete L.context,delete L.vao,"stencil"in L&&L.stencil.op&&(L.stencil.opBack=L.stencil.opFront=L.stencil.op,delete L.stencil.op);function $(k){if(k in L){var v=L[k];delete L[k],Object.keys(v).forEach(function(w){L[k+"."+w]=v[w]})}}return $("blend"),$("depth"),$("cull"),$("stencil"),$("polygonOffset"),$("scissor"),$("sample"),"vao"in G&&(L.vao=G.vao),L}function ht(G,L){var $={},k={};return Object.keys(G).forEach(function(v){var w=G[v];if(Ht.isDynamic(w)){k[v]=Ht.unbox(w,v);return}else if(L&&Array.isArray(w)){for(var m=0;m<w.length;++m)if(Ht.isDynamic(w[m])){k[v]=Ht.unbox(w,v);return}}$[v]=w}),{dynamic:k,static:$}}var kt=ht(De.context||{},!0),sr=ht(De.uniforms||{},!0),kr=ht(De.attributes||{},!1),y=ht(st(De),!1),q={gpuTime:0,cpuTime:0,count:0},V=Me.compile(y,kr,sr,kt,q),$e=V.draw,at=V.batch,_=V.scope,h=[];function A(G){for(;h.length<G;)h.push(null);return h}function I(G,L){var $;if(Q&&p.raise("context lost"),typeof G=="function")return _.call(this,null,G,0);if(typeof L=="function")if(typeof G=="number")for($=0;$<G;++$)_.call(this,null,L,$);else if(Array.isArray(G))for($=0;$<G.length;++$)_.call(this,G[$],L,$);else return _.call(this,G,L,0);else if(typeof G=="number"){if(G>0)return at.call(this,A(G|0),G|0)}else if(Array.isArray(G)){if(G.length)return at.call(this,G,G.length)}else return $e.call(this,G)}return o(I,{stats:q,destroy:function(){V.destroy()}})}var Et=_e.setFBO=Ft({framebuffer:Ht.define.call(null,Ws,"framebuffer")});function It(De,st){var ht=0;Me.procs.poll();var kt=st.color;kt&&(E.clearColor(+kt[0]||0,+kt[1]||0,+kt[2]||0,+kt[3]||0),ht|=qf),"depth"in st&&(E.clearDepth(+st.depth),ht|=Hf),"stencil"in st&&(E.clearStencil(st.stencil|0),ht|=Wf),p(!!ht,"called regl.clear with no buffer specified"),E.clear(ht)}function Mt(De){if(p(typeof De=="object"&&De,"regl.clear() takes an object as input"),"framebuffer"in De)if(De.framebuffer&&De.framebuffer_reglType==="framebufferCube")for(var st=0;st<6;++st)Et(o({framebuffer:De.framebuffer.faces[st]},De),It);else Et(De,It);else It(null,De)}function Nt(De){p.type(De,"function","regl.frame() callback must be a function"),J.push(De);function st(){var ht=Xs(J,De);p(ht>=0,"cannot cancel a frame twice");function kt(){var sr=Xs(J,kt);J[sr]=J[J.length-1],J.length-=1,J.length<=0&&dt()}J[ht]=kt}return rt(),{cancel:st}}function Gt(){var De=ye.viewport,st=ye.scissor_box;De[0]=De[1]=st[0]=st[1]=0,ae.viewportWidth=ae.framebufferWidth=ae.drawingBufferWidth=De[2]=st[2]=E.drawingBufferWidth,ae.viewportHeight=ae.framebufferHeight=ae.drawingBufferHeight=De[3]=st[3]=E.drawingBufferHeight}function Vt(){ae.tick+=1,ae.time=Je(),Gt(),Me.procs.poll()}function Lt(){pe.refresh(),Gt(),Me.procs.refresh(),le&&le.update()}function Je(){return(bn()-oe)/1e3}Lt();function zt(De,st){p.type(st,"function","listener callback must be a function");var ht;switch(De){case"frame":return Nt(st);case"lost":ht=je;break;case"restore":ht=Ze;break;case"destroy":ht=Le;break;default:p.raise("invalid event, must be one of frame,lost,restore,destroy")}return ht.push(st),{cancel:function(){for(var kt=0;kt<ht.length;++kt)if(ht[kt]===st){ht[kt]=ht[ht.length-1],ht.pop();return}}}}var vt=o(Ft,{clear:Mt,prop:Ht.define.bind(null,Ws),context:Ht.define.bind(null,Yf),this:Ht.define.bind(null,Kf),draw:Ft({}),buffer:function(De){return fe.create(De,Xf,!1,!1)},elements:function(De){return Ae.create(De,!1)},texture:pe.create2D,cube:pe.createCube,renderbuffer:te.create,framebuffer:_e.create,framebufferCube:_e.createCube,vao:Ee.createVAO,attributes:j,frame:Nt,on:zt,limits:X,hasExtension:function(De){return X.extensions.indexOf(De.toLowerCase())>=0},read:Xe,destroy:ot,_gl:E,_refresh:Lt,poll:function(){Vt(),le&&le.update()},now:Je,stats:ie});return d.onDone(null,vt),vt}return Qf})})(regl$1);const regl=regl$1.exports,Mouse=mouseListen();class HydraRenderer{constructor({pb:n=null,width:s=1280,height:o=720,numSources:u=4,numOutputs:c=4,makeGlobal:b=!0,autoLoop:O=!0,detectAudio:B=!0,enableStreamCapture:M=!0,canvas:xe,precision:Ce,extendTransforms:ge={}}={}){if(ArrayUtils.init(),this.pb=n,this.width=s,this.height=o,this.renderAll=!1,this.detectAudio=B,this._initCanvas(xe),this.synth={time:0,bpm:30,width:this.width,height:this.height,fps:void 0,stats:{fps:0},speed:1,mouse:Mouse,render:this._render.bind(this),setResolution:this.setResolution.bind(this),update:Re=>{},hush:this.hush.bind(this),tick:this.tick.bind(this)},b&&(window.loadScript=this.loadScript),this.timeSinceLastUpdate=0,this._time=0,Ce&&["lowp","mediump","highp"].includes(Ce.toLowerCase()))this.precision=Ce.toLowerCase();else{let Re=(/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!window.MSStream;this.precision=Re?"highp":"mediump"}if(this.extendTransforms=ge,this.saveFrame=!1,this.captureStream=null,this.generator=void 0,this._initRegl(),this._initOutputs(c),this._initSources(u),this._generateGlslTransforms(),this.synth.screencap=()=>{this.saveFrame=!0},M)try{this.captureStream=this.canvas.captureStream(25),this.synth.vidRecorder=new VideoRecorder(this.captureStream)}catch(Re){console.warn(`[hydra-synth warning]
new MediaSource() is not currently supported on iOS.`),console.error(Re)}B&&this._initAudio(),O&&rafLoop(this.tick.bind(this)).start(),this.sandbox=new EvalSandbox(this.synth,b,["speed","update","bpm","fps"])}eval(n){this.sandbox.eval(n)}getScreenImage(n){this.imageCallback=n,this.saveFrame=!0}hush(){this.s.forEach(n=>{n.clear()}),this.o.forEach(n=>{this.synth.solid(0,0,0,0).out(n)}),this.synth.render(this.o[0]),this.sandbox.set("update",n=>{})}loadScript(n=""){return new Promise((o,u)=>{var c=document.createElement("script");c.onload=function(){console.log(`loaded script ${n}`),o()},c.onerror=b=>{console.log(`error loading script ${n}`,"log-error"),o()},c.src=n,document.head.appendChild(c)})}setResolution(n,s){this.canvas.width=n,this.canvas.height=s,this.width=n,this.height=s,this.sandbox.set("width",n),this.sandbox.set("height",s),console.log(this.width),this.o.forEach(o=>{o.resize(n,s)}),this.s.forEach(o=>{o.resize(n,s)}),this.regl._refresh(),console.log(this.canvas.width)}canvasToImage(n){const s=document.createElement("a");s.style.display="none";let o=new Date;s.download=`hydra-${o.getFullYear()}-${o.getMonth()+1}-${o.getDate()}-${o.getHours()}.${o.getMinutes()}.${o.getSeconds()}.png`,document.body.appendChild(s);var u=this;this.canvas.toBlob(c=>{u.imageCallback?(u.imageCallback(c),delete u.imageCallback):(s.href=URL.createObjectURL(c),console.log(s.href),s.click())},"image/png"),setTimeout(()=>{document.body.removeChild(s),window.URL.revokeObjectURL(s.href)},300)}_initAudio(){this.synth.a=new Audio({numBins:4,parentEl:this.canvas.parentNode})}_initCanvas(n){n?(this.canvas=n,this.width=n.width,this.height=n.height):(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.imageRendering="pixelated",document.body.appendChild(this.canvas))}_initRegl(){this.regl=regl({canvas:this.canvas,pixelRatio:1}),this.regl.clear({color:[0,0,0,1]}),this.renderAll=this.regl({frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform sampler2D tex0;
      uniform sampler2D tex1;
      uniform sampler2D tex2;
      uniform sampler2D tex3;

      void main () {
        vec2 st = vec2(1.0 - uv.x, uv.y);
        st*= vec2(2);
        vec2 q = floor(st).xy*(vec2(2.0, 1.0));
        int quad = int(q.x) + int(q.y);
        st.x += step(1., mod(st.y,2.0));
        st.y += step(1., mod(st.x,2.0));
        st = fract(st);
        if(quad==0){
          gl_FragColor = texture2D(tex0, st);
        } else if(quad==1){
          gl_FragColor = texture2D(tex1, st);
        } else if (quad==2){
          gl_FragColor = texture2D(tex2, st);
        } else {
          gl_FragColor = texture2D(tex3, st);
        }

      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),tex1:this.regl.prop("tex1"),tex2:this.regl.prop("tex2"),tex3:this.regl.prop("tex3")},count:3,depth:{enable:!1}}),this.renderFbo=this.regl({frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform vec2 resolution;
      uniform sampler2D tex0;

      void main () {
        gl_FragColor = texture2D(tex0, vec2(1.0 - uv.x, uv.y));
      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),resolution:this.regl.prop("resolution")},count:3,depth:{enable:!1}})}_initOutputs(n){const s=this;this.o=Array(n).fill().map((o,u)=>{var c=new Output({regl:this.regl,width:this.width,height:this.height,precision:this.precision,label:`o${u}`});return c.id=u,s.synth["o"+u]=c,c}),this.output=this.o[0]}_initSources(n){this.s=[];for(var s=0;s<n;s++)this.createSource(s)}createSource(n){let s=new HydraSource({regl:this.regl,pb:this.pb,width:this.width,height:this.height,label:`s${n}`});return this.synth["s"+this.s.length]=s,this.s.push(s),s}_generateGlslTransforms(){var n=this;this.generator=new GeneratorFactory({defaultOutput:this.o[0],defaultUniforms:this.o[0].uniforms,extendTransforms:this.extendTransforms,changeListener:({type:s,method:o,synth:u})=>{s==="add"&&(n.synth[o]=u.generators[o],n.sandbox&&n.sandbox.add(o))}}),this.synth.setFunction=this.generator.setFunction.bind(this.generator)}_render(n){n?(this.output=n,this.isRenderingAll=!1):this.isRenderingAll=!0}tick(n,s){if(this.sandbox.tick(),this.detectAudio===!0&&this.synth.a.tick(),this.sandbox.set("time",this.synth.time+=n*.001*this.synth.speed),this.timeSinceLastUpdate+=n,!this.synth.fps||this.timeSinceLastUpdate>=1e3/this.synth.fps){if(this.synth.stats.fps=Math.ceil(1e3/this.timeSinceLastUpdate),this.synth.update)try{this.synth.update(this.timeSinceLastUpdate)}catch(o){console.log(o)}for(let o=0;o<this.s.length;o++)this.s[o].tick(this.synth.time);for(let o=0;o<this.o.length;o++)this.o[o].tick({time:this.synth.time,mouse:this.synth.mouse,bpm:this.synth.bpm,resolution:[this.canvas.width,this.canvas.height]});this.isRenderingAll?this.renderAll({tex0:this.o[0].getCurrent(),tex1:this.o[1].getCurrent(),tex2:this.o[2].getCurrent(),tex3:this.o[3].getCurrent(),resolution:[this.canvas.width,this.canvas.height]}):this.renderFbo({tex0:this.output.getCurrent(),resolution:[this.canvas.width,this.canvas.height]}),this.timeSinceLastUpdate=0}this.saveFrame===!0&&(this.canvasToImage(),this.saveFrame=!1)}}function create_fragment$4(r){let n;return{c(){n=element("canvas"),attr(n,"width",r[0]),attr(n,"height",r[1])},m(s,o){insert$2(s,n,o),r[6](n)},p(s,[o]){o&1&&attr(n,"width",s[0]),o&2&&attr(n,"height",s[1])},i:noop,o:noop,d(s){s&&detach(n),r[6](null)}}}function instance$5(r,n,s){let o,{synth:u}=n,{data:c}=n,{w:b}=n,{h:O}=n,{autoloop:B}=n,M,xe;onMount(()=>{xe=new HydraRenderer({makeGlobal:!1,autoLoop:{autoloop:B},detectAudio:!1,precision:"highp",canvas:o}),M=xe.synth}),afterUpdate(()=>u(c)(M));function Ce(ge){binding_callbacks[ge?"unshift":"push"](()=>{o=ge,s(2,o)})}return r.$$set=ge=>{"synth"in ge&&s(3,u=ge.synth),"data"in ge&&s(4,c=ge.data),"w"in ge&&s(0,b=ge.w),"h"in ge&&s(1,O=ge.h),"autoloop"in ge&&s(5,B=ge.autoloop)},[b,O,o,u,c,B,Ce]}class HydraViewer extends SvelteComponent{constructor(n){super(),init(this,n,instance$5,create_fragment$4,safe_not_equal,{synth:3,data:4,w:0,h:1,autoloop:5})}}function instance$4(r,n,s){let o,u,c;component_subscribe(r,EventStore,M=>s(5,c=M));let{ev:b,name:O,equipped:B}=n;return createEventDispatcher(),r.$$set=M=>{"ev"in M&&s(0,b=M.ev),"name"in M&&s(1,O=M.name),"equipped"in M&&s(2,B=M.equipped)},r.$$.update=()=>{r.$$.dirty&32&&s(4,o=document.elementsFromPoint(c.x,c.y).filter(M=>M.classList.contains("thumb")||M.classList.contains("range"))),r.$$.dirty&16&&s(3,u=o.length>0?o[0]:void 0),r.$$.dirty&40},[b,O,B,u,o,c]}class ICursor extends SvelteComponent{constructor(n){super(),init(this,n,instance$4,null,safe_not_equal,{ev:0,name:1,equipped:2})}}const ILever_svelte_svelte_type_style_lang="";function create_fragment$3(r){let n,s,o,u,c,b,O;return{c(){n=element("div"),s=space(),o=element("div"),u=space(),c=element("div"),attr(n,"class","round red svelte-ndsiq1"),set_style(n,"left",r[2].x+"px"),set_style(n,"top",r[2].y+"px"),set_style(n,"position","fixed"),toggle_class(n,"inactive",!r[0]),attr(o,"class","round green svelte-ndsiq1"),set_style(o,"left",r[1].x+"px"),set_style(o,"top",r[1].y+"px"),set_style(o,"position","fixed"),toggle_class(o,"inactive",!r[0]),attr(c,"class","round blue svelte-ndsiq1"),set_style(c,"left",r[3].x+"px"),set_style(c,"top",r[3].y+"px"),set_style(c,"position","fixed"),toggle_class(c,"inactive",!r[0])},m(B,M){insert$2(B,n,M),insert$2(B,s,M),insert$2(B,o,M),insert$2(B,u,M),insert$2(B,c,M),b||(O=[listen(window,"mousedown",r[13]),listen(window,"mouseup",r[14]),listen(window,"keydown",r[15]),listen(window,"keyup",r[16])],b=!0)},p(B,[M]){M&4&&set_style(n,"left",B[2].x+"px"),M&4&&set_style(n,"top",B[2].y+"px"),M&1&&toggle_class(n,"inactive",!B[0]),M&2&&set_style(o,"left",B[1].x+"px"),M&2&&set_style(o,"top",B[1].y+"px"),M&1&&toggle_class(o,"inactive",!B[0]),M&8&&set_style(c,"left",B[3].x+"px"),M&8&&set_style(c,"top",B[3].y+"px"),M&1&&toggle_class(c,"inactive",!B[0])},i:noop,o:noop,d(B){B&&detach(n),B&&detach(s),B&&detach(o),B&&detach(u),B&&detach(c),b=!1,run_all(O)}}}function instance$3(r,n,s){let o,u,c,b,O,B;component_subscribe(r,EventStore,ze=>s(11,u=ze));let{ev:M,name:xe,equipped:Ce}=n;const ge=createEventDispatcher(),[we,Re,ft,yt]=AlignmentStore({x:0,y:0,movementX:0,movementY:0},{x:0,y:0-10,movementX:0,movementY:0,mXPrev:0},{x:0,y:0-50,movementX:0,movementY:0});component_subscribe(r,we,ze=>s(2,O=ze)),component_subscribe(r,Re,ze=>s(1,b=ze)),component_subscribe(r,ft,ze=>s(3,B=ze)),component_subscribe(r,yt,ze=>s(12,c=ze)),onMount(()=>{});const Qe=ze=>{Re.set(!0)},Oe=ze=>{Re.set(!1)},Ge=ze=>{ze.shiftKey&&ft.set(!0)},tt=ze=>{ze.shiftKey||ft.set(!1)};return r.$$set=ze=>{"ev"in ze&&s(8,M=ze.ev),"name"in ze&&s(9,xe=ze.name),"equipped"in ze&&s(0,Ce=ze.equipped)},r.$$.update=()=>{r.$$.dirty&2048&&we.set(pick$1(["x","y","movementX","movementY"],u)),r.$$.dirty&4098&&s(10,o={targetPath:c?.dataset?.path,targetStore:c?.dataset?.store,cursorValue:b}),r.$$.dirty&7169&&c!=null&&ge("effect",mergeRight$1(u,o))},[Ce,b,O,B,we,Re,ft,yt,M,xe,o,u,c,Qe,Oe,Ge,tt]}class ILever extends SvelteComponent{constructor(n){super(),init(this,n,instance$3,create_fragment$3,safe_not_equal,{ev:8,name:9,equipped:0})}}function create_fragment$2(r){let n,s,o,u;return{c(){n=element("div"),s=text(r[0]),attr(n,"class","infobox instrument"),set_style(n,"top",r[2].y+20+"px"),set_style(n,"left",r[2].x+20+"px"),toggle_class(n,"inactive",!r[1])},m(c,b){insert$2(c,n,b),append(n,s),o||(u=listen(window,"click",r[5]),o=!0)},p(c,[b]){b&1&&set_data(s,c[0]),b&4&&set_style(n,"top",c[2].y+20+"px"),b&4&&set_style(n,"left",c[2].x+20+"px"),b&2&&toggle_class(n,"inactive",!c[1])},i:noop,o:noop,d(c){c&&detach(n),o=!1,u()}}}function instance$2(r,n,s){let o;component_subscribe(r,EventStore,M=>s(2,o=M));let{ev:u,name:c,equipped:b}=n;const O=createEventDispatcher(),B=M=>b?O("effect",o):M;return r.$$set=M=>{"ev"in M&&s(4,u=M.ev),"name"in M&&s(0,c=M.name),"equipped"in M&&s(1,b=M.equipped)},[c,b,o,O,u,B]}class IFix extends SvelteComponent{constructor(n){super(),init(this,n,instance$2,create_fragment$2,safe_not_equal,{ev:4,name:0,equipped:1})}}function create_fragment$1(r){let n,s,o,u;return{c(){n=element("div"),s=text(r[0]),attr(n,"class","infobox instrument"),set_style(n,"top",r[2].y+20+"px"),set_style(n,"left",r[2].x+20+"px"),toggle_class(n,"inactive",!r[1])},m(c,b){insert$2(c,n,b),append(n,s),o||(u=listen(window,"click",r[6]),o=!0)},p(c,[b]){b&1&&set_data(s,c[0]),b&4&&set_style(n,"top",c[2].y+20+"px"),b&4&&set_style(n,"left",c[2].x+20+"px"),b&2&&toggle_class(n,"inactive",!c[1])},i:noop,o:noop,d(c){c&&detach(n),o=!1,u()}}}function instance$1(r,n,s){let o,u;component_subscribe(r,EventStore,xe=>s(2,u=xe));let{ev:c,name:b,equipped:O}=n;const B=createEventDispatcher(),M=xe=>O?B("effect",o):xe;return r.$$set=xe=>{"ev"in xe&&s(5,c=xe.ev),"name"in xe&&s(0,b=xe.name),"equipped"in xe&&s(1,O=xe.equipped)},r.$$.update=()=>{r.$$.dirty&4&&s(3,o=u)},[b,O,u,o,B,c,M]}class IEraser extends SvelteComponent{constructor(n){super(),init(this,n,instance$1,create_fragment$1,safe_not_equal,{ev:5,name:0,equipped:1})}}var lib={};Object.defineProperty(lib,"__esModule",{value:!0});class RandomGenerator{constructor(n){var s,o,u;if(this.a=BigInt(13),this.b=BigInt(7),this.c=BigInt(17),n.seed<BigInt(0))throw new Error("negative seed value is not acceptable.");this.seed=n.seed,this.limit=n.limit,this.a=(s=n.a)!==null&&s!==void 0?s:BigInt(13),this.b=(o=n.b)!==null&&o!==void 0?o:BigInt(7),this.c=(u=n.c)!==null&&u!==void 0?u:BigInt(17),this.previous=this.limit^this.seed;const c=n.discards||RandomGenerator.defaultDiscards;for(let b=0;b<c;b++)this.next()}next(){return this.fetch(!0)}look(){return this.fetch(!1)}fetch(n){let s=this.previous;return s=(s^s<<this.a)%this.limit,s=(s^s>>this.b)%this.limit,s=(s^s<<this.c)%this.limit,n&&(this.previous=s),s}}var RandomGenerator_1=lib.RandomGenerator=RandomGenerator;RandomGenerator.defaultDiscards=100;function get_each_context(r,n,s){const o=r.slice();return o[67]=n[s],o}function get_each_context_1(r,n,s){const o=r.slice();return o[70]=n[s][0],o[5]=n[s][1].equipped,o[71]=n[s][1].component,o[72]=n[s][1].ev,o[73]=n[s][1].effect,o}function get_each_context_2(r,n,s){const o=r.slice();return o[70]=n[s][0],o[5]=n[s][1].equipped,o}function get_each_context_3(r,n,s){const o=r.slice();return o[78]=n[s][0],o[79]=n[s][1].a,o[80]=n[s][1].b,o[81]=n[s][1].c0,o[82]=n[s][1].c1,o[83]=n[s][1].z,o[84]=n[s][1].locked,o}function get_each_context_4(r,n,s){const o=r.slice();return o[70]=n[s].name,o[87]=n[s].preset,o[88]=n[s].synth,o[89]=n[s].inputSpace,o[90]=n[s].h_global,o[91]=n[s].h_local,o[93]=s,o}function create_each_block_4(r){let n,s,o,u,c,b,O,B,M,xe,Ce;return c=new HydraViewer({props:{synth:r[88],data:pluck$1("a",fromPairs$1(r[89])),w:150,h:150,autoloop:!1}}),{c(){n=element("label"),s=element("input"),u=space(),create_component(c.$$.fragment),b=space(),attr(s,"type","radio"),s.__value=o=r[87],s.value=s.__value,r[44][0].push(s),attr(n,"class",O="erasable willErase canvas "+r[21]),attr(n,"value",B=r[87])},m(ge,we){insert$2(ge,n,we),append(n,s),s.checked=s.__value===r[1],append(n,u),mount_component(c,n,null),append(n,b),M=!0,xe||(Ce=listen(s,"change",r[43]),xe=!0)},p(ge,we){(!M||we[0]&17&&o!==(o=ge[87]))&&(s.__value=o,s.value=s.__value),we[0]&2&&(s.checked=s.__value===ge[1]);const Re={};we[0]&17&&(Re.synth=ge[88]),we[0]&17&&(Re.data=pluck$1("a",fromPairs$1(ge[89]))),c.$set(Re),(!M||we[0]&2097152&&O!==(O="erasable willErase canvas "+ge[21]))&&attr(n,"class",O),(!M||we[0]&17&&B!==(B=ge[87]))&&attr(n,"value",B)},i(ge){M||(transition_in(c.$$.fragment,ge),M=!0)},o(ge){transition_out(c.$$.fragment,ge),M=!1},d(ge){ge&&detach(n),r[44][0].splice(r[44][0].indexOf(s),1),destroy_component(c),xe=!1,Ce()}}}function create_if_block(r){let n,s,o,u,c,b,O,B,M,xe,Ce,ge,we,Re,ft,yt,Qe,Oe,Ge,tt,ze,We,nt,gt;return{c(){n=element("ul"),s=element("li"),o=element("div"),o.textContent="Global macro",u=space(),c=element("div"),c.textContent="min",b=space(),O=element("div"),B=element("div"),Ce=space(),ge=element("div"),ge.textContent="max",we=space(),Re=element("li"),ft=element("div"),ft.textContent="Local macro",yt=space(),Qe=element("div"),Qe.textContent="min",Oe=space(),Ge=element("div"),tt=element("div"),nt=space(),gt=element("div"),gt.textContent="max",attr(o,"class","param-name"),attr(B,"class","thumb unlocked"),attr(B,"data-store","0"),attr(B,"data-path","h b"),set_style(B,"left",wasm_functions.rescale_index(r[22].toString(),r[25],r[26].length)*r[8]-3+"px"),add_render_callback(()=>r[45].call(B)),attr(O,"class","track"),add_render_callback(()=>r[46].call(O)),attr(s,"class","macro slider-grid"),attr(ft,"class","param-name"),attr(tt,"data-store","1"),attr(tt,"data-path","h a"),attr(tt,"class","thumb unlocked"),set_style(tt,"left",wasm_functions.rescale_index(r[23].toString(),r[25],r[26].length)*r[8]-3+"px"),add_render_callback(()=>r[47].call(tt)),attr(Ge,"class","track"),add_render_callback(()=>r[48].call(Ge)),attr(Re,"class","macro slider-grid"),attr(n,"class","sliders macro ")},m(lt,wt){insert$2(lt,n,wt),append(n,s),append(s,o),append(s,u),append(s,c),append(s,b),append(s,O),append(O,B),M=add_resize_listener(B,r[45].bind(B)),xe=add_resize_listener(O,r[46].bind(O)),append(s,Ce),append(s,ge),append(n,we),append(n,Re),append(Re,ft),append(Re,yt),append(Re,Qe),append(Re,Oe),append(Re,Ge),append(Ge,tt),ze=add_resize_listener(tt,r[47].bind(tt)),We=add_resize_listener(Ge,r[48].bind(Ge)),append(Re,nt),append(Re,gt)},p(lt,wt){wt[0]&104857856&&set_style(B,"left",wasm_functions.rescale_index(lt[22].toString(),lt[25],lt[26].length)*lt[8]-3+"px"),wt[0]&109052160&&set_style(tt,"left",wasm_functions.rescale_index(lt[23].toString(),lt[25],lt[26].length)*lt[8]-3+"px")},d(lt){lt&&detach(n),M(),xe(),ze(),We()}}}function create_each_block_3(r){let n,s,o=r[78].replaceAll("_"," ")+"",u,c,b,O,B=r[81]+"",M,xe,Ce,ge,we,Re,ft,yt,Qe,Oe,Ge,tt,ze,We,nt,gt,lt,wt=r[82]+"",qe,pt,bt,ct,R;return{c(){n=element("li"),s=element("div"),u=text(o),b=space(),O=element("div"),M=text(B),Ce=space(),ge=element("div"),we=element("div"),yt=space(),Qe=element("div"),Oe=space(),Ge=element("div"),gt=space(),lt=element("div"),qe=text(wt),bt=space(),attr(s,"class","param-name "),attr(s,"data-store","2"),attr(s,"data-path",c=r[78]),toggle_class(s,"unlocked",!r[84]),attr(O,"data-store","2"),attr(O,"data-path",xe=r[78]+" c0"),attr(O,"class","bound c0"),toggle_class(O,"unlocked",!r[84]),attr(we,"data-store","2"),attr(we,"data-path",Re=r[78]+" b"),attr(we,"class","range"),set_style(we,"width",r[8]*r[83]/(r[82]-r[81])+"px"),set_style(we,"left",r[8]*(r[80]-r[83]/2-r[81])/(r[82]-r[81])+"px"),add_render_callback(()=>r[49].call(we)),toggle_class(we,"unlocked",!r[84]),attr(Qe,"class","middle"),set_style(Qe,"width",2+"px"),set_style(Qe,"left",scale$1(r[81],r[82],0,r[8],r[80])+"px"),attr(Ge,"data-store","2"),attr(Ge,"data-path",tt=r[78]+" a"),attr(Ge,"class","thumb"),set_style(Ge,"left",r[8]*(r[79]-r[81])/(r[82]-r[81])+"px"),add_render_callback(()=>r[50].call(Ge)),toggle_class(Ge,"unlocked",!r[84]),attr(ge,"data-path",We=r[78]),attr(ge,"class","track"),add_render_callback(()=>r[51].call(ge)),attr(lt,"data-store","2"),attr(lt,"data-path",pt=r[78]+" c1"),attr(lt,"class","bound c1"),toggle_class(lt,"unlocked",!r[84]),attr(n,"class",ct="erasable slider-grid "+r[21]),attr(n,"data-path",R=r[78]),attr(n,"data-store","2"),toggle_class(n,"fixed",r[84])},m(g,H){insert$2(g,n,H),append(n,s),append(s,u),append(n,b),append(n,O),append(O,M),append(n,Ce),append(n,ge),append(ge,we),ft=add_resize_listener(we,r[49].bind(we)),append(ge,yt),append(ge,Qe),append(ge,Oe),append(ge,Ge),ze=add_resize_listener(Ge,r[50].bind(Ge)),nt=add_resize_listener(ge,r[51].bind(ge)),append(n,gt),append(n,lt),append(lt,qe),append(n,bt)},p(g,H){H[0]&8&&o!==(o=g[78].replaceAll("_"," ")+"")&&set_data(u,o),H[0]&8&&c!==(c=g[78])&&attr(s,"data-path",c),H[0]&8&&toggle_class(s,"unlocked",!g[84]),H[0]&8&&B!==(B=g[81]+"")&&set_data(M,B),H[0]&8&&xe!==(xe=g[78]+" c0")&&attr(O,"data-path",xe),H[0]&8&&toggle_class(O,"unlocked",!g[84]),H[0]&8&&Re!==(Re=g[78]+" b")&&attr(we,"data-path",Re),H[0]&264&&set_style(we,"width",g[8]*g[83]/(g[82]-g[81])+"px"),H[0]&264&&set_style(we,"left",g[8]*(g[80]-g[83]/2-g[81])/(g[82]-g[81])+"px"),H[0]&8&&toggle_class(we,"unlocked",!g[84]),H[0]&264&&set_style(Qe,"left",scale$1(g[81],g[82],0,g[8],g[80])+"px"),H[0]&8&&tt!==(tt=g[78]+" a")&&attr(Ge,"data-path",tt),H[0]&264&&set_style(Ge,"left",g[8]*(g[79]-g[81])/(g[82]-g[81])+"px"),H[0]&8&&toggle_class(Ge,"unlocked",!g[84]),H[0]&8&&We!==(We=g[78])&&attr(ge,"data-path",We),H[0]&8&&wt!==(wt=g[82]+"")&&set_data(qe,wt),H[0]&8&&pt!==(pt=g[78]+" c1")&&attr(lt,"data-path",pt),H[0]&8&&toggle_class(lt,"unlocked",!g[84]),H[0]&2097152&&ct!==(ct="erasable slider-grid "+g[21])&&attr(n,"class",ct),H[0]&8&&R!==(R=g[78])&&attr(n,"data-path",R),H[0]&2097160&&toggle_class(n,"fixed",g[84])},d(g){g&&detach(n),ft(),ze(),nt()}}}function create_each_block_2(r){let n,s=r[70]+"",o,u,c;function b(){return r[52](r[70])}return{c(){n=element("div"),o=text(s),toggle_class(n,"equipped",r[5])},m(O,B){insert$2(O,n,B),append(n,o),u||(c=listen(n,"mouseenter",b),u=!0)},p(O,B){r=O,B[0]&4&&s!==(s=r[70]+"")&&set_data(o,s),B[0]&4&&toggle_class(n,"equipped",r[5])},d(O){O&&detach(n),u=!1,c()}}}function create_each_block_1(r){let n,s,o;var u=r[71];function c(b){return{props:{equipped:b[5],ev:b[72],name:b[70]}}}return u&&(n=new u(c(r)),n.$on("effect",function(){is_function(r[73])&&r[73].apply(this,arguments)})),{c(){n&&create_component(n.$$.fragment),s=empty$2()},m(b,O){n&&mount_component(n,b,O),insert$2(b,s,O),o=!0},p(b,O){r=b;const B={};if(O[0]&4&&(B.equipped=r[5]),O[0]&4&&(B.ev=r[72]),O[0]&4&&(B.name=r[70]),u!==(u=r[71])){if(n){group_outros();const M=n;transition_out(M.$$.fragment,1,0,()=>{destroy_component(M,1)}),check_outros()}u?(n=new u(c(r)),n.$on("effect",function(){is_function(r[73])&&r[73].apply(this,arguments)}),create_component(n.$$.fragment),transition_in(n.$$.fragment,1),mount_component(n,s.parentNode,s)):n=null}else u&&n.$set(B)},i(b){o||(n&&transition_in(n.$$.fragment,b),o=!0)},o(b){n&&transition_out(n.$$.fragment,b),o=!1},d(b){b&&detach(s),n&&destroy_component(n,b)}}}function create_each_block(r){let n,s=r[67]+"",o,u;return{c(){n=element("option"),o=text(s),n.__value=u=r[67],n.value=n.__value},m(c,b){insert$2(c,n,b),append(n,o)},p(c,b){b[0]&16&&s!==(s=c[67]+"")&&set_data(o,s),b[0]&16&&u!==(u=c[67])&&(n.__value=u,n.value=n.__value)},d(c){c&&detach(n)}}}function create_fragment(r){let n,s,o,u,c,b,O,B,M,xe,Ce,ge,we,Re,ft,yt,Qe,Oe,Ge,tt,ze,We,nt,gt,lt,wt,qe,pt;add_render_callback(r[41]);let bt=r[4][r[0]],ct=[];for(let he=0;he<bt.length;he+=1)ct[he]=create_each_block_4(get_each_context_4(r,bt,he));const R=he=>transition_out(ct[he],1,1,()=>{ct[he]=null});let g=r[12]!="default"&&create_if_block(r),H=Object.entries(r[3]),N=[];for(let he=0;he<H.length;he+=1)N[he]=create_each_block_3(get_each_context_3(r,H,he));Ce=new HydraViewer({props:{synth:r[4][r[0]][r[1]].synth,data:r[27],w:1e3,h:1e3,autoloop:!0}});let ne=Object.entries(r[2]),be=[];for(let he=0;he<ne.length;he+=1)be[he]=create_each_block_2(get_each_context_2(r,ne,he));let Fe=Object.entries(r[2]),Pe=[];for(let he=0;he<Fe.length;he+=1)Pe[he]=create_each_block_1(get_each_context_1(r,Fe,he));const He=he=>transition_out(Pe[he],1,1,()=>{Pe[he]=null});let Ve=keys$1(r[4]),Ne=[];for(let he=0;he<Ve.length;he+=1)Ne[he]=create_each_block(get_each_context(r,Ve,he));return{c(){n=element("main"),s=element("div"),o=element("button"),o.innerHTML="<u>save</u>",u=space();for(let he=0;he<ct.length;he+=1)ct[he].c();c=space(),b=element("div"),g&&g.c(),O=space(),B=element("ul");for(let he=0;he<N.length;he+=1)N[he].c();M=space(),xe=element("div"),create_component(Ce.$$.fragment),ge=space(),we=element("div"),Re=element("div");for(let he=0;he<be.length;he+=1)be[he].c();ft=space();for(let he=0;he<Pe.length;he+=1)Pe[he].c();yt=space(),Qe=element("div"),Oe=element("select"),Ge=element("option"),Ge.textContent="Hilbert",tt=element("option"),tt.textContent="Random Walk",ze=element("option"),ze.textContent="Default",We=space(),nt=element("select");for(let he=0;he<Ne.length;he+=1)Ne[he].c();gt=space(),lt=element("button"),lt.textContent="Export",attr(o,"data-path",""),attr(s,"class","snapshots"),attr(B,"class","sliders single"),attr(b,"class","ui"),attr(xe,"class","viewport"),attr(Re,"class","palette"),set_style(Re,"left",r[24].x+"px"),set_style(Re,"top",r[24].y+"px"),toggle_class(Re,"hidden",!r[11]),set_style(we,"width","100vw"),set_style(we,"background","none"),set_style(we,"position","absolute"),set_style(we,"z-index","1000"),set_style(we,"top","0"),set_style(we,"left","0"),Ge.__value="hilbert",Ge.value=Ge.__value,tt.__value="random",tt.value=tt.__value,ze.__value="default",ze.value=ze.__value,attr(Oe,"name","UI Mode"),attr(Oe,"id","select-ui"),r[12]===void 0&&add_render_callback(()=>r[53].call(Oe)),attr(nt,"name","Presets"),attr(nt,"id","select-template"),r[0]===void 0&&add_render_callback(()=>r[54].call(nt)),attr(Qe,"class","config"),attr(n,"class","grid"),attr(n,"id","main")},m(he,Te){insert$2(he,n,Te),append(n,s),append(s,o),append(s,u);for(let ut=0;ut<ct.length;ut+=1)ct[ut].m(s,null);append(n,c),append(n,b),g&&g.m(b,null),append(b,O),append(b,B);for(let ut=0;ut<N.length;ut+=1)N[ut].m(B,null);append(n,M),append(n,xe),mount_component(Ce,xe,null),append(n,ge),append(n,we),append(we,Re);for(let ut=0;ut<be.length;ut+=1)be[ut].m(Re,null);append(we,ft);for(let ut=0;ut<Pe.length;ut+=1)Pe[ut].m(we,null);append(n,yt),append(n,Qe),append(Qe,Oe),append(Oe,Ge),append(Oe,tt),append(Oe,ze),select_option(Oe,r[12]),append(Qe,We),append(Qe,nt);for(let ut=0;ut<Ne.length;ut+=1)Ne[ut].m(nt,null);select_option(nt,r[0]),append(Qe,gt),append(Qe,lt),wt=!0,qe||(pt=[listen(window,"keydown",r[35]),listen(window,"keyup",r[36]),listen(window,"keydown",r[37]),listen(window,"keyup",r[38]),listen(window,"mousemove",r[39]),listen(window,"resize",r[40]),listen(window,"resize",r[41]),listen(o,"click",r[42]),listen(Oe,"change",r[53]),listen(nt,"change",r[54])],qe=!0)},p(he,Te){if(Te[0]&2097171){bt=he[4][he[0]];let Se;for(Se=0;Se<bt.length;Se+=1){const _t=get_each_context_4(he,bt,Se);ct[Se]?(ct[Se].p(_t,Te),transition_in(ct[Se],1)):(ct[Se]=create_each_block_4(_t),ct[Se].c(),transition_in(ct[Se],1),ct[Se].m(s,null))}for(group_outros(),Se=bt.length;Se<ct.length;Se+=1)R(Se);check_outros()}if(he[12]!="default"?g?g.p(he,Te):(g=create_if_block(he),g.c(),g.m(b,O)):g&&(g.d(1),g=null),Te[0]&2106120){H=Object.entries(he[3]);let Se;for(Se=0;Se<H.length;Se+=1){const _t=get_each_context_3(he,H,Se);N[Se]?N[Se].p(_t,Te):(N[Se]=create_each_block_3(_t),N[Se].c(),N[Se].m(B,null))}for(;Se<N.length;Se+=1)N[Se].d(1);N.length=H.length}const ut={};if(Te[0]&19&&(ut.synth=he[4][he[0]][he[1]].synth),Te[0]&134217728&&(ut.data=he[27]),Ce.$set(ut),Te[0]&4|Te[1]&4){ne=Object.entries(he[2]);let Se;for(Se=0;Se<ne.length;Se+=1){const _t=get_each_context_2(he,ne,Se);be[Se]?be[Se].p(_t,Te):(be[Se]=create_each_block_2(_t),be[Se].c(),be[Se].m(Re,null))}for(;Se<be.length;Se+=1)be[Se].d(1);be.length=ne.length}if((!wt||Te[0]&16777216)&&set_style(Re,"left",he[24].x+"px"),(!wt||Te[0]&16777216)&&set_style(Re,"top",he[24].y+"px"),(!wt||Te[0]&2048)&&toggle_class(Re,"hidden",!he[11]),Te[0]&4){Fe=Object.entries(he[2]);let Se;for(Se=0;Se<Fe.length;Se+=1){const _t=get_each_context_1(he,Fe,Se);Pe[Se]?(Pe[Se].p(_t,Te),transition_in(Pe[Se],1)):(Pe[Se]=create_each_block_1(_t),Pe[Se].c(),transition_in(Pe[Se],1),Pe[Se].m(we,null))}for(group_outros(),Se=Fe.length;Se<Pe.length;Se+=1)He(Se);check_outros()}if(Te[0]&4096&&select_option(Oe,he[12]),Te[0]&16){Ve=keys$1(he[4]);let Se;for(Se=0;Se<Ve.length;Se+=1){const _t=get_each_context(he,Ve,Se);Ne[Se]?Ne[Se].p(_t,Te):(Ne[Se]=create_each_block(_t),Ne[Se].c(),Ne[Se].m(nt,null))}for(;Se<Ne.length;Se+=1)Ne[Se].d(1);Ne.length=Ve.length}Te[0]&17&&select_option(nt,he[0])},i(he){if(!wt){for(let Te=0;Te<bt.length;Te+=1)transition_in(ct[Te]);transition_in(Ce.$$.fragment,he);for(let Te=0;Te<Fe.length;Te+=1)transition_in(Pe[Te]);wt=!0}},o(he){ct=ct.filter(Boolean);for(let Te=0;Te<ct.length;Te+=1)transition_out(ct[Te]);transition_out(Ce.$$.fragment,he),Pe=Pe.filter(Boolean);for(let Te=0;Te<Pe.length;Te+=1)transition_out(Pe[Te]);wt=!1},d(he){he&&detach(n),destroy_each(ct,he),g&&g.d(),destroy_each(N,he),destroy_component(Ce),destroy_each(be,he),destroy_each(Pe,he),destroy_each(Ne,he),qe=!1,run_all(pt)}}}function cursor_effect(r){console.log(r)}function instance(r,n,s){let o,u,c,b,O,B,M,xe,Ce,ge,we,Re=noop,ft=()=>(Re(),Re=subscribe(O,Be=>s(3,we=Be)),O),yt,Qe,Oe=noop,Ge=()=>(Oe(),Oe=subscribe(c,Be=>s(22,Qe=Be)),c),tt,ze=noop,We=()=>(ze(),ze=subscribe(b,Be=>s(23,tt=Be)),b),nt,gt,lt=noop,wt=()=>(lt(),lt=subscribe(Ce,Be=>s(58,gt=Be)),Ce),qe,pt,bt=noop,ct=()=>(bt(),bt=subscribe(B,Be=>s(25,pt=Be)),B),R,g=noop,H=()=>(g(),g=subscribe(M,Be=>s(26,R=Be)),M),N,ne=noop,be=()=>(ne(),ne=subscribe(xe,Be=>s(27,N=Be)),xe);r.$$.on_destroy.push(()=>Re()),r.$$.on_destroy.push(()=>Oe()),r.$$.on_destroy.push(()=>ze()),r.$$.on_destroy.push(()=>lt()),r.$$.on_destroy.push(()=>bt()),r.$$.on_destroy.push(()=>g()),r.$$.on_destroy.push(()=>ne()),new RandomGenerator_1({seed:BigInt(123456789),limit:BigInt(10)**BigInt(64)});let Fe="dualNoiseBW",Pe=0,He,Ve,Ne,he,Te,ut,Se,_t=6;const Jt=writable(examples);component_subscribe(r,Jt,Be=>s(57,nt=Be));const St=derived(Jt,groupBy$1(prop$1("name")));component_subscribe(r,St,Be=>s(4,yt=Be)),derived(St,Be=>Be[Pe]);const $t=writable({x:0,y:0});component_subscribe(r,$t,Be=>s(24,qe=Be));let xt={fix:{name:"fix",equipped:!1,component:IFix,ff:"willFix",effect:pn},lever:{name:"lever",equipped:!1,component:ILever,ff:"willNone",effect:Yn},cursor:{name:"none",equipped:!0,component:ICursor,ff:"willNone",effect:cursor_effect},eraser:{name:"erase",equipped:!1,component:IEraser,ff:"willErase",effect:qt}};const jt=writable(1);component_subscribe(r,jt,Be=>s(56,ge=Be));function pn(Be){let At=Be?.detail;const[nr,cr]=stringToPath(At?.target?.dataset?.path??"");At?.target?.dataset?.store==2&&O.update(modifyPath$1([nr,"locked"],not$1))}function Yn(Be){let[At,nr]=stringToPath(Be.detail.targetPath),cr=lerp(Te,Te+Ne,__,__,Be.detail.cursorValue.x);Be.detail.cursorValue.x-Te;let Dt=Be.detail.cursorValue.movementX;if(lerp(0,Ne,__,__,Dt),Be.detail.targetStore==0)c.update(Yr=>Yr+cr(0n,gt));else if(Be.detail.targetStore!=1){if(Be.detail.targetStore==2){let Yr=we[At].c1-we[At].c0;we[At].a;let Kr=Yr*Dt/Ne;console.log("m "+Dt),console.log("M "+Kr),console.log(At+" "+nr),console.log(we[At].a+Kr),O.evolve(deepObjOf([At,nr],ui=>ui+Kr)),console.log(we[At].a)}}}function qt(Be){let At=document.elementsFromPoint(Be.detail.x,Be.detail.y).filter(cr=>cr.tagName=="LABEL")[0].getAttribute("value"),nr=findIndex$1(and$1(propEq$1("preset",At),propEq$1("name",Fe)),nt);nt.filter(cr=>cr.name==Fe).length>1&&Jt.update(remove$2(nr,1))}function Wr(){let Be={name:Fe,preset:Pe,inputSpace:toPairs$1(we),h_local:tt,h_global:Qe,synth:yt[Fe][Pe].synth};console.log(toPairs$1(we)),Jt.update(insert$1(-1,Be))}function vr(Be){s(2,xt=mapObjIndexed$1((At,nr)=>modify$1("equipped",nr==Be?T$1:F$1,At),xt))}function Kn(Be){let At=clamp$1(1e-6,1,ge+scale$1(0,He*100,1e-6,1,Be.wheelDeltaY));O.evolve(map$3(always$1(objOf$1("z",multiply$1(At/ge))),we)),jt.set(At)}function yr(Be){s(2,xt[o]=assoc$1("ev",Be,xt[o]),xt)}onMount(()=>{mousemove_.thru(obs(yr)),mousedown_.thru(obs(yr)),drag_.thru(obs(yr)),asr(capture(ge,shiftdown_),mousewheel_,shiftup_).thru(obs(Kn)),s(10,Te=document.getElementsByClassName("track")[0].getBoundingClientRect().left)});const p=[[]],Qn=Be=>UIOptions.update(assoc$1("noscroll",Be.shiftKey)),Zn=Be=>UIOptions.update(assoc$1("noscroll",Be.shiftKey)),Jn=Be=>{s(11,ut=(Be.key==" "||ut)&&!0),document.getElementById("select-ui").blur(),document.getElementById("select-template").blur()},ei=Be=>s(11,ut=Be.key==" "?!1:ut||!1),ur=Be=>{ut?$t.update(At=>At):set_store_value($t,qe={x:Be.x,y:Be.y},qe),yr(Be),EventStore.update(mergeLeft$1(pick$1(["x","y","movementX","movementY"],Be)))},_n=Be=>{let At=document.getElementsByClassName("track")[0].getBoundingClientRect().left;s(10,Te=At)};function br(){s(6,He=window.innerHeight),s(7,Ve=window.innerWidth)}const vn=()=>Wr();function ti(){Pe=this.__value,s(1,Pe)}function ri(){_t=this.clientWidth,s(13,_t)}function yn(){Ne=this.clientWidth,s(8,Ne)}function Ht(){_t=this.clientWidth,s(13,_t)}function Xr(){Ne=this.clientWidth,s(8,Ne)}function bn(){he=this.clientWidth,s(9,he)}function ni(){_t=this.clientWidth,s(13,_t)}function ii(){Ne=this.clientWidth,s(8,Ne)}const ai=Be=>vr(Be);function si(){Se=select_value(this),s(12,Se)}function oi(){Fe=select_value(this),s(0,Fe)}return r.$$.update=()=>{r.$$.dirty[0]&4&&s(5,o=keys$1(pickBy$1((Be,At)=>Be.equipped,xt))[0]),r.$$.dirty[0]&36&&s(21,u=xt[o].ff),r.$$.dirty[0]&19&&Ge(s(16,[c,b,O,B,M,xe,Ce]=MuesliStore(yt[Fe][Pe]),c,We(s(15,b)),ft(s(14,O)),ct(s(20,B)),H(s(19,M)),be(s(18,xe)),wt(s(17,Ce)))),r.$$.dirty[0]&8&&toPairs$1(we)},[Fe,Pe,xt,we,yt,o,He,Ve,Ne,he,Te,ut,Se,_t,O,b,c,Ce,xe,M,B,u,Qe,tt,qe,pt,R,N,Jt,St,$t,jt,Wr,vr,yr,Qn,Zn,Jn,ei,ur,_n,br,vn,ti,p,ri,yn,Ht,Xr,bn,ni,ii,ai,si,oi]}class App extends SvelteComponent{constructor(n){super(),init(this,n,instance,create_fragment,safe_not_equal,{},null,[-1,-1,-1,-1])}}let wasm_functions={forward:void 0,inverse:void 0,rescale_index:void 0};async function loadApp(){await init$1(),wasm_functions.forward=hilbert_axes_wasm_from_str,wasm_functions.inverse=hilbert_index_wasm_to_str,wasm_functions.rescale_index=rescale_hilbert_from_str,new App({target:document.getElementById("app")})}loadApp()});export default Jf();
